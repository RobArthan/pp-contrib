=TEX
% TQtemplate.tex
\documentstyle[hol1,11pt,TQ]{article}
\def\Hide#1{}
\def\Bool{``$\it{:}bool\,$''}
\makeindex
\TPPproject{DRA FRONT END FILTER PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Proof of Security (IIb)}  %% Mandatory field
\TPPref{DS/FMU/FEF/011}  %% Mandatory field
\def\SCCSversion{$Revision$
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{92/10/20
}}  %% Mandatory field (with sensible default)
\TPPstatus{Draft}			%% Mandatory field
\TPPtype{Specification}
\TPPkeywords{}
\TPPauthor{G.~M.~Prout & WIN01}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthorisation{R.B.~Jones & HAT Manager}
\TPPabstract{This document provides a formal proof for two of the conjuncts
of the security property
on the relationship between $hide$ and $updateState$ for the
DRA front end filter project RSRE 1C/6130.}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
	HAT FEF File \\
	Simon Wiseman
}}
%\TPPclass{CLASSIFICATION}
\newfont{\icllogo}{icllogo50}
\def\TPPheadlhs{$\vcenter{\halign{##\cr\icllogo ICL\cr}}$}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}

\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

%\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\newpage
\section {DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu,fef}

\subsection{Changes History}
\begin{description}
\item[Issue \SCCSversion(\FormatDate{$Date$
})] Axioms for $query\_type$ etc. replaced by theorems.
\end{description}

\subsection{Changes Forecast}
Changes  may be necessary  as a result of issues raised
during  the transcription of the specification.
\pagebreak
\section{GENERAL}
\subsection{Scope}
This document provides a formal proof  that the components $hide$ and $updateState$ 
satisfy some of their critical 
requirements, as specified in 
the proof strategy \cite{DS/FMU/FEF/007}. It constitutes part of deliverable D6 
of work package 1a, as given
in section 7 of the Secure Database Technical Proposal, \cite{DS/FMU/017}.

\subsection{Introduction}

This document is a proof script which provides a formal proof which contributes to the proof
 of the second conjunct of $Lemma1$,
the requirement on the critical components  $hide$ and $updateState$, described in the proof strategy document \cite{DS/FMU/FEF/007}.

{\bf Lemma1}
=GFT 
	?ô 	hide  secureHide ± (hide,updateState)  secureUpdate
=TEX

In this document, we give proofs of the third and fourth conjuncts of $secureUpdate$:
=GFT
	?ô 	µ c s e · Fst(Snd(updateState (c,e,s))) = c
=TEX

and

=GFT
	?ô 	µ c s‰1 s‰2 e · hide (c, s‰1) = hide (c, s‰2)
			 ´ Snd (updateState (c, e, s‰1)) = Snd (updateState (c, e, s‰2))
=TEX


\section{PRELIMINARIES}
The following \Product{} instructions set up the new theory $fef011$.

=SML 
open_theory "fef010";
new_theoryÛ"fef011"Ý;
push_merge_pcs["hol","fefhol","'pair1"] ;
=TEX

\section{CONSISTENCY PROOFS}
=SML
val ÛInsertEffect_defÝ = get_spec¬InsertEffect®;
push_consistency_goal¬destInsert®;
a(rewrite_tac[InsertEffect_def]);
a(¶_tac¬(OutL,OutL o OutR,OutL o OutR o OutR,OutR o OutR o OutR)®);
a(rewrite_tac[]);
save_consistency_thm¬destInsert®(pop_thm());
val ÛdestInsert_defÝ = get_spec¬destInsert®;
=TEX
=GFT HOL output
destInsert_def = 
ô µ i d u s
  · destInsert (InsertEffect i) = i
      ± destDelete (DeleteEffect d) = d
      ± destUpdate (UpdateEffect u) = u
      ± destSelect (SelectEffect s) = s
=TEX

=SML
push_consistency_goal¬tabFromEffect®;
a(rewrite_tac[get_spec¬InsertEffect®]);
a(¶_tac¬Ì x : Effect ·
	if IsL x
	then Fst(OutL x)
	else if IsL(OutR x)
	then Fst(OutL(OutR x))
	else Fst(OutL(OutR(OutR x)))®);
a(rewrite_tac[sum_clauses]);
save_consistency_thm¬tabFromEffect®(pop_thm());
val ÛtabFromEffect_defÝ = get_spec¬tabFromEffect®;
=TEX
=GFT HOL output
tabFromEffect_def = 
ô µ i d u
  · tabFromEffect (InsertEffect i) = Fst i
      ± tabFromEffect (DeleteEffect d) = Fst d
      ± tabFromEffect (UpdateEffect u) = Fst u
=TEX

=SML
push_consistency_goal¬giveVal®;
a(¶_tac¬InL,InR,OutL,OutR,IsL,IsR®);
a(rewrite_tac[sum_clauses]);
a(REPEAT strip_tac THEN_TRY asm_rewrite_tac[]);
a(¶_tac¬OutL ve®THEN asm_rewrite_tac[]);
a(¶_tac¬OutR ve®THEN asm_rewrite_tac[]);
save_consistency_thm¬giveVal®(pop_thm());
val ÛgiveVal_defÝ = get_spec¬giveVal®;
=TEX
=GFT HOL output
giveVal_def = 
ô µ v e ve
  · giveVal v = InL v
      ± giveError e = InR e
      ± destVal (giveVal v) = v
      ± destError (giveError e) = e
      ± (isVal ve ¤ (¶ v‰1· ve = giveVal v‰1))
      ± (isError ve ¤ (¶ e‰1· ve = giveError e‰1))
=TEX
\subsection{Retrieving the Remaining Definitions of Constants}

=SML
val ÛchangeSpec_defÝ = conv_rule(MAP_C let_conv)(get_spec¬changeSpec®);
val ÛreplaceRows_defÝ = get_spec¬replaceRows®;
val ÛupdateQuery_defÝ = get_spec¬updateQuery®;
val ÛisInsert_defÝ = get_spec¬isInsert®;
val ÛisDelete_defÝ = get_spec¬isDelete®;
val ÛisUpdate_defÝ = get_spec¬isUpdate®;
val ÛisSelect_defÝ = get_spec¬isSelect®;
val ÛgetTable_defÝ = get_spec¬getTable®;
val ÛtabExists_defÝ = get_spec¬tabExists®;
val ÛcolDefaults_defÝ = get_spec¬colDefaults®;
val ÛvisibleCols_defÝ = get_spec¬visibleCols®;
val ÛrevealRow_defÝ = conv_rule(MAP_C let_conv)(get_spec¬revealRow®);
val ÛinsertQuery_defÝ = conv_rule(MAP_C let_conv)(get_spec¬insertQuery®);
val ÛupdateRow_defÝ = conv_rule(MAP_C let_conv)(get_spec¬updateRow®);
val ÛupdateField_defÝ = get_spec¬updateField®;
val ÛupdateStateR_defÝ = conv_rule(MAP_C let_conv)(get_spec¬updateStateR®);
val ÛupdateState_defÝ = conv_rule(MAP_C let_conv)(get_spec¬updateState®);
=TEX

\section{AUXILIARY THEOREMS}
=SML
val ÛgiveVal_eq_thmÝ = save_thm("giveVal_eq_thm",prove_rule[giveVal_def]
	¬µ x y · giveVal x = giveVal y ¤ x = y®);
val ÛgiveError_eq_thmÝ = save_thm("giveError_eq_thm",prove_rule[giveVal_def]
	¬µ x y · giveError x = giveError y ¤ x = y®);
val Û³isError_giveVal_thmÝ = save_thm("³isError_giveVal_thm",
	prove_rule[get_spec¬isError®]¬µ v · ³isError(giveVal v)®);
val Û³isVal_giveError_thmÝ = save_thm("³isVal_giveError_thm",
	prove_rule[get_spec¬isError®]¬µ e · ³isVal(giveError e)®);
val ÛisVal_defÝ = all_µ_intro(nth 4 (strip_±_rule (all_µ_elim giveVal_def)));
val ÛisError_defÝ = all_µ_intro(nth 5 (strip_±_rule (all_µ_elim giveVal_def)));
=TEX
=GFT HOL output
giveVal_eq_thm = ô µ x y· giveVal x = giveVal y ¤ x = y
giveError_eq_thm = ô µ x y· giveError x = giveError y ¤ x = y
³isError_giveVal_thm = ô µ v· ³ isError (giveVal v)
³isVal_giveError_thm = ô µ e· ³ isVal (giveError e)
isVal_def = ô µ ve· isVal ve ¤ (¶ v‰1· ve = giveVal v‰1)
isError_def = ô µ ve· isError ve ¤ (¶ e‰1· ve = giveError e‰1)
=TEX
=SML
val thm1 = (push_goal([],¬µ x y z · ³((z = InL x) ± (z = InR y))®);
a(REPEAT strip_tac THEN asm_rewrite_tac[]);
pop_thm());
=TEX
=SML
push_goal([],¬µq· (isInsert q ± ³(isDelete q ² isUpdate q ² isSelect q))
	² (isDelete q ± ³(isInsert q ² isUpdate q ² isSelect q))		
	² (isUpdate q ± ³(isInsert q ² isDelete q ² isSelect q))
	² (isSelect q ± ³(isInsert q ² isDelete q ² isUpdate q))®);
a(rewrite_tac[isInsert_def,InsertEffect_def]);
a(µ_tac THEN strip_tac THEN strip_tac);
=TEX
=SML
(* *** Goal "1" *** *)
a(prove_tac[] THEN_TRY asm_rewrite_tac[]);
(* *** Goal "1.1" *** *)
a(strip_asm_tac(µ_elim¬q®sum_cases_thm));
(* *** Goal "1.1.1" *** *)
a(asm_fc_tac[]);
(* *** Goal "1.1.2" *** *)
a(strip_asm_tac(µ_elim¬z®sum_cases_thm));
(* *** Goal "1.1.2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.1.2.2" *** *)
a(strip_asm_tac(µ_elim¬z'®sum_cases_thm));
(* *** Goal "1.1.2.2.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN  asm_rewrite_tac[]);
(* *** Goal "1.1.2.2.2" *** *)
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "1.2" *** *)
a(asm_fc_tac[]);
(* *** Goal "1.3" *** *)
a(asm_fc_tac[]);
(* *** Goal "1.4" *** *)
a(asm_fc_tac[]);
(* *** Goal "1.5" *** *)
a(asm_fc_tac[]);
(* *** Goal "1.6" *** *)
a(asm_fc_tac[]);
(* *** Goal "1.7" *** *)
a(asm_fc_tac[]);
(* *** Goal "1.8" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.9" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.10" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2" *** *)
a(asm_prove_tac[] THEN_TRY asm_rewrite_tac[]);
(* *** Goal "2.1" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "2.2" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "2.3" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "2.4" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "2.5" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "2.6" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
=TEX
=SML
(* *** Goal "2.7" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "2.8" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "2.9" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.10" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.11" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.12" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3" *** *)
a(asm_prove_tac[] THEN_TRY asm_rewrite_tac[]);
(* *** Goal "3.1" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "3.2" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "3.3" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "3.4" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "3.5" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "3.6" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
=TEX
=SML
(* *** Goal "3.7" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "3.8" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "3.9" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "3.10" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "3.11" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "3.12" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "4" *** *)
a(asm_prove_tac[] THEN_TRY asm_rewrite_tac[]);
(* *** Goal "4.1" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "4.2" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "4.3" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "4.4" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "4.5" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "4.6" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "4.7" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "4.8" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
val Ûquery_typeÝ = save_pop_thm"query_type";
=TEX
=GFT HOL output
query_type = ô µ q
  · isInsert q ± ³ (isDelete q ² isUpdate q ² isSelect q)
      ² isDelete q ± ³ (isInsert q ² isUpdate q ² isSelect q)
      ² isUpdate q ± ³ (isInsert q ² isDelete q ² isSelect q)
      ² isSelect q ± ³ (isInsert q ² isDelete q ² isUpdate q)
=TEX

=SML
push_goal([],¬µu· (isItem u ± ³(isClass u ² isData u))
	² (isClass u ± ³(isItem u ² isData u))		
	² (isData u ± ³(isItem u  ² isClass u))®);
a(rewrite_tac[get_spec¬isItem®,get_spec¬ItemUpdate®]);
a(prove_tac[] THEN_TRY asm_rewrite_tac[]);
(* *** Goal "1" *** *)
a(strip_asm_tac(µ_elim¬u®sum_cases_thm));
(* *** Goal "1.1" *** *)
a(asm_fc_tac[]);
(* *** Goal "1.2" *** *)
a(strip_asm_tac(µ_elim¬z®sum_cases_thm));
(* *** Goal "1.2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2" *** *)
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "3" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
(* *** Goal "4" *** *)
a(fc_tac[thm1] THEN asm_fc_tac[]);
val Ûupdate_typeÝ = save_pop_thm"update_type";
=TEX
=GFT HOL output
update_type = 
ô µ u
  · isItem u ± ³ (isClass u ² isData u)
      ² isClass u ± ³ (isItem u ² isData u)
      ² isData u ± ³ (isItem u ² isClass u)
=TEX

=SML
push_goal([],¬µv· (isVal v ± ³ isError v)
	² (isError v ± ³ isVal v)®);
a(rewrite_tac[isVal_def,isError_def,giveVal_def]);
a(REPEAT strip_tac THEN_TRY asm_rewrite_tac[]);
(* *** Goal "1" *** *)
a(fc_tac[sum_cases_thm]);
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(¶_tac¬e‰1®THEN asm_rewrite_tac[]);
val Ûval_or_error_typeÝ = save_pop_thm"val_or_error_type";
=TEX
=GFT HOL output
val_or_error_type = 
ô µ v· isVal v ± ³ isError v ² isError v ± ³ isVal v
=TEX


\section{PROOF OF SECURITY OF CRITICAL COMPONENTS}
\subsection{Proof of Conjunct 4}
=SML
push_goal([],¬µ c s e · Fst(Snd(updateState (c,e,s))) = c®);
a(REPEAT µ_tac);
a(LEMMA_T¬e = (Fst e,Snd e)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],rewrite_tac[updateStateR_def,updateState_def]]);
a(EVERY[strip_asm_tac(µ_elim ¬Fst e® query_type),
	asm_rewrite_tac[],
	cases_tac¬³ Snd e = []®,
	asm_rewrite_tac[],
	cases_tac¬tabExists c (tabFromEffect (Fst e)) (repState s)®,
	asm_rewrite_tac[],
	cases_tac¬c dominates TS_class (getTable (tabFromEffect (Fst e)) (repState s))®,
	asm_rewrite_tac[]]);
val Ûconjunct4Ý = save_pop_thm"conjunct4";
=TEX
=GFT HOL output
conjunct4 = ô µ c s e· Fst (Snd (updateState (c, e, s))) = c
=TEX
\subsection{Conjunct 3}
\subsubsection{Auxiliary Lemmas}
=SML
push_goal([],¬µ c s · isState(hideR(c, repState s))®);
a(REPEAT strip_tac);
a(strip_asm_tac (µ_elim¬s®isState_lemma));
a(strip_asm_tac (list_µ_elim[¬c®,¬repState s®]hideR_lemma));
val ÛisState_lemma3Ý = save_pop_thm"isState_lemma3";
=TEX
=GFT HOL output
isState_lemma3 = ô µ c s· isState (hideR (c, repState s))
=TEX
=SML
push_goal([],¬µ c s‰1 s‰2 · 
	hide(c,s‰1) = hide(c,s‰2) 
	¤ 
	hideR (c, repState s‰1) = hideR (c, repState s‰2)®);
a(rewrite_tac[hide_def,rewrite_rule[isState_lemma3]
	(list_µ_elim[¬hideR (c, repState s‰1)®,¬hideR (c, repState s‰2)®]isState_lemma2)]);
val Ûhide_eq_lemmaÝ = save_pop_thm"hide_eq_lemma";
=TEX
=GFT HOL output
hide_eq_lemma = 
ô µ c s‰1 s‰2
  · hide (c, s‰1) = hide (c, s‰2)
      ¤ hideR (c, repState s‰1) = hideR (c, repState s‰2) : THM
=TEX
=SML
push_goal([],¬µ c s‰1 s‰2
        · hide (c, s‰1) = hide (c, s‰2) 
	´ µ i ·  tabExists c i (repState s‰1) ¤ tabExists c i (repState s‰2)®);
a(rewrite_tac[tabExists_def,hideR_def,hide_eq_lemma,’_thm,
	r_»_r_thm,rel_ext_clauses,graph_thm]);
a(REPEAT µ_tac);
a(strip_asm_tac (rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰1®isState_lemma)));
a(strip_asm_tac (rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰2®isState_lemma)));
a(DROP_NTH_ASM_T 4  ante_tac THEN DROP_NTH_ASM_T 2 ante_tac 
	THEN rewrite_tac[ª_def,get_spec¬IdeL®,get_spec¬DirectoryS®,¡_def,¸_def,
	get_spec¬Universe®,dom_def,’_thm,r_»_r_thm,graph_thm,rel_ext_clauses,get_spec¬$ð®] 
	THEN strip_tac THEN strip_tac THEN strip_tac);
a(µ_tac THEN ¤_T strip_asm_tac);
=TEX
=SML
(* *** Goal "1" *** *)
a(strip_asm_tac(list_µ_elim[¬repState s‰1®,¬Front i®,¬y®]at_thm));
a(DROP_NTH_ASM_T 6 (asm_tac o list_µ_elim[¬Front i®,¬cleanDirectory c y®]));
a(LEMMA_T¬¶ z
             · (c dominates Dir_exist z ± (Front i, z)  repState s‰1)
                 ± cleanDirectory c y = cleanDirectory c z®asm_tac);
(* *** Goal "1.1" *** *)
a(¶_tac¬y® THEN  asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(±_tac THEN_LIST[¶_tac¬z®THEN asm_rewrite_tac[],
	strip_asm_tac(list_µ_elim[¬repState s‰2®,¬Front i®,¬z®]at_thm)]);
a(DROP_NTH_ASM_T 8 ante_tac THEN DROP_NTH_ASM_T 7 ante_tac 
	THEN asm_rewrite_tac[]);
a(REPEAT ´_tac);
a(DROP_NTH_ASM_T 4 ante_tac THEN 
	asm_rewrite_tac[cleanDirectory_def,dir_components,get_spec¬MkDirectory®] 
	THEN strip_tac);
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[] THEN strip_tac 
	THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 10 ante_tac THEN asm_rewrite_tac[] THEN strip_tac);
a(DROP_NTH_ASM_T 12 (strip_asm_tac o list_µ_elim[¬Front i®,¬y®]));
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
a(rewrite_tac[rel_ext_clauses,graph_thm,r_»_r_thm] 
	THEN ´_T (asm_tac o list_µ_elim[¬Last i®,¬cleanTable c y'®]));
a(LEMMA_T¬¶ z· (Last i, z)  Dir_tables y ± cleanTable c y' = cleanTable c z®asm_tac);
=TEX
=SML
(* *** Goal "1.2.1" *** *)
a(¶_tac¬y'® THEN  asm_rewrite_tac[]);
(* *** Goal "1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(strip_asm_tac(list_µ_elim[¬repState s‰2®,¬Front i®,¬y®]at_thm));
a(DROP_NTH_ASM_T 6 (asm_tac o list_µ_elim[¬Front i®,¬cleanDirectory c y®]));
a(LEMMA_T¬¶ z
             · (c dominates Dir_exist z ± (Front i, z)  repState s‰2)
                 ± cleanDirectory c y = cleanDirectory c z®asm_tac);
(* *** Goal "2.1" *** *)
a(¶_tac¬y® THEN  asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(±_tac THEN_LIST[¶_tac¬z®THEN asm_rewrite_tac[],
	strip_asm_tac(list_µ_elim[¬repState s‰1®,¬Front i®,¬z®]at_thm)]);
a(DROP_NTH_ASM_T 8 ante_tac THEN DROP_NTH_ASM_T 7 ante_tac 
	THEN asm_rewrite_tac[]);
a(REPEAT ´_tac);
a(DROP_NTH_ASM_T 4 ante_tac THEN 
	asm_rewrite_tac[cleanDirectory_def,dir_components,get_spec¬MkDirectory®] 
	THEN strip_tac);
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[] THEN strip_tac 
	THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 10 ante_tac THEN asm_rewrite_tac[] THEN strip_tac);
a(DROP_NTH_ASM_T 13 (strip_asm_tac o list_µ_elim[¬Front i®,¬y®]));
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
a(rewrite_tac[rel_ext_clauses,graph_thm,r_»_r_thm] 
	THEN ´_T (asm_tac o list_µ_elim[¬Last i®,¬cleanTable c y'®]));
a(LEMMA_T¬¶ z· (Last i, z)  Dir_tables y ± cleanTable c y' = cleanTable c z®asm_tac);
(* *** Goal "2.2.1" *** *)
a(¶_tac¬y'® THEN  asm_rewrite_tac[]);
(* *** Goal "2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
val ÛtabExists_lemmaÝ = save_pop_thm"tabExists_lemma";
=TEX
=GFT HOL output
tabExists_lemma = 
ô µ c s‰1 s‰2
  · hide (c, s‰1) = hide (c, s‰2)
      ´ (µ i· tabExists c i (repState s‰1) ¤ tabExists c i (repState s‰2))
=TEX

=SML
push_goal([],¬µ c t‰1 t‰2 s‰1 s‰2 i · (c dominates TS_class t‰1 ± c dominates TS_class t‰2 
	± cleanTable c t‰1 = cleanTable c t‰2)
	´ Snd (insertQuery (c, i, s‰1,t‰1)) = Snd (insertQuery (c, i, s‰2,t‰2))®);
=TEX
=SML
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN asm_rewrite_tac
	[cleanTable_def,get_spec¬MkTableSpec®,tab_components] THEN strip_tac);
a(lemma_tac¬colDefaults c t‰1 = colDefaults c t‰2®);
(* *** Goal "1" *** *)
a(asm_rewrite_tac[ext_thm,colDefaults_def,visibleCols_def]);
(* *** Goal "2" *** *)
a(LEMMA_T¬i = (Fst i,Snd i)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],asm_rewrite_tac[insertQuery_def]]);
a(cases_tac¬³ Elems
                           (Map
                               (MkRow c o colDefaults c t‰2)
                               (Snd i))
                         € RowS®THEN asm_rewrite_tac[]);
val ÛcleanTable_insertQuery_lemmaÝ = save_pop_thm"cleanTable_insertQuery_lemma";
=TEX
=GFT HOL output
cleanTable_insertQuery_lemma =
ô µ c t‰1 t‰2 s‰1 s‰2 i
  · c dominates TS_class t‰1
        ± c dominates TS_class t‰2
        ± cleanTable c t‰1 = cleanTable c t‰2
      ´ Snd (insertQuery (c, i, s‰1, t‰1))
        = Snd (insertQuery (c, i, s‰2, t‰2))
=TEX
=SML
push_goal([],¬µ c t‰1 t‰2 · cleanTable c t‰1 = cleanTable c t‰2 ´ 	
	((c dominates (TS_class t‰1) ± c dominates (TS_class t‰2))
	´ updateRow c (TS_class t‰1) = updateRow c (TS_class t‰2))®);
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 3 ante_tac);
a(asm_rewrite_tac[cleanTable_def,tab_components,get_spec¬MkTableSpec®]
	THEN strip_tac THEN asm_rewrite_tac[]);
val ÛupdateRow_lemmaÝ = save_pop_thm"updateRow_lemma";
=TEX
=GFT HOL output
updateRow_lemma = 
ô µ c t‰1 t‰2
  · cleanTable c t‰1 = cleanTable c t‰2
      ´ c dominates TS_class t‰1 ± c dominates TS_class t‰2
      ´ updateRow c (TS_class t‰1) = updateRow c (TS_class t‰2)
=TEX


=SML
push_goal([],¬µ c tc d‰1 d‰2 u · 
	(isError(updateField c tc (u,d‰1)) ± replaceData c d‰1 = replaceData c d‰2)
	´  updateField c tc (u,d‰1) = updateField c tc (u,d‰2)®);
a(REPEAT strip_tac);
a(POP_ASM_T (ante_tac o rewrite_rule[replaceData_def]));
a(cases_tac¬c dominates Dat_class d‰1® THEN 
	cases_tac¬c dominates Dat_class d‰2® THEN asm_rewrite_tac[]THEN strip_tac);
(* *** Goal "1" *** *)
a(asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(POP_ASM_T(strip_asm_tac o rewrite_rule[get_spec¬MkData®,data_components]));
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3" *** *)
a(POP_ASM_T(strip_asm_tac o rewrite_rule[get_spec¬MkData®,data_components]));
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "4" *** *)
a(POP_ASM_T(strip_asm_tac o rewrite_rule[get_spec¬MkData®,data_components]));
a(DROP_NTH_ASM_T 4 ante_tac THEN rewrite_tac[updateField_def]);
a(cases_tac¬c = tc®THEN asm_rewrite_tac[]);
a(cases_tac¬isItem u®THEN asm_rewrite_tac[]);
a(cases_tac¬isClass u®THEN asm_rewrite_tac[]);
a(cases_tac¬destClass u dominates Dat_class d‰2®
	THEN asm_rewrite_tac[³isError_giveVal_thm]);
val ÛisError_updateField_lemmaÝ = save_pop_thm"isError_updateField_lemma";
=TEX
=GFT HOL output
isError_updateField_lemma =
ô µ c tc d‰1 d‰2 u
  · isError (updateField c tc (u, d‰1))
        ± replaceData c d‰1 = replaceData c d‰2
      ´ updateField c tc (u, d‰1) = updateField c tc (u, d‰2)
=TEX

=SML
push_goal([],¬µ c r‰1 r‰2 t u ·
	(isError (updateRow c (TS_class t) (u, r‰1)) ± 
	isError (updateRow c (TS_class t) (u, r‰2))
	± cleanRow c (Snd (cleanColCons c t)) r‰1
             = cleanRow c (Snd (cleanColCons c t)) r‰2 ±
	Dom u € {n |¶ c'· c'  visibleCols c t ± CS_posn c' = n})
	´ updateRow c (TS_class t) (u,r‰1) = updateRow c (TS_class t) (u,r‰2)®);
a(REPEAT strip_tac);
a(POP_ASM_T (strip_asm_tac o rewrite_rule[sets_ext_clauses,visibleCols_def,dom_def]));
a(DROP_NTH_ASM_T 2 (strip_asm_tac o rewrite_rule
	[cleanRow_def,get_spec¬MkRow®,row_components]));
a(DROP_NTH_ASM_T 5 ante_tac THEN DROP_NTH_ASM_T 4 ante_tac 
	THEN rewrite_tac[updateRow_def]);
=TEX
=SML
a(cases_tac¬³ u  Functional® THEN asm_rewrite_tac[]);
a(cases_tac¬((RelCombine u (R_data r‰1)
                                     » Graph (updateField c (TS_class t)))
                                   ’ {x|isError x})
                                 » Graph destError = {}®
	THEN cases_tac¬((RelCombine u (R_data r‰2)
                                     » Graph (updateField c (TS_class t)))
                                   ’ {x|isError x})
                                 » Graph destError = {}®
	THEN asm_rewrite_tac[³isError_giveVal_thm,giveError_eq_thm]);
a(´_T (fn _ => id_tac) THEN ´_T (fn _ => id_tac) THEN 
	POP_ASM_T (fn _ => id_tac) THEN POP_ASM_T (fn _ => id_tac));
=TEX
=SML
a(lemma_tac¬((RelCombine u (R_data r‰1)
                           » Graph (updateField c (TS_class t)))
                         ’ {x|isError x})
                       » Graph destError
             = ((RelCombine u (R_data r‰2)
                           » Graph (updateField c (TS_class t)))
                         ’ {x|isError x})
                       » Graph destError®);
=TEX
=SML
(* *** Goal "1" *** *)
a(rewrite_tac[rel_ext_clauses,r_»_r_thm,rel_combine_def,graph_thm,’_thm]);
a(REPEAT strip_tac);
(* *** Goal "1.1" *** *)
a(DROP_NTH_ASM_T 9 (asm_tac o µ_elim¬x®));
a(LEMMA_T¬¶y· (x, y)  u®asm_tac);
(* *** Goal "1.1.1" *** *)
a(¶_tac¬Fst z'® THEN asm_rewrite_tac[]);
(* *** Goal "1.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac 
	THEN ´_T asm_tac);
a(DROP_NTH_ASM_T 8 (asm_tac o rewrite_rule[rel_ext_clauses,filterRow_def,
	r_»_r_thm,graph_thm,ò_thm]));
a(POP_ASM_T (asm_tac o list_µ_elim[¬x®,¬replaceData c (Snd z')®]));
a(LEMMA_T¬¶z· ((¶ c'· c'  Snd (cleanColCons c t) ± CS_posn c' = x)
                   ± (x, z)  R_data r‰1)
                 ± replaceData c (Snd z') = replaceData c z®asm_tac); 
(* *** Goal "1.1.2.1" *** *)
a(¶_tac¬Snd z'®THEN asm_rewrite_tac[]);
(* *** Goal "1.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z® THEN asm_rewrite_tac[]);
a(¶_tac¬(Fst z',z'')® THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 10 ante_tac THEN asm_rewrite_tac[]);
a(LEMMA_T¬z' = (Fst z',Snd z')® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],´_tac]);
a(strip_asm_tac (list_µ_elim[¬c®,¬TS_class t®,¬Snd z'®,¬z''®,¬Fst z'®]
	isError_updateField_lemma));
a(asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 9 (asm_tac o µ_elim¬x®));
a(LEMMA_T¬¶y· (x, y)  u®asm_tac);
(* *** Goal "1.2.1" *** *)
a(¶_tac¬Fst z'® THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac 
	THEN ´_T asm_tac);
a(DROP_NTH_ASM_T 8 (asm_tac o rewrite_rule[rel_ext_clauses,filterRow_def,
	r_»_r_thm,graph_thm,ò_thm]));
a(POP_ASM_T (asm_tac o list_µ_elim[¬x®,¬replaceData c (Snd z')®]));
a(LEMMA_T¬¶z· ((¶ c'· c'  Snd (cleanColCons c t) ± CS_posn c' = x)
                   ± (x, z)  R_data r‰2)
                 ± replaceData c (Snd z') = replaceData c z®asm_tac); 
=TEX
=SML
(* *** Goal "1.2.2.1" *** *)
a(¶_tac¬Snd z'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z® THEN asm_rewrite_tac[]);
a(¶_tac¬(Fst z',z'')® THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 10 ante_tac THEN asm_rewrite_tac[]);
a(LEMMA_T¬z' = (Fst z',Snd z')® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],´_tac]);
a(strip_asm_tac (list_µ_elim[¬c®,¬TS_class t®,¬Snd z'®,¬z''®,¬Fst z'®]
	isError_updateField_lemma));
a(asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(asm_rewrite_tac[]);
val ÛisError_updateRow_lemmaÝ = save_pop_thm"isError_updateRow_lemma";
=TEX
=GFT HOL output
isError_updateRow_lemma = 
ô µ c tc d‰1 d‰2 u
  · isError (updateField c tc (u, d‰1))
        ± replaceData c d‰1 = replaceData c d‰2
      ´ updateField c tc (u, d‰1) = updateField c tc (u, d‰2)
=TEX
=SML
push_goal([],¬µ c r‰1 r‰2 t u ·
	(isVal (updateRow c (TS_class t) (u, r‰1)) 
	± cleanRow c (Snd (cleanColCons c t)) r‰1
             = cleanRow c (Snd (cleanColCons c t)) r‰2 ±
	Dom u € {n |¶ c'· c'  visibleCols c t ± CS_posn c' = n})
	´ isVal (updateRow c (TS_class t) (u, r‰2))®);
a(REPEAT strip_tac);
a(POP_ASM_T (strip_asm_tac o rewrite_rule[sets_ext_clauses,visibleCols_def,dom_def]));
a(DROP_NTH_ASM_T 2 (strip_asm_tac o rewrite_rule
	[cleanRow_def,get_spec¬MkRow®,row_components]));
a(DROP_NTH_ASM_T 4 ante_tac THEN rewrite_tac[updateRow_def]);
=TEX
=SML
a(cases_tac¬³ u  Functional®
	THEN cases_tac¬((RelCombine u (R_data r‰1)
                                     » Graph (updateField c (TS_class t)))
                                   ’ {x|isError x})
                                 » Graph destError = {}®
	THEN cases_tac¬((RelCombine u (R_data r‰2)
                                     » Graph (updateField c (TS_class t)))
                                   ’ {x|isError x})
                                 » Graph destError = {}®
	THEN asm_rewrite_tac[³isVal_giveError_thm,giveVal_def]);
=TEX
=SML
(* *** Goal "1" *** *)
a(´_tac THEN prove_¶_tac);
(* *** Goal "2" *** *)
a(swap_nth_asm_concl_tac 1);
a(POP_ASM_T (fn _ => id_tac) THEN POP_ASM_T ante_tac);
a(rewrite_tac[rel_ext_clauses,r_»_r_thm,rel_combine_def,graph_thm,’_thm]);
a(REPEAT strip_tac);
a(swap_nth_asm_concl_tac 5);
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 (asm_tac o rewrite_rule
	[rel_ext_clauses,filterRow_def,r_»_r_thm,graph_thm,ò_thm]));
a(POP_ASM_T(asm_tac o list_µ_elim[¬x®,¬replaceData c (Snd z')®]));
a(DROP_NTH_ASM_T 9 (asm_tac o µ_elim¬x®));
a(LEMMA_T¬¶z· ((¶ c'· c'  Snd (cleanColCons c t) ± CS_posn c' = x)
                   ± (x, z)  R_data r‰2)
                 ± replaceData c (Snd z') = replaceData c z®asm_tac); 
=TEX
=SML
(* *** Goal "2.1" *** *)
a(¶_tac¬Snd z'® THEN asm_rewrite_tac[]);
a(LEMMA_T¬¶y· (x, y)  u®asm_tac);
(* *** Goal "2.1.1" *** *)
a(¶_tac¬Fst z'® THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN 
	´_T asm_tac);
=TEX
=SML
(* *** Goal "2.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬x® THEN REPEAT strip_tac);
a(¶_tac¬y® THEN rewrite_tac[]);
a(¶_tac¬z® THEN asm_rewrite_tac[]);
a(¶_tac¬(Fst z',z'')® THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
a(LEMMA_T¬z' = (Fst z',Snd z')® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],´_tac]);
a(strip_asm_tac (list_µ_elim[¬c®,¬TS_class t®,¬Snd z'®,¬z''®,¬Fst z'®]
	isError_updateField_lemma));
a(asm_rewrite_tac[]);
val ÛisVal_updateRow_lemmaÝ = save_pop_thm"isVal_updateRow_lemma";
=TEX
=GFT HOL output
isVal_updateRow_lemma =
ô µ c r‰1 r‰2 t u
  · isVal (updateRow c (TS_class t) (u, r‰1))
        ± cleanRow c (Snd (cleanColCons c t)) r‰1
          = cleanRow c (Snd (cleanColCons c t)) r‰2
        ± Dom u € {n|¶ c'· c'  visibleCols c t ± CS_posn c' = n}
      ´ isVal (updateRow c (TS_class t) (u, r‰2))
=TEX

=SML
push_goal([],¬µ c r‰1 r‰2 t u ·
	(cleanRow c (Snd (cleanColCons c t)) r‰1
             = cleanRow c (Snd (cleanColCons c t)) r‰2 ±
	Dom u € {n |¶ c'· c'  visibleCols c t ± CS_posn c' = n})
	´ 	(isError (updateRow c (TS_class t) (u, r‰1)) 
		¤ isError (updateRow c (TS_class t) (u, r‰2)))®);
a(REPEAT µ_tac THEN ´_tac);
a(REPEAT strip_tac);
(* *** Goal "1" *** *)
a(strip_asm_tac(µ_elim¬(updateRow c (TS_class t) (u, r‰2))®val_or_error_type));
a(DROP_NTH_ASM_T 5(asm_tac o eq_sym_rule));
a(strip_asm_tac(list_µ_elim[¬c®,¬r‰2®,¬r‰1®,¬t®,¬u®]isVal_updateRow_lemma));
a(strip_asm_tac(µ_elim¬(updateRow c (TS_class t) (u, r‰1))®val_or_error_type));
(* *** Goal "2" *** *)
a(strip_asm_tac(µ_elim¬(updateRow c (TS_class t) (u, r‰1))®val_or_error_type));
a(strip_asm_tac(list_µ_elim[¬c®,¬r‰1®,¬r‰2®,¬t®,¬u®]isVal_updateRow_lemma));
a(strip_asm_tac(µ_elim¬(updateRow c (TS_class t) (u, r‰2))®val_or_error_type));
val ÛisError_¤_updateRow_lemmaÝ = save_pop_thm"isError_¤_updateRow_lemma";
=TEX
=GFT HOL output
ô µ c r‰1 r‰2 t u
  · cleanRow c (Snd (cleanColCons c t)) r‰1
          = cleanRow c (Snd (cleanColCons c t)) r‰2
        ± Dom u € {n|¶ c'· c'  visibleCols c t ± CS_posn c' = n}
      ´ (isError (updateRow c (TS_class t) (u, r‰1))
        ¤ isError (updateRow c (TS_class t) (u, r‰2)))
=TEX
=SML
push_goal([],¬µ  x y (u : î ª (î ª Update)) c t · ((x, y)  u ± Dom (Þ (Ran u))
             € {n|¶ c'· c'  Snd (cleanColCons c t) ± CS_posn c' = n})
	´ Dom y € {n|¶ c'· c'  visibleCols c t ± CS_posn c' = n}®);
a(rewrite_tac[sets_ext_clauses,dom_thm,ran_thm,Þ_def]THEN REPEAT strip_tac);
(* *** Goal "1" *** *)
a(DROP_NTH_ASM_T 2 (asm_tac o µ_elim¬x'®));
a(LEMMA_T¬(¶ y s· (x', y)  s ± (¶ x· (x, s)  u))®asm_tac);
(* *** Goal "1" *** *)
a(¶_tac¬y'® THEN ¶_tac¬y® THEN asm_rewrite_tac[]);
a(¶_tac¬x® THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[visibleCols_def]);
val Ûdom_Þ_ran_lemmaÝ = save_pop_thm"dom_Þ_ran_lemma";
=TEX
=GFT HOL output
dom_Þ_ran_lemma = 
ô µ x y u c t
  · (x, y)  u
        ± Dom (Þ (Ran u))
          € {n|¶ c'· c'  Snd (cleanColCons c t) ± CS_posn c' = n}
      ´ Dom y € {n|¶ c'· c'  visibleCols c t ± CS_posn c' = n}
=TEX
=SML
push_goal([],¬µ(l:Row LIST) (last:Row) (s : Row ð) (u : î ª (î ª Update)) · Dom(InvRel
                               (Squash
                                   (Id
                                       (Dom
                                           (ListRel l ’ s))))
                             » u) ¡ Dom{(Length l + 1, last)}={}®); 
a(REPEAT µ_tac);
a(rewrite_tac[enumerate_def,r_»_r_thm,inv_rel_def,dom_def,id_def,squash_def,
	list_rel_def,’_thm,ò_thm,dot_dot_def]);
a(rewrite_tac[¡_def,sets_ext_clauses] THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[]);
val Ûdoms_null_lemma1Ý = save_pop_thm"doms_null_lemma1";
=TEX
=GFT HOL output
doms_null_lemma1 = 
ô µ l last s u
  · Dom (InvRel (Squash (Id (Dom (ListRel l ’ s)))) » u)
        ¡ Dom {(Length l + 1, last)}
      = {}
=TEX

=SML
push_goal([],¬µ(l:Row LIST) (s : Row ð) (u : î ª (î ª Update)) · Dom(InvRel
                                   {(Size
                                               (Squash
                                                   (Id
                                                       (Dom
                                                           (ListRel l ’ s))))
                                             + 1, Length l + 1)}
                                 » u) ¡ Dom(ListRel l)={}®); 
a(REPEAT µ_tac);
a(rewrite_tac[dom_def,inv_rel_def,r_»_r_thm]);
a(rewrite_tac[¡_def,sets_ext_clauses] THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac
	[list_rel_def,’_thm,ò_thm,dot_dot_def]);
val Ûdoms_null_lemma2Ý = save_pop_thm"doms_null_lemma2";
=TEX
=GFT HOL output
doms_null_lemma2 = 
ô µ l s u
  · Dom
          (InvRel
                {(Size (Squash (Id (Dom (ListRel l ’ s)))) + 1,
                      Length l + 1)}
              » u)
        ¡ Dom (ListRel l)
      = {}
=TEX

=SML
push_goal([],¬µ(l:Row LIST) (last:Row)(s : Row ð) (u : î ª (î ª Update)) · 
	µ n‰1 n‰2 · (n‰1  Dom (((RelCombine
                           (InvRel
                                 (Squash
                                     (Id
                                         (Dom
                                             (ListRel l ’ s))))
                               » u)
                           (ListRel l)
                         » Graph (updateRow c (TS_class t‰2)))
                       ’ {x|isError x})
                     » Graph destError)
	± n‰2  Dom (((RelCombine
                           (InvRel
                                 {(Size
                                             (Squash
                                                 (Id
                                                     (Dom
                                                         (ListRel l ’ s))))
                                           + 1, Length l + 1)}
                               » u)
                           {(Length l + 1, last)}
                         » Graph (updateRow c (TS_class t‰2)))
                       ’ {x|isError x})
                     » Graph destError)) ´ n‰2 > n‰1®);
=TEX
=SML
a(REPEAT µ_tac);
a(rewrite_tac[list_rel_def,dot_dot_def,ò_thm,dom_def,inv_rel_def,r_»_r_thm,
	rel_combine_def,r_»_r_thm,’_thm]);
a(REPEAT strip_tac);
a(asm_rewrite_tac[less_def]);
val Ûsquash_doms_lemmaÝ = save_pop_thm"squash_doms_lemma";
=TEX
=GFT HOL output
squash_doms_lemma = 
ô µ l last s u n‰1 n‰2
  · n‰1
           Dom
            (((RelCombine
                      (InvRel (Squash (Id (Dom (ListRel l ’ s)))) » u)
                      (ListRel l)
                    » Graph (updateRow c (TS_class t‰2)))
                  ’ {x|isError x})
                » Graph destError)
        ± n‰2
           Dom
            (((RelCombine
                      (InvRel
                            {(Size (Squash (Id (Dom (ListRel l ’ s)))) + 1,
                                  Length l + 1)}
                          » u)
                      {(Length l + 1, last)}
                    » Graph (updateRow c (TS_class t‰2)))
                  ’ {x|isError x})
                » Graph destError)
      ´ n‰2 > n‰1
=TEX
=SML
push_goal([],¬µ c t‰1 t‰2 · 
	cleanRows c (Snd (cleanColCons c t‰2)) (TS_rows t‰1)
               = cleanRows c (Snd (cleanColCons c t‰2)) (TS_rows t‰2)
	´ Size(ListRel (TS_rows t‰1) ’ {r|c dominates R_exist r}) =
	Size(ListRel (TS_rows t‰2) ’ {r|c dominates R_exist r})®);
a(REPEAT µ_tac);
a(lemma_tac¬¶ l · TS_rows t‰1 = l®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(lemma_tac¬¶ l1 · TS_rows t‰2 = l1®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(intro_µ_tac(¬l1®,¬l':Row LIST®));
a(rewrite_tac[cleanRows_def]);
a(REV_LIST_INDUCTION_T¬l®asm_tac);
=TEX
=SML
(* *** Goal "1" *** *)
a(rewrite_tac[map_def,map_null_thm]);
a(µ_tac THEN ´_T (asm_tac o rewrite_rule
	[all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm))]));
a(asm_rewrite_tac[list_rel_null_thm,’_null_thm]);
(* *** Goal "2" *** *)
a(REPEAT µ_tac);
a(intro_µ_tac(¬last®,¬last®));
a(REV_LIST_INDUCTION_T¬l'®asm_tac);
=TEX
=SML
(* *** Goal "2.1" *** *)
a(rewrite_tac[map_def,map_null_thm]);
a(µ_tac THEN cases_tac¬c dominates R_exist last® THEN  asm_rewrite_tac[]);
a(´_T (asm_tac o rewrite_rule[all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm))]));
a(asm_rewrite_tac[list_rel_ë_thm,list_rel_null_thm,’_null_thm,’_À_thm,’_single_lemma]);
(* *** Goal "2.2" *** *)
a(REPEAT µ_tac);
a(cases_tac¬c dominates R_exist last'®	THEN asm_rewrite_tac[] THEN
	cases_tac¬c dominates R_exist last® THEN asm_rewrite_tac[map_ë_thm]);
(* *** Goal "2.2.1" *** *)
a(´_tac THEN DROP_NTH_ASM_T 6 (ante_tac o µ_elim¬l'®) THEN asm_rewrite_tac[]
	THEN ´_tac);
a(asm_rewrite_tac[list_rel_ë_thm,’_À_thm,’_single_lemma]);
a(lemma_tac¬µ l last · (ListRel l ’ {r|c dominates R_exist r}) ¡ {(Length l + 1, last)} 
	= {}®);
=TEX
=SML
(* *** Goal "2.2.1.1" *** *)
a(REPEAT µ_tac THEN rewrite_tac
	[list_rel_def,’_thm,ò_thm,dot_dot_def,¡_def,rel_ext_clauses]);
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.1.2" *** *)
a(TOP_ASM_T (asm_tac o list_µ_elim[¬l'®,¬last®]));
a(asm_tac(list_µ_elim[¬l'®,¬{r|c dominates R_exist r}®]list_rel_’_finite_ax));
a(asm_tac(µ_elim¬(Length l' + 1, last)®finite_single));
a(ante_tac(list_µ_elim[¬ListRel l' ’ {r|c dominates R_exist r}®,
	¬{(Length l' + 1, last)}®]size_ax)THEN asm_rewrite_tac[size_null_ax,size_single_ax]);
a(´_T rewrite_thm_tac);
a(LIST_DROP_NTH_ASM_T [1,2,3] (fn _ => id_tac));
a(POP_ASM_T (asm_tac o list_µ_elim[¬l®,¬last'®]));
a(asm_tac(list_µ_elim[¬l®,¬{r|c dominates R_exist r}®]list_rel_’_finite_ax));
a(asm_tac(µ_elim¬(Length l + 1, last')®finite_single));
a(ante_tac(list_µ_elim[¬ListRel l ’ {r|c dominates R_exist r}®,
	¬{(Length l + 1, last')}®]size_ax)THEN asm_rewrite_tac[size_null_ax,size_single_ax]);
=TEX
=SML
(* *** Goal "2.2.2" *** *)
a(DROP_NTH_ASM_T 3(ante_tac o µ_elim¬last'®)THEN asm_rewrite_tac[map_ë_thm]);
a(´_T asm_tac THEN ´_tac);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]THEN strip_tac);
a(asm_rewrite_tac[list_rel_ë_’_ax]);
=TEX
=SML
(* *** Goal "2.2.3" *** *)
a(DROP_NTH_ASM_T 4(ante_tac o µ_elim¬l' ë [last]®) THEN asm_rewrite_tac[map_ë_thm]);
a(´_T asm_tac THEN ´_tac);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]THEN strip_tac);
a(asm_rewrite_tac[list_rel_ë_’_ax]);
=TEX
=SML
(* *** Goal "2.2.4" *** *)
a(asm_rewrite_tac[list_rel_ë_’_ax]);
val ÛcleanRows_size_lemmaÝ = save_pop_thm"cleanRows_size_lemma";
=TEX
=GFT HOL output
cleanRows_size_lemma = 
ô µ c t‰1 t‰2
  · cleanRows c (Snd (cleanColCons c t‰2)) (TS_rows t‰1)
        = cleanRows c (Snd (cleanColCons c t‰2)) (TS_rows t‰2)
      ´ Size (ListRel (TS_rows t‰1) ’ {r|c dominates R_exist r})
        = Size (ListRel (TS_rows t‰2) ’ {r|c dominates R_exist r})
=TEX
=SML
push_goal([],¬µ c t‰1 t‰2 u · 
	(Dom (Þ (Ran u)) € {n|¶ c'· c'  visibleCols c t‰2 ± CS_posn c' = n} ±
	cleanRows c (Snd (cleanColCons c t‰2)) (TS_rows t‰1)
               = cleanRows c (Snd (cleanColCons c t‰2)) (TS_rows t‰2))
	´ (((RelCombine
                             (InvRel (revealRow c t‰1) » u)
                             (ListRel (TS_rows t‰1))
                           » Graph (updateRow c (TS_class t‰2)))
                         ’ {x|isError x})
                       » Graph destError
             = {} ¤ ((RelCombine
                             (InvRel (revealRow c t‰2) » u)
                             (ListRel (TS_rows t‰2))
                           » Graph (updateRow c (TS_class t‰2)))
                         ’ {x|isError x})
                       » Graph destError = {})®);
=TEX
=SML
a(REPEAT µ_tac THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬c®,¬t‰1®,¬t‰2®]cleanRows_size_lemma));
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac);
a(rewrite_tac[revealRow_def]);
a(lemma_tac¬¶ l · TS_rows t‰1 = l®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(lemma_tac¬¶ l1 · TS_rows t‰2 = l1®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(intro_µ_tac(¬l1®,¬l':Row LIST®));
a(rewrite_tac[cleanRows_def]);
a(REV_LIST_INDUCTION_T¬l®asm_tac);
=TEX
=SML
(* *** Goal "1" *** *)
a(rewrite_tac[map_def,map_null_thm]);
a µ_tac;
a(REV_LIST_INDUCTION_T¬l'®asm_tac THEN rewrite_tac
	[list_rel_null_thm,rel_combine_null_thm1]);
a(µ_tac THEN cases_tac¬c dominates R_exist last®THEN asm_rewrite_tac[]);
a(´_T (asm_tac o rewrite_rule[all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm))]));
a(rewrite_tac[list_rel_null_thm,rel_combine_null_thm1,»_graph_null_thm,»_null_thm,squash_ë_ax]
	THEN asm_rewrite_tac[id_dom_null_thm,squash_null_thm,inv_rel_»_null_thm,
	rel_combine_null_thm,»_graph_null_thm]);
=TEX
=SML
(* *** Goal "2" *** *)
a(REPEAT µ_tac);
a(intro_µ_tac(¬last®,¬last®));
a(REV_LIST_INDUCTION_T¬l'®asm_tac);
(* *** Goal "2.1" *** *)
a(µ_tac THEN cases_tac¬c dominates R_exist last®
	THEN asm_rewrite_tac[map_def,map_null_thm]);
a(´_T (asm_tac o rewrite_rule[all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm))]));
a(asm_rewrite_tac[squash_ë_ax,list_rel_null_thm,rel_combine_null_thm1,
	»_graph_null_thm,’_null_thm]);
a(rewrite_tac[id_dom_null_thm,squash_null_thm,inv_rel_»_null_thm,
	rel_combine_null_thm,»_graph_null_thm,’_null_thm]);
(* *** Goal "2.2" *** *)
a(REPEAT µ_tac);
a(cases_tac¬c dominates R_exist last'®	THEN asm_rewrite_tac[] THEN
	cases_tac¬c dominates R_exist last® THEN asm_rewrite_tac[map_ë_thm]);
=TEX
=SML
(* *** Goal "2.2.1" *** *)
a(REPEAT ´_tac);
a(DROP_NTH_ASM_T 7(ante_tac o µ_elim¬l'®)THEN asm_rewrite_tac[]
	THEN ´_T asm_tac);
a(DROP_NTH_ASM_T 7 (fn _ => id_tac));
a(DROP_NTH_ASM_T 4 (fn _ => id_tac));
a(asm_rewrite_tac[squash_ë_ax,inv_rel_À_thm,rel_combine_À_thm1,»_À_thm]);
a(asm_rewrite_tac[list_rel_ë_thm,rel_combine_À_thm]);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[size_list_rel_ë_’_ax]);
a(´_tac THEN DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[] 
	THEN ´_T asm_tac);
=TEX
=SML
a(strip_asm_tac(list_µ_elim[¬l'®,¬last®,¬{r|c dominates R_exist r}®,¬u®]doms_null_lemma1));
a(strip_asm_tac(list_µ_elim[¬l®,¬last'®,¬{r|c dominates R_exist r}®,¬u®]doms_null_lemma1));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l' ’ {r|c dominates R_exist r}))))
                     » u)®,¬{(Length l' + 1, last)}®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac);
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l ’ {r|c dominates R_exist r}))))
                     » u)®,¬{(Length l + 1, last')}®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac);
=TEX
=SML
a(strip_asm_tac(list_µ_elim[¬l'®,¬{r|c dominates R_exist r}®,¬u®]doms_null_lemma2));
a(strip_asm_tac(list_µ_elim[¬l®,¬{r|c dominates R_exist r}®,¬u®]doms_null_lemma2));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       {(Size
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l
                                                   ’ {r
                                                   |c dominates R_exist r}))))
                                 + 1, Length l + 1)}
                     » u)®,¬ListRel l®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac);
=TEX
=SML
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       {(Size
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l'
                                                   ’ {r
                                                   |c dominates R_exist r}))))
                                 + 1, Length l' + 1)}
                     » u)®,¬ListRel l'®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac);
a(LIST_DROP_NTH_ASM_T [1,2,3,4] (fn _ => id_tac));
a(asm_rewrite_tac[»_À_thm,’_À_thm,À_null_thm]);
=TEX
=SML
a(LEMMA_T¬(((RelCombine
                         (InvRel
                               {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l
                                                           ’ {r
                                                           |c
           dominates R_exist r}))))
                                         + 1, Length l + 1)}
                             » u)
                         {(Length l + 1, last')}
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError) = {} ¤ (((RelCombine
                         (InvRel
                               {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l'
                                                           ’ {r
                                                           |c
           dominates R_exist r}))))
                                         + 1, Length l' + 1)}
                             » u)
                         {(Length l' + 1, last)}
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError) = {}®rewrite_thm_tac);
=TEX
=SML
a(POP_ASM_T (fn _ => id_tac));
a(rewrite_tac[rel_ext_clauses,rel_combine_def,r_»_r_thm,inv_rel_def,’_thm,graph_thm]);
a(REPEAT strip_tac);
(* *** Goal "2.2.1.1" *** *)
a(swap_nth_asm_concl_tac 7);
a(REPEAT strip_tac);
a(¶_tac¬Length l + 1® THEN rewrite_tac[]);
a(REPEAT strip_tac);
a(¶_tac¬y® THEN rewrite_tac[]);
a(¶_tac¬z® THEN asm_rewrite_tac[]);
a(¶_tac¬(Fst z',last')® THEN rewrite_tac[]);
a(DROP_NTH_ASM_T 2 ante_tac);
=TEX
=SML
a(LEMMA_T¬z' = (Fst z',Snd z')® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],pure_asm_rewrite_tac[] THEN ´_tac]);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
a(DROP_NTH_ASM_T 12 (asm_tac o rewrite_rule[visibleCols_def]));
a(strip_asm_tac(list_µ_elim[¬z''®,¬Fst z'®,¬u®,¬c®,¬t‰2®]dom_Þ_ran_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_¤_updateRow_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_updateRow_lemma));
a(asm_rewrite_tac[]);
a(¶_tac¬z''® THEN asm_rewrite_tac[]);
a(strip_asm_tac(list_µ_elim[¬l®,¬l'®,¬{r|c dominates R_exist r}®]size_squash_id_dom_thm));
a(asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2.1.2" *** *)
a(swap_nth_asm_concl_tac 7);
a(REPEAT strip_tac);
a(¶_tac¬Length l' + 1® THEN rewrite_tac[]);
a(REPEAT strip_tac);
a(¶_tac¬y® THEN rewrite_tac[]);
a(¶_tac¬z® THEN asm_rewrite_tac[]);
a(¶_tac¬(Fst z',last)® THEN rewrite_tac[]);
a(DROP_NTH_ASM_T 2 ante_tac);
a(LEMMA_T¬z' = (Fst z',Snd z')® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],pure_asm_rewrite_tac[] THEN ´_tac]);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
a(DROP_NTH_ASM_T 12 (asm_tac o rewrite_rule[visibleCols_def]));
a(strip_asm_tac(list_µ_elim[¬z''®,¬Fst z'®,¬u®,¬c®,¬t‰2®]dom_Þ_ran_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_¤_updateRow_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_updateRow_lemma));
a(asm_rewrite_tac[]);
a(¶_tac¬z''® THEN asm_rewrite_tac[]);
a(strip_asm_tac(list_µ_elim[¬l®,¬l'®,¬{r|c dominates R_exist r}®]size_squash_id_dom_thm));
=TEX
=SML
(* *** Goal "2.2.2" *** *)
a(DROP_NTH_ASM_T 3(ante_tac o µ_elim¬last'®)THEN 
	asm_rewrite_tac[map_ë_thm,size_list_rel_ë_’_ax]);
a(´_T asm_tac THEN REPEAT ´_tac);
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
a(´_T rewrite_thm_tac);
a(asm_rewrite_tac[list_rel_ë_’_ax]THEN rewrite_tac[list_rel_ë_thm,rel_combine_À_thm]);
a(strip_asm_tac(list_µ_elim[¬l'®,¬last®,¬{r|c dominates R_exist r}®,¬u®]doms_null_lemma1));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l' ’ {r|c dominates R_exist r}))))
                     » u)®,¬{(Length l' + 1, last)}®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.2.3" *** *)
a(DROP_NTH_ASM_T 4(ante_tac o µ_elim¬l' ë [last]®) THEN 
	asm_rewrite_tac[map_ë_thm,size_list_rel_ë_’_ax]);
a(´_T asm_tac THEN REPEAT ´_tac);
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
a(´_T (rewrite_thm_tac o eq_sym_rule));
a(asm_rewrite_tac[list_rel_ë_’_ax]THEN rewrite_tac[list_rel_ë_thm,rel_combine_À_thm]);
a(strip_asm_tac(list_µ_elim[¬l®,¬last'®,¬{r|c dominates R_exist r}®,¬u®]doms_null_lemma1));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l ’ {r|c dominates R_exist r}))))
                     » u)®,¬{(Length l + 1, last')}®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.2.4" *** *)
a(asm_rewrite_tac[list_rel_ë_’_ax]THEN rewrite_tac[list_rel_ë_thm,rel_combine_À_thm]);
a(strip_asm_tac(list_µ_elim[¬l'®,¬last®,¬{r|c dominates R_exist r}®,¬u®]doms_null_lemma1));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l' ’ {r|c dominates R_exist r}))))
                     » u)®,¬{(Length l' + 1, last)}®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac);
a(strip_asm_tac(list_µ_elim[¬l®,¬last'®,¬{r|c dominates R_exist r}®,¬u®]doms_null_lemma1));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l ’ {r|c dominates R_exist r}))))
                     » u)®,¬{(Length l + 1, last')}®]rel_combine_lemma));
a(asm_rewrite_tac[]);
val ÛcleanRows_errors_or_vals_lemmaÝ = save_pop_thm"cleanRows_errors_or_vals_lemma";
=TEX
=GFT HOL output
cleanRows_errors_or_vals_lemma = 
ô µ c t‰1 t‰2 u
  · Dom (Þ (Ran u)) € {n|¶ c'· c'  visibleCols c t‰2 ± CS_posn c' = n}
        ± cleanRows c (Snd (cleanColCons c t‰2)) (TS_rows t‰1)
          = cleanRows c (Snd (cleanColCons c t‰2)) (TS_rows t‰2)
      ´ (((RelCombine (InvRel (revealRow c t‰1) » u) (ListRel (TS_rows t‰1))
                » Graph (updateRow c (TS_class t‰2)))
              ’ {x|isError x})
            » Graph destError
          = {}
        ¤ ((RelCombine (InvRel (revealRow c t‰2) » u) (ListRel (TS_rows t‰2))
                » Graph (updateRow c (TS_class t‰2)))
              ’ {x|isError x})
            » Graph destError
          = {})
=TEX

=SML
push_goal([],¬µ c t‰1 t‰2 s‰1 s‰2 u · (c dominates TS_class t‰1 ± c dominates TS_class t‰2 
	± cleanTable c t‰1 = cleanTable c t‰2)
	´ Snd (updateQuery (c, u, s‰1,t‰1)) = Snd (updateQuery (c, u, s‰2,t‰2))®);
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN asm_rewrite_tac
	[cleanTable_def,get_spec¬MkTableSpec®,tab_components] THEN strip_tac);
a(POP_ASM_T ante_tac);
a(lemma_tac¬cleanColCons c t‰1 = cleanColCons c t‰2® 
	THEN_LIST[pure_once_asm_rewrite_tac[prove_rule[pair_clauses]
	¬µ p  · p = (Fst p, Snd p)®]THEN asm_rewrite_tac[],
	DROP_NTH_ASM_T 3(fn _ => id_tac) 
	THEN  DROP_NTH_ASM_T 2(fn _ => id_tac)]);
a(TOP_ASM_T rewrite_thm_tac THEN ´_tac);
=TEX
=SML
a(strip_asm_tac(list_µ_elim[¬c®,¬t‰1®,¬t‰2®]cleanRows_size_lemma));
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac);
a(LEMMA_T¬u = (Fst u,Snd u)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],rewrite_tac[updateQuery_def]]);
a(conv_tac(ONCE_MAP_C let_conv)THEN asm_rewrite_tac[visibleCols_def]);
a(cases_tac¬Snd u  Functional® THEN
	cases_tac¬Dom (Þ (Ran (Snd u))) € 
	{n |¶ c' · c'  Snd (cleanColCons c t‰2) ± CS_posn c' = n}®
	THEN asm_rewrite_tac[]);
a(conv_tac(MAP_C let_conv));
a ´_tac;
a(strip_asm_tac (rewrite_rule[visibleCols_def]
	(list_µ_elim[¬c®,¬t‰1®,¬t‰2®,¬Snd u®]cleanRows_errors_or_vals_lemma)) 
	THEN asm_rewrite_tac[]);
a(POP_ASM_T (fn _ => id_tac) THEN POP_ASM_T (fn _ => id_tac) THEN ´_tac);
=TEX
=SML
a(LEMMA_T¬Squash
                       (((RelCombine
                                 (InvRel (revealRow c t‰1) » Snd u)
                                 (ListRel (TS_rows t‰1))
                               » Graph (updateRow c (TS_class t‰2)))
                             ’ {x|isError x})
                           » Graph destError) = Squash
                       (((RelCombine
                                 (InvRel (revealRow c t‰2) » Snd u)
                                 (ListRel (TS_rows t‰2))
                               » Graph (updateRow c (TS_class t‰2)))
                             ’ {x|isError x})
                           » Graph destError)®rewrite_thm_tac);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac 
	THEN rewrite_tac[cleanRows_def,revealRow_def]);
a(lemma_tac¬¶ l · TS_rows t‰1 = l®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(lemma_tac¬¶ l1 · TS_rows t‰2 = l1®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(intro_µ_tac(¬l1®,¬l':Row LIST®));
a(REV_LIST_INDUCTION_T¬l®asm_tac);
=TEX
=SML
(* *** Goal "1" *** *)
a(rewrite_tac[map_def,map_null_thm,list_rel_null_thm,rel_combine_null_thm1,»_graph_null_thm,
	»_null_thm,’_null_thm,squash_null_thm]);
a µ_tac;
a(REV_LIST_INDUCTION_T¬l'®asm_tac);
(* *** Goal "1.1" *** *)
a(rewrite_tac[list_rel_null_thm,rel_combine_null_thm1,»_graph_null_thm,
	’_null_thm,id_dom_null_thm,squash_null_thm]);
(* *** Goal "1.2" *** *)
a(µ_tac THEN cases_tac¬c dominates R_exist last®THEN asm_rewrite_tac[]);
a(´_T (asm_tac o rewrite_rule[all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm))]));
a(asm_rewrite_tac[list_rel_null_thm,rel_combine_null_thm,»_graph_null_thm,’_null_thm,
	id_dom_null_thm,squash_null_thm,list_rel_ë_’_ax,inv_rel_»_null_thm]);
=TEX
=SML
(* *** Goal "2" *** *)
a(REPEAT µ_tac);
a(intro_µ_tac(¬last®,¬last®));
a(REV_LIST_INDUCTION_T¬l'®asm_tac);
(* *** Goal "2.1" *** *)
a(µ_tac THEN cases_tac¬c dominates R_exist last®
	THEN asm_rewrite_tac[map_def,map_null_thm]);
a(´_T (asm_tac o rewrite_rule[all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm))]));
a(asm_rewrite_tac[list_rel_null_thm,rel_combine_null_thm,»_graph_null_thm,’_null_thm,
	id_dom_null_thm,squash_null_thm,list_rel_ë_’_ax,inv_rel_»_null_thm]);
(* *** Goal "2.2" *** *)
a(REPEAT µ_tac);
a(cases_tac¬c dominates R_exist last'®	THEN asm_rewrite_tac[] THEN
	cases_tac¬c dominates R_exist last® THEN asm_rewrite_tac[map_ë_thm]);
=TEX
=SML
(* *** Goal "2.2.1" *** *)
a(REPEAT ´_tac);
a(DROP_NTH_ASM_T 7(ante_tac o µ_elim¬l'®)THEN asm_rewrite_tac[]
	THEN ´_T asm_tac);
a(DROP_NTH_ASM_T 7 (fn _ => id_tac));
a(DROP_NTH_ASM_T 4 (fn _ => id_tac));
a(asm_rewrite_tac[squash_ë_ax,inv_rel_À_thm,rel_combine_À_thm1,»_À_thm]);
a(asm_rewrite_tac[list_rel_ë_thm,rel_combine_À_thm]);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[size_list_rel_ë_’_ax]);
a(´_tac THEN DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[] 
	THEN ´_T asm_tac);
=TEX
=SML
a(strip_asm_tac(list_µ_elim[¬l®,¬last'®,¬{r|c dominates R_exist r}®,¬Snd u®]doms_null_lemma1));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l ’ {r|c dominates R_exist r}))))
                     » Snd u)®,¬{(Length l + 1, last')}®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac THEN POP_ASM_T (fn _ => id_tac));
a(strip_asm_tac(list_µ_elim[¬l'®,¬last®,¬{r|c dominates R_exist r}®,¬Snd u®]doms_null_lemma1));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l' ’ {r|c dominates R_exist r}))))
                     » Snd u)®,¬{(Length l' + 1, last)}®]rel_combine_lemma));
=TEX
=SML
a(POP_ASM_T rewrite_thm_tac THEN POP_ASM_T (fn _ => id_tac));
a(strip_asm_tac(list_µ_elim[¬l®,¬{r|c dominates R_exist r}®,¬Snd u®]doms_null_lemma2));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       {(Size
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l
                                                   ’ {r
                                                   |c dominates R_exist r}))))
                                 + 1, Length l + 1)}
                     » Snd u)®,¬ListRel l®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac THEN POP_ASM_T (fn _ => id_tac));
=TEX
=SML
a(strip_asm_tac(list_µ_elim[¬l'®,¬{r|c dominates R_exist r}®,¬Snd u®]doms_null_lemma2));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       {(Size
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l'
                                                   ’ {r
                                                   |c dominates R_exist r}))))
                                 + 1, Length l' + 1)}
                     » Snd u)®,¬ListRel l'®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac THEN POP_ASM_T (fn _ => id_tac));
a(rewrite_tac[»_À_thm,’_À_thm]);
=TEX
=SML
a(lemma_tac¬Ran(((RelCombine
                               (InvRel
                                     {(Size
                                                 (Squash
                                                     (Id
                                                         (Dom
                                                             (ListRel l
           ’ {r|c dominates R_exist r}))))
                                               + 1, Length l + 1)}
                                   » Snd u)
                               {(Length l + 1, last')}
                             » Graph (updateRow c (TS_class t‰2)))
                           ’ {x|isError x})
                         » Graph destError) = Ran(((RelCombine
                             (InvRel
                                   {(Size
                                               (Squash
                                                   (Id
                                                       (Dom
                                                           (ListRel l'
           ’ {r|c dominates R_exist r}))))
                                             + 1, Length l' + 1)}
                                 » Snd u)
                             {(Length l' + 1, last)}
                           » Graph (updateRow c (TS_class t‰2)))
                         ’ {x|isError x})
                       » Graph destError)®);
=TEX
=SML
(* *** Goal "2.2.1.1" *** *)
a(POP_ASM_T (fn _ => id_tac));
a(rewrite_tac[ran_def,rel_combine_def,r_»_r_thm,inv_rel_def,’_thm,rel_ext_clauses,graph_thm]);
a(rewrite_tac[sets_ext_clauses]);
a(REPEAT µ_tac THEN ¤_T strip_asm_tac);
(* *** Goal "2.2.1.1.1" *** *)
a(¶_tac¬Length l' + 1® THEN rewrite_tac[]);
a(¶_tac¬z® THEN asm_rewrite_tac[]);
a(¶_tac¬(Fst z',last)® THEN rewrite_tac[]);
a(DROP_NTH_ASM_T 2 ante_tac);
=TEX
=SML
a(LEMMA_T¬z' = (Fst z',Snd z')® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],pure_asm_rewrite_tac[] THEN ´_tac]);
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬z''®,¬Fst z'®,¬Snd u®,¬c®,¬t‰2®]dom_Þ_ran_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_¤_updateRow_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_updateRow_lemma));
a(asm_rewrite_tac[]);
a(¶_tac¬z''® THEN asm_rewrite_tac[]);
a(strip_asm_tac(list_µ_elim[¬l®,¬l'®,¬{r|c dominates R_exist r}®]size_squash_id_dom_thm));
=TEX
=SML
(* *** Goal "2.2.1.1.2" *** *)
a(¶_tac¬Length l + 1® THEN rewrite_tac[]);
a(¶_tac¬z® THEN asm_rewrite_tac[]);
a(¶_tac¬(Fst z',last')® THEN rewrite_tac[]);
a(DROP_NTH_ASM_T 2 ante_tac);
a(LEMMA_T¬z' = (Fst z',Snd z')® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],pure_asm_rewrite_tac[] THEN ´_tac]);
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬z''®,¬Fst z'®,¬Snd u®,¬c®,¬t‰2®]dom_Þ_ran_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_¤_updateRow_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_updateRow_lemma));
a(asm_rewrite_tac[]);
a(¶_tac¬z''® THEN asm_rewrite_tac[]);
a(strip_asm_tac(list_µ_elim[¬l®,¬l'®,¬{r|c dominates R_exist r}®]size_squash_id_dom_thm));
a(asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2.1.2" *** *)
a(lemma_tac¬(Dom (((RelCombine
                         (InvRel
                               {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l
                                                           ’ {r
                                                           |c
           dominates R_exist r}))))
                                         + 1, Length l + 1)}
                             » Snd u)
                         {(Length l + 1, last')}
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError) = {Length l + 1}
	± Dom(((RelCombine
                         (InvRel
                               {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l'
                                                           ’ {r
                                                           |c
           dominates R_exist r}))))
                                         + 1, Length l' + 1)}
                             » Snd u)
                         {(Length l' + 1, last)}
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError) = {Length l' + 1}) ² 
=TEX
=SML
	(Dom (((RelCombine
                         (InvRel
                               {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l
                                                           ’ {r
                                                           |c
           dominates R_exist r}))))
                                         + 1, Length l + 1)}
                             » Snd u)
                         {(Length l + 1, last')}
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError) = {}
	± Dom(((RelCombine
                         (InvRel
                               {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l'
                                                           ’ {r
                                                           |c
           dominates R_exist r}))))
                                         + 1, Length l' + 1)}
                             » Snd u)
                         {(Length l' + 1, last)}
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError) = {})®);
=TEX
=SML
(* *** Goal "2.2.1.2.1" *** *)
a(POP_ASM_T (fn _ => id_tac) THEN POP_ASM_T (fn _ => id_tac));
a(rewrite_tac[rel_combine_def,inv_rel_def,sets_ext_clauses,r_»_r_thm,
	’_thm,dom_thm,graph_thm]THEN REPEAT strip_tac);
(* *** Goal "2.2.1.2.1.1" *** *)
a(swap_nth_asm_concl_tac 7 THEN REPEAT strip_tac);
a(¶_tac¬y®THEN asm_rewrite_tac[]);
a(¶_tac¬z®THEN asm_rewrite_tac[]);
a(¶_tac¬(Fst z',last')®THEN asm_rewrite_tac[]);
a(strip_asm_tac(list_µ_elim[¬l®,¬l'®,¬{r|c dominates R_exist r}®]size_squash_id_dom_thm));
a(strip_asm_tac(list_µ_elim[¬z''®,¬Fst z'®,¬Snd u®,¬c®,¬t‰2®]dom_Þ_ran_lemma));
a(DROP_NTH_ASM_T 4 ante_tac);
a(LEMMA_T¬z' = (Fst z',Snd z')® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],pure_asm_rewrite_tac[] THEN ´_tac]);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_¤_updateRow_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_updateRow_lemma));
a(¶_tac¬z''® THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2.1.2.1.2" *** *)
a(swap_nth_asm_concl_tac 7 THEN REPEAT strip_tac);
a(¶_tac¬y®THEN asm_rewrite_tac[]);
a(¶_tac¬z®THEN asm_rewrite_tac[]);
a(¶_tac¬(Fst z',last')®THEN asm_rewrite_tac[]);
a(strip_asm_tac(list_µ_elim[¬l®,¬l'®,¬{r|c dominates R_exist r}®]size_squash_id_dom_thm));
a(strip_asm_tac(list_µ_elim[¬z''®,¬Fst z'®,¬Snd u®,¬c®,¬t‰2®]dom_Þ_ran_lemma));
a(DROP_NTH_ASM_T 4 ante_tac);
a(LEMMA_T¬z' = (Fst z',Snd z')® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],pure_asm_rewrite_tac[] THEN ´_tac]);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_¤_updateRow_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_updateRow_lemma));
a(asm_rewrite_tac[]);
a(¶_tac¬z''® THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2.1.2.1.3" *** *)
a(swap_nth_asm_concl_tac 7 THEN REPEAT strip_tac);
a(¶_tac¬y®THEN asm_rewrite_tac[]);
a(¶_tac¬z®THEN asm_rewrite_tac[]);
a(¶_tac¬(Fst z',last)®THEN asm_rewrite_tac[]);
a(strip_asm_tac(list_µ_elim[¬l®,¬l'®,¬{r|c dominates R_exist r}®]size_squash_id_dom_thm));
a(strip_asm_tac(list_µ_elim[¬z''®,¬Fst z'®,¬Snd u®,¬c®,¬t‰2®]dom_Þ_ran_lemma));
a(DROP_NTH_ASM_T 4 ante_tac);
a(LEMMA_T¬z' = (Fst z',Snd z')® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],pure_asm_rewrite_tac[] THEN ´_tac]);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_¤_updateRow_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_updateRow_lemma));
a(asm_rewrite_tac[]);
a(¶_tac¬z''® THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2.1.2.1.4" *** *)
a(swap_nth_asm_concl_tac 7 THEN REPEAT strip_tac);
a(¶_tac¬y®THEN asm_rewrite_tac[]);
a(¶_tac¬z®THEN asm_rewrite_tac[]);
a(¶_tac¬(Fst z',last)®THEN asm_rewrite_tac[]);
a(strip_asm_tac(list_µ_elim[¬l®,¬l'®,¬{r|c dominates R_exist r}®]size_squash_id_dom_thm));
a(strip_asm_tac(list_µ_elim[¬z''®,¬Fst z'®,¬Snd u®,¬c®,¬t‰2®]dom_Þ_ran_lemma));
a(DROP_NTH_ASM_T 4 ante_tac);
a(LEMMA_T¬z' = (Fst z',Snd z')® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],pure_asm_rewrite_tac[] THEN ´_tac]);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_¤_updateRow_lemma));
a(strip_asm_tac(list_µ_elim[¬c®,¬last'®,¬last®,¬t‰2®,¬Fst z'®]isError_updateRow_lemma));
a(¶_tac¬z''® THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2.1.2.2" *** *)
a(strip_asm_tac(list_µ_elim[¬(((RelCombine
                         (InvRel
                               {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l
                                                           ’ {r
                                                           |c
           dominates R_exist r}))))
                                         + 1, Length l + 1)}
                             » Snd u)
                         {(Length l + 1, last')}
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError)®,¬(((RelCombine
                         (InvRel
                               {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l'
                                                           ’ {r
                                                           |c
           dominates R_exist r}))))
                                         + 1, Length l' + 1)}
                             » Snd u)
                         {(Length l' + 1, last)}
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError)®,¬Length l + 1®,¬Length l' + 1®]squash_single_ax));
=TEX
=SML
a(strip_asm_tac(rewrite_rule
	[list_µ_elim[¬l®,¬last'®,¬{r|c dominates R_exist r}®,¬Snd u®]squash_doms_lemma,
	list_µ_elim[¬l'®,¬last®,¬{r|c dominates R_exist r}®,¬Snd u®]squash_doms_lemma]
	(list_µ_elim[¬(((RelCombine
                         (InvRel
                               (Squash
                                   (Id
                                       (Dom
                                           (ListRel l
                                               ’ {r|c dominates R_exist r}))))
                             » Snd u)
                         (ListRel l)
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError)®,¬(((RelCombine
                         (InvRel
                               (Squash
                                   (Id
                                       (Dom
                                           (ListRel l'
                                               ’ {r|c dominates R_exist r}))))
                             » Snd u)
                         (ListRel l')
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError)®,
=TEX
=SML
		¬(((RelCombine
                         (InvRel
                               {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l
                                                           ’ {r
                                                           |c
           dominates R_exist r}))))
                                         + 1, Length l + 1)}
                             » Snd u)
                         {(Length l + 1, last')}
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError)®,¬(((RelCombine
                         (InvRel
                               {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l'
                                                           ’ {r
                                                           |c
           dominates R_exist r}))))
                                         + 1, Length l' + 1)}
                             » Snd u)
                         {(Length l' + 1, last)}
                       » Graph (updateRow c (TS_class t‰2)))
                     ’ {x|isError x})
                   » Graph destError)®]squash_À_ax)));
(* *** Goal "2.2.1.2.3" *** *)
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac[dom_null_thm] 
	THEN REPEAT ´_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2.2" *** *)
a(DROP_NTH_ASM_T 3(ante_tac o µ_elim¬last'®)THEN 
	asm_rewrite_tac[map_ë_thm,size_list_rel_ë_’_ax]);
a(´_T asm_tac THEN REPEAT ´_tac);
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
a(´_T rewrite_thm_tac);
a(asm_rewrite_tac[list_rel_ë_’_ax]THEN rewrite_tac[list_rel_ë_thm,rel_combine_À_thm]);
a(lemma_tac¬Dom(InvRel
                               (Squash
                                   (Id
                                       (Dom
                                           (ListRel l'
                                               ’ {r|c dominates R_exist r}))))
                             » Snd u) ¡ Dom{(Length l' + 1, last)}={}®);
(* *** Goal "2.2.2.1" *** *)
a(rewrite_tac[enumerate_def,r_»_r_thm,inv_rel_def,dom_def,id_def,squash_def,
	list_rel_def,’_thm,ò_thm,dot_dot_def]);
a(rewrite_tac[¡_def,sets_ext_clauses] THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.2" *** *)
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l' ’ {r|c dominates R_exist r}))))
                     » Snd u)®,¬{(Length l' + 1, last)}®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.2.3" *** *)
a(DROP_NTH_ASM_T 4(ante_tac o µ_elim¬l' ë [last]®) THEN 
	asm_rewrite_tac[map_ë_thm,size_list_rel_ë_’_ax]);
a(´_T asm_tac THEN REPEAT ´_tac);
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
a(´_T (rewrite_thm_tac o eq_sym_rule));
a(asm_rewrite_tac[list_rel_ë_’_ax]THEN rewrite_tac[list_rel_ë_thm,rel_combine_À_thm]);
a(lemma_tac¬Dom(InvRel
                               (Squash
                                   (Id
                                       (Dom
                                           (ListRel l
                                               ’ {r|c dominates R_exist r}))))
                             » Snd u) ¡ Dom{(Length l + 1, last')}={}®);
(* *** Goal "2.2.3.1" *** *)
a(rewrite_tac[enumerate_def,r_»_r_thm,inv_rel_def,dom_def,id_def,squash_def,
	list_rel_def,’_thm,ò_thm,dot_dot_def]);
a(rewrite_tac[¡_def,sets_ext_clauses] THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.3.2" *** *)
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l ’ {r|c dominates R_exist r}))))
                     » Snd u)®,¬{(Length l + 1, last')}®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.2.4" *** *)
a(asm_rewrite_tac[list_rel_ë_’_ax]THEN rewrite_tac[list_rel_ë_thm,rel_combine_À_thm]);
a(lemma_tac¬µl (last:Row) · Dom(InvRel
                               (Squash
                                   (Id
                                       (Dom
                                           (ListRel l
                                               ’ {r|c dominates R_exist r}))))
                             » Snd u) ¡ Dom{(Length l + 1, last)}={}®);
(* *** Goal "2.2.4.1" *** *)
a(REPEAT µ_tac);
a(rewrite_tac[enumerate_def,r_»_r_thm,inv_rel_def,dom_def,id_def,squash_def,
	list_rel_def,’_thm,ò_thm,dot_dot_def]);
a(rewrite_tac[¡_def,sets_ext_clauses] THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.4.2" *** *)
a(TOP_ASM_T(strip_asm_tac o list_µ_elim[¬l'®,¬last®]));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l' ’ {r|c dominates R_exist r}))))
                     » Snd u)®,¬{(Length l' + 1, last)}®]rel_combine_lemma));
a(POP_ASM_T rewrite_thm_tac);
a(POP_ASM_T (fn _ => id_tac) 
	THEN POP_ASM_T(strip_asm_tac o list_µ_elim[¬l®,¬last'®]));
a(strip_asm_tac(list_µ_elim[¬(InvRel
                       (Squash
                           (Id (Dom (ListRel l ’ {r|c dominates R_exist r}))))
                     » Snd u)®,¬{(Length l + 1, last')}®]rel_combine_lemma));
a(asm_rewrite_tac[]);
val ÛcleanTable_updateQuery_lemmaÝ = save_pop_thm"cleanTable_updateQuery_lemma";
=TEX
=GFT HOL output
cleanTable_updateQuery_lemma = 
ô µ c t‰1 t‰2 s‰1 s‰2 u
  · c dominates TS_class t‰1
        ± c dominates TS_class t‰2
        ± cleanTable c t‰1 = cleanTable c t‰2
      ´ Snd (updateQuery (c, u, s‰1, t‰1))
        = Snd (updateQuery (c, u, s‰2, t‰2))
=TEX
=SML
push_goal([],¬µ c s‰1 s‰2 · hide (c, s‰1) = hide (c, s‰2) ´ 	
(µ i ·  tabExists c i (repState s‰1) 
	´ 	((cleanTable c (getTable i (repState s‰1))
				=
				cleanTable c (getTable i (repState s‰2)))
		±
		(c dominates TS_class (getTable i (repState s‰1))
		¤
		c dominates TS_class (getTable i (repState s‰2)))))®);
=TEX
=SML
a(REPEAT µ_tac THEN ´_tac THEN µ_tac THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬c®,¬s‰1®,¬s‰2®]tabExists_lemma));
a(POP_ASM_T (strip_asm_tac o µ_elim¬i®));
a(DROP_ASMS_T (MAP_EVERY ante_tac) THEN rewrite_tac[dom_def,tabExists_def,
	hideR_def,hide_eq_lemma,’_thm,r_»_r_thm,rel_ext_clauses,graph_thm]
	THEN REPEAT ´_tac);
a(rewrite_tac[getTable_def]);
a(strip_asm_tac (rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰1®isState_lemma)));
a(strip_asm_tac (rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰2®isState_lemma)));
=TEX
=SML
a(DROP_NTH_ASM_T 4  ante_tac THEN DROP_NTH_ASM_T 2 ante_tac THEN 
	rewrite_tac[ª_def,get_spec¬IdeL®,get_spec¬DirectoryS®,¡_def,¸_def,
	get_spec¬Universe®,dom_def,’_thm,r_»_r_thm,graph_thm,rel_ext_clauses,
	get_spec¬$ð®] 
	THEN strip_tac THEN strip_tac);
a(strip_asm_tac(list_µ_elim[¬repState s‰1®,¬Front i®,¬y®]at_thm));
a(strip_asm_tac(list_µ_elim[¬repState s‰2®,¬Front i®,¬y''®]at_thm));
a(LIST_DROP_NTH_ASM_T [7,8,9,11,12,13](MAP_EVERY ante_tac)
	THEN  asm_rewrite_tac[] THEN REPEAT ´_tac);
a(DROP_NTH_ASM_T 10 (strip_asm_tac o list_µ_elim[¬Front i®,¬y''®]));
a(DROP_NTH_ASM_T 10 (strip_asm_tac o list_µ_elim[¬Front i®,¬y®]));
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac[ß_def,¡_def] 
	THEN REPEAT ´_tac);
=TEX
=SML
a(strip_asm_tac(list_µ_elim[¬Dir_tables y®,¬Last i®,¬y'®]at_thm));
a(strip_asm_tac(list_µ_elim[¬Dir_tables y''®,¬Last i®,¬y'''®]at_thm));
a(asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 19 (asm_tac o list_µ_elim[¬Front i®,¬cleanDirectory c y®]));
a(LEMMA_T¬¶ z
             · (c dominates Dir_exist z ± (Front i, z)  repState s‰1)
                 ± cleanDirectory c y = cleanDirectory c z®asm_tac);
(* *** Goal "1" *** *)
a(¶_tac¬y® THEN  asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z = y''®);
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 18(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Front i®,¬z®,¬y''®]));
(* *** Goal "2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a(asm_rewrite_tac[cleanDirectory_def,dir_components,get_spec¬MkDirectory®] THEN strip_tac);
a(DROP_NTH_ASM_T 3 ante_tac THEN rewrite_tac[rel_ext_clauses,graph_thm,r_»_r_thm] 
	THEN ´_T (asm_tac o list_µ_elim[¬Last i®,¬cleanTable c y'®]));
a(LEMMA_T¬¶ z· (Last i, z)  Dir_tables y ± cleanTable c y' = cleanTable c z®asm_tac);
=TEX
=SML
(* *** Goal "2.2.1" *** *)
a(¶_tac¬y'® THEN  asm_rewrite_tac[]);
(* *** Goal "2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z' = y'''®);
(* *** Goal "2.2.2.1" *** *)
a(DROP_NTH_ASM_T 11(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Last i®,¬z'®,¬y'''®]));
=TEX
=SML
(* *** Goal "2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac 
	THEN ´_tac THEN asm_rewrite_tac[] THEN POP_ASM_T ante_tac);
a(rewrite_tac[cleanTable_def]);
a(cases_tac¬c dominates TS_class y'''® THEN cases_tac¬c dominates TS_class y'® 
	THEN asm_rewrite_tac[tab_components,get_spec¬MkTableSpec®] 
	THEN strip_tac THEN_TRY asm_rewrite_tac[]);
(* *** Goal "2.2.2.2.1" *** *)
a(REPEAT strip_tac THEN contr_tac);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.2.2" *** *)
a(REPEAT strip_tac THEN contr_tac);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
val ÛtabExists_cleanTable_lemmaÝ = save_pop_thm"tabExists_cleanTable_lemma";
=TEX
=GFT HOL output
tabExists_cleanTable_lemma = ô µ c s‰1 s‰2
  · hide (c, s‰1) = hide (c, s‰2)
      ´ (µ i
      · tabExists c i (repState s‰1)
          ´ (cleanTable c (getTable i (repState s‰1))
                = cleanTable c (getTable i (repState s‰2))
              ± (c dominates TS_class (getTable i (repState s‰1))
                ¤ c dominates TS_class (getTable i (repState s‰2))))
=TEX
\subsubsection{Proof of Conjunct 3}

=SML
push_goal([],¬µ c s‰1 s‰2 e
        · hide (c, s‰1) = hide (c, s‰2)
            ´ Snd (updateState (c, e, s‰1)) = Snd (updateState (c, e, s‰2))®);
a(REPEAT strip_tac);
a(LEMMA_T¬e = (Fst e,Snd e)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],rewrite_tac[updateState_def,updateStateR_def]]);
a(lemma_tac¬(tabExists c (tabFromEffect (Fst e)) (repState s‰1) 
		´ tabExists c (tabFromEffect (Fst e)) (repState s‰2))
	± (tabExists c (tabFromEffect (Fst e)) (repState s‰2 )
		´ tabExists c (tabFromEffect (Fst e)) (repState s‰1))®);
=TEX
=SML
(* *** Goal "1" *** *)
a(strip_asm_tac(list_µ_elim[¬c®,¬s‰1®,¬s‰2®]tabExists_lemma)THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
(* invalid tables in s‰1 and s‰2 *)
a(strip_asm_tac(µ_elim ¬Fst e® query_type) THEN asm_rewrite_tac[]
	THEN cases_tac¬³ Snd e = []® THEN asm_rewrite_tac[]);
(* *** Goal "3" *** *)
(* valid tables in s‰1 and s‰2 *)
a(strip_asm_tac (list_µ_elim[¬c®,¬s‰1®,¬s‰2®]tabExists_cleanTable_lemma));
a(POP_ASM_T (strip_asm_tac o µ_elim¬tabFromEffect (Fst e)®));
(* *** Goal "3.1" *** *)
(* table classes not dominated  by c *)
a(EVERY[strip_asm_tac(µ_elim ¬Fst e® query_type),
	asm_rewrite_tac[],
	cases_tac¬³ Snd e = []®,
	asm_rewrite_tac[]]);
=TEX
=SML
(* *** Goal "3.2" *** *)
(* table classes dominated by c *)
a(EVERY[strip_asm_tac(µ_elim ¬Fst e® query_type),
	asm_rewrite_tac[],
	cases_tac¬³ Snd e = []®,
	asm_rewrite_tac[]]);
=TEX
=SML
(* Select and Delete automatically proven *)
(* *** Goal "3.2.1" *** *)
(* *** Insert *** *)
a(strip_asm_tac(list_µ_elim[¬c®,¬getTable (tabFromEffect (Fst e)) (repState s‰1)®,
	¬getTable (tabFromEffect (Fst e)) (repState s‰2)®,
	¬repState s‰1®,¬repState s‰2®,¬destInsert (Fst e)®]cleanTable_insertQuery_lemma));
=TEX
=SML
(* *** Goal "3.2.2" *** *)
(* *** Update *** *)
a(strip_asm_tac(list_µ_elim[¬c®,¬getTable (tabFromEffect (Fst e)) (repState s‰1)®,
	¬getTable (tabFromEffect (Fst e)) (repState s‰2)®,
	¬repState s‰1®,¬repState s‰2®,¬destUpdate (Fst e)®]cleanTable_updateQuery_lemma));
val Ûconjunct3Ý = save_pop_thm"conjunct3";
=TEX
=GFT HOL output
conjunct3 = ô µ c s‰1 s‰2 e
  · hide (c, s‰1) = hide (c, s‰2)
      ´ Snd (updateState (c, e, s‰1)) = Snd (updateState (c, e, s‰2))
=TEX


\section{CLOSING DOWN}
The following \Product{} instruction restores the previous proof context.
=SML
pop_pc();
=TEX

\newpage
\input{fef011th.tex}

\newpage
\twocolumn[\section{INDEX} \label{INDEX}]
\small
\printindex

\end{document}
push_goal([],¬µv· (isVal v ± ³ isError v)
	² (isError v ± ³ isVal v)®);
a(rewrite_tac[isVal_def,isError_def,giveVal_def]);
a(REPEAT strip_tac THEN_TRY asm_rewrite_tac[]);
(* *** Goal "1" *** *)
a(fc_tac[sum_cases_thm]);
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(¶_tac¬e‰1®THEN asm_rewrite_tac[]);
val Ûval_or_error_typeÝ = save_pop_thm"val_or_error_type";

