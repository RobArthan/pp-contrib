=TEX
% TQtemplate.tex
\documentstyle[hol1,11pt,TQ]{article}
\def\Hide#1{}
\def\Bool{``$\it{:}bool\,$''}
\makeindex
\TPPproject{DRA FRONT END FILTER PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Proof of Security (IIc)}  %% Mandatory field
\TPPref{DS/FMU/FEF/012}  %% Mandatory field
\def\SCCSversion{$Revision$
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$
}}  %% Mandatory field (with sensible default)
\TPPstatus{Draft}			%% Mandatory field
\TPPtype{Specification}
\TPPkeywords{}
\TPPauthor{G.~M.~Prout & WIN01}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthorisation{R.B.~Jones & HAT Manager}
\TPPabstract{This document provides a formal proof for the first  conjunct
of the security property
on the relationship between $hide$ and $updateState$ for the
DRA front end filter project RSRE 1C/6130.}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
	HAT FEF File \\
	Simon Wiseman
}}
%\TPPclass{CLASSIFICATION}
\newfont{\icllogo}{icllogo50}
\def\TPPheadlhs{$\vcenter{\halign{##\cr\icllogo ICL\cr}}$}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}

\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

%\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\newpage
\section {DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu,fef}

\subsection{Changes History}
\begin{description}
\item[Issue \SCCSversion(\FormatDate{$Date$
})] Product name changed. $top\_thm$ should be $pop\_thm$.
\end{description}

\subsection{Changes Forecast}
Changes  may be necessary  as a result of issues raised
during  the transcription of the specification.
\pagebreak
\section{GENERAL}
\subsection{Scope}
This document, together with \cite{DS/FMU/FEF/011} and \cite{DS/FMU/FEF/013}, provides a formal proof  that the components $hide$ and $updateState$ 
satisfy their critical 
requirements, as specified in 
the proof strategy \cite{DS/FMU/FEF/007}. It constitutes part of deliverable D6 
of work package 1a, as given
in section 7 of the Secure Database Technical Proposal, \cite{DS/FMU/017}.

\subsection{Introduction}

This document is a proof script which provides a formal proof which contributes to the proof
 of the second conjunct of $Lemma1$,
the requirement on the critical components  $hide$ and $updateState$, described in the proof strategy document \cite{DS/FMU/FEF/007}.

{\bf Lemma1}
=GFT 
	?ô 	hide  secureHide ± (hide,updateState)  secureUpdate
=TEX

In this document, we give a proof that the first conjunct of $secureUpdate$ holds for $hideR$ and $updateStateR$:
=GFT
	?ô 	µ c‰1 c‰2 s e  · 
			³ hideR (c‰2, repState s) 
			= hideR (c‰2, Fst (updateStateR (c‰1, e, repState s))) 
				´ c‰2 dominates c‰1
=TEX



\section{PRELIMINARIES}
The following \Product{} instructions set up the new theory $fef012$.

=SML 
open_theory "fef011";
new_theoryÛ"fef012"İ;
add_rw_thms [repState_absState_def] "fefrel";
push_merge_pcs["hol","fefhol","fefrel","'pair1"] ;
=TEX


\subsection{Consistency proofs}

=SML
push_consistency_goal¬destItem®;
a(¶_tac¬(OutL,OutL o OutR,OutR o OutR)®);
a(rewrite_tac[get_spec¬ItemUpdate®]);
save_consistency_thm¬destItem®(pop_thm());
val ÛdestItem_defİ = get_spec¬destItem®;
=TEX
=GFT HOL output
destItem_def = 
ô µ i c d
  · destItem (ItemUpdate i) = i
      ± destClass (ClassUpdate c) = c
      ± destData (DataUpdate d) = d
=TEX
\subsection{Retrieving the Remaining Constant Definition}

=SML
val ÛdeleteQuery_defİ = conv_rule(MAP_C let_conv)(get_spec¬deleteQuery®);
=TEX
=GFT HOL output
deleteQuery_def =
ô µ clear i ns e s ts
  · deleteQuery (clear, (i, ns), s, ts)
      = changeSpec
        i
        (replaceRows
            ts
            (Extract
                (1 .. Length (TS_rows ts)
                    \ revealRow clear ts Image ns
                      ¡ {i|R_exist (Nth (TS_rows ts) i) = clear})
                (TS_rows ts))) s
=TEX

\subsection{Axioms}

=SML
val Ûconjunct1_ax1İ =  new_axiom(["conjunct1_ax1"],
	¬µ l last c (u : î ª (î ª Update)) t ·
	u  Functional
	´
	RelList (ListRel (l ë [last])
                         « (RelCombine
                             (InvRel
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l
                                                   ’ {r|c dominates R_exist r}))))
                                 » u)
                             (ListRel l)
                           » Graph (updateRow c (TS_class t))) » Graph destVal)
	= RelList (ListRel l « (RelCombine
                             (InvRel
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l
                                                   ’ {r|c dominates R_exist r}))))
                                 » u)
                             (ListRel l)
                           » Graph (updateRow c (TS_class t))) » Graph destVal) ë [last]®);
=TEX
=SML
val Ûconjunct1_ax2İ =  new_axiom(["conjunct1_ax2"],
	¬µ c last l u us t · 
		(us  Functional
		± c dominates R_exist last 
		± (#(Squash (Id (Dom(ListRel (l ë [last])
                                   ’ {r|c dominates R_exist r})))),u)  us) 
	´
		RelList
                     (ListRel (l ë [last])
                         « (RelCombine
                             (InvRel
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel (l ë [last])
                                                   ’ {r|c dominates R_exist r}))))
                                 » us)
                             (ListRel (l ë [last]))
                           » Graph (updateRow c (TS_class t)))
                         » Graph destVal) = RelList
                       (ListRel l
                           « (RelCombine
                               (InvRel
                                     (Squash
                                         (Id
                                             (Dom
                                                 (ListRel l
                                                     ’ {r
                                                     |c dominates R_exist r}))))
                                   » us)
                               (ListRel l)
                             » Graph (updateRow c (TS_class t)))
                           » Graph destVal) ë [destVal(updateRow c (TS_class t)(u,last))]®);
=TEX



\subsection{Auxiliary Theorems}
=SML
val ÛdestVal_defİ = all_µ_intro(nth 2 (strip_±_rule (all_µ_elim giveVal_def)));
val ÛdestError_defİ = all_µ_intro(nth 3 (strip_±_rule (all_µ_elim giveVal_def)));
=TEX
=GFT HOL output
destVal_def = ô µ v· destVal (giveVal v) = v
destError_def = ô µ e· destError (giveError e) = e
=TEX
=SML
val Û³giveVal_eq_giveError_thmİ = save_thm("³giveVal_eq_giveError_thm",
	prove_rule[giveVal_def]¬µ v e· ³(giveVal v = giveError e)®);
val Û³giveError_eq_giveVal_thmİ = save_thm("³giveError_eq_giveVal_thm",
	prove_rule[giveVal_def]¬µ e v· ³(giveError e = giveVal v)®);
=TEX
=GFT HOL output
³giveVal_eq_giveError_thm = ô µ v e· ³ giveVal v = giveError e
³giveError_eq_giveVal_thm = ô µ e v· ³ giveError e = giveVal v
=TEX

=SML
push_goal([],¬µ l (last:Row) s (u : î ª (î ª Update)) · 
	RelCombine(InvRel (Squash(Id (Dom(ListRel l ’ s)))) » u)
                               (ListRel (l ë [last]))
	= RelCombine(InvRel (Squash(Id (Dom(ListRel l ’ s)))) » u)
                               (ListRel l)®);
a(rewrite_tac[rel_combine_def,rel_ext_clauses,list_rel_def,’_thm,ò_thm,
	dot_dot_def,length_ë_one_thm]);
a(REPEAT strip_tac);
(* *** Goal "1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(DROP_NTH_ASM_T 5(strip_asm_tac o rewrite_rule[enumerate_def,inv_rel_def,dom_def,
	id_def,squash_def,’_thm,ò_thm]));
a(DROP_NTH_ASM_T 8 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "3" *** *)
a(DROP_NTH_ASM_T 5(strip_asm_tac o rewrite_rule[enumerate_def,inv_rel_def,dom_def,
	id_def,squash_def,’_thm,ò_thm]));
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬z'®,¬last®]nth_ë_thm1)));
a(POP_ASM_T ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
(* *** Goal "4" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "5" *** *)
a(fc_tac[¼_plus_one_thm]);
(* *** Goal "6" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(asm_rewrite_tac[]);
val Ûrel_combine_one_lemmaİ = save_pop_thm"rel_combine_one_lemma";
=TEX
=GFT HOL output
rel_combine_one_lemma =
 ô µ l last s u
  · RelCombine
        (InvRel (Squash (Id (Dom (ListRel l ’ s)))) » u)
        (ListRel (l ë [last]))
      = RelCombine
        (InvRel (Squash (Id (Dom (ListRel l ’ s)))) » u)
        (ListRel l)
=TEX
=SML
push_goal([],¬µ l last c t us· ((RelCombine
                     (InvRel
                           (Squash
                               (Id
                                   (Dom
                                       (ListRel (l ë [last])
                                           ’ {r|c dominates R_exist r}))))
                         » us)
                     (ListRel (l ë [last]))
                   » Graph (updateRow c (TS_class t)))
                 ’ {x|isError x})
               » Graph destError
             = {} ´ ((RelCombine
                       (InvRel
                             (Squash
                                 (Id
                                     (Dom
                                         (ListRel l ’ {r|c dominates R_exist r}))))
                           » us)
                       (ListRel l)
                     » Graph (updateRow c (TS_class t)))
                   ’ {x|isError x})
                 » Graph destError
               = {}®); 
a(REPEAT µ_tac);
a(cases_tac¬c dominates R_exist last®THEN asm_rewrite_tac
	[squash_ë_ax,inv_rel_À_thm,rel_combine_À_thm,»_À_thm]);
(* *** Goal "1" *** *)
a(rewrite_tac[À_null_thm]THEN strip_tac);
a(DROP_NTH_ASM_T 3 (fn _ => id_tac) THEN POP_ASM_T(fn _ => id_tac));
set_labelled_goal"2";
(* *** Goal "1 & 2" *** *)
a(POP_ASM_T(fn _ => id_tac) THEN strip_tac);
a(POP_ASM_T (strip_asm_tac o rewrite_rule[rel_combine_one_lemma]));
val Ûrel_combine_null_lemmaİ = save_pop_thm"rel_combine_null_lemma";
=TEX
=GFT HOL output
rel_combine_null_lemma =
ô µ l last c t us
  · ((RelCombine
                (InvRel
                      (Squash
                          (Id
                              (Dom
                                  (ListRel (l ë [last])
                                      ’ {r|c dominates R_exist r}))))
                    » us)
                (ListRel (l ë [last]))
              » Graph (updateRow c (TS_class t)))
            ’ {x|isError x})
          » Graph destError
        = {}
      ´ ((RelCombine
                (InvRel
                      (Squash
                          (Id (Dom (ListRel l ’ {r|c dominates R_exist r}))))
                    » us)
                (ListRel l)
              » Graph (updateRow c (TS_class t)))
            ’ {x|isError x})
          » Graph destError
        = {}
=TEX


\section{PROOF OF SECURITY OF CRITICAL COMPONENTS}
The main proof of this section is built up from a series of lemmas.
\subsection{Insert Lemmas}

=SML
push_goal([],¬µ c‰1 c‰2 t ds · 
	³ c‰2 dominates c‰1  
	´ cleanTable c‰2 t = cleanTable c‰2 (replaceRows t 
		((TS_rows t) ë (Map((MkRow c‰1) o (colDefaults c‰1 t))ds)))®);
a(REPEAT strip_tac);
a(rewrite_tac[cleanTable_def,replaceRows_def,get_spec¬MkTableSpec®]);
a(cases_tac¬c‰2 dominates TS_class t®THEN 
	asm_rewrite_tac[tab_components,get_spec¬MkTableSpec®,cleanColCons_def]);
a(rewrite_tac[cleanRows_def,revealRow_def]);
a(lemma_tac ¬(Map (MkRow c‰1 o colDefaults c‰1 t) ds)ù {r|c‰2 dominates R_exist r} = []®);
(* *** Goal "1" *** *)
a(REV_LIST_INDUCTION_T¬ds®asm_tac);
(* *** Goal "1.1" *** *)
a(rewrite_tac[map_def,ù_def]);
(* *** Goal "1.2" *** *)
a(rewrite_tac[map_ë_thm,ù_thm,get_spec¬MkRow®]);
a(µ_tac THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(asm_rewrite_tac[ë_ù_thm,ë_null_thm1]);
val ÛinsertRows_lemmaİ = save_pop_thm"insertRows_lemma";
=TEX
=GFT HOL output
insertRows_lemma =
 ô µ c‰1 c‰2 t ds
  · ³ c‰2 dominates c‰1
      ´ cleanTable c‰2 t
        = cleanTable
          c‰2
          (replaceRows
              t
              (TS_rows t ë Map (MkRow c‰1 o colDefaults c‰1 t) ds))
=TEX

=SML
push_goal([],¬µ c‰1 c‰2 s i ds
        · (³ c‰2 dominates c‰1 ± tabExists c‰1 (tabFromEffect (InsertEffect (i,ds))) (repState s))
	´ hideR (c‰2, repState s)
             = hideR(c‰2, Fst(insertQuery
                           (c‰1, destInsert(InsertEffect (i,ds)), repState s,getTable 
			(tabFromEffect (InsertEffect (i,ds))) (repState s))))®);
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN rewrite_tac[destInsert_def,tabFromEffect_def,
	getTable_def,rewrite_rule[dom_def]tabExists_def]);
a(REPEAT strip_tac);
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s®,¬Front i®,¬y®]at_thm));
=TEX
=SML
a(LIST_DROP_NTH_ASM_T[4,5,6](MAP_EVERY ante_tac) 
	THEN TOP_ASM_T rewrite_thm_tac);
a(REPEAT ´_tac THEN DROP_NTH_ASM_T 6  ante_tac  THEN 
	rewrite_tac[ª_def,get_spec¬IdeL®,get_spec¬DirectoryS®,¡_def,¸_def,
	get_spec¬Universe®,dom_thm,rel_ext_clauses,get_spec¬$ğ®]THEN strip_tac);
a(asm_fc_tac[]);
a(POP_ASM_T ante_tac THEN rewrite_tac[ß_def,¡_def]THEN REPEAT ´_tac);
a(strip_asm_tac(list_µ_elim[¬Dir_tables y®,¬Last i®,¬y'®]at_thm));
a(asm_rewrite_tac[]);
a(REPEAT µ_tac);
a(rewrite_tac[insertQuery_def]);
=TEX
=SML
a(cases_tac¬³ Elems(Map(MkRow c‰1 o colDefaults c‰1 y') ds)
	€ RowS®THEN asm_rewrite_tac[]);
a(asm_rewrite_tac[changeSpec_def,hideR_def,rel_ext_clauses]);
a(REPEAT strip_tac);
=TEX
=SML
(* *** Goal "1" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front i®asm_tac);
(* *** Goal "1.1" *** *)
a(¶_tac¬MkDirectory
                         (Dir_tables y
                             « {(Last i,
                                 replaceRows
                                     y'
                                     (TS_rows y'
                                         ë Map
                                           (MkRow c‰1 o colDefaults c‰1 y')
                                           ds))})
                         (Dir_exist y)
                         (Dir_class y)®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
a(lemma_tac¬y = z®);
(* *** Goal "1.1.1" *** *)
a(DROP_NTH_ASM_T 15 ante_tac THEN TOP_ASM_T (rewrite_thm_tac o eq_sym_rule)
	THEN strip_tac); 
a(DROP_NTH_ASM_T 15(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬x®,¬y®,¬z®]));
=TEX
=SML
(* *** Goal "1.1.2" *** *)
a(asm_rewrite_tac[cleanDirectory_def]);
a(cases_tac¬c‰2 dominates Dir_class z®THEN asm_rewrite_tac
	[get_spec¬MkDirectory®,dir_components]);
a(rewrite_tac[rel_ext_clauses,«_single]);
a(REPEAT µ_tac);
a(cases_tac¬x' = Last i®THEN asm_rewrite_tac[]);
a(¤_T strip_asm_tac);
(* *** Goal "1.1.2.1" *** *)
a(lemma_tac¬y' = z'®);
(* *** Goal "1.1.2.1.1" *** *)
a(DROP_NTH_ASM_T 15 ante_tac THEN DROP_NTH_ASM_T 12 ante_tac 
	THEN asm_rewrite_tac[]THEN REPEAT ´_tac);
a(DROP_NTH_ASM_T 2(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Last i®,¬y'®,¬z'®]));
(* *** Goal "1.1.2.1.2" *** *)
a(prove_¶_tac);
a(asm_rewrite_tac[]);
a(bc_tac[insertRows_lemma] THEN asm_rewrite_tac[]);
(* *** Goal "1.1.2.2" *** *)
a(¶_tac¬y'® THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 5(asm_rewrite_thm_tac o eq_sym_rule));
a(conv_tac eq_sym_conv);
a(bc_tac[insertRows_lemma] THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "1.2" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(CASES_T¬x = Front i®asm_tac);
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_single,get_spec¬MkDirectory®,
	dir_components]THEN strip_tac);
a(¶_tac¬y®THEN asm_rewrite_tac[]);
a(GET_NTH_ASM_T 2 (rewrite_thm_tac o eq_sym_rule));
a(GET_NTH_ASM_T 6 rewrite_thm_tac);
a(rewrite_tac[cleanDirectory_def,rel_ext_clauses]);
a(cases_tac¬c‰2 dominates Dir_class y®THEN asm_rewrite_tac
	[get_spec¬MkDirectory®,dir_components]);
a(rewrite_tac[rel_ext_clauses,«_single]);
a(REPEAT µ_tac);
a(cases_tac¬x' = Last i®THEN asm_rewrite_tac[]);
a(¤_T strip_asm_tac);
(* *** Goal "2.1.1" *** *)
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
a(conv_tac eq_sym_conv);
a(bc_tac[insertRows_lemma] THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.1.2" *** *)
a prove_¶_tac;
a(lemma_tac¬z' = y'®);
(* *** Goal "2.1.2.1" *** *)
a(DROP_NTH_ASM_T 13 (asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Last i®,¬z'®,¬y'®]));
(* *** Goal "2.1.2.2" *** *)
a(asm_rewrite_tac[]);
a(bc_tac[insertRows_lemma] THEN asm_rewrite_tac[]);
(* *** Goal "2.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_single,get_spec¬MkDirectory®,
	dir_components]THEN strip_tac);
a(¶_tac¬z®THEN asm_rewrite_tac[]);
val ÛinsertQuery_lemmaİ = save_pop_thm"insertQuery_lemma";
=TEX
=GFT HOL output
insertQuery_lemma =
ô µ c‰1 c‰2 s i ds
  · ³ c‰2 dominates c‰1
        ± tabExists c‰1 (tabFromEffect (InsertEffect (i, ds))) (repState s)
      ´ hideR (c‰2, repState s)
        = hideR
          (c‰2,
              insertQuery
                  (c‰1, destInsert (InsertEffect (i, ds)), repState s,
                      getTable
                          (tabFromEffect (InsertEffect (i, ds)))
                          (repState s)))
=TEX
\subsection{Delete Lemmas}


=SML
push_goal([],¬µ c‰1 c‰2 s t ns · 
	³ c‰2 dominates c‰1  
	´ cleanTable c‰2 t = cleanTable c‰2 (replaceRows t 
		(Extract (1 .. Length(TS_rows t) \ 
	((revealRow c‰1 t) Image ns ¡ {i|R_exist(Nth(TS_rows t)i) = c‰1}))
	(TS_rows t)))®);
a(REPEAT strip_tac);
a(rewrite_tac[cleanTable_def,replaceRows_def,get_spec¬MkTableSpec®]);
a(cases_tac¬c‰2 dominates TS_class t®THEN 
	asm_rewrite_tac[tab_components,get_spec¬MkTableSpec®,cleanColCons_def]);
a(rewrite_tac[cleanRows_def,revealRow_def]);
=TEX
=SML
a(LEMMA_T¬TS_rows t ù {r|c‰2 dominates R_exist r} = 
	Extract
                     (1 .. Length (TS_rows t)
                         \ Squash
                               (Id
                                   (Dom
                                       (ListRel (TS_rows t)
                                           ’ {r|c‰1 dominates R_exist r})))
                             Image ns
                           ¡ {i|R_exist (Nth (TS_rows t) i) = c‰1})
                     (TS_rows t)
                   ù {r|c‰2 dominates R_exist r}®rewrite_thm_tac);
a(lemma_tac¬¶ l · TS_rows t = l®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(REV_LIST_INDUCTION_T¬l®asm_tac);
=TEX
=SML
(* *** Goal "1" *** *)
a(rewrite_tac[extract_def,rel_list_null_thm]);
(* *** Goal "2" *** *)
a(µ_tac THEN cases_tac¬c‰2 dominates R_exist last®THEN 
	cases_tac¬c‰1 dominates R_exist last®
	THEN asm_rewrite_tac[extract_ë_single_ax,squash_ë_ax,length_ë_one_thm,
	dot_dot_def,image_À_thm,À_¡_thm]);
(* *** Goal "2.1" *** *)
a(LEMMA_T¬Length l + 1  {i|1 ¼ i ± i ¼ Length l + 1}
                       \ Squash
                               (Id(Dom(ListRel l
                                           ’ {r|c‰1 dominates R_exist r})))
                             Image ns
                           ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1}
                         À {(Size(Squash(Id(Dom(ListRel l
                              ’ {r |c‰1 dominates R_exist r}))))
                                     + 1, Length l + 1)}
                             Image ns
                           ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1}® rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.1.1" *** *)
a(REPEAT strip_tac THEN POP_ASM_T(asm_tac o rewrite_rule[nth_length_one_thm])
	THEN DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2" *** *)
a(rewrite_tac[extract_def]);
a(LEMMA_T¬{i|1 ¼ i ± i ¼ Length l}
                           \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth l i) = c‰1}
                         ò ListRel l =
	{i|1 ¼ i ± i ¼ Length l + 1}
                           \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                                 Image ns
                               ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1}
                             À {(Size(Squash(Id(Dom(ListRel l
                                              ’ {r|c‰1 dominates R_exist r}))))
                                         + 1, Length l + 1)}
                                 Image ns
                               ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1}
                         ò ListRel l®asm_rewrite_thm_tac);
=TEX
=SML
a(rewrite_tac[set_dif_À_thm,rel_ext_clauses,ò_def,’_def,list_rel_def,image_def,
	dot_dot_def,¼_plus1_thm]);
a(REPEAT strip_tac THEN_TRY asm_rewrite_tac[]);
(* *** Goal "2.1.2.1" *** *)
a(spec_nth_asm_tac 4 ¬x'®);
(* *** Goal "2.1.2.2" *** *)
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2.3" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2.4" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[nth_length_one_thm]);
a(´_tac THEN DROP_NTH_ASM_T 9 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2.5" *** *)
a(spec_nth_asm_tac 6 ¬x'®);
(* *** Goal "2.1.2.6" *** *)
a(spec_nth_asm_tac 6 ¬x'®);
(* *** Goal "2.1.2.7" *** *)
a(spec_nth_asm_tac 6 ¬x'®);
(* *** Goal "2.1.2.8" *** *)
a(spec_nth_asm_tac 6 ¬x'®);
(* *** Goal "2.1.2.9" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.1.2.10" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2.11" *** *)
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2.13" *** *)
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2.14" *** *)
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2.15" *** *)
a(spec_nth_asm_tac 5 ¬x'®);
(* *** Goal "2.1.2.16" *** *)
a(spec_nth_asm_tac 5 ¬x'®);
(* *** Goal "2.1.2.17" *** *)
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2.18" *** *)
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2.19" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2.20" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2" *** *)
a(LEMMA_T¬Length l + 1
                      {i|1 ¼ i ± i ¼ Length l + 1}
                       \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                           Image ns
                         ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1}®rewrite_thm_tac);
(* *** Goal "2.2.1" *** *)
a(rewrite_tac[image_def,squash_def,enumerate_def,list_rel_def,
	id_def,dom_thm,’_thm,ò_thm,dot_dot_def,length_ë_one_thm]);
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 8 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2" *** *)
a(asm_rewrite_tac[extract_def]);
a(LEMMA_T¬{i|1 ¼ i ± i ¼ Length l}
                           \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth l i) = c‰1}
                         ò ListRel l={i|1 ¼ i ± i ¼ Length l + 1}
                           \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1}
                         ò ListRel l®rewrite_thm_tac);
=TEX
=SML
a(rewrite_tac[ò_thm,list_rel_def,dot_dot_def,set_dif_def,rel_ext_clauses]);
a(REPEAT strip_tac);
(* *** Goal "2.2.2.1" *** *)
a(asm_rewrite_tac[¼_plus1_thm]);
(* *** Goal "2.2.2.2" *** *)
a(asm_rewrite_tac[¼_plus1_thm]);
(* *** Goal "2.2.2.3" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.4" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.3" *** *)
a(rewrite_tac[image_single_thm,set_dif_À_thm]);
a(cases_tac¬Size (Squash(Id(Dom(ListRel l ’ {r|c‰1 dominates R_exist r}))))
                                   + 1
                                  ns®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.3.1" *** *)
a(CASES_T¬Length l + 1
                      ({i|1 ¼ i ± i ¼ Length l + 1}
                         \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                             Image ns
                           ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1})
                       ¡ ({i|1 ¼ i ± i ¼ Length l + 1}
                         \ {Length l + 1} ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1})®
	asm_tac THEN TOP_ASM_T asm_rewrite_thm_tac);
(*  2.3.1.1 and 2.3.1.2 the same except for unnecessary assumption 1 *)
(* *** Goal "2.3.1.1" *** *)
a(POP_ASM_T (fn _ => id_tac));
set_labelled_goal"2.3.1.2";
=TEX
=SML
(* *** Goal "2.3.1.2" *** *)
a(POP_ASM_T (fn _ => id_tac));
a(rewrite_tac[extract_def]);
a(LEMMA_T¬{i|1 ¼ i ± i ¼ Length l}
                           \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth l i) = c‰1}
                         ò ListRel l = 
	({i|1 ¼ i ± i ¼ Length l + 1}
                             \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                                 Image ns
                               ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1})
                           ¡ ({i|1 ¼ i ± i ¼ Length l + 1}
                             \ {Length l + 1} ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1})
                         ò ListRel l®rewrite_thm_tac);
=TEX
=SML
a(rewrite_tac[rel_ext_clauses,ò_def,’_def,list_rel_def,image_def,dot_dot_def,¼_plus1_thm]);
a(REPEAT strip_tac);
(* *** Goal "2.3.1.2.1" *** *)
a(spec_nth_asm_tac 4 ¬x'®);
(* *** Goal "2.3.1.2.2" *** *)
a contr_tac;
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.3.1.2.3" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.3.1.2.4" *** *)
a contr_tac;
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.3.1.2.5" *** *)
a(spec_nth_asm_tac 6 ¬x'®);
(* *** Goal "2.3.1.2.6" *** *)
a(spec_nth_asm_tac 6 ¬x'®);
=TEX
=SML
(* *** Goal "2.3.1.2.7" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.3.1.2.9" *** *)
a(spec_nth_asm_tac 6 ¬x'®);
(* *** Goal "2.3.1.2.10" *** *)
a(spec_nth_asm_tac 5 ¬x'®);
(* *** Goal "2.3.1.2.11" *** *)
a(spec_nth_asm_tac 5 ¬x'®);
(* *** Goal "2.3.1.2.12" *** *)
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.3.1.2.13" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.3.1.2.14" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.3.2" *** *)
a(CASES_T¬Length l + 1
                      ({i|1 ¼ i ± i ¼ Length l + 1}
                         \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                             Image ns
                           ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1})
                       ¡ {i|1 ¼ i ± i ¼ Length l + 1}®
	asm_tac THEN TOP_ASM_T asm_rewrite_thm_tac);
(*  2.3.2.1 and 2.3.2.2 the same except for unnecessary assumption 1 *)
(* *** Goal "2.3.2.1" *** *)
a(POP_ASM_T (fn _ => id_tac));
set_labelled_goal"2.3.2.2";
(* *** Goal "2.3.2.2" *** *)
a(POP_ASM_T (fn _ => id_tac));
a(rewrite_tac[extract_def]);
=TEX
=SML
a(LEMMA_T¬{i|1 ¼ i ± i ¼ Length l}
                           \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth l i) = c‰1}
                         ò ListRel l = 
	({i|1 ¼ i ± i ¼ Length l + 1}
                             \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                                 Image ns
                               ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1})
                           ¡ {i|1 ¼ i ± i ¼ Length l + 1}
                         ò ListRel l®rewrite_thm_tac);
a(rewrite_tac[rel_ext_clauses,ò_def,’_def,list_rel_def,image_def,dot_dot_def,¼_plus1_thm]);
a(REPEAT strip_tac);
=TEX
=SML
(* *** Goal "2.3.2.2.1" *** *)
a(spec_nth_asm_tac 4 ¬x'®);
(* *** Goal "2.3.2.2.2" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.3.2.2.3" *** *)
a(spec_nth_asm_tac 5 ¬x'®);
(* *** Goal "2.3.2.2.5" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.3.2.2.7" *** *)
a(spec_nth_asm_tac 5 ¬x'®);
(* *** Goal "2.3.2.2.8" *** *)
a(spec_nth_asm_tac 4 ¬x'®);
(* *** Goal "2.3.2.2.9" *** *)
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.3.2.2.10" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.4" *** *)
a(CASES_T¬Length l + 1
                      {i|1 ¼ i ± i ¼ Length l + 1}
                       \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                           Image ns
                         ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1}®
	asm_tac THEN TOP_ASM_T asm_rewrite_thm_tac);
(*  2.4.1 and 2.4.2 the same except for unnecessary assumption 1 *)
(* *** Goal "2.4.1" *** *)
a(POP_ASM_T (fn _ => id_tac));
set_labelled_goal"2.4.2";
(* *** Goal "2.4.2" *** *)
a(POP_ASM_T (fn _ => id_tac));
a(rewrite_tac[extract_def]);
=TEX
=SML
a(LEMMA_T¬{i|1 ¼ i ± i ¼ Length l}
                           \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth l i) = c‰1}
                         ò ListRel l = 
	{i|1 ¼ i ± i ¼ Length l + 1}
                           \ Squash (Id (Dom (ListRel l ’ {r|c‰1 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l ë [last]) i) = c‰1}
                         ò ListRel l®rewrite_thm_tac);
a(rewrite_tac[rel_ext_clauses,ò_def,’_def,list_rel_def,image_def,dot_dot_def,¼_plus1_thm]);
a(REPEAT strip_tac);
=TEX
=SML
(* *** Goal "2.4.2.1" *** *)
a(spec_nth_asm_tac 4 ¬x'®);
(* *** Goal "2.4.2.2" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.4.2.3" *** *)
a(spec_nth_asm_tac 5 ¬x'®);
(* *** Goal "2.4.2.4" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.4.2.5" *** *)
a(spec_nth_asm_tac 4 ¬x'®);
(* *** Goal "2.4.2.6" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x®,¬last®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
val ÛdeleteRows_lemmaİ = save_pop_thm"deleteRows_lemma";
=TEX
=GFT HOL output
deleteRows_lemma =
 ô µ c‰1 c‰2 s t ns
  · ³ c‰2 dominates c‰1
      ´ cleanTable c‰2 t
        = cleanTable
          c‰2
          (replaceRows
              t
              (Extract
                  (1 .. Length (TS_rows t)
                      \ revealRow c‰1 t Image ns
                        ¡ {i|R_exist (Nth (TS_rows t) i) = c‰1})
                  (TS_rows t)))
=TEX
=SML
push_goal([],¬µ c‰1 c‰2 s i ns
        · (³ c‰2 dominates c‰1 ± tabExists c‰1 (tabFromEffect (DeleteEffect (i,ns))) (repState s))
	´ hideR (c‰2, repState s)
             = hideR(c‰2, deleteQuery
                           (c‰1, destDelete(DeleteEffect (i,ns)), repState s,getTable 
			(tabFromEffect (DeleteEffect (i,ns))) (repState s)))®);
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN rewrite_tac[destInsert_def,tabFromEffect_def,
	getTable_def,rewrite_rule[dom_def]tabExists_def]);
a(REPEAT strip_tac);
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s®,¬Front i®,¬y®]at_thm));
a(LIST_DROP_NTH_ASM_T[4,5,6](MAP_EVERY ante_tac) 
	THEN TOP_ASM_T rewrite_thm_tac);
a(REPEAT ´_tac THEN DROP_NTH_ASM_T 6  ante_tac  THEN 
	rewrite_tac[ª_def,get_spec¬IdeL®,get_spec¬DirectoryS®,¡_def,¸_def,
	get_spec¬Universe®,dom_thm,rel_ext_clauses,get_spec¬$ğ®]THEN strip_tac);
a(asm_fc_tac[]);
a(POP_ASM_T ante_tac THEN rewrite_tac[ß_def,¡_def]THEN REPEAT ´_tac);
a(strip_asm_tac(list_µ_elim[¬Dir_tables y®,¬Last i®,¬y'®]at_thm));
a(asm_rewrite_tac[]);
a(REPEAT µ_tac);
a(rewrite_tac[deleteQuery_def]);
a(asm_rewrite_tac[changeSpec_def,hideR_def,rel_ext_clauses]);
a(REPEAT strip_tac);
=TEX
=SML
(* *** Goal "1" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front i®asm_tac);
(* *** Goal "1.1" *** *)
a(¶_tac¬MkDirectory(Dir_tables y
                             « {(Last i,
                                 replaceRows
                                     y'
                                     (Extract
                                         (1 .. Length (TS_rows y')
                                             \ revealRow c‰1 y' Image ns
                                               ¡ {i
                                               |R_exist (Nth (TS_rows y') i) = c‰1})
                                         (TS_rows y')))})
                         (Dir_exist y)
                         (Dir_class y)®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
a(lemma_tac¬y = z®);
=TEX
=SML
(* *** Goal "1.1.1" *** *)
a(DROP_NTH_ASM_T 14 ante_tac THEN TOP_ASM_T (rewrite_thm_tac o eq_sym_rule)
	THEN strip_tac); 
a(DROP_NTH_ASM_T 14(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬x®,¬y®,¬z®]));
(* *** Goal "1.1.2" *** *)
a(asm_rewrite_tac[cleanDirectory_def]);
a(cases_tac¬c‰2 dominates Dir_class z®THEN asm_rewrite_tac
	[get_spec¬MkDirectory®,dir_components]);
a(rewrite_tac[rel_ext_clauses,«_single]);
a(REPEAT µ_tac);
a(cases_tac¬x' = Last i®THEN asm_rewrite_tac[]);
a(¤_T strip_asm_tac);
(* *** Goal "1.1.2.1" *** *)
a(lemma_tac¬y' = z'®);
(* *** Goal "1.1.2.1.1" *** *)
a(DROP_NTH_ASM_T 14 ante_tac THEN DROP_NTH_ASM_T 11 ante_tac 
	THEN asm_rewrite_tac[]THEN REPEAT ´_tac);
a(DROP_NTH_ASM_T 2(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Last i®,¬y'®,¬z'®]));
(* *** Goal "1.1.2.1.2" *** *)
a(prove_¶_tac);
a(asm_rewrite_tac[]);
a(bc_tac[deleteRows_lemma] THEN asm_rewrite_tac[]);
(* *** Goal "1.1.2.2" *** *)
a(¶_tac¬y'® THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 5(asm_rewrite_thm_tac o eq_sym_rule));
a(conv_tac eq_sym_conv);
a(bc_tac[deleteRows_lemma] THEN asm_rewrite_tac[]);
(* *** Goal "1.2" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2" *** *)
a(CASES_T¬x = Front i®asm_tac);
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac
	[«_single,get_spec¬MkDirectory®,dir_components]THEN strip_tac);
a(¶_tac¬y®THEN asm_rewrite_tac[]);
a(GET_NTH_ASM_T 2 (rewrite_thm_tac o eq_sym_rule));
a(GET_NTH_ASM_T 6 rewrite_thm_tac);
a(rewrite_tac[cleanDirectory_def,rel_ext_clauses]);
a(cases_tac¬c‰2 dominates Dir_class y®THEN asm_rewrite_tac
	[get_spec¬MkDirectory®,dir_components]);
a(rewrite_tac[rel_ext_clauses,«_single]);
a(REPEAT µ_tac);
a(cases_tac¬x' = Last i®THEN asm_rewrite_tac[]);
a(¤_T strip_asm_tac);
(* *** Goal "2.1.1" *** *)
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
a(conv_tac eq_sym_conv);
a(bc_tac[deleteRows_lemma] THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.1.2" *** *)
a prove_¶_tac;
a(lemma_tac¬z' = y'®);
(* *** Goal "2.1.2.1" *** *)
a(DROP_NTH_ASM_T 12 (asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Last i®,¬z'®,¬y'®]));
(* *** Goal "2.1.2.2" *** *)
a(asm_rewrite_tac[]);
a(bc_tac[deleteRows_lemma] THEN asm_rewrite_tac[]);
(* *** Goal "2.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac
	[«_single,get_spec¬MkDirectory®,dir_components]THEN strip_tac);
a(¶_tac¬z®THEN asm_rewrite_tac[]);
val ÛdeleteQuery_lemmaİ = save_pop_thm"deleteQuery_lemma";
=TEX
=GFT HOL output
deleteQuery_lemma =
ô µ c‰1 c‰2 s i ns
  · ³ c‰2 dominates c‰1
        ± tabExists c‰1 (tabFromEffect (DeleteEffect (i, ns))) (repState s)
      ´ hideR (c‰2, repState s)
        = hideR
          (c‰2,
              deleteQuery
                  (c‰1, destDelete (DeleteEffect (i, ns)), repState s,
                      getTable
                          (tabFromEffect (DeleteEffect (i, ns)))
                          (repState s)))
=TEX
\subsection{Update Lemmas}

=SML
push_goal([],¬µ c‰1 c‰2 d tc u 
        · c‰1 dominates tc ± c‰2 dominates tc
	´ (³ c‰2 dominates c‰1 ± isVal(updateField c‰1 tc (u, d))
	´ replaceData c‰2 d = replaceData c‰2 (destVal(updateField c‰1 tc (u, d))))®);
a(REPEAT strip_tac);
a(lemma_tac¬³ c‰1 = tc®);
(* *** Goal "1" *** *)
a contr_tac;
a(DROP_NTH_ASM_T 4 ante_tac THEN (POP_ASM_T (rewrite_thm_tac o eq_sym_rule))
	THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN rewrite_tac[updateField_def]);
a(cases_tac ¬isItem u® THEN asm_rewrite_tac[destVal_def]
	THEN POP_ASM_T(strip_asm_tac o rewrite_rule[get_spec¬isItem®]) 
	THEN asm_rewrite_tac[³isVal_giveError_thm]);
a(cases_tac¬Dat_class d dominates c‰1®
	THEN asm_rewrite_tac[destVal_def,get_spec¬MkData®,³isVal_giveError_thm]);
a(´_tac THEN rewrite_tac[replaceData_def]);
a(lemma_tac¬³ c‰2 dominates Dat_class d®);
(* *** Goal "2.1" *** *)
a contr_tac;
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "2.2" *** *)
a(asm_rewrite_tac[get_spec¬MkData®]);
val ÛreplaceData_updateField_lemmaİ = save_pop_thm"replaceData_updateField_lemma";
=TEX
=GFT HOL output
replaceData_updateField_lemma =
 ô µ c‰1 c‰2 d tc u
  · c‰1 dominates tc ± c‰2 dominates tc
      ´ ³ c‰2 dominates c‰1 ± isVal (updateField c‰1 tc (u, d))
      ´ replaceData c‰2 d   
	  = replaceData c‰2 (destVal (updateField c‰1 tc (u, d)))
=TEX
=SML
push_goal([],¬µ c‰1 c‰2 r t u 
        · c‰1 dominates TS_class t ± c‰2 dominates TS_class t
	´ (³ c‰2 dominates c‰1 ± isVal(updateRow c‰1 (TS_class t) (u, r))
	´ 	cleanRow c‰2 (Snd (cleanColCons c‰2 t)) r 
		= cleanRow c‰2 (Snd (cleanColCons c‰2 t)) 
			(destVal(updateRow c‰1 (TS_class t) (u, r))))®);
a(REPEAT strip_tac);
a(POP_ASM_T (strip_asm_tac o rewrite_rule[isVal_def]));
a(asm_rewrite_tac[destVal_def]);
a(POP_ASM_T ante_tac THEN rewrite_tac[updateRow_def]);
a(cases_tac¬³ u  Functional® THEN
	cases_tac¬((RelCombine u (R_data r)
                                     » Graph (updateField c‰1 (TS_class t)))
                                   ’ {x|isError x}) » Graph destError  = {}®
	THEN asm_rewrite_tac[³giveError_eq_giveVal_thm,giveVal_eq_thm]);
a(rewrite_tac[cleanRow_def,«_thm,get_spec¬MkRow®,row_components,rel_ext_clauses,
	filterRow_def,rel_combine_def]);
a(strip_tac THEN asm_rewrite_tac[] THEN REPEAT µ_tac THEN ¤_T strip_asm_tac);
=TEX
=SML
(* *** Goal "1" *** *)
(* Case split on there being an update for x *)
a(cases_tac¬¶ up · (x,up)  u®);
(* *** Goal "1.1" *** *)
a(DROP_NTH_ASM_T 6(asm_tac o list_µ_elim
	[¬x®,¬destVal(updateField c‰1 (TS_class t)(up,z))®]));
a(LEMMA_T¬³ (¶ y z
                   · (¶ z'
                       · ((x, Fst z')  u ± (x, Snd z')  R_data r)
                           ± z = updateField c‰1 (TS_class t) z')
                       ± y = destVal z)
                 ± (x, destVal (updateField c‰1 (TS_class t) (up,z)))  R_data r
               ² (¶ z'
               · (¶ z''
                   · ((x, Fst z'')  u ± (x, Snd z'')  R_data r)
                       ± z' = updateField c‰1 (TS_class t) z'')
                   ± destVal (updateField c‰1 (TS_class t) (up,z)) = destVal z')®asm_tac);
=TEX
=SML
(* *** Goal "1.1.1" *** *)
a(REPEAT strip_tac);
(* *** Goal "1.1.1.1" *** *)
a(¶_tac¬(updateField c‰1 (TS_class t) (up, z))®THEN asm_rewrite_tac[]);
a(¶_tac¬(up, z)®THEN asm_rewrite_tac[]);
(* *** Goal "1.1.1.2" *** *)
a(¶_tac¬(updateField c‰1 (TS_class t) (up, z))®THEN asm_rewrite_tac[]);
a(¶_tac¬(up, z)®THEN asm_rewrite_tac[]);
(* *** Goal "1.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬destVal (updateField c‰1 (TS_class t) (up, z))®THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 8(strip_asm_tac o 
	rewrite_rule[rel_ext_clauses,rel_combine_def,’_thm]));
a(list_spec_nth_asm_tac 1 [¬x®,¬destError(updateField c‰1 (TS_class t) (up, z))®]);
a(spec_nth_asm_tac 1 ¬(updateField c‰1 (TS_class t) (up, z))®);
=TEX
=SML
(* *** Goal "1.1.2.1" *** *)
a(strip_asm_tac(µ_elim¬(updateField c‰1 (TS_class t) (up, z))®val_or_error_type));
a(strip_asm_tac(list_µ_elim[¬c‰1®,¬c‰2®,¬z®,¬TS_class t®,¬up®]replaceData_updateField_lemma));
a(asm_rewrite_tac[]);
a(¶_tac¬c®THEN asm_rewrite_tac[]);
(* *** Goal "1.1.2.2" *** *)
a(POP_ASM_T (strip_asm_tac o rewrite_rule[] o µ_elim¬(up,z)®));
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 6(ante_tac o list_µ_elim[¬x®,¬z®])THEN REPEAT strip_tac);
(* *** Goal "1.2.1" *** *)
a(spec_nth_asm_tac 7 ¬Fst z''®);
(* *** Goal "1.2.2" *** *)
a(spec_nth_asm_tac 7 ¬Fst z''®);
(* *** Goal "1.2.3" *** *)
a(spec_nth_asm_tac 10 ¬Fst z''®);
(* *** Goal "1.2.4" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
a(¶_tac¬c®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.5" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
a(¶_tac¬c®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2" *** *)
a(DROP_NTH_ASM_T 5(ante_tac o list_µ_elim[¬x®,¬z®])THEN asm_rewrite_tac[]
	THEN strip_tac);
(* *** Goal "2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
a(¶_tac¬c®THEN asm_rewrite_tac[]);
(* *** Goal "2.2" *** *)
a(¶_tac¬Snd z''®THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 10(strip_asm_tac o 
	rewrite_rule[rel_ext_clauses,rel_combine_def,’_thm]));
a(list_spec_nth_asm_tac 1 [¬x®,¬destError(updateField c‰1 (TS_class t) z'')®]);
a(spec_nth_asm_tac 1 ¬(updateField c‰1 (TS_class t) z'')®);
(* *** Goal "2.2.1" *** *)
a(strip_asm_tac(µ_elim¬(updateField c‰1 (TS_class t) z'')®val_or_error_type));
a(POP_ASM_T ante_tac THEN LEMMA_T¬z'' = (Fst z'',Snd z'')® 
	pure_once_asm_rewrite_thm_tac THEN_LIST[rewrite_tac[],´_T asm_tac]);
a(strip_asm_tac(list_µ_elim[¬c‰1®,¬c‰2®,¬Snd z''®,¬TS_class t®,¬Fst z''®]
	replaceData_updateField_lemma));
a(asm_rewrite_tac[]);
a(¶_tac¬c®THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2" *** *)
a(spec_nth_asm_tac 1 ¬z''®);
val ÛcleanRow_updateRow_lemmaİ = save_pop_thm"cleanRow_updateRow_lemma";
=TEX
=GFT
cleanRow_updateRow_lemma = 
ô µ c‰1 c‰2 r t u
  · c‰1 dominates TS_class t ± c‰2 dominates TS_class t
      ´ ³ c‰2 dominates c‰1 ± isVal (updateRow c‰1 (TS_class t) (u, r))
      ´ cleanRow c‰2 (Snd (cleanColCons c‰2 t)) r
        = cleanRow
          c‰2
          (Snd (cleanColCons c‰2 t))
          (destVal (updateRow c‰1 (TS_class t) (u, r)))
=TEX

=SML
push_goal([],¬µ c‰1 c‰2 s t us · 
	us  Functional 
	± ³ c‰2 dominates c‰1  ± c‰1 dominates TS_class t
	± ((RelCombine (InvRel (revealRow c‰1 t) » us)(ListRel (TS_rows t))
                   » Graph(updateRow c‰1 (TS_class t)))  ’ {x|isError x})
                                  » Graph destError = {}
	´ cleanTable c‰2 t = cleanTable c‰2 (replaceRows
                   t
                   (RelList
                       (ListRel (TS_rows t)
                           « (RelCombine
                               (InvRel (revealRow c‰1 t) » us)
                               (ListRel (TS_rows t))
                             » Graph (updateRow c‰1 (TS_class t)))
                           » Graph destVal)
))®);
a(REPEAT strip_tac);
a(rewrite_tac[cleanTable_def,replaceRows_def,get_spec¬MkTableSpec®]);
a(cases_tac¬c‰2 dominates TS_class t®THEN 
	asm_rewrite_tac[tab_components,get_spec¬MkTableSpec®,cleanColCons_def]);
a(DROP_NTH_ASM_T 2 ante_tac THEN rewrite_tac[cleanRows_def,revealRow_def]);
=TEX
=SML
a(lemma_tac¬¶ l · TS_rows t = l®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(REV_LIST_INDUCTION_T¬l®asm_tac);
(* *** Goal "1" *** *)
a(rewrite_tac[map_def,map_null_thm,«_null_thm,rel_list_null_thm]);
(* *** Goal "2" *** *)
a(µ_tac THEN ´_tac);
a(fc_tac[rel_combine_null_lemma]);
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[] THEN strip_tac);
a(cases_tac¬c‰2 dominates R_exist last®THEN 
	cases_tac¬c‰1 dominates R_exist last®
	THEN asm_rewrite_tac[] THEN DROP_NTH_ASM_T 3 (fn _ => id_tac));
=TEX
=SML
(* *** Goal "2.1" *** *)
a(cases_tac¬¶ up · (#(Squash (Id (Dom (ListRel (l ë [last])
                                                   ’ {r|c‰1 dominates R_exist r})))),up)  us®);
(* *** Goal "2.1.1" *** *)
a(strip_asm_tac(list_µ_elim[¬c‰1®,¬last®,¬l®,¬up®,¬us®,¬t®]conjunct1_ax2)
	THEN POP_ASM_T rewrite_thm_tac);
a(lemma_tac¬isVal(updateRow c‰1 (TS_class t) (up, last))®);
(* *** Goal "2.1.1.1" *** *)
a(strip_asm_tac(µ_elim¬(updateRow c‰1 (TS_class t) (up, last))®val_or_error_type));
a(DROP_NTH_ASM_T 7 (strip_asm_tac o rewrite_rule[rel_ext_clauses,rel_combine_def]));
a(list_spec_nth_asm_tac 1 [¬Length l + 1®,¬destError(updateRow c‰1 (TS_class t) (up, last))®]);
a(spec_nth_asm_tac 1 ¬(updateRow c‰1 (TS_class t) (up, last))®);
a(POP_ASM_T(strip_asm_tac o rewrite_rule[] o µ_elim ¬(up, last)®));
(* *** Goal "2.1.1.1.1" *** *)
a(spec_nth_asm_tac 1 ¬#(Squash (Id (Dom (ListRel (l ë [last])
                                                   ’ {r|c‰1 dominates R_exist r}))))®);
a(POP_ASM_T ante_tac THEN asm_rewrite_tac[inv_rel_def]);
a(strip_asm_tac(list_µ_elim[¬l®,¬last®,¬{r|c‰1 dominates R_exist r}®]size_ë_one_lemma));
(* *** Goal "2.1.1.1.2" *** *)
a(POP_ASM_T(strip_asm_tac o rewrite_rule[list_rel_def,dot_dot_def,ò_thm,
	length_ë_one_thm,nth_length_one_thm]));
=TEX
=SML
(* *** Goal "2.1.1.2" *** *)
a(LEMMA_T¬c‰2 dominates R_exist
                         (destVal (updateRow c‰1 (TS_class t) (up, last)))®rewrite_thm_tac);
(* *** Goal "2.1.1.2.1" *** *)
a(POP_ASM_T ante_tac THEN rewrite_tac[updateRow_def]);
a(cases_tac¬³ up  Functional®THEN
	cases_tac¬((RelCombine up (R_data last)
                                 » Graph (updateField c‰1 (TS_class t)))
                               ’ {x|isError x})
                             » Graph destError
                           = {}®
	THEN asm_rewrite_tac[³isVal_giveError_thm,destVal_def,get_spec¬MkRow®,
	row_components]THEN REPEAT strip_tac);
(* *** Goal "2.1.1.2.2" *** *)
a(strip_asm_tac(list_µ_elim[¬c‰1®,¬c‰2®,¬last®,¬t®,¬up®]
	(rewrite_rule[cleanColCons_def]cleanRow_updateRow_lemma)));
=TEX
=SML
(* *** Goal "2.1.2" *** *)
a(LEMMA_T¬RelCombine
                             (InvRel
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel (l ë [last])
                                                   ’ {r|c‰1 dominates R_exist r}))))
                                 » us)
                             (ListRel (l ë [last]))
	=RelCombine
                             (InvRel
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l
                                                   ’ {r|c‰1 dominates R_exist r}))))
                                 » us)
                             (ListRel l)®rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.1.2.1" *** *)
a(asm_rewrite_tac[squash_ë_ax,inv_rel_À_thm,rel_combine_À_thm,»_À_thm]);
a(LEMMA_T¬InvRel
                       {(Size
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l
                                                   ’ {r
                                                   |c‰1
                                                       dominates R_exist r}))))
                                 + 1, Length l + 1)}
                     » us = {}®rewrite_thm_tac);
(* *** Goal "2.1.2.1.1" *** *)
a(rewrite_tac[rel_ext_clauses,inv_rel_def]THEN REPEAT strip_tac);
a(spec_nth_asm_tac 3 ¬y®);
a(DROP_NTH_ASM_T 4(fn _ => id_tac));
a(strip_asm_tac(list_µ_elim[¬l®,¬last®,¬{r|c‰1 dominates R_exist r}®]size_squash_plus1_lemma));
a contr_tac;
a(DROP_NTH_ASM_T 5 ante_tac THEN DROP_NTH_ASM_T 3 ante_tac 
	THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2.1.2" *** *)
a(rewrite_tac[rel_combine_one_lemma]);
(* *** Goal "2.1.2.2" *** *)
a(strip_asm_tac(list_µ_elim[¬l®,¬last®,¬c‰1®,¬us®,¬t®]conjunct1_ax1));
a(asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2" *** *)
a(asm_rewrite_tac[rel_combine_one_lemma,squash_ë_ax]);
a(strip_asm_tac(list_µ_elim[¬l®,¬last®,¬c‰1®,¬us®,¬t®]conjunct1_ax1));
a(asm_rewrite_tac[]);
(* *** Goal "2.3" *** *)
a(cases_tac¬¶ up · (#(Squash (Id (Dom (ListRel (l ë [last])
                                                   ’ {r|c‰1 dominates R_exist r})))),up)  us®);
(* *** Goal "2.3.1" *** *)
a(strip_asm_tac(list_µ_elim[¬c‰1®,¬last®,¬l®,¬up®,¬us®,¬t®]conjunct1_ax2)
	THEN POP_ASM_T rewrite_thm_tac);
a(lemma_tac¬isVal(updateRow c‰1 (TS_class t) (up, last))®);
(* *** Goal "2.3.1.1" *** *)
a(strip_asm_tac(µ_elim¬(updateRow c‰1 (TS_class t) (up, last))®val_or_error_type));
a(DROP_NTH_ASM_T 7 (strip_asm_tac o rewrite_rule[rel_ext_clauses,rel_combine_def]));
a(list_spec_nth_asm_tac 1 [¬Length l + 1®,¬destError(updateRow c‰1 (TS_class t) (up, last))®]);
a(spec_nth_asm_tac 1 ¬(updateRow c‰1 (TS_class t) (up, last))®);
a(POP_ASM_T(strip_asm_tac o rewrite_rule[] o µ_elim ¬(up, last)®));
(* *** Goal "2.3.1.1.1" *** *)
a(spec_nth_asm_tac 1 ¬#(Squash (Id (Dom (ListRel (l ë [last])
                                                   ’ {r|c‰1 dominates R_exist r}))))®);
a(POP_ASM_T ante_tac THEN asm_rewrite_tac[inv_rel_def]);
a(strip_asm_tac(list_µ_elim[¬l®,¬last®,¬{r|c‰1 dominates R_exist r}®]size_ë_one_lemma));
(* *** Goal "2.3.1.1.2" *** *)
a(POP_ASM_T(strip_asm_tac o rewrite_rule[list_rel_def,dot_dot_def,ò_thm,
	length_ë_one_thm,nth_length_one_thm]));
=TEX
=SML
(* *** Goal "2.3.1.2" *** *)
a(LEMMA_T¬³ c‰2 dominates R_exist
                         (destVal (updateRow c‰1 (TS_class t) (up, last)))®rewrite_thm_tac);
a(POP_ASM_T ante_tac THEN rewrite_tac[updateRow_def]);
a(cases_tac¬³ up  Functional®THEN
	cases_tac¬((RelCombine up (R_data last)
                                 » Graph (updateField c‰1 (TS_class t)))
                               ’ {x|isError x})
                             » Graph destError
                           = {}®
	THEN asm_rewrite_tac[³isVal_giveError_thm,destVal_def,get_spec¬MkRow®,
	row_components]THEN REPEAT strip_tac);
=TEX
=SML
(* *** Goal "2.3.2" *** *)
a(LEMMA_T¬RelCombine
                             (InvRel
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel (l ë [last])
                                                   ’ {r|c‰1 dominates R_exist r}))))
                                 » us)
                             (ListRel (l ë [last]))
	=RelCombine
                             (InvRel
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l
                                                   ’ {r|c‰1 dominates R_exist r}))))
                                 » us)
                             (ListRel l)®rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.3.2.1" *** *)
a(asm_rewrite_tac[squash_ë_ax,inv_rel_À_thm,rel_combine_À_thm,»_À_thm]);
a(LEMMA_T¬InvRel
                       {(Size
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l
                                                   ’ {r
                                                   |c‰1
                                                       dominates R_exist r}))))
                                 + 1, Length l + 1)}
                     » us = {}®rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.3.2.1.1" *** *)
a(rewrite_tac[rel_ext_clauses,inv_rel_def]THEN REPEAT strip_tac);
a(spec_nth_asm_tac 3 ¬y®);
a(DROP_NTH_ASM_T 4(fn _ => id_tac));
a(strip_asm_tac(list_µ_elim[¬l®,¬last®,¬{r|c‰1 dominates R_exist r}®]size_squash_plus1_lemma));
a contr_tac;
a(DROP_NTH_ASM_T 5 ante_tac THEN DROP_NTH_ASM_T 3 ante_tac 
	THEN asm_rewrite_tac[]);
(* *** Goal "2.3.2.1.2" *** *)
a(rewrite_tac[rel_combine_one_lemma]);
(* *** Goal "2.3.2.2" *** *)
a(strip_asm_tac(list_µ_elim[¬l®,¬last®,¬c‰1®,¬us®,¬t®]conjunct1_ax1));
a(asm_rewrite_tac[]);
(* *** Goal "2.4" *** *)
a(asm_rewrite_tac[rel_combine_one_lemma,squash_ë_ax]);
a(strip_asm_tac(list_µ_elim[¬l®,¬last®,¬c‰1®,¬us®,¬t®]conjunct1_ax1));
a(asm_rewrite_tac[]);
val ÛupdateRows_lemmaİ = save_pop_thm"updateRows_lemma";
=TEX
=GFT HOL output
updateRows_lemma =
 ô µ c‰1 c‰2 s t us
  · us  Functional
	± ³ c‰2 dominates c‰1
        ± c‰1 dominates TS_class t
        ± ((RelCombine (InvRel (revealRow c‰1 t) » us) (ListRel (TS_rows t))
                » Graph (updateRow c‰1 (TS_class t)))
              ’ {x|isError x})
            » Graph destError
          = {}
      ´ cleanTable c‰2 t
        = cleanTable
          c‰2
          (replaceRows
              t
              (RelList
                  (ListRel (TS_rows t)
                      « (RelCombine
                          (InvRel (revealRow c‰1 t) » us)
                          (ListRel (TS_rows t))
                        » Graph (updateRow c‰1 (TS_class t)))
                      » Graph destVal)))
=TEX
=SML
push_goal([],¬µ c‰1 c‰2 s i us
        · (³ c‰2 dominates c‰1 
	± tabExists c‰1 (tabFromEffect (UpdateEffect (i,us))) (repState s)
	± c‰1 dominates (TS_class ((getTable(tabFromEffect (UpdateEffect (i,us))))(repState s))))
	´ hideR (c‰2, repState s)
             = hideR(c‰2, Fst(updateQuery
                           (c‰1, destUpdate(UpdateEffect (i,us)), repState s,getTable 
			(tabFromEffect (UpdateEffect (i,us))) (repState s))))®);
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac
	[destInsert_def,tabFromEffect_def,
	getTable_def,rewrite_rule[dom_def]tabExists_def]);
a(REPEAT strip_tac);
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s®,¬Front i®,¬y®]at_thm));
=TEX
=SML
a(LIST_DROP_NTH_ASM_T[4,5,6,7](MAP_EVERY ante_tac) 
	THEN TOP_ASM_T rewrite_thm_tac);
a(REPEAT ´_tac THEN DROP_NTH_ASM_T 7  ante_tac  THEN 
	rewrite_tac[ª_def,get_spec¬IdeL®,get_spec¬DirectoryS®,¡_def,¸_def,
	get_spec¬Universe®,dom_thm,rel_ext_clauses,get_spec¬$ğ®]THEN strip_tac);
a(asm_fc_tac[]);
a(POP_ASM_T ante_tac THEN rewrite_tac[ß_def,¡_def]THEN REPEAT ´_tac);
a(strip_asm_tac(list_µ_elim[¬Dir_tables y®,¬Last i®,¬y'®]at_thm));
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
a(REPEAT µ_tac);
a(rewrite_tac[updateQuery_def]);
a(conv_tac(MAP_C let_conv));
a(cases_tac¬us  Functional® THEN 
	cases_tac¬Dom (Ş (Ran us)) € {n|¶ c· c  visibleCols c‰1 y' ± CS_posn c = n}®
	THEN asm_rewrite_tac[]);
a(cases_tac¬((RelCombine (InvRel (revealRow c‰1 y') » us)(ListRel (TS_rows y'))
                   » Graph(updateRow c‰1 (TS_class y')))  ’ {x|isError x})
                                  » Graph destError = {}® THEN asm_rewrite_tac[]);
a(asm_rewrite_tac[changeSpec_def,hideR_def,rel_ext_clauses]);
a(REPEAT strip_tac);
=TEX
=SML
(* *** Goal "1" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front i®asm_tac);
(* *** Goal "1.1" *** *)
a(¶_tac¬MkDirectory(Dir_tables y
                             « {(Last i,
                                 replaceRows
                                     y'
                                     (RelList
                                         (ListRel (TS_rows y')
                                             « (RelCombine
                                                 (InvRel (revealRow c‰1 y') » us)
                                                 (ListRel (TS_rows y'))
                                               » Graph
                                                 (updateRow c‰1 (TS_class y')))
                                             » Graph destVal)))})
                         (Dir_exist y)
                         (Dir_class y)®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
a(lemma_tac¬y = z®);
=TEX
=SML
(* *** Goal "1.1.1" *** *)
a(DROP_NTH_ASM_T 18 ante_tac THEN TOP_ASM_T (rewrite_thm_tac o eq_sym_rule)
	THEN strip_tac); 
a(DROP_NTH_ASM_T 18(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬x®,¬y®,¬z®]));
(* *** Goal "1.1.2" *** *)
a(asm_rewrite_tac[cleanDirectory_def]);
a(cases_tac¬c‰2 dominates Dir_class z®THEN asm_rewrite_tac
	[get_spec¬MkDirectory®,dir_components]);
a(rewrite_tac[rel_ext_clauses,«_single]);
a(REPEAT µ_tac);
a(cases_tac¬x' = Last i®THEN asm_rewrite_tac[]);
a(¤_T strip_asm_tac);
=TEX
=SML
(* *** Goal "1.1.2.1" *** *)
a(lemma_tac¬y' = z'®);
(* *** Goal "1.1.2.1.1" *** *)
a(DROP_NTH_ASM_T 18 ante_tac THEN DROP_NTH_ASM_T 15 ante_tac 
	THEN asm_rewrite_tac[]THEN REPEAT ´_tac);
a(DROP_NTH_ASM_T 2(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Last i®,¬y'®,¬z'®]));
(* *** Goal "1.1.2.1.2" *** *)
a(prove_¶_tac);
a(DROP_NTH_ASM_T 14 ante_tac THEN DROP_NTH_ASM_T 11 ante_tac 
	THEN asm_rewrite_tac[] THEN REPEAT ´_tac);
a(bc_tac[updateRows_lemma] THEN asm_rewrite_tac[]);
(* *** Goal "1.1.2.2" *** *)
a(¶_tac¬y'® THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 5(asm_rewrite_thm_tac o eq_sym_rule));
a(conv_tac eq_sym_conv);
a(bc_tac[updateRows_lemma] THEN_TRY asm_rewrite_tac[]);
(* *** Goal "1.2" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2" *** *)
a(CASES_T¬x = Front i®asm_tac);
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_single,get_spec¬MkDirectory®,
	dir_components]THEN strip_tac);
a(¶_tac¬y®THEN asm_rewrite_tac[]);
a(GET_NTH_ASM_T 2 (rewrite_thm_tac o eq_sym_rule));
a(GET_NTH_ASM_T 6 rewrite_thm_tac);
a(rewrite_tac[cleanDirectory_def,rel_ext_clauses]);
a(cases_tac¬c‰2 dominates Dir_class y®THEN asm_rewrite_tac
	[get_spec¬MkDirectory®,dir_components]);
a(rewrite_tac[rel_ext_clauses,«_single]);
a(REPEAT µ_tac);
a(cases_tac¬x' = Last i®THEN asm_rewrite_tac[]);
a(¤_T strip_asm_tac);
=TEX
=SML
(* *** Goal "2.1.1" *** *)
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
a(conv_tac eq_sym_conv);
a(bc_tac[updateRows_lemma] THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2" *** *)
a prove_¶_tac;
a(lemma_tac¬z' = y'®);
(* *** Goal "2.1.2.1" *** *)
a(DROP_NTH_ASM_T 16 (asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Last i®,¬z'®,¬y'®]));
(* *** Goal "2.1.2.2" *** *)
a(asm_rewrite_tac[]);
a(bc_tac[updateRows_lemma] THEN asm_rewrite_tac[]);
(* *** Goal "2.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_single,get_spec¬MkDirectory®,
	dir_components]THEN strip_tac);
a(¶_tac¬z®THEN asm_rewrite_tac[]);
val ÛupdateQuery_lemmaİ = save_pop_thm"updateQuery_lemma";
=TEX
=GFT HOL output
updateQuery_lemma =
 ô µ c‰1 c‰2 s i us
  · ³ c‰2 dominates c‰1
        ± tabExists c‰1 (tabFromEffect (UpdateEffect (i, us))) (repState s)
        ± c‰1
          dominates TS_class
            (getTable (tabFromEffect (UpdateEffect (i, us))) (repState s))
      ´ hideR (c‰2, repState s)
        = hideR
          (c‰2,
              Fst
                  (updateQuery
                      (c‰1, destUpdate (UpdateEffect (i, us)), repState s,
                          getTable
                              (tabFromEffect (UpdateEffect (i, us)))
                              (repState s))))
=TEX

\subsection{Proof of Conjunct 1}

=SML
push_goal([],¬µ c‰1 c‰2 s e
        · ³ hideR (c‰2, repState s) = hideR (c‰2, Fst (updateStateR (c‰1, e, repState s))) 
	´ c‰2 dominates c‰1®);
a(REPEAT strip_tac);
a(swap_nth_asm_concl_tac 1);
a(LEMMA_T¬e = (Fst e,Snd e)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],rewrite_tac[updateStateR_def]]);
a(strip_asm_tac(µ_elim ¬Fst e® query_type) THEN asm_rewrite_tac[]
	THEN cases_tac¬³ Snd e = []® THEN asm_rewrite_tac[]
	THEN cases_tac¬tabExists c‰1 (tabFromEffect (Fst e)) (repState s)® 
	THEN asm_rewrite_tac[]
	THEN cases_tac¬³ c‰1 dominates TS_class(getTable (tabFromEffect (Fst e)) 
		(repState s))® 
	THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** 3 subgoals - state unchanged for Select  *** *)
(* *** Goal "1" *** *)
(** Insert **)
a(POP_ASM_T (fn _ => id_tac) THEN POP_ASM_T ante_tac);
a(DROP_NTH_ASM_T 5 (strip_asm_tac o rewrite_rule[isInsert_def]));
a(TOP_ASM_T rewrite_thm_tac);
a(LEMMA_T¬i = (Fst i,Snd i)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],´_T asm_tac]);
a(bc_tac[insertQuery_lemma]THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
(** Delete **)
a(POP_ASM_T (fn _ => id_tac) THEN POP_ASM_T ante_tac);
a(DROP_NTH_ASM_T 5 (strip_asm_tac o rewrite_rule[isDelete_def]));
a(TOP_ASM_T rewrite_thm_tac);
a(LEMMA_T¬d = (Fst d,Snd d)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],´_T asm_tac]);
a(bc_tac[deleteQuery_lemma]THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3" *** *)
(** Update **)
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac);
a(DROP_NTH_ASM_T 5 (strip_asm_tac o rewrite_rule[isUpdate_def]));
a(TOP_ASM_T rewrite_thm_tac);
a(LEMMA_T¬u = (Fst u,Snd u)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],REPEAT ´_tac]);
a(bc_tac[updateQuery_lemma]THEN asm_rewrite_tac[]);
val Ûconjunct1İ = save_pop_thm"conjunct1";
=TEX
=GFT HOL output
conjunct1 =
 ô µ c‰1 c‰2 s e
  · ³ hideR (c‰2, repState s)
          = hideR (c‰2, Fst (updateStateR (c‰1, e, repState s)))
      ´ c‰2 dominates c‰1
=TEX

\section{CLOSING DOWN}
The following \Product{} instruction restores the previous proof context.
=SML
pop_pc();
=TEX



\newpage
\input{fef012th.tex}

\newpage
\twocolumn[\section{INDEX} \label{INDEX}]
\small
\printindex

\end{document}
