=TEX
% TQtemplate.tex
\documentstyle[hol1,11pt,TQ]{article}
\def\Hide#1{}
\def\Bool{``$\it{:}bool\,$''}
\makeindex
\TPPproject{DRA FRONT END FILTER PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Proof of Security (IId)}  %% Mandatory field
\TPPref{DS/FMU/FEF/013}  %% Mandatory field
\def\SCCSversion{$Revision$
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$
}}  %% Mandatory field (with sensible default)
\TPPstatus{Draft}			%% Mandatory field
\TPPtype{Specification}
\TPPkeywords{}
\TPPauthor{G.~M.~Prout & WIN01}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthorisation{R.B.~Jones & HAT Manager}
\TPPabstract{This document provides a formal proof for the second  conjunct
of the security property
on the relationship between $hide$ and $updateState$ for the
DRA front end filter project RSRE 1C/6130.}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
	HAT FEF File \\
	Simon Wiseman
}}
%\TPPclass{CLASSIFICATION}
\newfont{\icllogo}{icllogo50}
\def\TPPheadlhs{$\vcenter{\halign{##\cr\icllogo ICL\cr}}$}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}

\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

%\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\newpage
\section {DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu,fef}

\subsection{Changes History}
\begin{description}
\item[Issue \SCCSversion(\FormatDate{$Date$
})]First Issue
\end{description}

\subsection{Changes Forecast}
Changes  may be necessary  as a result of issues raised
during  the transcription of the specification.
\pagebreak
\section{GENERAL}
\subsection{Scope}
This document, together with \cite{DS/FMU/FEF/011} and \cite{DS/FMU/FEF/012}, provides a formal proof  that the components $hide$ and $updateState$ 
satisfy their critical 
requirements, as specified in 
the proof strategy \cite{DS/FMU/FEF/007}. It constitutes part of deliverable D6 
of work package 1a, as given
in section 7 of the Secure Database Technical Proposal, \cite{DS/FMU/017}.

\subsection{Introduction}

This document is a proof script which provides a formal proof which contributes to the proof
 of the second conjunct of $Lemma1$,
the requirement on the critical components  $hide$ and $updateState$, described in the proof strategy document \cite{DS/FMU/FEF/007}.

{\bf Lemma1}
=GFT 
	?ô 	hide  secureHide ± (hide,updateState)  secureUpdate
=TEX


In this document, we give a proof that the second conjunct of $secureUpdate$ holds for $hideR$ and $updateStateR$:

=GFT
	?ô µ c‰1 c‰2 s‰1 s‰2 e
          · hideR (c‰1, repState s‰1) = hideR (c‰1, repState s‰2) ± c‰1 dominates c‰2
              ´ hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰1)))
              = hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰2)))
=TEX


\section{PRELIMINARIES}
The following \Product{} instructions set up the new theory $fef013$.

=SML 
open_theory "fef012";
new_theoryÛ"fef013"Ý;
push_merge_pcs["hol","fefhol","fefrel","'pair1"] ;
=TEX
\section{AUXILIARY RESULTS}
=SML
val Û«_null_thm2Ý = save_thm("«_null_thm2",prove_rule[«_def,á_def,rel_ext_clauses]
	¬µf · f « {} = f®);

=TEX
\section{PROOF OF CONJUNCT 2}


\subsection{Insert Rows Lemma}

=SML
push_goal([],¬µ c‰1 c‰2 t‰1 t‰2 ds · 
	cleanTable c‰1 t‰1 = cleanTable c‰1 t‰2 ± c‰1 dominates c‰2  
	´
	cleanTable c‰1 (replaceRows t‰1
		((TS_rows t‰1) ë (Map((MkRow c‰2) o (colDefaults c‰2 t‰1))ds)))
	=
	cleanTable c‰1 (replaceRows t‰2
		((TS_rows t‰2) ë (Map((MkRow c‰2) o (colDefaults c‰2 t‰2))ds)))®);
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 2 ante_tac THEN rewrite_tac
	[cleanTable_def,replaceRows_def,get_spec¬MkTableSpec®]);
a(cases_tac¬c‰1 dominates TS_class t‰1®THEN cases_tac¬c‰1 dominates TS_class t‰2®
	THEN asm_rewrite_tac[]);
(* *** Goal "1" *** *)
a(rewrite_tac[get_spec¬MkTableSpec®,tab_components,cleanColCons_def]
	THEN REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN rewrite_tac[cleanRows_def,revealRow_def,map_ë_thm1]);
a ´_tac;
=TEX
=SML
a(LEMMA_T¬Map
                 (cleanRow
                     c‰1
                     {col
                       |¶ y
                         · c‰1 dominates CC_exist y
                             ± (CS_consGroup col, y)  TS_cons t‰1})
                 (Map (MkRow c‰2 o colDefaults c‰2 t‰1) ds
                     ù {r|c‰1 dominates R_exist r}) = 
	Map
                 (cleanRow
                     c‰1
                     {col
                       |¶ y
                         · c‰1 dominates CC_exist y
                             ± (CS_consGroup col, y)  TS_cons t‰2})
                 (Map (MkRow c‰2 o colDefaults c‰2 t‰2) ds
                     ù {r|c‰1 dominates R_exist r})®asm_rewrite_thm_tac);
a(POP_ASM_T (fn _ => id_tac));
a(REV_LIST_INDUCTION_T¬ds®asm_tac);
=TEX
=SML
(* *** Goal "1.1" *** *)
a(rewrite_tac[map_def,ù_def]);
(* *** Goal "1.2" *** *)
a(rewrite_tac[map_ë_thm,ù_thm,get_spec¬MkRow®]);
a(µ_tac THEN GET_NTH_ASM_T 8 rewrite_thm_tac);
a(LEMMA_T¬cleanRow  c‰1 {col
                   |¶ y
                     · c‰1 dominates CC_exist y
                         ± (CS_consGroup col, y)  TS_cons t‰1}
                 (MkRow c‰2 (colDefaults c‰2 t‰1 last))
               = cleanRow c‰1  {col
                   |¶ y
                     · c‰1 dominates CC_exist y
                         ± (CS_consGroup col, y)  TS_cons t‰2}
                 (MkRow c‰2 (colDefaults c‰2 t‰2 last))®asm_rewrite_thm_tac);
a(POP_ASM_T (fn _ => id_tac));
a(POP_ASM_T(strip_asm_tac o rewrite_rule[rel_ext_clauses,’_thm]));
a(asm_rewrite_tac[colDefaults_def,cleanColCons_def,visibleCols_def,cleanRow_def,
	get_spec¬MkRow®,row_components,rel_ext_clauses,filterRow_def]);
a(REPEAT strip_tac);
=TEX
=SML
(* *** Goal "1.2.1" *** *)
a(cases_tac¬³ x  Dom{(n, d)
               |¶ c
                 · ³ (¶ y
                       · c‰2 dominates CC_exist y
                           ± (CS_consGroup c, y)  TS_cons t‰1)
                     ± n = CS_posn c
                     ± d = CS_default c}®);
(* *** Goal "1.2.1.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
(* *** Goal "1.2.1.1.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
(* *** Goal "1.2.1.1.1.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.1.1.1.2" *** *)
a ²_left_tac;
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬y''®);
a(spec_nth_asm_tac 1 ¬c'®);
a(¶_tac¬y'''®THEN asm_rewrite_tac[]);
a(lemma_tac¬c‰1 dominates CC_exist y'''®);
=TEX
=SML
(* *** Goal "1.2.1.1.1.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.1.1.1.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y'''®]);
(* *** Goal "1.2.1.1.2" *** *)
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬z®);
a(spec_nth_asm_tac 1 ¬c'®);
a(spec_nth_asm_tac 7 ¬y''®);
(* *** Goal "1.2.1.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
=TEX
=SML
(* *** Goal "1.2.1.2.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.1.2.2" *** *)
a ²_right_tac;
a(¶_tac¬c'®THEN asm_rewrite_tac[]);
a(REPEAT strip_tac);
a(spec_nth_asm_tac 4 ¬y''®);
a contr_tac;
a(lemma_tac¬c‰1 dominates CC_exist y''®);
(* *** Goal "1.2.1.2.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.1.2.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y''®]);
=TEX
=SML
(* *** Goal "1.2.2" *** *)
a(cases_tac¬³ x  Dom{(n, d)
               |¶ c
                 · ³ (¶ y
                       · c‰2 dominates CC_exist y
                           ± (CS_consGroup c, y)  TS_cons t‰2)
                     ± n = CS_posn c
                     ± d = CS_default c}®);
(* *** Goal "1.2.2.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
(* *** Goal "1.2.2.1.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
(* *** Goal "1.2.2.1.1.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "1.2.2.1.1.2" *** *)
a ²_left_tac;
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬y''®);
a(spec_nth_asm_tac 1 ¬c'®);
a(¶_tac¬y'''®THEN asm_rewrite_tac[]);
a(lemma_tac¬c‰1 dominates CC_exist y'''®);
(* *** Goal "1.2.2.1.1.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.2.1.1.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y'''®]);
(* *** Goal "1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬z®);
a(spec_nth_asm_tac 1 ¬c'®);
a(spec_nth_asm_tac 7 ¬y''®);
=TEX
=SML
(* *** Goal "1.2.2.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
(* *** Goal "1.2.2.2.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.2.2" *** *)
a ²_right_tac;
a(¶_tac¬c'®THEN asm_rewrite_tac[]);
a(REPEAT strip_tac);
a(spec_nth_asm_tac 4 ¬y''®);
a contr_tac;
a(lemma_tac¬c‰1 dominates CC_exist y''®);
(* *** Goal "1.2.2.2.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.2.2.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y''®]);
=TEX
=SML
(* *** Goal "2" *** *)
a(rewrite_tac[get_spec¬MkTableSpec®,tab_components,cleanColCons_def]
	THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN DROP_NTH_ASM_T 5 rewrite_thm_tac);
a(asm_rewrite_tac[]);
(* *** Goal "3" *** *)
a(rewrite_tac[get_spec¬MkTableSpec®,tab_components,cleanColCons_def]
	THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN DROP_NTH_ASM_T 5 rewrite_thm_tac);
a(asm_rewrite_tac[]);
val ÛcleanTable_insertRows_lemmaÝ = save_pop_thm"cleanTable_insertRows_lemma";
=TEX
=GFT HOL output
cleanTable_insertRows_lemma = 
ô µ c‰1 c‰2 t‰1 t‰2 ds
  · cleanTable c‰1 t‰1 = cleanTable c‰1 t‰2 ± c‰1 dominates c‰2
      ´ cleanTable
          c‰1
          (replaceRows
              t‰1
              (TS_rows t‰1 ë Map (MkRow c‰2 o colDefaults c‰2 t‰1) ds))
        = cleanTable
          c‰1
          (replaceRows
              t‰2
              (TS_rows t‰2 ë Map (MkRow c‰2 o colDefaults c‰2 t‰2) ds))
=TEX

\subsection{Delete Rows Lemmas}

=SML
push_goal([],¬µ c l x· Extract
                       (1 .. Length (l ë [x])
                           \ Squash (Id(Dom(ListRel (l  ë [x]) ’ {r|c dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l ë [x]) i) = c}) (l ë [x])              
	=	if  Length l + 1  (1 .. Length (l ë [x])
                           \ Squash (Id(Dom(ListRel (l  ë [x]) ’ {r|c dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l ë [x]) i) = c})
		then
		(Extract
                       (1 .. Length l
                           \ Squash (Id(Dom(ListRel l ’ {r|c dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth l i) = c}) l) ë [x]
		else
		(Extract
                       (1 .. Length l
                           \ Squash (Id(Dom(ListRel l ’ {r|c dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth l i) = c}) l)®);
=TEX
=SML
a(REPEAT strip_tac THEN rewrite_tac[extract_ë_single_ax]);
a(cases_tac¬c dominates R_exist x®THEN 
	asm_rewrite_tac[squash_ë_ax,image_À_thm,À_¡_thm]);
(* *** Goal "1" *** *)
a(CASES_T¬ Length l + 1
                    1 .. Length (l ë [x])
                     \ Squash
                             (Id (Dom (ListRel l ’ {r|c dominates R_exist r})))
                           Image ns
                         ¡ {i|R_exist (Nth (l ë [x]) i) = c}
                       À {(Size
                                     (Squash
                                         (Id
                                             (Dom
                                                 (ListRel l
                                                     ’ {r
                                                     |c
                                                         dominates R_exist
                                                           r}))))
                                   + 1, Length l + 1)}
                           Image ns
                         ¡ {i|R_exist (Nth (l ë [x]) i) = c}®rewrite_thm_tac);
=TEX
=SML
(* *** Goal "1.1 & 1.2"*** *)
a(rewrite_tac[extract_def]);
a(LEMMA_T¬(1 .. Length (l ë [x])
                         \ Squash
                                 (Id
                                     (Dom
                                         (ListRel l
                                             ’ {r|c dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l ë [x]) i) = c}
                           À {(Size
                                         (Squash
                                             (Id
                                                 (Dom
                                                     (ListRel l
                                                         ’ {r
                                                         |c
                                                             dominates R_exist
           r}))))
                                       + 1, Length l + 1)}
                               Image ns
                             ¡ {i|R_exist (Nth (l ë [x]) i) = c}
                       ò ListRel l) = (1 .. Length l
                         \ Squash
                               (Id
                                   (Dom
                                       (ListRel l
                                           ’ {r|c dominates R_exist r})))
                             Image ns
                           ¡ {i|R_exist (Nth l i) = c}
                       ò ListRel l)®rewrite_thm_tac);
=TEX
=SML
a(rewrite_tac[rel_ext_clauses,ò_def,’_def,list_rel_def,image_def,dot_dot_def,
	¼_plus1_thm,length_ë_one_thm]);
a(REPEAT strip_tac);
(* *** Goal "1.1.1" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.1.2" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.1.3" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.1.4" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.1.5" *** *)
a(spec_nth_asm_tac 5 ¬x''®);
(* *** Goal "1.1.6" *** *)
a(spec_nth_asm_tac 5 ¬x''®);
=TEX
=SML
(* *** Goal "1.1.7" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x'®,¬x®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.1.8" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x'®,¬x®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.1.9" *** *)
a(spec_nth_asm_tac 4 ¬x''®);
(* *** Goal "1.1.10" *** *)
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.1.11" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x'®,¬x®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.1.12" *** *)
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2" *** *)
a(CASES_T¬ Length l + 1
                    1 .. Length (l ë [x])
                     \ Squash
                           (Id (Dom (ListRel l ’ {r|c dominates R_exist r})))
                         Image ns
                       ¡ {i|R_exist (Nth (l ë [x]) i) = c}® rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.1 & 2.2" *** *)
a(rewrite_tac[extract_def]);
a(LEMMA_T¬(1 .. Length (l ë [x])
                         \ Squash
                               (Id
                                   (Dom
                                       (ListRel l
                                           ’ {r|c dominates R_exist r})))
                             Image ns
                           ¡ {i|R_exist (Nth (l ë [x]) i) = c}
                       ò ListRel l)=(1 .. Length l
                         \ Squash
                               (Id
                                   (Dom
                                       (ListRel l
                                           ’ {r|c dominates R_exist r})))
                             Image ns
                           ¡ {i|R_exist (Nth l i) = c}
                       ò ListRel l)®rewrite_thm_tac);
=TEX
=SML
a(rewrite_tac[rel_ext_clauses,ò_def,’_def,list_rel_def,image_def,dot_dot_def,
	¼_plus1_thm,length_ë_one_thm]);
a(REPEAT strip_tac);
(* *** Goal "2.1.1" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.2" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.3" *** *)
a(spec_nth_asm_tac 4 ¬x''®);
(* *** Goal "2.1.4" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x'®,¬x®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.1.5" *** *)
a(spec_nth_asm_tac 4 ¬x''®);
(* *** Goal "2.1.6" *** *)
a(strip_asm_tac(rewrite_rule[dot_dot_def](list_µ_elim[¬l®,¬x'®,¬x®]nth_ë_thm1)));
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);
val Ûextract_ë_single_lemmaÝ = save_pop_thm"extract_ë_single_lemma";
=TEX
=GFT HOL output
extract_ë_single_lemma = 
ô µ c l x
  · Extract
        (1 .. Length (l ë [x])
            \ Squash
                  (Id (Dom (ListRel (l ë [x]) ’ {r|c dominates R_exist r})))
                Image ns
              ¡ {i|R_exist (Nth (l ë [x]) i) = c})
        (l ë [x])
      = (if
          Length l + 1
             1 .. Length (l ë [x])
              \ Squash
                    (Id
                        (Dom
                            (ListRel (l ë [x]) ’ {r|c dominates R_exist r})))
                  Image ns
                ¡ {i|R_exist (Nth (l ë [x]) i) = c}
        then
          Extract
              (1 .. Length l
                  \ Squash (Id (Dom (ListRel l ’ {r|c dominates R_exist r})))
                      Image ns
                    ¡ {i|R_exist (Nth l i) = c})
              l
            ë [x]
        else
          Extract
            (1 .. Length l
                \ Squash (Id (Dom (ListRel l ’ {r|c dominates R_exist r})))
                    Image ns
                  ¡ {i|R_exist (Nth l i) = c})
            l)
=TEX

=SML
push_goal([],¬µ l‰1 l‰2 c‰1 c‰2 s · 
	c‰1 dominates c‰2 
	±
	Map(cleanRow c‰1 s)(l‰1 ù {r|c‰1 dominates R_exist r})
	= 
	Map(cleanRow c‰1 s)(l‰2 ù {r|c‰1 dominates R_exist r}) 
	´
		Map(cleanRow c‰2 s)(l‰1 ù {r|c‰2 dominates R_exist r})
		= 
		Map(cleanRow c‰2 s)(l‰2 ù {r|c‰2 dominates R_exist r})®);
=TEX
=SML
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN intro_µ_tac(¬l‰1®,¬l‰1®));
a(LIST_INDUCTION_T¬l‰2®asm_tac);
(* *** Goal "1" *** *)
a(rewrite_tac[map_def,all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm))]);
a(rewrite_tac[rel_ext_clauses]THEN REPEAT strip_tac);
a contr_tac;
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "2" *** *)
a(REPEAT µ_tac);
a(intro_µ_tac(¬x®,¬x®));
a(LIST_INDUCTION_T¬l‰1®asm_tac);
a(rewrite_tac[map_def]);
=TEX
=SML
(* *** Goal "2.1" *** *)
a(rewrite_tac[map_def,all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm))]);
a(rewrite_tac[rel_ext_clauses]THEN REPEAT strip_tac);
a contr_tac;
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "2.2" *** *)
a(rewrite_tac[ù_def]);
a(REPEAT µ_tac);
a(cases_tac¬c‰2 dominates R_exist x®THEN cases_tac¬c‰2 dominates R_exist x'®
	THEN asm_rewrite_tac[map_def]);
(* *** Goal "2.2.1" *** *)
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
a(asm_rewrite_tac[map_def]THEN strip_tac);
a(DROP_NTH_ASM_T 11 (ante_tac o µ_elim¬l‰1®)THEN asm_rewrite_tac[]
	THEN strip_tac THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 3 ante_tac THEN rewrite_tac
	[cleanRow_def,row_components,get_spec¬MkRow®]);
a(rewrite_tac[rel_ext_clauses]THEN REPEAT strip_tac);
=TEX
=SML
(* *** Goal "2.2.1.1" *** *)
a(DROP_NTH_ASM_T 3 (asm_tac o list_µ_elim[¬x''®,¬replaceData c‰1 z®]));
a(LEMMA_T¬(¶ z'
             · (x'', z')  filterRow s (R_data x)
                 ± replaceData c‰1 z = replaceData c‰1 z')®asm_tac);
(* *** Goal "2.2.1.1.1" *** *)
a(¶_tac¬z® THEN asm_rewrite_tac[]);
(* *** Goal "2.2.1.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'® THEN asm_rewrite_tac[]);
a(fc_tac[replaceData_lemma] THEN asm_fc_tac[]);
(* *** Goal "2.2.1.2" *** *)
a(DROP_NTH_ASM_T 3 (asm_tac o list_µ_elim[¬x''®,¬replaceData c‰1 z®]));
a(LEMMA_T¬(¶ z'
             · (x'', z')  filterRow s (R_data x')
                 ± replaceData c‰1 z = replaceData c‰1 z')®asm_tac);
(* *** Goal "2.2.1.2.1" *** *)
a(¶_tac¬z® THEN asm_rewrite_tac[]);
(* *** Goal "2.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'® THEN asm_rewrite_tac[]);
a(fc_tac[replaceData_lemma] THEN asm_fc_tac[]);
=TEX
=SML
(* *** Goal "2.2.2" *** *)
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
a(cases_tac¬c‰1 dominates R_exist x'®THEN asm_rewrite_tac[map_def,ù_def]);
(* *** Goal "2.2.2.1" *** *)
a strip_tac;
a(DROP_NTH_ASM_T 2
	(ante_tac o rewrite_rule[cleanRow_def,row_components,get_spec¬MkRow®]));
a strip_tac;
a(DROP_NTH_ASM_T 9 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.2" *** *)
a strip_tac;
a(DROP_NTH_ASM_T 9(ante_tac o µ_elim¬Cons x l‰1®));
a(asm_rewrite_tac[ù_def,map_def]);
=TEX
=SML
(* *** Goal "2.2.3" *** *)
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
a(cases_tac¬c‰1 dominates R_exist x®THEN asm_rewrite_tac[map_def,ù_def]);
(* *** Goal "2.2.3.1" *** *)
a strip_tac;
a(DROP_NTH_ASM_T 2
	(ante_tac o rewrite_rule[cleanRow_def,row_components,get_spec¬MkRow®]));
a strip_tac;
a(DROP_NTH_ASM_T 9 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.3.2" *** *)
a strip_tac;
a(DROP_NTH_ASM_T 8(ante_tac o µ_elim¬x'®));
a(asm_rewrite_tac[ù_def,map_def]);
=TEX
=SML
(* *** Goal "2.2.4" *** *)
a(cases_tac ¬c‰1 dominates R_exist x®THEN cases_tac ¬c‰1 dominates R_exist x'®
	THEN asm_rewrite_tac[map_def,ù_def]);
(* *** Goal "2.2.4.1" *** *)
a(strip_tac THEN DROP_NTH_ASM_T 8(ante_tac o µ_elim¬l‰1®)THEN asm_rewrite_tac[]);
(* *** Goal "2.2.4.2" *** *)
a(strip_tac THEN DROP_NTH_ASM_T 7(ante_tac o µ_elim¬Cons x l‰1®)
	THEN asm_rewrite_tac[map_def,ù_def]);
(* *** Goal "2.2.4.3" *** *)
a(strip_tac THEN DROP_NTH_ASM_T 6(ante_tac o µ_elim¬x'®)
	THEN asm_rewrite_tac[map_def,ù_def]);
val Ûmap_cleanRow_lemma1Ý = save_pop_thm"map_cleanRow_lemma1";
=TEX
=GFT HOL output
map_cleanRow_lemma1 = 
ô µ l‰1 l‰2 c‰1 c‰2 s
  · c‰1 dominates c‰2
        ± Map (cleanRow c‰1 s) (l‰1 ù {r|c‰1 dominates R_exist r})
          = Map (cleanRow c‰1 s) (l‰2 ù {r|c‰1 dominates R_exist r})
      ´ Map (cleanRow c‰2 s) (l‰1 ù {r|c‰2 dominates R_exist r})
        = Map (cleanRow c‰2 s) (l‰2 ù {r|c‰2 dominates R_exist r})
=TEX
=SML
push_goal([],¬µ l‰1 l‰2 c‰1 c‰2 s · 
	c‰1 dominates c‰2 
	±
	Map(cleanRow c‰1 s)(l‰1 ù {r|c‰1 dominates R_exist r})
	= 
	Map(cleanRow c‰1 s)(l‰2 ù {r|c‰1 dominates R_exist r}) 
	´
		Size (ListRel l‰1 ’ {r|c‰2 dominates R_exist r})
		= 
		Size (ListRel l‰2 ’ {r|c‰2 dominates R_exist r})®);
=TEX
=SML
a(REPEAT strip_tac);
a(fc_tac[map_cleanRow_lemma1]THEN asm_fc_tac[]);
a(DROP_NTH_ASM_T 2 (fn _ => id_tac)THEN DROP_NTH_ASM_T 2 (fn _ => id_tac));
a(POP_ASM_T ante_tac);
a(intro_µ_tac(¬l‰2®,¬l‰2®));
a(REV_LIST_INDUCTION_T¬l‰1®asm_tac);
(* *** Goal "1" *** *)
a(rewrite_tac[map_def]);
a(µ_tac THEN ´_T (asm_tac o rewrite_rule
	[all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm))]));
a(asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2" *** *)
a(REPEAT µ_tac);
a(intro_µ_tac(¬last®,¬last®));
a(REV_LIST_INDUCTION_T¬l‰2®asm_tac);
(* *** Goal "2.1" *** *)
a(rewrite_tac[map_def]);
a(µ_tac THEN cases_tac¬c‰2 dominates R_exist last® THEN  asm_rewrite_tac[]);
a(´_T (asm_tac o rewrite_rule[all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm))]));
a(asm_rewrite_tac[list_rel_ë_thm]);
=TEX
=SML
(* *** Goal "2.2" *** *)
a(REPEAT µ_tac);
a(cases_tac¬c‰2 dominates R_exist last'®
	 THEN cases_tac¬c‰2 dominates R_exist last® THEN asm_rewrite_tac[]);
(* *** Goal "2.2.1" *** *)
a(´_tac THEN DROP_NTH_ASM_T 6 (ante_tac o µ_elim¬l‰2®) THEN asm_rewrite_tac[]
	THEN ´_tac);
a(asm_rewrite_tac[list_rel_ë_thm]);
a(lemma_tac¬µ l last · (ListRel l ’ {r|c‰2 dominates R_exist r}) ¡ {(Length l + 1, last)} 
	= {}®);
(* *** Goal "2.2.1.1" *** *)
a(REPEAT µ_tac THEN rewrite_tac[list_rel_def,’_def,dot_dot_def,rel_ext_clauses]);
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2.1.2" *** *)
a(TOP_ASM_T (asm_tac o list_µ_elim[¬l‰1®,¬last'®]));
a(asm_tac(list_µ_elim[¬l‰1®,¬{r|c‰2 dominates R_exist r}®]list_rel_’_finite_ax));
a(asm_tac(µ_elim¬(Length l‰1 + 1, last')®finite_single));
a(ante_tac(list_µ_elim[¬ListRel l‰1 ’ {r|c‰2 dominates R_exist r}®,
	¬{(Length l‰1 + 1, last')}®]size_ax)THEN asm_rewrite_tac[size_null_ax,size_single_ax]);
a(´_T rewrite_thm_tac);
a(DROP_NTH_ASM_T 4 (asm_tac o list_µ_elim[¬l‰2®,¬last®]));
a(asm_tac(list_µ_elim[¬l‰2®,¬{r|c‰2 dominates R_exist r}®]list_rel_’_finite_ax));
a(asm_tac(µ_elim¬(Length l‰2 + 1, last)®finite_single));
a(ante_tac(list_µ_elim[¬ListRel l‰2 ’ {r|c‰2 dominates R_exist r}®,
	¬{(Length l‰2 + 1, last)}®]size_ax)THEN asm_rewrite_tac[size_null_ax,size_single_ax]);
a(´_T asm_rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.2.2" *** *)
a(DROP_NTH_ASM_T 3(ante_tac o µ_elim¬last'®)THEN asm_rewrite_tac[]);
a(´_T asm_tac THEN ´_tac);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]THEN strip_tac);
a(asm_rewrite_tac[list_rel_ë_’_ax]);
(* *** Goal "2.2.3" *** *)
a(DROP_NTH_ASM_T 4(ante_tac o µ_elim¬l‰2 ë [last]®) THEN asm_rewrite_tac[]);
a(´_T asm_tac THEN ´_tac);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]THEN strip_tac);
a(asm_rewrite_tac[list_rel_ë_’_ax]);
(* *** Goal "2.2.4" *** *)
a(asm_rewrite_tac[list_rel_ë_’_ax]);
val Ûmap_cleanRow_lemma2Ý = save_pop_thm"map_cleanRow_lemma2";
=TEX
=GFT HOL output
map_cleanRow_lemma2 = 
ô µ l‰1 l‰2 c‰1 c‰2 s
  · c‰1 dominates c‰2
        ± Map (cleanRow c‰1 s) (l‰1 ù {r|c‰1 dominates R_exist r})
          = Map (cleanRow c‰1 s) (l‰2 ù {r|c‰1 dominates R_exist r})
      ´ Size (ListRel l‰1 ’ {r|c‰2 dominates R_exist r})
        = Size (ListRel l‰2 ’ {r|c‰2 dominates R_exist r})
=TEX
=SML
push_goal([],¬µ c‰1 c‰2 t‰1 t‰2 ns · 
	cleanTable c‰1 t‰1 = cleanTable c‰1 t‰2 
	± c‰1 dominates c‰2 ± c‰2 dominates TS_class t‰1 
	´
	cleanTable c‰1 (replaceRows t‰1 
		(Extract (1 .. Length(TS_rows t‰1) \ 
	((revealRow c‰2 t‰1) Image ns ¡ {i|R_exist(Nth(TS_rows t‰1)i) = c‰2}))
	(TS_rows t‰1)))
	=
	cleanTable c‰1 (replaceRows t‰2 
		(Extract (1 .. Length(TS_rows t‰2) \ 
	((revealRow c‰2 t‰2) Image ns ¡ {i|R_exist(Nth(TS_rows t‰2)i) = c‰2}))
	(TS_rows t‰2)))®);
a(REPEAT strip_tac);
a(lemma_tac¬cleanTable c‰2 t‰1 = cleanTable c‰2 t‰2®
	THEN_LIST[fc_tac[cleanTable_lemma]
	THEN asm_fc_tac[],id_tac]);
a(DROP_NTH_ASM_T 4 ante_tac THEN  
	rewrite_tac[cleanTable_def,replaceRows_def,get_spec¬MkTableSpec®]);
a(lemma_tac¬c‰1 dominates TS_class t‰1®THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(cases_tac¬c‰1 dominates TS_class t‰2®THEN asm_rewrite_tac[]);
=TEX
=SML
set_labelled_goal"2";
(* *** Goal "2" *** *)
a(rewrite_tac[get_spec¬MkTableSpec®,tab_components,cleanColCons_def]
	THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN DROP_NTH_ASM_T 5 rewrite_thm_tac);
a(asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "1" *** *)
a(´_T(strip_asm_tac o rewrite_rule[get_spec¬MkTableSpec®,tab_components]));
a(DROP_NTH_ASM_T 8 ante_tac THEN asm_rewrite_tac[cleanTable_def]);
a(GET_NTH_ASM_T 8 ante_tac THEN GET_NTH_ASM_T 5 rewrite_thm_tac 
	THEN ´_tac
	THEN asm_rewrite_tac[get_spec¬MkTableSpec®,tab_components] THEN strip_tac);
a(POP_ASM_T ante_tac THEN lemma_tac¬cleanColCons c‰2 t‰1 = cleanColCons c‰2 t‰2® 
	THEN_LIST[pure_once_asm_rewrite_tac[prove_rule[pair_clauses]
	¬µ p  · p = (Fst p, Snd p)®]THEN asm_rewrite_tac[],
	DROP_NTH_ASM_T 3(fn _ => id_tac) 
	THEN  DROP_NTH_ASM_T 2(fn _ => id_tac)]);
a(asm_rewrite_tac[] THEN ´_tac);
a(lemma_tac¬cleanColCons c‰1 t‰1 = cleanColCons c‰1 t‰2® 
	THEN_LIST[pure_once_asm_rewrite_tac[prove_rule[pair_clauses]
	¬µ p  · p = (Fst p, Snd p)®]THEN asm_rewrite_tac[],
	DROP_NTH_ASM_T 7(fn _ => id_tac) 
	THEN  DROP_NTH_ASM_T 6(fn _ => id_tac)]);
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
=TEX
=SML
a(fc_tac[cleanRows_size_lemma]);
a(LIST_DROP_NTH_ASM_T [1,2,3,4](MAP_EVERY ante_tac));
a(LIST_DROP_NTH_ASM_T [1,2](MAP_EVERY (fn _ => id_tac)));
a(rewrite_tac[cleanColCons_def,cleanRows_def,revealRow_def,get_spec¬MkTableSpec®]);
a(REPEAT strip_tac);
a(LIST_DROP_NTH_ASM_T [1,2,3](MAP_EVERY ante_tac));
a(lemma_tac¬¶ l‰1 · TS_rows t‰1 = l‰1®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(lemma_tac¬¶ l‰2 · TS_rows t‰2 = l‰2®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(intro_µ_tac(¬l‰2®,¬l‰2®));
a(REV_LIST_INDUCTION_T¬l‰1®asm_tac);
=TEX
=SML
(* *** Goal "1.1" *** *)
a(rewrite_tac[map_def]THEN REPEAT strip_tac);
a(fc_tac[ù_extract_null_thm]);
a(spec_nth_asm_tac 1¬(1 .. Length l‰2
                         \ Squash
                               (Id
                                   (Dom
                                       (ListRel l‰2
                                           ’ {r|c‰2 dominates R_exist r})))
                             Image ns
                           ¡ {i|R_exist (Nth l‰2 i) = c‰2})®);
a(asm_rewrite_tac[extract_def,rel_list_null_thm]);
(* *** Goal "1.2" *** *)
a(REPEAT µ_tac);
a(intro_µ_tac(¬last®,¬last®) THEN REV_LIST_INDUCTION_T¬l‰2®asm_tac);
=TEX
=SML
(* *** Goal "1.2.1" *** *)
a(REPEAT µ_tac THEN cases_tac¬c‰1 dominates R_exist last®THEN asm_rewrite_tac
	[map_def,extract_ë_single_ax] THEN REPEAT strip_tac);
a(CASES_T¬Length l‰1 + 1
                          1 .. Length (l‰1 ë [last])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰1 ë [last])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰1 ë [last]) i) = c‰2}®rewrite_thm_tac);
=TEX
=SML
(* *** Goal "1.2.1.1" *** *)
a(fc_tac[ù_extract_null_thm]);
a(spec_nth_asm_tac 1¬(1 .. Length (l‰1 ë [last])
                             \ Squash
                                   (Id
                                       (Dom
                                           (ListRel (l‰1 ë [last])
                                               ’ {r|c‰2 dominates R_exist r})))
                                 Image ns
                               ¡ {i|R_exist (Nth (l‰1 ë [last]) i) = c‰2})®);
a(asm_rewrite_tac[extract_def,rel_list_null_thm]);
=TEX
=SML
(* *** Goal "1.2.1.2" *** *)
a(fc_tac[ù_extract_null_thm]);
a(spec_nth_asm_tac 1¬(1 .. Length (l‰1 ë [last])
                             \ Squash
                                   (Id
                                       (Dom
                                           (ListRel (l‰1 ë [last])
                                               ’ {r|c‰2 dominates R_exist r})))
                                 Image ns
                               ¡ {i|R_exist (Nth (l‰1 ë [last]) i) = c‰2})®);
a(asm_rewrite_tac[extract_def,rel_list_null_thm]);
=TEX
=SML
(* *** Goal "1.2.2" *** *)
a(REPEAT µ_tac THEN cases_tac¬c‰1 dominates R_exist last®THEN 
	cases_tac¬c‰1 dominates R_exist last'® THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1" *** *)
a(cases_tac¬c‰2 dominates R_exist last®
	THEN cases_tac¬c‰2 dominates R_exist last'® 
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax]);
(* *** Goal "1.2.2.1.1" *** *)
a(REPEAT ´_tac THEN DROP_NTH_ASM_T 10(ante_tac o µ_elim¬l‰2®) 
	THEN DROP_NTH_ASM_T 9(fn _ => id_tac) 	
	THEN asm_rewrite_tac[extract_ë_single_lemma] THEN ´_tac);
=TEX
=SML
a(LEMMA_T¬Length l‰1 + 1
                          1 .. Length (l‰1 ë [last'])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰1 ë [last'])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2} ¤ 
	Length l‰2 + 1
                          1 .. Length (l‰2 ë [last])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰2 ë [last])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰2 ë [last]) i) = c‰2}®asm_tac);
=TEX
=SML
(* *** Goal "1.2.2.1.1.1" *** *)
a(POP_ASM_T (fn _ => id_tac) THEN POP_ASM_T (fn _ => id_tac)
	THEN DROP_NTH_ASM_T 2 (strip_asm_tac o rewrite_rule
	[cleanRow_def,get_spec¬MkRow®,row_components,rel_ext_clauses]));
a(POP_ASM_T (fn _ => id_tac));
a(fc_tac[size_squash_id_dom_thm]);
a(asm_rewrite_tac[squash_ë_ax,image_def,dot_dot_def,¼_plus1_thm,
	length_ë_one_thm]);
a(REPEAT strip_tac);
(* *** Goal "1.2.2.1.1.1.1" *** *)
a(POP_ASM_T (strip_asm_tac o rewrite_rule[squash_def,list_rel_def,
	enumerate_def,id_def,dom_thm,dot_dot_def]));
a(DROP_NTH_ASM_T 8 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.1.1.2" *** *)
a(spec_nth_asm_tac 3 ¬x®);
a(POP_ASM_T ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.1.1.3" *** *)
a(POP_ASM_T (strip_asm_tac o rewrite_rule[squash_def,list_rel_def,
	enumerate_def,id_def,dom_thm,dot_dot_def]));
a(DROP_NTH_ASM_T 8 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "1.2.2.1.1.1.4" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN DROP_NTH_ASM_T 2 ante_tac 
	THEN asm_rewrite_tac[nth_length_one_thm]THEN REPEAT strip_tac);
(* *** Goal "1.2.2.1.1.1.5" *** *)
a(POP_ASM_T (strip_asm_tac o rewrite_rule[squash_def,list_rel_def,
	enumerate_def,id_def,dom_thm,dot_dot_def]));
a(DROP_NTH_ASM_T 8 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.1.1.6" *** *)
a(spec_nth_asm_tac 3 ¬x®);
a(POP_ASM_T ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.1.1.7" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN DROP_NTH_ASM_T 2 ante_tac 
	THEN asm_rewrite_tac[nth_length_one_thm]THEN REPEAT strip_tac);
(* *** Goal "1.2.2.1.1.1.8" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN DROP_NTH_ASM_T 2 ante_tac 
	THEN asm_rewrite_tac[nth_length_one_thm]THEN REPEAT strip_tac);
=TEX
=SML
(* *** Goal "1.2.2.1.1.2" *** *)
a(CASES_T¬Length l‰1 + 1
                1 .. Length (l‰1 ë [last'])
                 \ Squash
                       (Id
                           (Dom
                               (ListRel (l‰1 ë [last'])
                                   ’ {r|c‰2 dominates R_exist r})))
                     Image ns
                   ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}®asm_tac);
(* *** Goal "1.2.2.1.1.2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[] 
	THEN ´_T asm_rewrite_thm_tac);
(* *** Goal "1.2.2.1.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[] 
	THEN ´_T asm_rewrite_thm_tac);
=TEX
=SML
(* *** Goal "1.2.2.1.2" *** *)
a(REPEAT ´_tac);
a(fc_tac[map_cleanRow_lemma2]THEN asm_fc_tac[]);
a(DROP_NTH_ASM_T 16 ante_tac THEN DROP_NTH_ASM_T 5 rewrite_thm_tac);
(* *** Goal "1.2.2.1.3" *** *)
a(REPEAT ´_tac);
a(fc_tac[map_cleanRow_lemma2]THEN asm_fc_tac[]);
a(DROP_NTH_ASM_T 16 ante_tac THEN DROP_NTH_ASM_T 5 rewrite_thm_tac);
(* *** Goal "1.2.2.1.4" *** *)
a(REPEAT ´_tac THEN DROP_NTH_ASM_T 10(ante_tac o µ_elim¬l‰2®) 
	THEN DROP_NTH_ASM_T 9(fn _ => id_tac) 	
	THEN asm_rewrite_tac[extract_ë_single_lemma] THEN ´_tac);
=TEX
=SML
a(LEMMA_T¬Length l‰1 + 1
                          1 .. Length (l‰1 ë [last'])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰1 ë [last'])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2} ¤ 
	Length l‰2 + 1
                          1 .. Length (l‰2 ë [last])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰2 ë [last])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰2 ë [last]) i) = c‰2}®asm_tac);
=TEX
=SML
(* *** Goal "1.2.2.1.4.1" *** *)
a(POP_ASM_T (fn _ => id_tac) THEN POP_ASM_T (fn _ => id_tac)
	THEN DROP_NTH_ASM_T 2 (strip_asm_tac o rewrite_rule
	[cleanRow_def,get_spec¬MkRow®,row_components,rel_ext_clauses]));
a(POP_ASM_T (fn _ => id_tac));
a(fc_tac[size_squash_id_dom_thm]);
a(asm_rewrite_tac[squash_ë_ax,image_def,dot_dot_def,¼_plus1_thm,
	length_ë_one_thm]);
a(REPEAT strip_tac);
(* *** Goal "1.2.2.1.4.1.1" *** *)
a(POP_ASM_T (strip_asm_tac o rewrite_rule[squash_def,list_rel_def,
	enumerate_def,id_def,dom_thm,dot_dot_def]));
a(DROP_NTH_ASM_T 8 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.4.1.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN DROP_NTH_ASM_T 2 ante_tac 
	THEN asm_rewrite_tac[nth_length_one_thm]THEN REPEAT strip_tac);
(* *** Goal "1.2.2.1.4.1.3" *** *)
a(POP_ASM_T (strip_asm_tac o rewrite_rule[squash_def,list_rel_def,
	enumerate_def,id_def,dom_thm,dot_dot_def]));
a(DROP_NTH_ASM_T 8 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.4.1.4" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN DROP_NTH_ASM_T 2 ante_tac 
	THEN asm_rewrite_tac[nth_length_one_thm]THEN REPEAT strip_tac);
=TEX
=SML
(* *** Goal "1.2.2.1.4.2" *** *)
a(CASES_T¬³ Length l‰1 + 1
                1 .. Length (l‰1 ë [last'])
                 \ Squash
                       (Id
                           (Dom
                               (ListRel (l‰1 ë [last'])
                                   ’ {r|c‰2 dominates R_exist r})))
                     Image ns
                   ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}®asm_tac);
(* *** Goal "1.2.2.1.4.2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[] 
	THEN ´_T asm_rewrite_thm_tac);
(* *** Goal "1.2.2.1.4.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[] 
	THEN ´_T asm_rewrite_thm_tac);
=TEX
=SML
(* *** Goal "1.2.2.2" *** *)
a(cases_tac¬c‰2 dominates R_exist last'® 
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax]);
(* *** Goal "1.2.2.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.2.2.2" *** *)
a(REPEAT ´_tac THEN DROP_NTH_ASM_T 8(ante_tac o µ_elim¬l‰2 ë [last]®) 
	THEN DROP_NTH_ASM_T 7(fn _ => id_tac) 	
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax] THEN ´_tac);
a(POP_ASM_T (rewrite_thm_tac o eq_sym_rule));
a(asm_rewrite_tac[extract_ë_single_lemma]);
a(CASES_T¬Length l‰1 + 1
                          1 .. Length (l‰1 ë [last'])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰1 ë [last'])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}®
	asm_rewrite_thm_tac);
=TEX
=SML
(* *** Goal "1.2.2.3" *** *)
a(cases_tac¬c‰2 dominates R_exist last® 
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax]);
(* *** Goal "1.2.2.3.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.2.3.2" *** *)
a(REPEAT ´_tac THEN DROP_NTH_ASM_T 8 (fn _ => id_tac)
	THEN DROP_NTH_ASM_T 7(ante_tac o µ_elim¬last'®) 	
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax] THEN ´_tac);
a(POP_ASM_T rewrite_thm_tac);
a(asm_rewrite_tac[extract_ë_single_lemma]);
a(CASES_T¬Length l‰2 + 1
                          1 .. Length (l‰2 ë [last])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰2 ë [last])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰2 ë [last]) i) = c‰2}®
	asm_rewrite_thm_tac);
=TEX
=SML
(* *** Goal "1.2.2.4" *** *)
a(cases_tac¬c‰2 dominates R_exist last®
	THEN cases_tac¬c‰2 dominates R_exist last'® 
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax]);
=TEX
=SML
(* *** Goal "1.2.2.4.1" *** *)
a(REPEAT ´_tac THEN DROP_NTH_ASM_T 9(ante_tac o µ_elim¬l‰2®) 
	THEN DROP_NTH_ASM_T 8(fn _ => id_tac) 	
	THEN asm_rewrite_tac[extract_ë_single_lemma] THEN ´_tac);
a(CASES_T¬Length l‰1 + 1
                          1 .. Length (l‰1 ë [last'])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰1 ë [last'])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}®
	asm_rewrite_thm_tac
	THEN CASES_T¬Length l‰2 + 1
                          1 .. Length (l‰2 ë [last])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰2 ë [last])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰2 ë [last]) i) = c‰2}®
	asm_rewrite_thm_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "1.2.2.4.2" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.2.4.3" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.2.4.4" *** *)
a(REPEAT ´_tac THEN DROP_NTH_ASM_T 9(ante_tac o µ_elim¬l‰2®) 
	THEN DROP_NTH_ASM_T 8(fn _ => id_tac) 	
	THEN asm_rewrite_tac[extract_ë_single_lemma] THEN ´_tac);
a(CASES_T¬Length l‰1 + 1
                          1 .. Length (l‰1 ë [last'])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰1 ë [last'])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}®
	asm_rewrite_thm_tac
	THEN CASES_T¬Length l‰2 + 1
                          1 .. Length (l‰2 ë [last])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰2 ë [last])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰2 ë [last]) i) = c‰2}®
	asm_rewrite_thm_tac THEN asm_rewrite_tac[]);
val ÛcleanTable_deleteRows_lemmaÝ = save_pop_thm"cleanTable_deleteRows_lemma";
=TEX
=GFT HOL output
cleanTable_deleteRows_lemma = 
ô µ c‰1 c‰2 t‰1 t‰2 ns
  · cleanTable c‰1 t‰1 = cleanTable c‰1 t‰2
        ± c‰1 dominates c‰2
        ± c‰2 dominates TS_class t‰1
      ´ cleanTable
          c‰1
          (replaceRows
              t‰1
              (Extract
                  (1 .. Length (TS_rows t‰1)
                      \ revealRow c‰2 t‰1 Image ns
                        ¡ {i|R_exist (Nth (TS_rows t‰1) i) = c‰2})
                  (TS_rows t‰1)))
        = cleanTable
          c‰1
          (replaceRows
              t‰2
              (Extract
                  (1 .. Length (TS_rows t‰2)
                      \ revealRow c‰2 t‰2 Image ns
                        ¡ {i|R_exist (Nth (TS_rows t‰2) i) = c‰2})
                  (TS_rows t‰2)))
=TEX

\subsection{Update Rows Lemma}
We prove two subsidiary results for $updateField$ and $updateRow$.
\subsubsection{Update Field Lemma}

=SML
push_goal([],¬µ c‰1 c‰2 d‰1 d‰2 t u · 
	c‰1 dominates c‰2 
	± replaceData c‰1 d‰1 = replaceData c‰1 d‰2
	± isVal(updateField c‰2 (TS_class t) (u,d‰1))
	± isVal(updateField c‰2 (TS_class t) (u,d‰2))
	´
	replaceData c‰1 (destVal(updateField c‰2 (TS_class t) (u,d‰1)))
	=
	replaceData c‰1 (destVal(updateField c‰2 (TS_class t) (u,d‰2)))®);
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac[updateField_def]);
a(cases_tac¬c‰2 = TS_class t®
	THEN cases_tac¬isItem u®
	THEN cases_tac¬isClass u®
	THEN asm_rewrite_tac[³isVal_giveError_thm,destVal_def]);
=TEX
=SML
(* *** Goal "1" *** *)
a(´_T (fn _ => id_tac) THEN ´_T (fn _ => id_tac));
a(DROP_NTH_ASM_T 4 ante_tac THEN 
	asm_rewrite_tac[replaceData_def,get_spec¬MkData®]);
a(cases_tac¬c‰1 dominates Dat_class d‰1® THEN cases_tac¬c‰1 dominates Dat_class d‰2® 
	THEN asm_rewrite_tac[]);
(* *** Goal "1.1" *** *)
a(´_T rewrite_thm_tac);
(* *** Goal "1.2" *** *)
a(rewrite_tac[get_spec¬MkData®,data_components]THEN strip_tac);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.3" *** *)
a(rewrite_tac[get_spec¬MkData®,data_components]THEN strip_tac);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2" *** *)
a(´_T (fn _ => id_tac) THEN ´_T (fn _ => id_tac));
a(DROP_NTH_ASM_T 4 ante_tac THEN 
	asm_rewrite_tac[replaceData_def,get_spec¬MkData®]);
a(cases_tac¬c‰1 dominates Dat_class d‰1® THEN cases_tac¬c‰1 dominates Dat_class d‰2® 
	THEN asm_rewrite_tac[]);
(* *** Goal "2.1" *** *)
a(´_T rewrite_thm_tac);
(* *** Goal "2.2" *** *)
a(rewrite_tac[get_spec¬MkData®,data_components]THEN strip_tac);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.3" *** *)
a(rewrite_tac[get_spec¬MkData®,data_components]THEN strip_tac);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3" *** *)
a(cases_tac¬destClass u dominates Dat_class d‰1®
	THEN cases_tac¬destClass u dominates Dat_class d‰2®
	THEN asm_rewrite_tac[³isVal_giveError_thm,destVal_def]);
a(´_T (fn _ => id_tac) THEN ´_T (fn _ => id_tac));
a(DROP_NTH_ASM_T 6 ante_tac THEN 
	asm_rewrite_tac[replaceData_def,get_spec¬MkData®]);
a(cases_tac¬c‰1 dominates destClass u®THEN asm_rewrite_tac[]);
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
a(asm_rewrite_tac[]);
a(´_T rewrite_thm_tac);
=TEX
=SML
(* *** Goal "4" *** *)
a(cases_tac¬Dat_class d‰1 dominates c‰2®
	THEN cases_tac¬Dat_class d‰2 dominates c‰2®
	THEN asm_rewrite_tac[³isVal_giveError_thm,destVal_def]);
a(´_T (fn _ => id_tac) THEN ´_T (fn _ => id_tac));
a(DROP_NTH_ASM_T 6 ante_tac THEN 
	asm_rewrite_tac[replaceData_def,get_spec¬MkData®]);
a(cases_tac¬c‰1 dominates Dat_class d‰1® THEN cases_tac¬c‰1 dominates Dat_class d‰2® 
	THEN asm_rewrite_tac[]);
(* *** Goal "4.1" *** *)
a(´_T rewrite_thm_tac);
(* *** Goal "4.2" *** *)
a(rewrite_tac[get_spec¬MkData®,data_components]THEN strip_tac);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "4.3" *** *)
a(rewrite_tac[get_spec¬MkData®,data_components]THEN strip_tac);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "5" *** *)
a(cases_tac¬Dat_class d‰1 dominates c‰2®
	THEN cases_tac¬Dat_class d‰2 dominates c‰2®
	THEN asm_rewrite_tac[³isVal_giveError_thm,destVal_def]);
a(´_T (fn _ => id_tac) THEN ´_T (fn _ => id_tac));
a(DROP_NTH_ASM_T 6 ante_tac THEN 
	asm_rewrite_tac[replaceData_def,get_spec¬MkData®]);
a(cases_tac¬c‰1 dominates Dat_class d‰1® THEN cases_tac¬c‰1 dominates Dat_class d‰2® 
	THEN asm_rewrite_tac[]);
(* *** Goal "5.1" *** *)
a(´_T rewrite_thm_tac);
(* *** Goal "5.2" *** *)
a(rewrite_tac[get_spec¬MkData®,data_components]THEN strip_tac);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "5.3" *** *)
a(rewrite_tac[get_spec¬MkData®,data_components]THEN strip_tac);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
val ÛreplaceData_updateField_lemmaÝ = save_pop_thm"replaceData_updateField_lemma";
=TEX
=GFT HOL output
replaceData_updateField_lemma = 
ô µ c‰1 c‰2 d‰1 d‰2 t u
  · c‰1 dominates c‰2
        ± replaceData c‰1 d‰1 = replaceData c‰1 d‰2
        ± isVal (updateField c‰2 (TS_class t) (u, d‰1))
        ± isVal (updateField c‰2 (TS_class t) (u, d‰2))
      ´ replaceData c‰1 (destVal (updateField c‰2 (TS_class t) (u, d‰1)))
        = replaceData c‰1 (destVal (updateField c‰2 (TS_class t) (u, d‰2)))
=TEX
\subsubsection{Update Row Lemma}
=SML
push_goal([],¬µ c‰1 c‰2 r‰1 r‰2 t u
	· c‰1 dominates c‰2
	± Dom u € {n|¶ c'· c'  visibleCols c‰2 t ± CS_posn c' = n}
	± cleanRow c‰1 (Snd (cleanColCons c‰1 t)) r‰1
             = cleanRow c‰1 (Snd (cleanColCons c‰1 t)) r‰2
        ± isVal (updateRow c‰2 (TS_class t) (u, r‰1))
	± isVal (updateRow c‰2 (TS_class t) (u, r‰2))  
	´ cleanRow c‰1(Snd (cleanColCons c‰1 t))(destVal(updateRow c‰2 (TS_class t)(u, r‰1)))
	= cleanRow c‰1(Snd (cleanColCons c‰1 t))(destVal(updateRow c‰2 (TS_class t)(u, r‰2)))®);
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac[updateRow_def]);
=TEX
=SML
a(cases_tac¬((RelCombine u (R_data r‰1)
                                     » Graph (updateField c‰2 (TS_class t)))
                                   ’ {x|isError x})
                                 » Graph destError = {}®
	THEN cases_tac¬((RelCombine u (R_data r‰2)
                                     » Graph (updateField c‰2 (TS_class t)))
                                   ’ {x|isError x})
                                 » Graph destError = {}®
	THEN asm_rewrite_tac[³isVal_giveError_thm,giveVal_eq_thm]);
a(´_T (fn _ => id_tac) THEN ´_T (fn _ => id_tac) THEN rewrite_tac[destVal_def]);
a(DROP_NTH_ASM_T 3 ante_tac THEN rewrite_tac[cleanRow_def,filterRow_def,
	get_spec¬MkRow®,row_components,rel_ext_clauses,rel_combine_def,«_thm]
	THEN REPEAT ´_tac THEN strip_tac THEN_TRY asm_rewrite_tac[]);
a(REPEAT strip_tac);
=TEX
=SML
(* *** Goal "1" *** *)
(* no update *)
a(lemma_tac¬³ ¶ up · (x,up)  u®);
(* *** Goal "1.1" *** *)
a contr_tac;
a(spec_nth_asm_tac 4 ¬destVal(updateField c‰2 (TS_class t) (up,z))®);
a(spec_nth_asm_tac 1 ¬updateField c‰2 (TS_class t) (up,z)®);
a(spec_nth_asm_tac 1 ¬(up,z)®);
(* *** Goal "1.1.1" *** *)
a(POP_ASM_T (strip_asm_tac o rewrite_rule[]));
(* *** Goal "1.1.2" *** *)
a(POP_ASM_T (strip_asm_tac o rewrite_rule[]));
=TEX
=SML
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬x®,¬replaceData c‰1 z®]));
a(LEMMA_T¬(¶ z'
             · ((¶ c· c  Snd (cleanColCons c‰1 t) ± CS_posn c = x)
                   ± (x, z')  R_data r‰1)
                 ± replaceData c‰1 z = replaceData c‰1 z')®asm_tac);
(* *** Goal "1.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
a(¶_tac¬c®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
a(LEMMA_T¬¶ c· c  Snd (cleanColCons c‰1 t) ± CS_posn c = x®rewrite_thm_tac);
(* *** Goal "1.2.2.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.2" *** *)
a(REPEAT strip_tac);
a(spec_nth_asm_tac 9 ¬Fst z'''®);
=TEX
=SML
(* *** Goal "2" *** *)
(* update *)
a(DROP_NTH_ASM_T 8(asm_tac o list_µ_elim[¬x®,¬replaceData c‰1 (Snd z'')®]));
a(LEMMA_T¬(¶ z
             · ((¶ c· c  Snd (cleanColCons c‰1 t) ± CS_posn c = x)
                   ± (x, z)  R_data r‰1)
                 ± replaceData c‰1 (Snd z'') = replaceData c‰1 z)®asm_tac);
(* *** Goal "2.1" *** *)
a(¶_tac¬Snd z''®THEN asm_rewrite_tac[]);
a(¶_tac¬c®THEN asm_rewrite_tac[]);
(* *** Goal "2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]THEN ´_tac);
a(¶_tac¬destVal(updateField c‰2 (TS_class t)(Fst z'',z'''))®);
a(LEMMA_T¬¶ c· c  Snd (cleanColCons c‰1 t) ± CS_posn c = x®rewrite_thm_tac);
(* *** Goal "2.2.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2.2" *** *)
a(LEMMA_T¬(³ (¶ y z
                   · (¶ z'
                       · ((x, Fst z')  u ± (x, Snd z')  R_data r‰2)
                           ± z = updateField c‰2 (TS_class t) z')
                       ± y = destVal z)
                 ± (x, destVal (updateField c‰2 (TS_class t) (Fst z'', z''')))
                    R_data r‰2
               ² (¶ z'
               · (¶ z
                   · ((x, Fst z)  u ± (x, Snd z)  R_data r‰2)
                       ± z' = updateField c‰2 (TS_class t) z)
                   ± destVal (updateField c‰2 (TS_class t) (Fst z'', z'''))
                     = destVal z'))®rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.2.2.1" *** *)
a ²_right_tac;
a(¶_tac¬updateField c‰2 (TS_class t) (Fst z'', z''')®THEN rewrite_tac[]);
a(¶_tac¬(Fst z'', z''')®THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.2" *** *)
a(lemma_tac¬isVal (updateField c‰2 (TS_class t) (Fst z'', z''')) ± 
	isVal (updateField c‰2 (TS_class t) z'')®);
(* *** Goal "2.2.2.2.1" *** *)
a strip_tac;
(* *** Goal "2.2.2.2.1.1" *** *)
a(strip_asm_tac(µ_elim¬(updateField c‰2 (TS_class t) (Fst z'', z'''))®val_or_error_type));
a(DROP_NTH_ASM_T 16 (strip_asm_tac o rewrite_rule[rel_ext_clauses,rel_combine_def]));
a(list_spec_nth_asm_tac 1 [¬x®,¬destError(updateField c‰2 (TS_class t) (Fst z'', z'''))®]);
a(spec_nth_asm_tac 1 ¬(updateField c‰2 (TS_class t) (Fst z'', z'''))®);
a(POP_ASM_T(strip_asm_tac o rewrite_rule[] o µ_elim ¬(Fst z'', z''')®));
=TEX
=SML
(* *** Goal "2.2.2.2.1.2" *** *)
a(strip_asm_tac(µ_elim¬(updateField c‰2 (TS_class t) z'')®val_or_error_type));
a(DROP_NTH_ASM_T 17 (strip_asm_tac o rewrite_rule[rel_ext_clauses,rel_combine_def]));
a(list_spec_nth_asm_tac 1 [¬x®,¬destError(updateField c‰2 (TS_class t) z'')®]);
a(spec_nth_asm_tac 1 ¬(updateField c‰2 (TS_class t) z'')®);
a(POP_ASM_T(strip_asm_tac o rewrite_rule[] o µ_elim ¬z''®));
(* *** Goal "2.2.2.2.2" *** *)
a(asm_rewrite_tac[]);
a(POP_ASM_T ante_tac THEN pure_once_rewrite_tac[prove_rule[]¬z'' = (Fst z'',Snd z'')®]
	THEN ´_tac); 
a(fc_tac[replaceData_updateField_lemma]
	THEN asm_fc_tac[] THEN asm_fc_tac[] THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3" *** *)
(* no update *)
a(lemma_tac¬³ ¶ up · (x,up)  u®);
(* *** Goal "3.1" *** *)
a contr_tac;
a(spec_nth_asm_tac 4 ¬destVal(updateField c‰2 (TS_class t) (up,z))®);
a(spec_nth_asm_tac 1 ¬updateField c‰2 (TS_class t) (up,z)®);
a(spec_nth_asm_tac 1 ¬(up,z)®);
(* *** Goal "3.1.1" *** *)
a(POP_ASM_T (strip_asm_tac o rewrite_rule[]));
(* *** Goal "3.1.2" *** *)
a(POP_ASM_T (strip_asm_tac o rewrite_rule[]));
=TEX
=SML
(* *** Goal "3.2" *** *)
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬x®,¬replaceData c‰1 z®]));
a(LEMMA_T¬(¶ z'
             · ((¶ c· c  Snd (cleanColCons c‰1 t) ± CS_posn c = x)
                   ± (x, z')  R_data r‰2)
                 ± replaceData c‰1 z = replaceData c‰1 z')®asm_tac);
(* *** Goal "3.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
a(¶_tac¬c®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
a(LEMMA_T¬¶ c· c  Snd (cleanColCons c‰1 t) ± CS_posn c = x®rewrite_thm_tac);
(* *** Goal "3.2.2.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2" *** *)
a(REPEAT strip_tac);
a(spec_nth_asm_tac 9 ¬Fst z'''®);
=TEX
=SML
(* *** Goal "4" *** *)
(* update *)
a(DROP_NTH_ASM_T 8(asm_tac o list_µ_elim[¬x®,¬replaceData c‰1 (Snd z'')®]));
a(LEMMA_T¬(¶ z
             · ((¶ c· c  Snd (cleanColCons c‰1 t) ± CS_posn c = x)
                   ± (x, z)  R_data r‰2)
                 ± replaceData c‰1 (Snd z'') = replaceData c‰1 z)®asm_tac);
(* *** Goal "4.1" *** *)
a(¶_tac¬Snd z''®THEN asm_rewrite_tac[]);
a(¶_tac¬c®THEN asm_rewrite_tac[]);
(* *** Goal "4.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]THEN ´_tac);
a(¶_tac¬destVal(updateField c‰2 (TS_class t)(Fst z'',z'''))®);
a(LEMMA_T¬¶ c· c  Snd (cleanColCons c‰1 t) ± CS_posn c = x®rewrite_thm_tac);
(* *** Goal "4.2.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "4.2.2" *** *)
a(LEMMA_T¬(³ (¶ y z
                   · (¶ z'
                       · ((x, Fst z')  u ± (x, Snd z')  R_data r‰1)
                           ± z = updateField c‰2 (TS_class t) z')
                       ± y = destVal z)
                 ± (x, destVal (updateField c‰2 (TS_class t) (Fst z'', z''')))
                    R_data r‰1
               ² (¶ z'
               · (¶ z
                   · ((x, Fst z)  u ± (x, Snd z)  R_data r‰1)
                       ± z' = updateField c‰2 (TS_class t) z)
                   ± destVal (updateField c‰2 (TS_class t) (Fst z'', z'''))
                     = destVal z'))®rewrite_thm_tac);
=TEX
=SML
(* *** Goal "4.2.2.1" *** *)
a ²_right_tac;
a(¶_tac¬updateField c‰2 (TS_class t) (Fst z'', z''')®THEN rewrite_tac[]);
a(¶_tac¬(Fst z'', z''')®THEN asm_rewrite_tac[]);
(* *** Goal "4.2.2.2" *** *)
a(lemma_tac¬isVal (updateField c‰2 (TS_class t) (Fst z'', z''')) ± 
	isVal (updateField c‰2 (TS_class t) z'')®);
(* *** Goal "4.2.2.2.1" *** *)
a strip_tac;
(* *** Goal "4.2.2.2.1.1" *** *)
a(strip_asm_tac(µ_elim¬(updateField c‰2 (TS_class t) (Fst z'', z'''))®val_or_error_type));
a(DROP_NTH_ASM_T 17 (strip_asm_tac o rewrite_rule[rel_ext_clauses,rel_combine_def]));
a(list_spec_nth_asm_tac 1 [¬x®,¬destError(updateField c‰2 (TS_class t) (Fst z'', z'''))®]);
a(spec_nth_asm_tac 1 ¬(updateField c‰2 (TS_class t) (Fst z'', z'''))®);
a(POP_ASM_T(strip_asm_tac o rewrite_rule[] o µ_elim ¬(Fst z'', z''')®));
=TEX
=SML
(* *** Goal "4.2.2.2.1.2" *** *)
a(strip_asm_tac(µ_elim¬(updateField c‰2 (TS_class t) z'')®val_or_error_type));
a(DROP_NTH_ASM_T 16 (strip_asm_tac o rewrite_rule[rel_ext_clauses,rel_combine_def]));
a(list_spec_nth_asm_tac 1 [¬x®,¬destError(updateField c‰2 (TS_class t) z'')®]);
a(spec_nth_asm_tac 1 ¬(updateField c‰2 (TS_class t) z'')®);
a(POP_ASM_T(strip_asm_tac o rewrite_rule[] o µ_elim ¬z''®));
(* *** Goal "4.2.2.2.2" *** *)
a(asm_rewrite_tac[]);
a(POP_ASM_T ante_tac THEN pure_once_rewrite_tac[prove_rule[]¬z'' = (Fst z'',Snd z'')®]
	THEN ´_tac); 
a(fc_tac[replaceData_updateField_lemma]
	THEN asm_fc_tac[] THEN asm_fc_tac[] THEN asm_rewrite_tac[]);
val ÛcleanRow_updateRow_lemmaÝ = save_pop_thm"cleanRow_updateRow_lemma";
=TEX
=GFT HOL output
cleanRow_updateRow_lemma =
ô µ c‰1 c‰2 r‰1 r‰2 t u
  · c‰1 dominates c‰2
        ± Dom u € {n|¶ c'· c'  visibleCols c‰2 t ± CS_posn c' = n}
        ± cleanRow c‰1 (Snd (cleanColCons c‰1 t)) r‰1
          = cleanRow c‰1 (Snd (cleanColCons c‰1 t)) r‰2
        ± isVal (updateRow c‰2 (TS_class t) (u, r‰1))
        ± isVal (updateRow c‰2 (TS_class t) (u, r‰2))
      ´ cleanRow
          c‰1
          (Snd (cleanColCons c‰1 t))
          (destVal (updateRow c‰2 (TS_class t) (u, r‰1)))
        = cleanRow
          c‰1
          (Snd (cleanColCons c‰1 t))
          (destVal (updateRow c‰2 (TS_class t) (u, r‰2)))
=TEX
\subsubsection{Update Rows Lemma}
We first prove a theorem which essentially states that if the row existence class of 
two rows is the same and the same fields of the two rows are visible, then an update 
either exists for both rows or for neither.
=SML
push_goal([],¬µ l‰1 l‰2 x‰1 x‰2 c us up · 
	R_exist x‰1 = R_exist x‰2 ±  
	#(ListRel l‰1 ’ {r|c dominates R_exist r})
             = #(ListRel l‰2 ’ {r|c dominates R_exist r})
	´  
	(((#(Squash (Id (Dom (ListRel (l‰1 ë [x‰1])
                                        ’ {r|c dominates R_exist r})))),up)  us)
	¤((#(Squash (Id (Dom (ListRel (l‰2 ë [x‰2])
                                        ’ {r|c dominates R_exist r})))),up)  us))®);
=TEX
=SML
a(REPEAT µ_tac THEN strip_tac);
a(cases_tac¬c dominates R_exist x‰2®);
(* *** Goal "1" *** *)
a(lemma_tac¬c dominates R_exist x‰1® THEN_LIST[asm_rewrite_tac[],id_tac]);
a(fc_tac[size_squash_id_dom_thm]);
a(LEMMA_T¬#(Squash (Id (Dom (ListRel (l‰1 ë [x‰1])
                                        ’ {r|c dominates R_exist r}))))
	= #(Squash (Id (Dom (ListRel (l‰2 ë [x‰2])
                                        ’ {r|c dominates R_exist r}))))®rewrite_thm_tac);
a(strip_asm_tac(list_µ_elim[¬l‰1®,¬x‰1®,¬{r|c dominates R_exist r}®]size_squash_plus1_lemma));
a(strip_asm_tac(list_µ_elim[¬l‰2®,¬x‰2®,¬{r|c dominates R_exist r}®]size_squash_plus1_lemma));
a(asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(lemma_tac¬³ c dominates R_exist x‰1® THEN_LIST[asm_rewrite_tac[],id_tac]);
a(LEMMA_T¬#(Squash (Id (Dom (ListRel (l‰1 ë [x‰1])
                                        ’ {r|c dominates R_exist r}))))
	= #(Squash (Id (Dom (ListRel (l‰2 ë [x‰2])
                                        ’ {r|c dominates R_exist r}))))®rewrite_thm_tac);
a(asm_rewrite_tac[list_rel_ë_’_ax]);
a(fc_tac[size_squash_id_dom_thm]);
val ÛinUpdates_lemmaÝ = save_pop_thm"inUpdates_lemma";
=TEX
=GFT HOL output
inUpdates_lemma =
ô µ l‰1 l‰2 x‰1 x‰2 c us up
  · R_exist x‰1 = R_exist x‰2
        ± Size (ListRel l‰1 ’ {r|c dominates R_exist r})
          = Size (ListRel l‰2 ’ {r|c dominates R_exist r})
      ´ ((Size
                (Squash
                    (Id
                        (Dom
                            (ListRel (l‰1 ë [x‰1])
                                ’ {r|c dominates R_exist r})))), up)
           us
        ¤ (Size
                (Squash
                    (Id
                        (Dom
                            (ListRel (l‰2 ë [x‰2])
                                ’ {r|c dominates R_exist r})))), up)
           us)
=TEX
Now the main theorem of this section.
=SML
push_goal([],¬µ c‰1 c‰2 t‰1 t‰2 us · 
	Dom (Þ (Ran us)) € {n
                             |¶ c
                               · c  Snd (cleanColCons c‰2 t‰2) ± CS_posn c = n}
	±
	((RelCombine
                     (InvRel (revealRow c‰2 t‰1) » us)
                     (ListRel (TS_rows t‰1))
                   » Graph (updateRow c‰2 (TS_class t‰2)))
                 ’ {x|isError x})
               » Graph destError
             = {}
	± ((RelCombine
                     (InvRel (revealRow c‰2 t‰2) » us)
                     (ListRel (TS_rows t‰2))
                   » Graph (updateRow c‰2 (TS_class t‰2)))
                 ’ {x|isError x})
               » Graph destError
             = {}
	± cleanTable c‰1 t‰1 = cleanTable c‰1 t‰2 
	± c‰1 dominates c‰2 ± c‰2 dominates TS_class t‰1  
	´
	cleanTable
               c‰1
               (replaceRows
                   t‰1
                   (RelList
                       (ListRel (TS_rows t‰1)
                           « (RelCombine
                               (InvRel (revealRow c‰2 t‰1) » us)
                               (ListRel (TS_rows t‰1))
                             » Graph (updateRow c‰2 (TS_class t‰1)))
                           » Graph destVal)))
	=
	cleanTable
               c‰1
               (replaceRows
                   t‰2
                   (RelList
                       (ListRel (TS_rows t‰2)
                           « (RelCombine
                               (InvRel (revealRow c‰2 t‰2) » us)
                               (ListRel (TS_rows t‰2))
                             » Graph (updateRow c‰2 (TS_class t‰2)))
                           » Graph destVal)))®);
=TEX
=SML
a(REPEAT strip_tac);
a(lemma_tac¬cleanTable c‰2 t‰1 = cleanTable c‰2 t‰2®
	THEN_LIST[fc_tac[cleanTable_lemma]
	THEN asm_fc_tac[],id_tac]);
a(DROP_NTH_ASM_T 4 ante_tac THEN  
	rewrite_tac[cleanTable_def,replaceRows_def,get_spec¬MkTableSpec®]);
a(lemma_tac¬c‰1 dominates TS_class t‰1®THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(cases_tac¬c‰1 dominates TS_class t‰2®THEN asm_rewrite_tac[]);
=TEX
=SML
set_labelled_goal"2";
(* *** Goal "2" *** *)
a(rewrite_tac[get_spec¬MkTableSpec®,tab_components,cleanColCons_def]
	THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN DROP_NTH_ASM_T 5 rewrite_thm_tac);
a(asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "1" *** *)
a(´_T(strip_asm_tac o rewrite_rule[get_spec¬MkTableSpec®,tab_components]));
a(DROP_NTH_ASM_T 8 ante_tac THEN asm_rewrite_tac[cleanTable_def]);
a(GET_NTH_ASM_T 8 ante_tac THEN GET_NTH_ASM_T 5 rewrite_thm_tac 
	THEN ´_tac
	THEN asm_rewrite_tac[get_spec¬MkTableSpec®,tab_components] THEN strip_tac);
a(POP_ASM_T ante_tac THEN lemma_tac¬cleanColCons c‰2 t‰1 = cleanColCons c‰2 t‰2® 
	THEN_LIST[pure_once_asm_rewrite_tac[prove_rule[pair_clauses]
	¬µ p  · p = (Fst p, Snd p)®]THEN asm_rewrite_tac[],
	DROP_NTH_ASM_T 3(fn _ => id_tac) 
	THEN  DROP_NTH_ASM_T 2(fn _ => id_tac)]);
a(asm_rewrite_tac[] THEN ´_tac);
a(lemma_tac¬cleanColCons c‰1 t‰1 = cleanColCons c‰1 t‰2® 
	THEN_LIST[pure_once_asm_rewrite_tac[prove_rule[pair_clauses]
	¬µ p  · p = (Fst p, Snd p)®]THEN asm_rewrite_tac[],
	DROP_NTH_ASM_T 7(fn _ => id_tac) 
	THEN  DROP_NTH_ASM_T 6(fn _ => id_tac)]);
=TEX
=SML
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[] THEN ´_tac);
a(fc_tac[cleanRows_size_lemma]);
a(LIST_DROP_NTH_ASM_T [1,2,3,4](MAP_EVERY ante_tac));
a(LIST_DROP_NTH_ASM_T [1,2](MAP_EVERY (fn _ => id_tac)));
a(DROP_NTH_ASM_T 9 ante_tac THEN DROP_NTH_ASM_T 8 ante_tac THEN 
	rewrite_tac[cleanColCons_def,cleanRows_def,revealRow_def,get_spec¬MkTableSpec®]);
a(REPEAT strip_tac);
a(LIST_DROP_NTH_ASM_T [1,2,3,6,7](MAP_EVERY ante_tac));
a(lemma_tac¬¶ l‰1 · TS_rows t‰1 = l‰1®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(lemma_tac¬¶ l‰2 · TS_rows t‰2 = l‰2®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(intro_µ_tac(¬l‰2®,¬l‰2®));
a(REV_LIST_INDUCTION_T¬l‰1®asm_tac);
=TEX
=SML
(* *** Goal "1.1" *** *)
a(rewrite_tac[map_def,all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm)),
	«_null_thm,rel_list_null_thm]THEN REPEAT strip_tac);
a(LEMMA_T¬ListRel l‰2 ’ {r|c‰2 dominates R_exist r} = {}®rewrite_thm_tac);
(* *** Goal "1.1.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN rewrite_tac[rel_ext_clauses,’_def]);
a(REPEAT strip_tac);
a(list_spec_nth_asm_tac 2 [¬x®,¬y®]);
a(swap_nth_asm_concl_tac 1);
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.1.2" *** *)
a(asm_rewrite_tac[«_null_thm2,rel_list_def]);
=TEX
=SML
(* *** Goal "1.2" *** *)
a(REPEAT µ_tac);
a(intro_µ_tac(¬last®,¬last®) THEN REV_LIST_INDUCTION_T¬l‰2®asm_tac);
(* *** Goal "1.2.1" *** *)
a(REPEAT µ_tac THEN cases_tac¬c‰1 dominates R_exist last®THEN asm_rewrite_tac
	[map_def,«_null_thm,rel_list_null_thm,
	all_µ_intro(eq_sym_rule(all_µ_elim list_rel_list_thm))]THEN REPEAT strip_tac);
a(LEMMA_T¬ListRel (l‰1 ë [last]) ’ {r|c‰2 dominates R_exist r} = {}®rewrite_thm_tac);
(* *** Goal "1.2.1.1" *** *)
a(lemma_tac¬³ c‰2 dominates R_exist last®);
(* *** Goal "1.2.1.1.1" *** *)
a(swap_nth_asm_concl_tac 4);
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.1.1.2" *** *)
a(asm_rewrite_tac[list_rel_ë_’_ax]);
a(DROP_NTH_ASM_T 4 ante_tac THEN rewrite_tac[rel_ext_clauses,’_def]);
a(REPEAT strip_tac);
a(list_spec_nth_asm_tac 2 [¬x®,¬y®]);
a(swap_nth_asm_concl_tac 1);
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.1.2" *** *)
a(asm_rewrite_tac[«_null_thm2,rel_list_def,list_rel_ë_’_ax]);
=TEX
=SML
(* *** Goal "1.2.2" *** *)
a(REPEAT µ_tac THEN cases_tac¬c‰1 dominates R_exist last®THEN 
	cases_tac¬c‰1 dominates R_exist last'® THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1" *** *)
a(cases_tac¬c‰2 dominates R_exist last®
	THEN cases_tac¬c‰2 dominates R_exist last'® 
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax]);
=TEX
=SML
(* *** Goal "1.2.2.1.1" *** *)
a(REPEAT ´_tac THEN fc_tac[rel_combine_null_lemma]);
a(DROP_NTH_ASM_T 14(ante_tac o µ_elim¬l‰2®) 
	THEN DROP_NTH_ASM_T 13(fn _ => id_tac) 	
	THEN asm_rewrite_tac[] THEN ´_tac);
a(GET_NTH_ASM_T 6 (strip_asm_tac o rewrite_rule
	[cleanRow_def,get_spec¬MkRow®,row_components,rel_ext_clauses]));
a(POP_ASM_T (fn _ => id_tac));
a(ante_tac(list_µ_elim[¬l‰1®,¬l‰2®,¬last'®,¬last®,¬c‰2®,¬us®]inUpdates_lemma) 
	THEN asm_rewrite_tac[] THEN ´_tac);
a(cases_tac¬¶ up · (#(Squash (Id (Dom (ListRel (l‰1 ë [last'])
                                                   ’ {r|c‰2 dominates R_exist r})))),up)  us®);
(* *** Goal "1.2.2.1.1.1" *** *)
a(strip_asm_tac(list_µ_elim[
	¬Size(Squash(Id(Dom(ListRel (l‰1 ë [last']) ’ {r|c‰2 dominates R_exist r}))))®,
	¬up®,¬us®,¬c‰2®,¬t‰2®]dom_Þ_ran_lemma));
a(DROP_NTH_ASM_T 3 (ante_tac o µ_elim¬up®) THEN asm_rewrite_tac[]THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬c‰2®,¬last'®,¬l‰1®,¬up®,¬us®,¬t‰2®]conjunct1_ax2)
	THEN POP_ASM_T rewrite_thm_tac);
a(strip_asm_tac(list_µ_elim[¬c‰2®,¬last®,¬l‰2®,¬up®,¬us®,¬t‰2®]conjunct1_ax2)
	THEN POP_ASM_T rewrite_thm_tac);
a(lemma_tac¬isVal (updateRow c‰2 (TS_class t‰2) (up, last')) 
	± isVal (updateRow c‰2 (TS_class t‰2) (up, last))®);
=TEX
=SML
(* *** Goal "1.2.2.1.1.1.1" *** *)
a strip_tac;
(* *** Goal "1.2.2.1.1.1.1.1" *** *)
a(strip_asm_tac(µ_elim¬(updateRow c‰2 (TS_class t‰2) (up, last'))®val_or_error_type));
a(DROP_NTH_ASM_T 14 (strip_asm_tac o rewrite_rule[rel_ext_clauses,rel_combine_def]));
a(list_spec_nth_asm_tac 1 [¬Length l‰1 + 1®,¬destError(updateRow c‰2(TS_class t‰2)(up,last'))®]);
a(spec_nth_asm_tac 1 ¬(updateRow c‰2 (TS_class t‰2) (up, last'))®);
a(POP_ASM_T(strip_asm_tac o rewrite_rule[] o µ_elim ¬(up, last')®));
(* *** Goal "1.2.2.1.1.1.1.1.1" *** *)
a(spec_nth_asm_tac 1 ¬#(Squash (Id (Dom (ListRel (l‰1 ë [last'])
                                                   ’ {r|c‰2 dominates R_exist r}))))®);
a(POP_ASM_T ante_tac THEN asm_rewrite_tac[inv_rel_def]);
a(strip_asm_tac(list_µ_elim[¬l‰1®,¬last'®,¬{r|c‰2 dominates R_exist r}®]size_ë_one_lemma));
(* *** Goal "1.2.2.1.1.1.1.1.2" *** *)
a(POP_ASM_T(strip_asm_tac o rewrite_rule[list_rel_def,dot_dot_def,ò_thm,
	length_ë_one_thm,nth_length_one_thm]));
=TEX
=SML
(* *** Goal "1.2.2.1.1.1.1.2" *** *)
a(strip_asm_tac(µ_elim¬(updateRow c‰2 (TS_class t‰2) (up, last))®val_or_error_type));
a(DROP_NTH_ASM_T 15 (strip_asm_tac o rewrite_rule[rel_ext_clauses,rel_combine_def]));
a(list_spec_nth_asm_tac 1 [¬Length l‰2 + 1®,¬destError(updateRow c‰2(TS_class t‰2)(up, last))®]);
a(spec_nth_asm_tac 1 ¬(updateRow c‰2 (TS_class t‰2) (up, last))®);
a(POP_ASM_T(strip_asm_tac o rewrite_rule[] o µ_elim ¬(up, last)®));
(* *** Goal "1.2.2.1.1.1.1.2.1" *** *)
a(spec_nth_asm_tac 1 ¬#(Squash (Id (Dom (ListRel (l‰2 ë [last])
                                                   ’ {r|c‰2 dominates R_exist r}))))®);
a(POP_ASM_T ante_tac THEN asm_rewrite_tac[inv_rel_def]);
a(strip_asm_tac(list_µ_elim[¬l‰2®,¬last®,¬{r|c‰2 dominates R_exist r}®]size_ë_one_lemma));
(* *** Goal "1.2.2.1.1.1.1.2.2" *** *)
a(POP_ASM_T(strip_asm_tac o rewrite_rule[list_rel_def,dot_dot_def,ò_thm,
	length_ë_one_thm,nth_length_one_thm]));
=TEX
=SML
(* *** Goal "1.2.2.1.1.1.2" *** *)
a(LEMMA_T¬c‰1 dominates R_exist
                         (destVal (updateRow c‰2 (TS_class t‰2) (up, last')))
	± c‰1 dominates R_exist
                         (destVal (updateRow c‰2 (TS_class t‰2) (up, last)))®asm_rewrite_thm_tac);
(* *** Goal "1.2.2.1.1.1.2.1" *** *)
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac[updateRow_def]);
a(cases_tac¬((RelCombine up (R_data last')
                                 » Graph (updateField c‰2 (TS_class t‰2)))
                               ’ {x|isError x})
                             » Graph destError
                           = {}
	± ((RelCombine up (R_data last)
                                 » Graph (updateField c‰2 (TS_class t‰2)))
                               ’ {x|isError x})
                             » Graph destError
                           = {}®
	THEN asm_rewrite_tac[³isVal_giveError_thm,destVal_def,get_spec¬MkRow®,
	row_components]THEN REPEAT strip_tac);
(* *** Goal "1.2.2.1.1.1.2.2" *** *)
a(bc_tac[rewrite_rule[cleanColCons_def]cleanRow_updateRow_lemma]THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "1.2.2.1.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]  THEN ´_tac);
a(LEMMA_T¬RelCombine
                             (InvRel
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel (l‰1 ë [last'])
                                                   ’ {r|c‰2 dominates R_exist r}))))
                                 » us)
                             (ListRel (l‰1 ë [last']))
	=RelCombine
                             (InvRel
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l‰1
                                                   ’ {r|c‰2 dominates R_exist r}))))
                                 » us)
                             (ListRel l‰1)®rewrite_thm_tac);
=TEX
=SML
(* *** Goal "1.2.2.1.1.2.1" *** *)
a(asm_rewrite_tac[squash_ë_ax,inv_rel_À_thm,rel_combine_À_thm,»_À_thm]);
a(LEMMA_T¬InvRel {(Size (Squash(Id(Dom (ListRel l‰1
           ’ {r|c‰2 dominates R_exist r})))) + 1, Length l‰1 + 1)}
                     » us = {}®rewrite_thm_tac);
(* *** Goal "1.2.2.1.1.2.1.1" *** *)
a(rewrite_tac[rel_ext_clauses,inv_rel_def]THEN REPEAT strip_tac);
a(spec_nth_asm_tac 4 ¬y®);
a(DROP_NTH_ASM_T 4(fn _ => id_tac) THEN DROP_NTH_ASM_T 4(fn _ => id_tac));
a(strip_asm_tac(list_µ_elim[¬l‰1®,¬last'®,¬{r|c‰2 dominates R_exist r}®]size_squash_plus1_lemma));
a(swap_nth_asm_concl_tac 2);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.1.2.1.2" *** *)
a(rewrite_tac[rel_combine_one_lemma]);
=TEX
=SML
(* *** Goal "1.2.2.1.1.2.2" *** *)
a(LEMMA_T¬RelCombine
                             (InvRel
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel (l‰2 ë [last])
                                                   ’ {r|c‰2 dominates R_exist r}))))
                                 » us)
                             (ListRel (l‰2 ë [last]))
	=RelCombine
                             (InvRel
                                   (Squash
                                       (Id
                                           (Dom
                                               (ListRel l‰2
                                                   ’ {r|c‰2 dominates R_exist r}))))
                                 » us)
                             (ListRel l‰2)®rewrite_thm_tac);
(* *** Goal "1.2.2.1.1.2.2.1" *** *)
a(asm_rewrite_tac[squash_ë_ax,inv_rel_À_thm,rel_combine_À_thm,»_À_thm]);
a(LEMMA_T¬InvRel {(Size (Squash(Id(Dom (ListRel l‰2
           ’ {r|c‰2 dominates R_exist r})))) + 1, Length l‰2 + 1)}
                     » us = {}®rewrite_thm_tac);
(* *** Goal "1.2.2.1.1.2.2.1.1" *** *)
a(rewrite_tac[rel_ext_clauses,inv_rel_def]THEN REPEAT strip_tac);
a(spec_nth_asm_tac 3 ¬y®);
a(DROP_NTH_ASM_T 4(fn _ => id_tac) THEN DROP_NTH_ASM_T 4(fn _ => id_tac));
a(strip_asm_tac(list_µ_elim[¬l‰2®,¬last®,¬{r|c‰2 dominates R_exist r}®]size_squash_plus1_lemma));
a(swap_nth_asm_concl_tac 2);
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.1.2.2.1.2" *** *)
a(rewrite_tac[rel_combine_one_lemma]);
(* *** Goal "1.2.2.1.1.2.2.2" *** *)
a(asm_rewrite_tac[conjunct1_ax1]);
=TEX
=SML
(* *** Goal "1.2.2.1.2" *** *)
a(REPEAT ´_tac);
a(strip_asm_tac(list_µ_elim[¬l‰1®,¬l‰2®,¬c‰1®,¬c‰2®,¬{col
                     |¶ y
                       · c‰1 dominates CC_exist y
                           ± (CS_consGroup col, y)  TS_cons t‰2}®]
	map_cleanRow_lemma2));
a(DROP_NTH_ASM_T 3 ante_tac THEN POP_ASM_T rewrite_thm_tac);
=TEX
=SML
(* *** Goal "1.2.2.1.3" *** *)
a(REPEAT ´_tac);
a(strip_asm_tac(list_µ_elim[¬l‰1®,¬l‰2®,¬c‰1®,¬c‰2®,¬{col
                     |¶ y
                       · c‰1 dominates CC_exist y
                           ± (CS_consGroup col, y)  TS_cons t‰2}®]
	map_cleanRow_lemma2));
a(DROP_NTH_ASM_T 3 ante_tac THEN POP_ASM_T rewrite_thm_tac);
=TEX
=SML
(* *** Goal "1.2.2.1.4" *** *)
a(REPEAT ´_tac THEN fc_tac[rel_combine_null_lemma]);
a(DROP_NTH_ASM_T 14(ante_tac o µ_elim¬l‰2®) 
	THEN DROP_NTH_ASM_T 13(fn _ => id_tac) 	
	THEN asm_rewrite_tac[] THEN ´_tac);
a(asm_rewrite_tac[list_rel_ë_’_ax,rel_combine_one_lemma,conjunct1_ax1]);
=TEX
=SML
(* *** Goal "1.2.2.2" *** *)
a(cases_tac¬c‰2 dominates R_exist last'® 
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax]);
(* *** Goal "1.2.2.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.2.2.2" *** *)
a(REPEAT ´_tac THEN fc_tac[rel_combine_null_lemma]);
a(DROP_NTH_ASM_T 12(ante_tac o µ_elim¬l‰2 ë [last]®) 
	THEN DROP_NTH_ASM_T 11(fn _ => id_tac) 	
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax] THEN ´_tac);
a(POP_ASM_T (rewrite_thm_tac o eq_sym_rule));
a(asm_rewrite_tac[list_rel_ë_’_ax,rel_combine_one_lemma,conjunct1_ax1]);
=TEX
=SML
(* *** Goal "1.2.2.3" *** *)
a(cases_tac¬c‰2 dominates R_exist last® 
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax]);
(* *** Goal "1.2.2.3.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.2.3.2" *** *)
a(REPEAT ´_tac THEN fc_tac[rel_combine_null_lemma]);
a(DROP_NTH_ASM_T 12(fn _ => id_tac) 
	THEN DROP_NTH_ASM_T 11(ante_tac o µ_elim¬last'®) 	
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax] THEN ´_tac);
a(POP_ASM_T rewrite_thm_tac);
a(asm_rewrite_tac[list_rel_ë_’_ax,rel_combine_one_lemma,conjunct1_ax1]);
=TEX
=SML
(* *** Goal "1.2.2.4" *** *)
a(lemma_tac¬³ c‰2 dominates R_exist last ± ³ c‰2 dominates R_exist last'®);
(* *** Goal "1.2.2.4.1" *** *)
a(swap_nth_asm_concl_tac 1 THEN fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.2.4.2" *** *)
a(asm_rewrite_tac[size_list_rel_ë_’_ax] THEN REPEAT ´_tac 
	THEN fc_tac[rel_combine_null_lemma]);
a(DROP_NTH_ASM_T 13(ante_tac o µ_elim¬l‰2®) 
	THEN DROP_NTH_ASM_T 12(fn _ => id_tac) 	
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax] THEN ´_tac);
a(asm_rewrite_tac[list_rel_ë_’_ax,rel_combine_one_lemma,conjunct1_ax1]);
val ÛcleanTable_updateRows_lemmaÝ = save_pop_thm"cleanTable_updateRows_lemma";
=TEX
=GFT HOL output
cleanTable_updateRows_lemma =
ô µ c‰1 c‰2 t‰1 t‰2 us
  · Dom (Þ (Ran us))
          € {n|¶ c· c  Snd (cleanColCons c‰2 t‰2) ± CS_posn c = n}
        ± ((RelCombine
                  (InvRel (revealRow c‰2 t‰1) » us)
                  (ListRel (TS_rows t‰1))
                » Graph (updateRow c‰2 (TS_class t‰2)))
              ’ {x|isError x})
            » Graph destError
          = {}
        ± ((RelCombine
                  (InvRel (revealRow c‰2 t‰2) » us)
                  (ListRel (TS_rows t‰2))
                » Graph (updateRow c‰2 (TS_class t‰2)))
              ’ {x|isError x})
            » Graph destError
          = {}
        ± cleanTable c‰1 t‰1 = cleanTable c‰1 t‰2
        ± c‰1 dominates c‰2
        ± c‰2 dominates TS_class t‰1
      ´ cleanTable
          c‰1
          (replaceRows
              t‰1
              (RelList
                  (ListRel (TS_rows t‰1)
                      « (RelCombine
                          (InvRel (revealRow c‰2 t‰1) » us)
                          (ListRel (TS_rows t‰1))
                        » Graph (updateRow c‰2 (TS_class t‰1)))
                      » Graph destVal)))
        = cleanTable
          c‰1
          (replaceRows
              t‰2
              (RelList
                  (ListRel (TS_rows t‰2)
                      « (RelCombine
                          (InvRel (revealRow c‰2 t‰2) » us)
                          (ListRel (TS_rows t‰2))
                        » Graph (updateRow c‰2 (TS_class t‰2)))
                      » Graph destVal)))
=TEX
\subsection{Proof of Conjunct 2}

=SML
push_goal([],¬µ c‰1 c‰2 i s · (c‰1 dominates c‰2 ± tabExists c‰2 i s) 
	´ tabExists c‰1 i s®);
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN rewrite_tac[tabExists_def]);
a(REPEAT strip_tac);
(* *** Goal "1" *** *)
a(¶_tac¬y®THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "3" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "4" *** *)
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
val ÛtabExists_lemma1Ý = save_pop_thm"tabExists_lemma1";
=TEX
=GFT HOL output
tabExists_lemma1 = 
ô µ c‰1 c‰2 i s
  · c‰1 dominates c‰2 ± tabExists c‰2 i s ´ tabExists c‰1 i s 
=TEX
=SML
push_goal([],¬µ c s‰1 s‰2
  · hideR (c, repState s‰1) = hideR (c, repState s‰2)
      ´ (µ i
      · tabExists c i (repState s‰1)
          ´ cleanTable c (getTable i (repState s‰1))
              = cleanTable c (getTable i (repState s‰2)))®);
a(REPEAT strip_tac);
a(fc_tac[rewrite_rule[hide_eq_lemma]tabExists_cleanTable_lemma]THEN asm_fc_tac[]);
val ÛtabExists_cleanTable_lemma1Ý = save_pop_thm"tabExists_cleanTable_lemma1";
=TEX
=GFT HOL output
tabExists_cleanTable_lemma1 = 
ô µ c s‰1 s‰2
  · hideR (c, repState s‰1) = hideR (c, repState s‰2)
      ´ (µ i
      · tabExists c i (repState s‰1)
          ´ cleanTable c (getTable i (repState s‰1))
            = cleanTable c (getTable i (repState s‰2))) 
=TEX

=SML
push_goal([],¬µ c‰1 c‰2 s‰1 s‰2 e
        · hideR (c‰1, repState s‰1) = hideR (c‰1, repState s‰2) ± c‰1 dominates c‰2
            ´ hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰1)))
              = hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰2)))®);
a(REPEAT strip_tac);
a(lemma_tac¬hideR (c‰2, repState s‰1) = hideR (c‰2, repState s‰2)®
	THEN_LIST[fc_tac[rewrite_rule[hide_eq_lemma,secureHide_def]secureHide_lemma]
	THEN asm_fc_tac[],id_tac]);
a(LEMMA_T¬e = (Fst e,Snd e)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],rewrite_tac[updateStateR_def]]);
a(lemma_tac¬(tabExists c‰2 (tabFromEffect (Fst e)) (repState s‰1) 
		´ tabExists c‰2 (tabFromEffect (Fst e)) (repState s‰2))
	± (tabExists c‰2(tabFromEffect (Fst e)) (repState s‰2 )
		´ tabExists c‰2(tabFromEffect (Fst e)) (repState s‰1))®);
=TEX
=SML
(* *** Goal "1" *** *)
a(strip_asm_tac(list_µ_elim[¬c‰2®,¬s‰1®,¬s‰2®](rewrite_rule[hide_eq_lemma]
	tabExists_lemma))THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
(* invalid tables in s‰1 and s‰2 *)
a(strip_asm_tac(µ_elim ¬Fst e® query_type) THEN asm_rewrite_tac[]
	THEN cases_tac¬³ Snd e = []® THEN asm_rewrite_tac[]);
(* *** Goal "3" *** *)
(* valid tables in s‰1 and s‰2 *)
a(strip_asm_tac (list_µ_elim[¬c‰2®,¬s‰1®,¬s‰2®](rewrite_rule[hide_eq_lemma]
	tabExists_cleanTable_lemma)));
a(POP_ASM_T (strip_asm_tac o µ_elim¬tabFromEffect (Fst e)®));
=TEX
=SML
(* *** Goal "3.1" *** *)
(* table classes not dominated  by c *)
a(EVERY[strip_asm_tac(µ_elim ¬Fst e® query_type),
	asm_rewrite_tac[],
	cases_tac¬³ Snd e = []®,
	asm_rewrite_tac[]]);
(* *** Goal "3.2" *** *)
(* table classes dominated by c *)
a(strip_asm_tac(list_µ_elim[¬c‰1®,¬c‰2®,¬tabFromEffect (Fst e)®,¬repState s‰1®]tabExists_lemma1));
a(strip_asm_tac (list_µ_elim[¬c‰1®,¬s‰1®,¬s‰2®]tabExists_cleanTable_lemma1));
a(POP_ASM_T (strip_asm_tac o µ_elim¬tabFromEffect (Fst e)®));
a(EVERY[strip_asm_tac(µ_elim ¬Fst e® query_type),
	asm_rewrite_tac[],
	cases_tac¬³ Snd e = []®,
	asm_rewrite_tac[]]);
=TEX
=SML
(* 3 subgoals - Select automatically proven *)
(* *** Goal "3.2.1" *** *)
(* *** Insert *** *)
a(LIST_DROP_NTH_ASM_T[1,2,3,4,7](MAP_EVERY (fn _ => id_tac))); 
a(POP_ASM_T (strip_asm_tac o rewrite_rule[isInsert_def]));
a(LIST_DROP_NTH_ASM_T[2,3,4,5,6,7](MAP_EVERY ante_tac) 
	THEN POP_ASM_T rewrite_thm_tac);
a(rewrite_tac[destInsert_def,tabFromEffect_def,
	getTable_def,rewrite_rule[dom_def]tabExists_def]);
a(REPEAT strip_tac);
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰1®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰1®,¬Front (Fst i)®,¬y''®]at_thm));
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰2®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰2®,¬Front (Fst i)®,¬y®]at_thm));
a(LIST_DROP_NTH_ASM_T[7,8,9,10,11,12,13,15,16,17](MAP_EVERY ante_tac) 
	THEN GET_NTH_ASM_T 4 rewrite_thm_tac THEN TOP_ASM_T rewrite_thm_tac);
=TEX
=SML
a(REPEAT ´_tac);
a(DROP_NTH_ASM_T 16  ante_tac  THEN DROP_NTH_ASM_T 13  ante_tac  THEN
	rewrite_tac[ª_def,get_spec¬IdeL®,get_spec¬DirectoryS®,¡_def,¸_def,
	get_spec¬Universe®,dom_thm,rel_ext_clauses,get_spec¬$ð®]THEN REPEAT ´_tac);
a(asm_fc_tac[]);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac[ß_def,¡_def]
	THEN REPEAT ´_tac);
a(strip_asm_tac(list_µ_elim[¬Dir_tables y®,¬Last (Fst i)®,¬y'®]at_thm));
a(strip_asm_tac(list_µ_elim[¬Dir_tables y''®,¬Last (Fst i)®,¬y'''®]at_thm));
a(LIST_DROP_NTH_ASM_T[9,10,11,12](MAP_EVERY ante_tac)THEN asm_rewrite_tac[]);
a(LIST_DROP_NTH_ASM_T[4,6,7,8](MAP_EVERY (fn _ => id_tac))
	THEN REPEAT ´_tac); 
a(LEMMA_T¬i = (Fst i,Snd i)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],asm_rewrite_tac[hideR_def,insertQuery_def,changeSpec_def]]);
a(DROP_NTH_ASM_T 23(strip_asm_tac o rewrite_rule[hideR_def,rel_ext_clauses]));
a(REPEAT strip_tac);
=TEX
=SML
(* *** Goal "3.2.1.1" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front (Fst i)®asm_tac);
(* *** Goal "3.2.1.1.1" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬Front(Fst i)®,¬cleanDirectory c‰1 y''®]));
a(LEMMA_T¬(¶ z
             · (c‰1 dominates Dir_exist z ± (Front (Fst i), z)  repState s‰1)
                 ± cleanDirectory c‰1 y'' = cleanDirectory c‰1 z)®asm_tac);
(* *** Goal "3.2.1.1.1.1" *** *)
a(¶_tac¬y''®THEN asm_rewrite_tac[]);
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "3.2.1.1.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z' = y®);
=TEX
=SML
(* *** Goal "3.2.1.1.1.2.1" *** *)
a(DROP_NTH_ASM_T 25(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Front (Fst i)®,¬z'®,¬y®]));
(* *** Goal "3.2.1.1.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a(´_T (strip_asm_tac o rewrite_rule[cleanDirectory_def,
	get_spec¬MkDirectory®,dir_components]));
a(¶_tac¬MkDirectory
                         (Dir_tables y
                             « {(Last (Fst i),
                                 replaceRows
                                     y'
                                     (TS_rows y'
                                         ë Map
                                           (MkRow c‰2 o colDefaults c‰2 y')
                                           (Snd i)))})
                         (Dir_exist y)
                         (Dir_class y)®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
a(lemma_tac¬c‰1 dominates Dir_exist y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(rewrite_tac[cleanDirectory_def]);
a(lemma_tac¬c‰1 dominates Dir_class y''® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(asm_rewrite_tac[get_spec¬MkDirectory®,dir_components]);
a(lemma_tac¬c‰1 dominates Dir_class y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[rel_ext_clauses]THEN ´_tac);
a(rewrite_tac[«_single]);
a(REPEAT µ_tac THEN ¤_T asm_tac);
=TEX
=SML
(* *** Goal "3.2.1.1.1.2.2.1" *** *)
a(cases_tac¬x' = Last (Fst i)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.1.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y' (TS_rows y' ë Map (MkRow c‰2 o colDefaults c‰2 y') (Snd i))®
	THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_insertRows_lemma]THEN asm_fc_tac[]); 
a(spec_nth_asm_tac 7 ¬Snd i®);
(* *** Goal "3.2.1.1.1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(DROP_NTH_ASM_T 4 (asm_tac o list_µ_elim[¬x'®,¬cleanTable c‰1 z''®]));
a(LEMMA_T¬¶ z · (x', z)  Dir_tables y''
                 ± cleanTable c‰1 z'' = cleanTable c‰1 z®asm_tac);
(* *** Goal "3.2.1.1.1.2.2.1.2.1" *** *)
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.1.2.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'''®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.1.1.1.2.2.2" *** *)
a(cases_tac¬x' = Last (Fst i)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.1.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y''' (TS_rows y''' ë Map (MkRow c‰2 o colDefaults c‰2 y''') (Snd i))®
	THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_insertRows_lemma]THEN asm_fc_tac[]); 
a(spec_nth_asm_tac 7 ¬Snd i®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.1.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.1.1.2" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 5(asm_tac o list_µ_elim[¬x®,¬cleanDirectory c‰1 z®]));
a(LEMMA_T¬¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰1)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z'®asm_tac);
(* *** Goal "3.2.1.1.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.1.2" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front (Fst i)®asm_tac);
(* *** Goal "3.2.1.2.1" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬Front(Fst i)®,¬cleanDirectory c‰1 y''®]));
a(LEMMA_T¬(¶ z
             · (c‰1 dominates Dir_exist z ± (Front (Fst i), z)  repState s‰1)
                 ± cleanDirectory c‰1 y'' = cleanDirectory c‰1 z)®asm_tac);
(* *** Goal "3.2.1.2.1.1" *** *)
a(¶_tac¬y''®THEN asm_rewrite_tac[]);
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "3.2.1.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z' = y®);
=TEX
=SML
(* *** Goal "3.2.1.2.1.2.1" *** *)
a(DROP_NTH_ASM_T 25(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Front (Fst i)®,¬z'®,¬y®]));
(* *** Goal "3.2.1.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a(´_T (strip_asm_tac o rewrite_rule[cleanDirectory_def,
	get_spec¬MkDirectory®,dir_components]));
a(¶_tac¬MkDirectory
                         (Dir_tables y''
                             « {(Last (Fst i),
                                 replaceRows
                                     y'''
                                     (TS_rows y'''
                                         ë Map
                                           (MkRow c‰2 o colDefaults c‰2 y''')
                                           (Snd i)))})
                         (Dir_exist y'')
                         (Dir_class y'')®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
a(lemma_tac¬c‰1 dominates Dir_exist y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(rewrite_tac[cleanDirectory_def]);
a(lemma_tac¬c‰1 dominates Dir_class y''® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(asm_rewrite_tac[get_spec¬MkDirectory®,dir_components]);
a(lemma_tac¬c‰1 dominates Dir_class y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[rel_ext_clauses]THEN ´_tac);
a(rewrite_tac[«_single]);
a(REPEAT µ_tac THEN ¤_T asm_tac);
=TEX
=SML
(* *** Goal "3.2.1.2.1.2.2.1" *** *)
a(cases_tac¬x' = Last (Fst i)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.1.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y''' (TS_rows y''' ë Map (MkRow c‰2 o colDefaults c‰2 y''') (Snd i))®
	THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_insertRows_lemma]THEN asm_fc_tac[]); 
a(spec_nth_asm_tac 7 ¬Snd i® THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.1.2.1.2.2.2" *** *)
a(cases_tac¬x' = Last (Fst i)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.1.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y' (TS_rows y' ë Map (MkRow c‰2 o colDefaults c‰2 y') (Snd i))®
	THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_insertRows_lemma]THEN asm_fc_tac[]); 
a(spec_nth_asm_tac 7 ¬Snd i®);
(* *** Goal "3.2.1.2.1.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(DROP_NTH_ASM_T 4 (asm_tac o list_µ_elim[¬x'®,¬cleanTable c‰1 z''®]));
a(LEMMA_T¬¶ z · (x', z)  Dir_tables y''
                 ± cleanTable c‰1 z'' = cleanTable c‰1 z®asm_tac);
(* *** Goal "3.2.1.2.1.2.2.2.2.1" *** *)
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.1.2.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'''®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 5(asm_tac o list_µ_elim[¬x®,¬cleanDirectory c‰1 z®]));
a(LEMMA_T¬¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰2)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z'®asm_tac);
(* *** Goal "3.2.1.2.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.2" *** *)
(* *** Delete *** *)
a(LIST_DROP_NTH_ASM_T[1,2,3,4,7](MAP_EVERY (fn _ => id_tac))); 
a(POP_ASM_T (strip_asm_tac o rewrite_rule[isDelete_def]));
a(LIST_DROP_NTH_ASM_T[2,3,4,5,6,7](MAP_EVERY ante_tac) 
	THEN POP_ASM_T rewrite_thm_tac);
a(rewrite_tac[destInsert_def,tabFromEffect_def,
	getTable_def,rewrite_rule[dom_def]tabExists_def]);
a(REPEAT strip_tac);
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰1®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰1®,¬Front (Fst d)®,¬y''®]at_thm));
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰2®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰2®,¬Front (Fst d)®,¬y®]at_thm));
a(LIST_DROP_NTH_ASM_T[7,8,9,10,11,12,13,15,16,17](MAP_EVERY ante_tac) 
	THEN GET_NTH_ASM_T 4 rewrite_thm_tac THEN TOP_ASM_T rewrite_thm_tac);
=TEX
=SML
a(REPEAT ´_tac);
a(DROP_NTH_ASM_T 16  ante_tac  THEN DROP_NTH_ASM_T 13  ante_tac  THEN
	rewrite_tac[ª_def,get_spec¬IdeL®,get_spec¬DirectoryS®,¡_def,¸_def,
	get_spec¬Universe®,dom_thm,rel_ext_clauses,get_spec¬$ð®]THEN REPEAT ´_tac);
a(asm_fc_tac[]);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac[ß_def,¡_def]
	THEN REPEAT ´_tac);
a(strip_asm_tac(list_µ_elim[¬Dir_tables y®,¬Last (Fst d)®,¬y'®]at_thm));
a(strip_asm_tac(list_µ_elim[¬Dir_tables y''®,¬Last (Fst d)®,¬y'''®]at_thm));
a(LIST_DROP_NTH_ASM_T[9,10,11,12](MAP_EVERY ante_tac)THEN asm_rewrite_tac[]);
a(LIST_DROP_NTH_ASM_T[4,6,7,8](MAP_EVERY (fn _ => id_tac))
	THEN REPEAT ´_tac); 
a(LEMMA_T¬d = (Fst d,Snd d)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],asm_rewrite_tac[hideR_def,deleteQuery_def,changeSpec_def]]);
a(DROP_NTH_ASM_T 23(strip_asm_tac o rewrite_rule[hideR_def,rel_ext_clauses]));
a(REPEAT strip_tac);
=TEX
=SML
(* *** Goal "3.2.2.1" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front (Fst d)®asm_tac);
(* *** Goal "3.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬Front(Fst d)®,¬cleanDirectory c‰1 y''®]));
a(LEMMA_T¬(¶ z
             · (c‰1 dominates Dir_exist z ± (Front (Fst d), z)  repState s‰1)
                 ± cleanDirectory c‰1 y'' = cleanDirectory c‰1 z)®asm_tac);
(* *** Goal "3.2.2.1.1.1" *** *)
a(¶_tac¬y''®THEN asm_rewrite_tac[]);
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "3.2.2.1.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z' = y®);
=TEX
=SML
(* *** Goal "3.2.2.1.1.2.1" *** *)
a(DROP_NTH_ASM_T 25(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Front (Fst d)®,¬z'®,¬y®]));
(* *** Goal "3.2.2.1.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a(´_T (strip_asm_tac o rewrite_rule[cleanDirectory_def,
	get_spec¬MkDirectory®,dir_components]));
=TEX
=SML
a(¶_tac¬MkDirectory(Dir_tables y
                             « {(Last (Fst d),
                                 replaceRows
                                     y'
                                     (Extract
                                         (1 .. Length (TS_rows y')
                                             \ revealRow c‰2 y' Image Snd d
                                               ¡ {i
                                               |R_exist (Nth (TS_rows y') i)
                                                   = c‰2})
                                         (TS_rows y')))})
                         (Dir_exist y)
                         (Dir_class y)®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
=TEX
=SML
a(lemma_tac¬c‰1 dominates Dir_exist y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(rewrite_tac[cleanDirectory_def]);
a(lemma_tac¬c‰1 dominates Dir_class y''® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(asm_rewrite_tac[get_spec¬MkDirectory®,dir_components]);
a(lemma_tac¬c‰1 dominates Dir_class y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[rel_ext_clauses]THEN ´_tac);
a(rewrite_tac[«_single]);
a(REPEAT µ_tac THEN ¤_T asm_tac);
=TEX
=SML
(* *** Goal "3.2.2.1.1.2.2.1" *** *)
a(cases_tac¬x' = Last (Fst d)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.1.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y'
                       (Extract
                           (1 .. Length (TS_rows y')
                               \ revealRow c‰2 y' Image Snd d
                                 ¡ {i|R_exist (Nth (TS_rows y') i) = c‰2})
                           (TS_rows y'))® THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_deleteRows_lemma]THEN asm_fc_tac[]);
a(spec_nth_asm_tac 7 ¬Snd d®);
(* *** Goal "3.2.2.1.1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(DROP_NTH_ASM_T 4 (asm_tac o list_µ_elim[¬x'®,¬cleanTable c‰1 z''®]));
a(LEMMA_T¬¶ z · (x', z)  Dir_tables y''
                 ± cleanTable c‰1 z'' = cleanTable c‰1 z®asm_tac);
=TEX
=SML
(* *** Goal "3.2.2.1.1.2.2.1.2.1" *** *)
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.1.2.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.1.2.2.2" *** *)
a(cases_tac¬x' = Last (Fst d)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.1.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y'''
                   (Extract
                       (1 .. Length (TS_rows y''')
                           \ revealRow c‰2 y''' Image Snd d
                             ¡ {i|R_exist (Nth (TS_rows y''') i) = c‰2})
                       (TS_rows y'''))® THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_deleteRows_lemma]THEN asm_fc_tac[]); 
a(spec_nth_asm_tac 7 ¬Snd d®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.1.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 5(asm_tac o list_µ_elim[¬x®,¬cleanDirectory c‰1 z®]));
a(LEMMA_T¬¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰1)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z'®asm_tac);
(* *** Goal "3.2.2.1.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.2.2" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front (Fst d)®asm_tac);
(* *** Goal "3.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬Front(Fst d)®,¬cleanDirectory c‰1 y''®]));
a(LEMMA_T¬(¶ z
             · (c‰1 dominates Dir_exist z ± (Front (Fst d), z)  repState s‰1)
                 ± cleanDirectory c‰1 y'' = cleanDirectory c‰1 z)®asm_tac);
(* *** Goal "3.2.2.2.1.1" *** *)
a(¶_tac¬y''®THEN asm_rewrite_tac[]);
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "3.2.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z' = y®);
=TEX
=SML
(* *** Goal "3.2.2.2.1.2.1" *** *)
a(DROP_NTH_ASM_T 25(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Front (Fst d)®,¬z'®,¬y®]));
(* *** Goal "3.2.2.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a(´_T (strip_asm_tac o rewrite_rule[cleanDirectory_def,
	get_spec¬MkDirectory®,dir_components]));
a(¶_tac¬MkDirectory (Dir_tables y''
                             « {(Last (Fst d),
                                 replaceRows
                                     y'''
                                     (Extract
                                         (1 .. Length (TS_rows y''')
                                             \ revealRow c‰2 y''' Image Snd d
                                               ¡ {i
                                               |R_exist (Nth (TS_rows y''') i)
                                                   = c‰2})
                                         (TS_rows y''')))})
                         (Dir_exist y'')
                         (Dir_class y'')®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
=TEX
=SML
a(lemma_tac¬c‰1 dominates Dir_exist y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(rewrite_tac[cleanDirectory_def]);
a(lemma_tac¬c‰1 dominates Dir_class y''® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(asm_rewrite_tac[get_spec¬MkDirectory®,dir_components]);
a(lemma_tac¬c‰1 dominates Dir_class y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[rel_ext_clauses]THEN ´_tac);
a(rewrite_tac[«_single]);
a(REPEAT µ_tac THEN ¤_T asm_tac);
=TEX
=SML
(* *** Goal "3.2.2.2.1.2.2.1" *** *)
a(cases_tac¬x' = Last (Fst d)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.1.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y'''
                   (Extract
                       (1 .. Length (TS_rows y''')
                           \ revealRow c‰2 y''' Image Snd d
                             ¡ {i|R_exist (Nth (TS_rows y''') i) = c‰2})
                       (TS_rows y'''))® THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_deleteRows_lemma]THEN asm_fc_tac[]); 
a(spec_nth_asm_tac 7 ¬Snd d® THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.1.2.2.2" *** *)
a(cases_tac¬x' = Last (Fst d)®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.2.2.1.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y'
                       (Extract
                           (1 .. Length (TS_rows y')
                               \ revealRow c‰2 y' Image Snd d
                                 ¡ {i|R_exist (Nth (TS_rows y') i) = c‰2})
                           (TS_rows y'))® THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_deleteRows_lemma]THEN asm_fc_tac[]); 
a(spec_nth_asm_tac 7 ¬Snd d®);
(* *** Goal "3.2.2.2.1.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(DROP_NTH_ASM_T 4 (asm_tac o list_µ_elim[¬x'®,¬cleanTable c‰1 z''®]));
a(LEMMA_T¬¶ z · (x', z)  Dir_tables y''
                 ± cleanTable c‰1 z'' = cleanTable c‰1 z®asm_tac);
(* *** Goal "3.2.2.2.1.2.2.2.2.1" *** *)
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.1.2.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'''®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 5(asm_tac o list_µ_elim[¬x®,¬cleanDirectory c‰1 z®]));
a(LEMMA_T¬¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰2)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z'®asm_tac);
(* *** Goal "3.2.2.2.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.3" *** *)
(* *** Update *** *)
a(LIST_DROP_NTH_ASM_T[1,2,3,4,7](MAP_EVERY (fn _ => id_tac))); 
a(POP_ASM_T (strip_asm_tac o rewrite_rule[isUpdate_def]));
a(LIST_DROP_NTH_ASM_T[2,3,4,5,6,7](MAP_EVERY ante_tac) 
	THEN POP_ASM_T rewrite_thm_tac);
a(rewrite_tac[destInsert_def,tabFromEffect_def,
	getTable_def,rewrite_rule[dom_def]tabExists_def]);
a(REPEAT strip_tac);
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰1®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰1®,¬Front (Fst u)®,¬y''®]at_thm));
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰2®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰2®,¬Front (Fst u)®,¬y®]at_thm));
a(LIST_DROP_NTH_ASM_T[7,8,9,10,11,12,13,15,16,17](MAP_EVERY ante_tac) 
	THEN GET_NTH_ASM_T 4 rewrite_thm_tac THEN TOP_ASM_T rewrite_thm_tac);
=TEX
=SML
a(REPEAT ´_tac);
a(DROP_NTH_ASM_T 16  ante_tac  THEN DROP_NTH_ASM_T 13  ante_tac  THEN
	rewrite_tac[ª_def,get_spec¬IdeL®,get_spec¬DirectoryS®,¡_def,¸_def,
	get_spec¬Universe®,dom_thm,rel_ext_clauses,get_spec¬$ð®]THEN REPEAT ´_tac);
a(asm_fc_tac[]);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac[ß_def,¡_def]
	THEN REPEAT ´_tac);
a(strip_asm_tac(list_µ_elim[¬Dir_tables y®,¬Last (Fst u)®,¬y'®]at_thm));
a(strip_asm_tac(list_µ_elim[¬Dir_tables y''®,¬Last (Fst u)®,¬y'''®]at_thm));
a(LIST_DROP_NTH_ASM_T[9,10,11,12](MAP_EVERY ante_tac)THEN asm_rewrite_tac[]);
a(LIST_DROP_NTH_ASM_T[4,6,7,8](MAP_EVERY (fn _ => id_tac))
	THEN REPEAT ´_tac); 
a(LEMMA_T¬hideR (c‰1, Fst (updateQuery (c‰2, u, repState s‰1, y''')))
	= hideR(c‰1, Fst (updateQuery (c‰2, u, repState s‰2, y')))®
	rewrite_thm_tac);
a(DROP_NTH_ASM_T 4 ante_tac THEN 
	asm_rewrite_tac[cleanTable_def,get_spec¬MkTableSpec®,tab_components]);
a strip_tac;
a(DROP_NTH_ASM_T 27 (asm_tac o rewrite_rule[hideR_def]));
a(LEMMA_T¬u = (Fst u,Snd u)® pure_once_asm_rewrite_thm_tac THEN_LIST[rewrite_tac[],
	asm_rewrite_tac[hideR_def,updateQuery_def,changeSpec_def,visibleCols_def]]);
a(conv_tac (MAP_C let_conv));
a(cases_tac¬³ Dom (Þ (Ran (Snd u)))
                             € {n
                             |¶ c
                               · c  Snd (cleanColCons c‰2 y') ± CS_posn c = n}®
	THEN asm_rewrite_tac[]);
a(ante_tac (rewrite_rule[visibleCols_def]
	(list_µ_elim[¬c‰2®,¬y'®,¬y'''®,¬Snd u®]cleanRows_errors_or_vals_lemma)) 
	THEN asm_rewrite_tac[] THEN REPEAT strip_tac THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 4(asm_tac o rewrite_rule[rel_ext_clauses]));
a(rewrite_tac[rel_ext_clauses]THEN REPEAT strip_tac);
=TEX
=SML
(* *** Goal "3.2.3.1" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front (Fst u)®asm_tac);
(* *** Goal "3.2.3.1.1" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬Front(Fst u)®,¬cleanDirectory c‰1 y''®]));
a(LEMMA_T¬(¶ z
             · (c‰1 dominates Dir_exist z ± (Front (Fst u), z)  repState s‰1)
                 ± cleanDirectory c‰1 y'' = cleanDirectory c‰1 z)®asm_tac);
(* *** Goal "3.2.3.1.1.1" *** *)
a(¶_tac¬y''®THEN asm_rewrite_tac[]);
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "3.2.3.1.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z' = y®);
(* *** Goal "3.2.3.1.1.2.1" *** *)
a(DROP_NTH_ASM_T 32(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Front (Fst u)®,¬z'®,¬y®]));
=TEX
=SML
(* *** Goal "3.2.3.1.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a(´_T (strip_asm_tac o rewrite_rule[cleanDirectory_def,
	get_spec¬MkDirectory®,dir_components]));
a(¶_tac¬MkDirectory(Dir_tables y
                             « {(Last (Fst u),
                                 replaceRows
                                     y'
                                     (RelList
                                         (ListRel (TS_rows y')
                                             « (RelCombine
                                                 (InvRel (revealRow c‰2 y')
                                                     » Snd u)
                                                 (ListRel (TS_rows y'))
                                               » Graph
                                                 (updateRow c‰2 (TS_class y')))
                                             » Graph destVal)))})
                         (Dir_exist y)
                         (Dir_class y)®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
=TEX
=SML
a(lemma_tac¬c‰1 dominates Dir_exist y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(rewrite_tac[cleanDirectory_def]);
a(lemma_tac¬c‰1 dominates Dir_class y''® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(asm_rewrite_tac[get_spec¬MkDirectory®,dir_components]);
a(lemma_tac¬c‰1 dominates Dir_class y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[rel_ext_clauses]THEN ´_tac);
a(rewrite_tac[«_single]);
a(REPEAT µ_tac THEN ¤_T asm_tac);
=TEX
=SML
(* *** Goal "3.2.3.1.1.2.2.1" *** *)
a(cases_tac¬x' = Last (Fst u)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.1.1.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows
                   y'
                   (RelList
                       (ListRel (TS_rows y')
                           « (RelCombine
                               (InvRel (revealRow c‰2 y') » Snd u)
                               (ListRel (TS_rows y'))
                             » Graph (updateRow c‰2 (TS_class y')))
                           » Graph destVal))® THEN asm_rewrite_tac[]);
a(ante_tac(list_µ_elim[¬c‰1®,¬c‰2®,¬y'''®,¬y'®,¬Snd u®]cleanTable_updateRows_lemma)
	THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.1.1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(DROP_NTH_ASM_T 4 (asm_tac o list_µ_elim[¬x'®,¬cleanTable c‰1 z''®]));
a(LEMMA_T¬¶ z · (x', z)  Dir_tables y''
                 ± cleanTable c‰1 z'' = cleanTable c‰1 z®asm_tac);
=TEX
=SML
(* *** Goal "3.2.3.1.1.2.2.1.2.1" *** *)
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.1.1.2.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.1.1.2.2.2" *** *)
a(cases_tac¬x' = Last (Fst u)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.1.1.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows
                   y'''
                   (RelList
                       (ListRel (TS_rows y''')
                           « (RelCombine
                               (InvRel (revealRow c‰2 y''') » Snd u)
                               (ListRel (TS_rows y'''))
                             » Graph (updateRow c‰2 (TS_class y')))
                           » Graph destVal))® THEN asm_rewrite_tac[]);
a(ante_tac(list_µ_elim[¬c‰1®,¬c‰2®,¬y'''®,¬y'®,¬Snd u®]cleanTable_updateRows_lemma)
	THEN asm_rewrite_tac[] THEN ´_T rewrite_thm_tac);
(* *** Goal "3.2.3.1.1.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.3.1.2" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 5(asm_tac o list_µ_elim[¬x®,¬cleanDirectory c‰1 z®]));
a(LEMMA_T¬¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰1)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z'®asm_tac);
(* *** Goal "3.2.3.1.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.3.2" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front (Fst u)®asm_tac);
(* *** Goal "3.2.3.2.1" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬Front(Fst u)®,¬cleanDirectory c‰1 y''®]));
a(LEMMA_T¬(¶ z
             · (c‰1 dominates Dir_exist z ± (Front (Fst u), z)  repState s‰1)
                 ± cleanDirectory c‰1 y'' = cleanDirectory c‰1 z)®asm_tac);
(* *** Goal "3.2.3.2.1.1" *** *)
a(¶_tac¬y''®THEN asm_rewrite_tac[]);
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "3.2.3.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z' = y®);
(* *** Goal "3.2.3.2.1.2.1" *** *)
a(DROP_NTH_ASM_T 32(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Front (Fst u)®,¬z'®,¬y®]));
=TEX
=SML
(* *** Goal "3.2.3.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a(´_T (strip_asm_tac o rewrite_rule[cleanDirectory_def,
	get_spec¬MkDirectory®,dir_components]));
a(¶_tac¬MkDirectory (Dir_tables y''
                             « {(Last (Fst u),
                                   replaceRows
                                       y'''
                                       (RelList
                                           (ListRel (TS_rows y''')
                                               « (RelCombine
                                                   (InvRel (revealRow c‰2 y''')
                                                       » Snd u)
                                                   (ListRel (TS_rows y'''))
                                                 » Graph
                                                   (updateRow
                                                       c‰2
                                                       (TS_class y')))
                                               » Graph destVal)))})
                         (Dir_exist y'')
                         (Dir_class y'')®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
a(lemma_tac¬c‰1 dominates Dir_exist y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(rewrite_tac[cleanDirectory_def]);
a(lemma_tac¬c‰1 dominates Dir_class y''® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(asm_rewrite_tac[get_spec¬MkDirectory®,dir_components]);
a(lemma_tac¬c‰1 dominates Dir_class y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[rel_ext_clauses]THEN ´_tac);
a(rewrite_tac[«_single]);
a(REPEAT µ_tac THEN ¤_T asm_tac);
=TEX
=SML
(* *** Goal "3.2.3.2.1.2.2.1" *** *)
a(cases_tac¬x' = Last (Fst u)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.2.1.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y'''
                   (RelList
                           (ListRel (TS_rows y''')
                               « (RelCombine
                                   (InvRel (revealRow c‰2 y''') » Snd u)
                                   (ListRel (TS_rows y'''))
                                 » Graph (updateRow c‰2 (TS_class y')))
                               » Graph destVal))® THEN asm_rewrite_tac[]);
a(ante_tac(list_µ_elim[¬c‰1®,¬c‰2®,¬y'''®,¬y'®,¬Snd u®]cleanTable_updateRows_lemma)
	THEN asm_rewrite_tac[] THEN ´_T rewrite_thm_tac);
(* *** Goal "3.2.3.2.1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.2.1.2.2.2" *** *)
a(cases_tac¬x' = Last (Fst u)®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "3.2.3.2.1.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y'
                       (RelList
                           (ListRel (TS_rows y')
                               « (RelCombine
                                   (InvRel (revealRow c‰2 y') » Snd u)
                                   (ListRel (TS_rows y'))
                                 » Graph (updateRow c‰2 (TS_class y')))
                               » Graph destVal))® THEN asm_rewrite_tac[]);
a(ante_tac(list_µ_elim[¬c‰1®,¬c‰2®,¬y'''®,¬y'®,¬Snd u®]cleanTable_updateRows_lemma)
	THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.2.1.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(DROP_NTH_ASM_T 4 (asm_tac o list_µ_elim[¬x'®,¬cleanTable c‰1 z''®]));
a(LEMMA_T¬¶ z · (x', z)  Dir_tables y''
                 ± cleanTable c‰1 z'' = cleanTable c‰1 z®asm_tac);
=TEX
=SML
(* *** Goal "3.2.3.2.1.2.2.2.2.1" *** *)
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.2.1.2.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.2.2" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule
	[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 5(asm_tac o list_µ_elim[¬x®,¬cleanDirectory c‰1 z®]));
a(LEMMA_T¬¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰2)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z'®asm_tac);
(* *** Goal "3.2.3.2.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
val Ûconjunct2Ý = save_pop_thm"conjunct2";
=TEX
=GFT HOL output
conjunct2 = 
ô µ c‰1 c‰2 s‰1 s‰2 e
  · hideR (c‰1, repState s‰1) = hideR (c‰1, repState s‰2) ± c‰1 dominates c‰2
      ´ hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰1)))
        = hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰2)))
=TEX
\section{CLOSING DOWN}
The following \Product{} instruction restores the previous proof context.
=SML
pop_pc();
=TEX


\newpage
\input{fef013th.tex}

\newpage
\twocolumn[\section{INDEX} \label{INDEX}]
\small
\printindex

\end{document}

 





