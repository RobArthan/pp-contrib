=TEX
% TQtemplate.tex
\documentstyle[hol1,11pt,TQ]{article}
\def\Hide#1{}
\def\Bool{``$\it{:}bool\,$''}
\makeindex
\TPPproject{DRA FRONT END FILTER PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Proof of Security (IId)}  %% Mandatory field
\TPPref{DS/FMU/FEF/012}  %% Mandatory field
\def\SCCSversion{$Revision$
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$
}}  %% Mandatory field (with sensible default)
\TPPstatus{Draft}			%% Mandatory field
\TPPtype{Specification}
\TPPkeywords{}
\TPPauthor{G.~M.~Prout & WIN01}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthorisation{R.B.~Jones & HAT Manager}
\TPPabstract{This document completes the formal proof of security for the
DRA front end filter project RSRE 1C/6130.}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
	HAT FEF File \\
	Simon Wiseman
}}
%\TPPclass{CLASSIFICATION}
\newfont{\icllogo}{icllogo50}
\def\TPPheadlhs{$\vcenter{\halign{##\cr\icllogo ICL\cr}}$}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}

\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

%\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\newpage
\section {DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu,fef}

\subsection{Changes History}
\begin{description}
\item[Issue \SCCSversion(\FormatDate{$Date$
})] First draft version.
\end{description}

\subsection{Changes Forecast}
Changes  may be necessary  as a result of issues raised
during  the transcription of the specification.
\pagebreak
\section{GENERAL}
\subsection{Scope}
This document, together with \cite{DS/FMU/FEF/011} and \cite{DS/FMU/FEF/012}, provides a formal proof  that the components $hide$ and $updateState$ 
satisfy their critical 
requirements, as specified in 
the proof strategy \cite{DS/FMU/FEF/007}. It constitutes part of deliverable D6 
of work package 1a, as given
in section 7 of the Secure Database Technical Proposal, \cite{DS/FMU/017}.

\subsection{Introduction}

This document is a proof script which provides a formal proof which completes  the proof
 of the second conjunct of $Lemma1$,
the requirement on the critical components  $hide$ and $updateState$, described in the proof strategy document \cite{DS/FMU/FEF/007}.

{\bf Lemma1}
=GFT 
	?ô 	hide  secureHide ± (hide,updateState)  secureUpdate
=TEX

In this document, we give a proof that the second conjunct of $secureUpdate$ holds for $hideR$ and $updateStateR$:

=GFT
	?ô 	µ c‰1 c‰2 s‰1 s‰2 e
			· hideR(c‰1, s‰1) = hideR (c‰1, s‰2) ± c‰1 dominates c‰2
				´ hideR(c‰1, Fst (updateStateR (c‰2, e, s‰1)))
              = hideR (c‰1, Fst (updateStateR (c‰2, e, s‰2))))
=TEX
Hence ....


\section{PRELIMINARIES}
The following ICL HOL instructions set up the new theory $fef013$.

=SML 
open_theory "fef012";
new_theoryÛ"fef013"Ý;
push_merge_pcs["hol","fefhol","fefrel","'pair1"] ;
=TEX

\section{PROOF OF SECURITY OF CRITICAL COMPONENTS}




\subsection{Proof of Conjunct 2}

=SML
push_goal([],¬µ t rs · TS_class(replaceRows t rs) = TS_class t®);
a(rewrite_tac[replaceRows_def,tab_components,get_spec¬MkTableSpec®]);
val Ûclass_replaceRows_lemmaÝ = save_pop_thm"class_replaceRows_lemma";
=TEX
=SML
push_goal([],¬µ c‰1 c‰2 t‰1 t‰2 ds · 
	cleanTable c‰1 t‰1 = cleanTable c‰1 t‰2 ± c‰1 dominates c‰2  
	´
	cleanTable c‰1 (replaceRows t‰1
		((TS_rows t‰1) ë (Map((MkRow c‰2) o (colDefaults c‰2 t‰1))ds)))
	=
	cleanTable c‰1 (replaceRows t‰2
		((TS_rows t‰2) ë (Map((MkRow c‰2) o (colDefaults c‰2 t‰2))ds)))®);
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 2 ante_tac THEN rewrite_tac[cleanTable_def,replaceRows_def,get_spec¬MkTableSpec®]);
a(cases_tac¬c‰1 dominates TS_class t‰1®THEN cases_tac¬c‰1 dominates TS_class t‰2®
	THEN asm_rewrite_tac[]);
(* *** Goal "1" *** *)
a(rewrite_tac[get_spec¬MkTableSpec®,tab_components,cleanColCons_def]THEN REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN rewrite_tac[cleanRows_def,revealRow_def,map_ë_thm1]);
a ´_tac;
a(LEMMA_T¬Map
                 (cleanRow
                     c‰1
                     {col
                       |¶ y
                         · c‰1 dominates CC_exist y
                             ± (CS_consGroup col, y)  TS_cons t‰1})
                 (Map (MkRow c‰2 o colDefaults c‰2 t‰1) ds
                     ù {r|c‰1 dominates R_exist r}) = 
	Map
                 (cleanRow
                     c‰1
                     {col
                       |¶ y
                         · c‰1 dominates CC_exist y
                             ± (CS_consGroup col, y)  TS_cons t‰2})
                 (Map (MkRow c‰2 o colDefaults c‰2 t‰2) ds
                     ù {r|c‰1 dominates R_exist r})®asm_rewrite_thm_tac);
a(POP_ASM_T (fn _ => id_tac));
a(REV_LIST_INDUCTION_T¬ds®asm_tac);
(* *** Goal "1.1" *** *)
a(rewrite_tac[map_def,ù_def]);
(* *** Goal "1.2" *** *)
a(rewrite_tac[map_ë_thm,ù_thm,get_spec¬MkRow®]);
a(µ_tac THEN GET_NTH_ASM_T 8 rewrite_thm_tac);
a(LEMMA_T¬cleanRow  c‰1 {col
                   |¶ y
                     · c‰1 dominates CC_exist y
                         ± (CS_consGroup col, y)  TS_cons t‰1}
                 (MkRow c‰2 (colDefaults c‰2 t‰1 last))
               = cleanRow c‰1  {col
                   |¶ y
                     · c‰1 dominates CC_exist y
                         ± (CS_consGroup col, y)  TS_cons t‰2}
                 (MkRow c‰2 (colDefaults c‰2 t‰2 last))®asm_rewrite_thm_tac);
a(POP_ASM_T (fn _ => id_tac));
a(POP_ASM_T(strip_asm_tac o rewrite_rule[rel_ext_clauses,’_thm]));
a(asm_rewrite_tac[colDefaults_def,cleanColCons_def,visibleCols_def,cleanRow_def,
	get_spec¬MkRow®,row_components,rel_ext_clauses,filterRow_def]);
a(REPEAT strip_tac);
(* *** Goal "1.2.1" *** *)
a(cases_tac¬³ x  Dom{(n, d)
               |¶ c
                 · ³ (¶ y
                       · c‰2 dominates CC_exist y
                           ± (CS_consGroup c, y)  TS_cons t‰1)
                     ± n = CS_posn c
                     ± d = CS_default c}®);
(* *** Goal "1.2.1.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
(* *** Goal "1.2.1.1.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
(* *** Goal "1.2.1.1.1.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.1.1.1.2" *** *)
a ²_left_tac;
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬y''®);
a(spec_nth_asm_tac 1 ¬c'®);
a(¶_tac¬y'''®THEN asm_rewrite_tac[]);
a(lemma_tac¬c‰1 dominates CC_exist y'''®);
(* *** Goal "1.2.1.1.1.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.1.1.1.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y'''®]);
(* *** Goal "1.2.1.1.2" *** *)
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬z®);
a(spec_nth_asm_tac 1 ¬c'®);
a(spec_nth_asm_tac 7 ¬y''®);
(* *** Goal "1.2.1.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
(* *** Goal "1.2.1.2.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.1.2.2" *** *)
a ²_right_tac;
a(¶_tac¬c'®THEN asm_rewrite_tac[]);
a(REPEAT strip_tac);
a(spec_nth_asm_tac 4 ¬y''®);
a contr_tac;
a(lemma_tac¬c‰1 dominates CC_exist y''®);
(* *** Goal "1.2.1.2.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.1.2.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y''®]);
(* *** Goal "1.2.2" *** *)
a(cases_tac¬³ x  Dom{(n, d)
               |¶ c
                 · ³ (¶ y
                       · c‰2 dominates CC_exist y
                           ± (CS_consGroup c, y)  TS_cons t‰2)
                     ± n = CS_posn c
                     ± d = CS_default c}®);
(* *** Goal "1.2.2.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
(* *** Goal "1.2.2.1.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
(* *** Goal "1.2.2.1.1.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.1.2" *** *)
a ²_left_tac;
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬y''®);
a(spec_nth_asm_tac 1 ¬c'®);
a(¶_tac¬y'''®THEN asm_rewrite_tac[]);
a(lemma_tac¬c‰1 dominates CC_exist y'''®);
(* *** Goal "1.2.2.1.1.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.2.1.1.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y'''®]);
(* *** Goal "1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬z®);
a(spec_nth_asm_tac 1 ¬c'®);
a(spec_nth_asm_tac 7 ¬y''®);
(* *** Goal "1.2.2.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
(* *** Goal "1.2.2.2.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.2.2" *** *)
a ²_right_tac;
a(¶_tac¬c'®THEN asm_rewrite_tac[]);
a(REPEAT strip_tac);
a(spec_nth_asm_tac 4 ¬y''®);
a contr_tac;
a(lemma_tac¬c‰1 dominates CC_exist y''®);
(* *** Goal "1.2.2.2.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.2.2.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y''®]);
(* *** Goal "2" *** *)
a(rewrite_tac[get_spec¬MkTableSpec®,tab_components,cleanColCons_def]THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN DROP_NTH_ASM_T 5 rewrite_thm_tac);
a(asm_rewrite_tac[]);
(* *** Goal "3" *** *)
a(rewrite_tac[get_spec¬MkTableSpec®,tab_components,cleanColCons_def]THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN DROP_NTH_ASM_T 5 rewrite_thm_tac);
a(asm_rewrite_tac[]);
val ÛcleanTable_insertRows_lemmaÝ = save_pop_thm"cleanTable_insertRows_lemma";
=TEX
=SML
val delete_ax = new_axiom(["delete_ax"],¬µ c‰1 c‰2 t‰1 t‰2 ns · 
	cleanTable c‰1 t‰1 = cleanTable c‰1 t‰2 
	± c‰1 dominates c‰2 ± c‰2 dominates TS_class t‰1 
	´
	cleanTable c‰1 (replaceRows t‰1 
		(Extract (1 .. Length(TS_rows t‰1) \ 
	((revealRow c‰2 t‰1) Image ns ¡ {i|R_exist(Nth(TS_rows t‰1)i) = c‰2}))
	(TS_rows t‰1)))
	=
	cleanTable c‰1 (replaceRows t‰2 
		(Extract (1 .. Length(TS_rows t‰2) \ 
	((revealRow c‰2 t‰2) Image ns ¡ {i|R_exist(Nth(TS_rows t‰2)i) = c‰2}))
	(TS_rows t‰2)))®);
=TEX



=SML
push_goal([],¬µ c‰1 c‰2 i s · (c‰1 dominates c‰2 ± tabExists c‰2 i s) 
	´ tabExists c‰1 i s®);
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN rewrite_tac[tabExists_def]);
a(REPEAT strip_tac);
(* *** Goal "1" *** *)
a(¶_tac¬y®THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "3" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "4" *** *)
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
val ÛtabExists_lemma1Ý = save_pop_thm"tabExists_lemma1";
=TEX
=SML
push_goal([],¬µ c s‰1 s‰2
  · hideR (c, repState s‰1) = hideR (c, repState s‰2)
      ´ (µ i
      · tabExists c i (repState s‰1)
          ´ cleanTable c (getTable i (repState s‰1))
              = cleanTable c (getTable i (repState s‰2)))®);
a(REPEAT strip_tac);
a(fc_tac[rewrite_rule[hide_eq_lemma]tabExists_cleanTable_lemma]THEN asm_fc_tac[]);
val ÛtabExists_cleanTable_lemma1Ý = save_pop_thm"tabExists_cleanTable_lemma1";
=TEX

=SML
push_goal([],¬µ c‰1 c‰2 s‰1 s‰2 e
        · hideR (c‰1, repState s‰1) = hideR (c‰1, repState s‰2) ± c‰1 dominates c‰2
            ´ hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰1)))
              = hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰2)))®);
a(REPEAT strip_tac);
a(lemma_tac¬hideR (c‰2, repState s‰1) = hideR (c‰2, repState s‰2)®
	THEN_LIST[fc_tac[rewrite_rule[hide_eq_lemma,secureHide_def]secureHide_lemma]
	THEN asm_fc_tac[],id_tac]);
a(LEMMA_T¬e = (Fst e,Snd e)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],rewrite_tac[updateStateR_def]]);
a(lemma_tac¬(tabExists c‰2 (tabFromEffect (Fst e)) (repState s‰1) 
		´ tabExists c‰2 (tabFromEffect (Fst e)) (repState s‰2))
	± (tabExists c‰2(tabFromEffect (Fst e)) (repState s‰2 )
		´ tabExists c‰2(tabFromEffect (Fst e)) (repState s‰1))®);
(* *** Goal "1" *** *)
a(strip_asm_tac(list_µ_elim[¬c‰2®,¬s‰1®,¬s‰2®](rewrite_rule[hide_eq_lemma]
	tabExists_lemma))THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
(* invalid tables in s‰1 and s‰2 *)
a(strip_asm_tac(µ_elim ¬Fst e® query_type) THEN asm_rewrite_tac[]
	THEN cases_tac¬³ Snd e = []® THEN asm_rewrite_tac[]);
(* *** Goal "3" *** *)
(* valid tables in s‰1 and s‰2 *)
a(strip_asm_tac (list_µ_elim[¬c‰2®,¬s‰1®,¬s‰2®](rewrite_rule[hide_eq_lemma]
	tabExists_cleanTable_lemma)));
a(POP_ASM_T (strip_asm_tac o µ_elim¬tabFromEffect (Fst e)®));
(* *** Goal "3.1" *** *)
(* table classes not dominated  by c *)
a(EVERY[strip_asm_tac(µ_elim ¬Fst e® query_type),
	asm_rewrite_tac[],
	cases_tac¬³ Snd e = []®,
	asm_rewrite_tac[]]);
(* *** Goal "3.2" *** *)
(* table classes dominated by c *)
a(strip_asm_tac(list_µ_elim[¬c‰1®,¬c‰2®,¬tabFromEffect (Fst e)®,¬repState s‰1®]tabExists_lemma1));
a(strip_asm_tac (list_µ_elim[¬c‰1®,¬s‰1®,¬s‰2®]tabExists_cleanTable_lemma1));
a(POP_ASM_T (strip_asm_tac o µ_elim¬tabFromEffect (Fst e)®));
a(EVERY[strip_asm_tac(µ_elim ¬Fst e® query_type),
	asm_rewrite_tac[],
	cases_tac¬³ Snd e = []®,
	asm_rewrite_tac[]]);
(* 3 subgoals - Select automatically proven *)
(* *** Goal "3.2.1" *** *)
(* *** Insert *** *)
a(LIST_DROP_NTH_ASM_T[1,2,3,4,7](MAP_EVERY (fn _ => id_tac))); 
a(POP_ASM_T (strip_asm_tac o rewrite_rule[isInsert_def]));
a(LIST_DROP_NTH_ASM_T[2,3,4,5,6,7](MAP_EVERY ante_tac) THEN POP_ASM_T rewrite_thm_tac);
a(rewrite_tac[destInsert_def,tabFromEffect_def,
	getTable_def,rewrite_rule[dom_def]tabExists_def]);
a(REPEAT strip_tac);
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰1®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰1®,¬Front (Fst i)®,¬y''®]at_thm));
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰2®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰2®,¬Front (Fst i)®,¬y®]at_thm));
a(LIST_DROP_NTH_ASM_T[7,8,9,10,11,12,13,15,16,17](MAP_EVERY ante_tac) 
	THEN GET_NTH_ASM_T 4 rewrite_thm_tac THEN TOP_ASM_T rewrite_thm_tac);
a(REPEAT ´_tac);
a(DROP_NTH_ASM_T 16  ante_tac  THEN DROP_NTH_ASM_T 13  ante_tac  THEN
	rewrite_tac[ª_def,get_spec¬IdeL®,get_spec¬DirectoryS®,¡_def,¸_def,
	get_spec¬Universe®,dom_thm,rel_ext_clauses,get_spec¬$ð®]THEN REPEAT ´_tac);
a(asm_fc_tac[]);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac[ß_def,¡_def]
	THEN REPEAT ´_tac);
a(strip_asm_tac(list_µ_elim[¬Dir_tables y®,¬Last (Fst i)®,¬y'®]at_thm));
a(strip_asm_tac(list_µ_elim[¬Dir_tables y''®,¬Last (Fst i)®,¬y'''®]at_thm));
a(LIST_DROP_NTH_ASM_T[9,10,11,12](MAP_EVERY ante_tac)THEN asm_rewrite_tac[]);
a(LIST_DROP_NTH_ASM_T[4,6,7,8](MAP_EVERY (fn _ => id_tac))THEN REPEAT ´_tac); 
a(LEMMA_T¬i = (Fst i,Snd i)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],asm_rewrite_tac[hideR_def,insertQuery_def,changeSpec_def]]);
a(DROP_NTH_ASM_T 23(strip_asm_tac o rewrite_rule[hideR_def,rel_ext_clauses]));
a(REPEAT strip_tac);
(* *** Goal "3.2.1.1" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front (Fst i)®asm_tac);
(* *** Goal "3.2.1.1.1" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬Front(Fst i)®,¬cleanDirectory c‰1 y''®]));
a(LEMMA_T¬(¶ z
             · (c‰1 dominates Dir_exist z ± (Front (Fst i), z)  repState s‰1)
                 ± cleanDirectory c‰1 y'' = cleanDirectory c‰1 z)®asm_tac);
(* *** Goal "3.2.1.1.1.1" *** *)
a(¶_tac¬y''®THEN asm_rewrite_tac[]);
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "3.2.1.1.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z' = y®);
(* *** Goal "3.2.1.1.1.2.1" *** *)
a(DROP_NTH_ASM_T 25(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Front (Fst i)®,¬z'®,¬y®]));
(* *** Goal "3.2.1.1.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a(´_T (strip_asm_tac o rewrite_rule[cleanDirectory_def,get_spec¬MkDirectory®,dir_components]));
a(¶_tac¬MkDirectory
                         (Dir_tables y
                             « {(Last (Fst i),
                                 replaceRows
                                     y'
                                     (TS_rows y'
                                         ë Map
                                           (MkRow c‰2 o colDefaults c‰2 y')
                                           (Snd i)))})
                         (Dir_exist y)
                         (Dir_class y)®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
a(lemma_tac¬c‰1 dominates Dir_exist y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(rewrite_tac[cleanDirectory_def]);
a(lemma_tac¬c‰1 dominates Dir_class y''® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(asm_rewrite_tac[get_spec¬MkDirectory®,dir_components]);
a(lemma_tac¬c‰1 dominates Dir_class y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[rel_ext_clauses]THEN ´_tac);
a(rewrite_tac[«_single]);
a(REPEAT µ_tac THEN ¤_T asm_tac);
(* *** Goal "3.2.1.1.1.2.2.1" *** *)
a(cases_tac¬x' = Last (Fst i)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.1.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y' (TS_rows y' ë Map (MkRow c‰2 o colDefaults c‰2 y') (Snd i))®
	THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_insertRows_lemma]THEN asm_fc_tac[]); 
a(spec_nth_asm_tac 7 ¬Snd i®);
(* *** Goal "3.2.1.1.1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(DROP_NTH_ASM_T 4 (asm_tac o list_µ_elim[¬x'®,¬cleanTable c‰1 z''®]));
a(LEMMA_T¬¶ z · (x', z)  Dir_tables y''
                 ± cleanTable c‰1 z'' = cleanTable c‰1 z®asm_tac);
(* *** Goal "3.2.1.1.1.2.2.1.2.1" *** *)
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.1.2.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.1.2.2.2" *** *)
a(cases_tac¬x' = Last (Fst i)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.1.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y''' (TS_rows y''' ë Map (MkRow c‰2 o colDefaults c‰2 y''') (Snd i))®
	THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_insertRows_lemma]THEN asm_fc_tac[]); 
a(spec_nth_asm_tac 7 ¬Snd i®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.1.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.2" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 5(asm_tac o list_µ_elim[¬x®,¬cleanDirectory c‰1 z®]));
a(LEMMA_T¬¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰1)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z'®asm_tac);
(* *** Goal "3.2.1.1.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front (Fst i)®asm_tac);
(* *** Goal "3.2.1.2.1" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬Front(Fst i)®,¬cleanDirectory c‰1 y''®]));
a(LEMMA_T¬(¶ z
             · (c‰1 dominates Dir_exist z ± (Front (Fst i), z)  repState s‰1)
                 ± cleanDirectory c‰1 y'' = cleanDirectory c‰1 z)®asm_tac);
(* *** Goal "3.2.1.2.1.1" *** *)
a(¶_tac¬y''®THEN asm_rewrite_tac[]);
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "3.2.1.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z' = y®);
(* *** Goal "3.2.1.2.1.2.1" *** *)
a(DROP_NTH_ASM_T 25(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Front (Fst i)®,¬z'®,¬y®]));
(* *** Goal "3.2.1.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a(´_T (strip_asm_tac o rewrite_rule[cleanDirectory_def,get_spec¬MkDirectory®,dir_components]));
a(¶_tac¬MkDirectory
                         (Dir_tables y''
                             « {(Last (Fst i),
                                 replaceRows
                                     y'''
                                     (TS_rows y'''
                                         ë Map
                                           (MkRow c‰2 o colDefaults c‰2 y''')
                                           (Snd i)))})
                         (Dir_exist y'')
                         (Dir_class y'')®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
a(lemma_tac¬c‰1 dominates Dir_exist y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(rewrite_tac[cleanDirectory_def]);
a(lemma_tac¬c‰1 dominates Dir_class y''® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(asm_rewrite_tac[get_spec¬MkDirectory®,dir_components]);
a(lemma_tac¬c‰1 dominates Dir_class y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[rel_ext_clauses]THEN ´_tac);
a(rewrite_tac[«_single]);
a(REPEAT µ_tac THEN ¤_T asm_tac);
(* *** Goal "3.2.1.2.1.2.2.1" *** *)
a(cases_tac¬x' = Last (Fst i)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.1.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y''' (TS_rows y''' ë Map (MkRow c‰2 o colDefaults c‰2 y''') (Snd i))®
	THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_insertRows_lemma]THEN asm_fc_tac[]); 
a(spec_nth_asm_tac 7 ¬Snd i® THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.1.2.2.2" *** *)
a(cases_tac¬x' = Last (Fst i)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.1.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y' (TS_rows y' ë Map (MkRow c‰2 o colDefaults c‰2 y') (Snd i))®
	THEN asm_rewrite_tac[]);
a(fc_tac[cleanTable_insertRows_lemma]THEN asm_fc_tac[]); 
a(spec_nth_asm_tac 7 ¬Snd i®);
(* *** Goal "3.2.1.2.1.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(DROP_NTH_ASM_T 4 (asm_tac o list_µ_elim[¬x'®,¬cleanTable c‰1 z''®]));
a(LEMMA_T¬¶ z · (x', z)  Dir_tables y''
                 ± cleanTable c‰1 z'' = cleanTable c‰1 z®asm_tac);
(* *** Goal "3.2.1.2.1.2.2.2.2.1" *** *)
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.1.2.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 5(asm_tac o list_µ_elim[¬x®,¬cleanDirectory c‰1 z®]));
a(LEMMA_T¬¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰2)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z'®asm_tac);
(* *** Goal "3.2.1.2.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.1.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2" *** *)
(* *** Delete *** *)
a(LIST_DROP_NTH_ASM_T[1,2,3,4,7](MAP_EVERY (fn _ => id_tac))); 
a(POP_ASM_T (strip_asm_tac o rewrite_rule[isDelete_def]));
a(LIST_DROP_NTH_ASM_T[2,3,4,5,6,7](MAP_EVERY ante_tac) THEN POP_ASM_T rewrite_thm_tac);
a(rewrite_tac[destInsert_def,tabFromEffect_def,
	getTable_def,rewrite_rule[dom_def]tabExists_def]);
a(REPEAT strip_tac);
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰1®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰1®,¬Front (Fst d)®,¬y''®]at_thm));
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰2®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰2®,¬Front (Fst d)®,¬y®]at_thm));
a(LIST_DROP_NTH_ASM_T[7,8,9,10,11,12,13,15,16,17](MAP_EVERY ante_tac) 
	THEN GET_NTH_ASM_T 4 rewrite_thm_tac THEN TOP_ASM_T rewrite_thm_tac);
a(REPEAT ´_tac);
a(DROP_NTH_ASM_T 16  ante_tac  THEN DROP_NTH_ASM_T 13  ante_tac  THEN
	rewrite_tac[ª_def,get_spec¬IdeL®,get_spec¬DirectoryS®,¡_def,¸_def,
	get_spec¬Universe®,dom_thm,rel_ext_clauses,get_spec¬$ð®]THEN REPEAT ´_tac);
a(asm_fc_tac[]);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac[ß_def,¡_def]
	THEN REPEAT ´_tac);
a(strip_asm_tac(list_µ_elim[¬Dir_tables y®,¬Last (Fst d)®,¬y'®]at_thm));
a(strip_asm_tac(list_µ_elim[¬Dir_tables y''®,¬Last (Fst d)®,¬y'''®]at_thm));
a(LIST_DROP_NTH_ASM_T[9,10,11,12](MAP_EVERY ante_tac)THEN asm_rewrite_tac[]);
a(LIST_DROP_NTH_ASM_T[4,6,7,8](MAP_EVERY (fn _ => id_tac))THEN REPEAT ´_tac); 
a(LEMMA_T¬d = (Fst d,Snd d)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],asm_rewrite_tac[hideR_def,deleteQuery_def,changeSpec_def]]);
a(DROP_NTH_ASM_T 23(strip_asm_tac o rewrite_rule[hideR_def,rel_ext_clauses]));
a(REPEAT strip_tac);
(* *** Goal "3.2.2.1" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front (Fst d)®asm_tac);
(* *** Goal "3.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬Front(Fst d)®,¬cleanDirectory c‰1 y''®]));
a(LEMMA_T¬(¶ z
             · (c‰1 dominates Dir_exist z ± (Front (Fst d), z)  repState s‰1)
                 ± cleanDirectory c‰1 y'' = cleanDirectory c‰1 z)®asm_tac);
(* *** Goal "3.2.2.1.1.1" *** *)
a(¶_tac¬y''®THEN asm_rewrite_tac[]);
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "3.2.2.1.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z' = y®);
(* *** Goal "3.2.2.1.1.2.1" *** *)
a(DROP_NTH_ASM_T 25(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Front (Fst d)®,¬z'®,¬y®]));
(* *** Goal "3.2.2.1.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a(´_T (strip_asm_tac o rewrite_rule[cleanDirectory_def,get_spec¬MkDirectory®,dir_components]));
a(¶_tac¬MkDirectory(Dir_tables y
                             « {(Last (Fst d),
                                 replaceRows
                                     y'
                                     (Extract
                                         (1 .. Length (TS_rows y')
                                             \ revealRow c‰2 y' Image Snd d
                                               ¡ {i
                                               |R_exist (Nth (TS_rows y') i)
                                                   = c‰2})
                                         (TS_rows y')))})
                         (Dir_exist y)
                         (Dir_class y)®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
a(lemma_tac¬c‰1 dominates Dir_exist y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(rewrite_tac[cleanDirectory_def]);
a(lemma_tac¬c‰1 dominates Dir_class y''® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(asm_rewrite_tac[get_spec¬MkDirectory®,dir_components]);
a(lemma_tac¬c‰1 dominates Dir_class y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[rel_ext_clauses]THEN ´_tac);
a(rewrite_tac[«_single]);
a(REPEAT µ_tac THEN ¤_T asm_tac);
(* *** Goal "3.2.2.1.1.2.2.1" *** *)
a(cases_tac¬x' = Last (Fst d)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.1.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y'
                       (Extract
                           (1 .. Length (TS_rows y')
                               \ revealRow c‰2 y' Image Snd d
                                 ¡ {i|R_exist (Nth (TS_rows y') i) = c‰2})
                           (TS_rows y'))® THEN asm_rewrite_tac[]);
a(fc_tac[delete_ax]THEN asm_fc_tac[]); (****SHOULD BE THEOREM****)
a(spec_nth_asm_tac 7 ¬Snd d®);
(* *** Goal "3.2.2.1.1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(DROP_NTH_ASM_T 4 (asm_tac o list_µ_elim[¬x'®,¬cleanTable c‰1 z''®]));
a(LEMMA_T¬¶ z · (x', z)  Dir_tables y''
                 ± cleanTable c‰1 z'' = cleanTable c‰1 z®asm_tac);
(* *** Goal "3.2.2.1.1.2.2.1.2.1" *** *)
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.1.2.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.1.2.2.2" *** *)
a(cases_tac¬x' = Last (Fst d)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.1.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y'''
                   (Extract
                       (1 .. Length (TS_rows y''')
                           \ revealRow c‰2 y''' Image Snd d
                             ¡ {i|R_exist (Nth (TS_rows y''') i) = c‰2})
                       (TS_rows y'''))® THEN asm_rewrite_tac[]);
a(fc_tac[delete_ax]THEN asm_fc_tac[]); (****SHOULD BE THEOREM****)
a(spec_nth_asm_tac 7 ¬Snd d®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.1.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 5(asm_tac o list_µ_elim[¬x®,¬cleanDirectory c‰1 z®]));
a(LEMMA_T¬¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰1)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z'®asm_tac);
(* *** Goal "3.2.2.1.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2" *** *)
a(rewrite_tac[«_single]);
a(CASES_T¬x = Front (Fst d)®asm_tac);
(* *** Goal "3.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 7(asm_tac o list_µ_elim[¬Front(Fst d)®,¬cleanDirectory c‰1 y''®]));
a(LEMMA_T¬(¶ z
             · (c‰1 dominates Dir_exist z ± (Front (Fst d), z)  repState s‰1)
                 ± cleanDirectory c‰1 y'' = cleanDirectory c‰1 z)®asm_tac);
(* *** Goal "3.2.2.2.1.1" *** *)
a(¶_tac¬y''®THEN asm_rewrite_tac[]);
a(fc_tac[dominates_trans] THEN asm_fc_tac[]);
(* *** Goal "3.2.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(lemma_tac¬z' = y®);
(* *** Goal "3.2.2.2.1.2.1" *** *)
a(DROP_NTH_ASM_T 25(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬Front (Fst d)®,¬z'®,¬y®]));
(* *** Goal "3.2.2.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a(´_T (strip_asm_tac o rewrite_rule[cleanDirectory_def,get_spec¬MkDirectory®,dir_components]));
a(¶_tac¬MkDirectory (Dir_tables y''
                             « {(Last (Fst d),
                                 replaceRows
                                     y'''
                                     (Extract
                                         (1 .. Length (TS_rows y''')
                                             \ revealRow c‰2 y''' Image Snd d
                                               ¡ {i
                                               |R_exist (Nth (TS_rows y''') i)
                                                   = c‰2})
                                         (TS_rows y''')))})
                         (Dir_exist y'')
                         (Dir_class y'')®THEN asm_rewrite_tac[get_spec¬MkDirectory®]);
a(lemma_tac¬c‰1 dominates Dir_exist y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(rewrite_tac[cleanDirectory_def]);
a(lemma_tac¬c‰1 dominates Dir_class y''® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(asm_rewrite_tac[get_spec¬MkDirectory®,dir_components]);
a(lemma_tac¬c‰1 dominates Dir_class y® THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[rel_ext_clauses]THEN ´_tac);
a(rewrite_tac[«_single]);
a(REPEAT µ_tac THEN ¤_T asm_tac);
(* *** Goal "3.2.2.2.1.2.2.1" *** *)
a(cases_tac¬x' = Last (Fst d)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.1.2.2.1.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y'''
                   (Extract
                       (1 .. Length (TS_rows y''')
                           \ revealRow c‰2 y''' Image Snd d
                             ¡ {i|R_exist (Nth (TS_rows y''') i) = c‰2})
                       (TS_rows y'''))® THEN asm_rewrite_tac[]);
a(fc_tac[delete_ax]THEN asm_fc_tac[]); (****SHOULD BE THEOREM****)
a(spec_nth_asm_tac 7 ¬Snd d® THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.1.2.2.1.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.1.2.2.2" *** *)
a(cases_tac¬x' = Last (Fst d)®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.1.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(¶_tac¬replaceRows y'
                       (Extract
                           (1 .. Length (TS_rows y')
                               \ revealRow c‰2 y' Image Snd d
                                 ¡ {i|R_exist (Nth (TS_rows y') i) = c‰2})
                           (TS_rows y'))® THEN asm_rewrite_tac[]);
a(fc_tac[delete_ax]THEN asm_fc_tac[]); (****SHOULD BE THEOREM****)
a(spec_nth_asm_tac 7 ¬Snd d®);
(* *** Goal "3.2.2.2.1.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 strip_asm_tac);
a(DROP_NTH_ASM_T 4 (asm_tac o list_µ_elim[¬x'®,¬cleanTable c‰1 z''®]));
a(LEMMA_T¬¶ z · (x', z)  Dir_tables y''
                 ± cleanTable c‰1 z'' = cleanTable c‰1 z®asm_tac);
(* *** Goal "3.2.2.2.1.2.2.2.2.1" *** *)
a(¶_tac¬z''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.1.2.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'''®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 3(strip_asm_tac o rewrite_rule[«_single,get_spec¬MkDirectory®,dir_components]));
a(DROP_NTH_ASM_T 5(asm_tac o list_µ_elim[¬x®,¬cleanDirectory c‰1 z®]));
a(LEMMA_T¬¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰2)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z'®asm_tac);
(* *** Goal "3.2.2.2.2.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac THEN ´_tac);
a(¶_tac¬z'®THEN asm_rewrite_tac[]);
(* *** Goal "3.2.3" *** *)
(* *** Update *** *)
a(LIST_DROP_NTH_ASM_T[1,2,3,4,7](MAP_EVERY (fn _ => id_tac))); 
a(POP_ASM_T (strip_asm_tac o rewrite_rule[isUpdate_def]));
a(LIST_DROP_NTH_ASM_T[2,3,4,5,6,7](MAP_EVERY ante_tac) THEN POP_ASM_T rewrite_thm_tac);
a(rewrite_tac[destInsert_def,tabFromEffect_def,
	getTable_def,rewrite_rule[dom_def]tabExists_def]);
a(REPEAT strip_tac);
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰1®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰1®,¬Front (Fst u)®,¬y''®]at_thm));
a(strip_asm_tac (pure_rewrite_rule[get_spec¬isState®,get_spec¬StateS®,ß_def,¡_def]
	(µ_elim¬s‰2®isState_lemma)));
a(strip_asm_tac(list_µ_elim[¬repState s‰2®,¬Front (Fst u)®,¬y®]at_thm));
a(LIST_DROP_NTH_ASM_T[7,8,9,10,11,12,13,15,16,17](MAP_EVERY ante_tac) 
	THEN GET_NTH_ASM_T 4 rewrite_thm_tac THEN TOP_ASM_T rewrite_thm_tac);
a(REPEAT ´_tac);
a(DROP_NTH_ASM_T 16  ante_tac  THEN DROP_NTH_ASM_T 13  ante_tac  THEN
	rewrite_tac[ª_def,get_spec¬IdeL®,get_spec¬DirectoryS®,¡_def,¸_def,
	get_spec¬Universe®,dom_thm,rel_ext_clauses,get_spec¬$ð®]THEN REPEAT ´_tac);
a(asm_fc_tac[]);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN rewrite_tac[ß_def,¡_def]
	THEN REPEAT ´_tac);
a(strip_asm_tac(list_µ_elim[¬Dir_tables y®,¬Last (Fst u)®,¬y'®]at_thm));
a(strip_asm_tac(list_µ_elim[¬Dir_tables y''®,¬Last (Fst u)®,¬y'''®]at_thm));
a(LIST_DROP_NTH_ASM_T[9,10,11,12](MAP_EVERY ante_tac)THEN asm_rewrite_tac[]);
a(LIST_DROP_NTH_ASM_T[4,6,7,8](MAP_EVERY (fn _ => id_tac))THEN REPEAT ´_tac); 



=TEX
=SML
push_goal([],¬µ c‰1 c‰2 t‰1 t‰2 ns · 
	cleanTable c‰1 t‰1 = cleanTable c‰1 t‰2 
	± c‰1 dominates c‰2 ± c‰2 dominates TS_class t‰1 
	´
	cleanTable c‰1 (replaceRows t‰1 
		(Extract (1 .. Length(TS_rows t‰1) \ 
	((revealRow c‰2 t‰1) Image ns ¡ {i|R_exist(Nth(TS_rows t‰1)i) = c‰2}))
	(TS_rows t‰1)))
	=
	cleanTable c‰1 (replaceRows t‰2 
		(Extract (1 .. Length(TS_rows t‰2) \ 
	((revealRow c‰2 t‰2) Image ns ¡ {i|R_exist(Nth(TS_rows t‰2)i) = c‰2}))
	(TS_rows t‰2)))®);
a(REPEAT strip_tac);
a(lemma_tac¬cleanTable c‰2 t‰1 = cleanTable c‰2 t‰2®
	THEN_LIST[fc_tac[cleanTable_lemma]
	THEN asm_fc_tac[],id_tac]);
a(DROP_NTH_ASM_T 4 ante_tac THEN  
	rewrite_tac[cleanTable_def,replaceRows_def,get_spec¬MkTableSpec®]);
a(lemma_tac¬c‰1 dominates TS_class t‰1®THEN_LIST
	[fc_tac[dominates_trans] THEN asm_fc_tac[],asm_rewrite_tac[]]);
a(cases_tac¬c‰1 dominates TS_class t‰2®THEN asm_rewrite_tac[]);
set_labelled_goal"2";
(* *** Goal "2" *** *)
a(rewrite_tac[get_spec¬MkTableSpec®,tab_components,cleanColCons_def]THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN DROP_NTH_ASM_T 5 rewrite_thm_tac);
a(asm_rewrite_tac[]);
(* *** Goal "1" *** *)
a(´_T(strip_asm_tac o rewrite_rule[get_spec¬MkTableSpec®,tab_components]));
a(DROP_NTH_ASM_T 8 ante_tac THEN asm_rewrite_tac[cleanTable_def]);
a(GET_NTH_ASM_T 8 ante_tac THEN GET_NTH_ASM_T 5 rewrite_thm_tac THEN ´_tac
	THEN asm_rewrite_tac[get_spec¬MkTableSpec®,tab_components] THEN strip_tac);
a(POP_ASM_T ante_tac THEN lemma_tac¬cleanColCons c‰2 t‰1 = cleanColCons c‰2 t‰2® 
	THEN_LIST[pure_once_asm_rewrite_tac[prove_rule[pair_clauses]
	¬µ p  · p = (Fst p, Snd p)®]THEN asm_rewrite_tac[],
	DROP_NTH_ASM_T 3(fn _ => id_tac) 
	THEN  DROP_NTH_ASM_T 2(fn _ => id_tac)]);
a(asm_rewrite_tac[] THEN ´_tac);
a(fc_tac[cleanRows_size_lemma]);
a(lemma_tac¬cleanColCons c‰1 t‰1 = cleanColCons c‰1 t‰2® 
	THEN_LIST[pure_once_asm_rewrite_tac[prove_rule[pair_clauses]
	¬µ p  · p = (Fst p, Snd p)®]THEN asm_rewrite_tac[],
	DROP_NTH_ASM_T 8(fn _ => id_tac) 
	THEN  DROP_NTH_ASM_T 7(fn _ => id_tac)]);
a(POP_ASM_T ante_tac THEN rewrite_tac[cleanColCons_def,revealRow_def,get_spec¬MkTableSpec®]);
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 5 (fn _ => id_tac) THEN DROP_NTH_ASM_T 4 (fn _ => id_tac));
a(DROP_NTH_ASM_T 5 ante_tac THEN DROP_NTH_ASM_T 3 ante_tac);
a(rewrite_tac[cleanRows_def]);
a(lemma_tac¬¶ l‰1 · TS_rows t‰1 = l‰1®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(lemma_tac¬¶ l‰2 · TS_rows t‰2 = l‰2®THEN_LIST
	[prove_¶_tac,POP_ASM_T rewrite_thm_tac]);
a(intro_µ_tac(¬l‰2®,¬l‰2®));
a(REV_LIST_INDUCTION_T¬l‰1®asm_tac);
(* *** Goal "1.1" *** *)
a(rewrite_tac[map_def]THEN REPEAT strip_tac);
a(fc_tac[ù_extract_null_thm]);
a(spec_nth_asm_tac 1¬(1 .. Length l‰2
                         \ Squash
                               (Id
                                   (Dom
                                       (ListRel l‰2
                                           ’ {r|c‰2 dominates R_exist r})))
                             Image ns
                           ¡ {i|R_exist (Nth l‰2 i) = c‰2})®);
a(asm_rewrite_tac[extract_def,rel_list_null_thm]);
(* *** Goal "1.2" *** *)
a(REPEAT µ_tac);
a(intro_µ_tac(¬last®,¬last®)THEN REV_LIST_INDUCTION_T¬l‰2®asm_tac);
(* *** Goal "1.2.1" *** *)
a(µ_tac THEN cases_tac¬c‰1 dominates R_exist last®THEN asm_rewrite_tac[map_def,extract_ë_single_ax]
	THEN REPEAT strip_tac);
a(CASES_T¬Length l‰1 + 1
                          1 .. Length (l‰1 ë [last])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰1 ë [last])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰1 ë [last]) i) = c‰2}®rewrite_thm_tac);
(* *** Goal "1.2.1.1" *** *)
a(fc_tac[ù_extract_null_thm]);
a(spec_nth_asm_tac 1¬(1 .. Length (l‰1 ë [last])
                             \ Squash
                                   (Id
                                       (Dom
                                           (ListRel (l‰1 ë [last])
                                               ’ {r|c‰2 dominates R_exist r})))
                                 Image ns
                               ¡ {i|R_exist (Nth (l‰1 ë [last]) i) = c‰2})®);
a(asm_rewrite_tac[extract_def,rel_list_null_thm]);
(* *** Goal "1.2.1.2" *** *)
a(fc_tac[ù_extract_null_thm]);
a(spec_nth_asm_tac 1¬(1 .. Length (l‰1 ë [last])
                             \ Squash
                                   (Id
                                       (Dom
                                           (ListRel (l‰1 ë [last])
                                               ’ {r|c‰2 dominates R_exist r})))
                                 Image ns
                               ¡ {i|R_exist (Nth (l‰1 ë [last]) i) = c‰2})®);
a(asm_rewrite_tac[extract_def,rel_list_null_thm]);
(* *** Goal "1.2.2" *** *)
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN asm_rewrite_tac[cleanColCons_def]THEN REPEAT ´_tac);
a(REPEAT µ_tac THEN cases_tac¬c‰1 dominates R_exist last®THEN 
	cases_tac¬c‰1 dominates R_exist last'® THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1" *** *)
a(REPEAT ´_tac);
a(rewrite_tac[extract_ë_single_ax]);
a(CASES_T¬Length l‰1 + 1
                          1 .. Length (l‰1 ë [last'])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰1 ë [last'])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}® 
	asm_tac THEN TOP_ASM_T rewrite_thm_tac THEN CASES_T¬Length l‰2 + 1
                          1 .. Length (l‰2 ë [last])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰2 ë [last])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰2 ë [last]) i) = c‰2}®
	 asm_tac THEN TOP_ASM_T rewrite_thm_tac);
die;




a(DROP_NTH_ASM_T 3 ante_tac THEN cases_tac¬c‰2 dominates R_exist last®
	THEN cases_tac¬c‰2 dominates R_exist last'® 
	THEN asm_rewrite_tac[size_list_rel_ë_’_ax]);
(* *** Goal "1.2.2.1.1" *** *)
a(´_tac THEN DROP_NTH_ASM_T 9(ante_tac o µ_elim¬l‰2®) THEN DROP_NTH_ASM_T 8(fn _ => id_tac) 
	THEN asm_rewrite_tac[extract_ë_single_ax] THEN ´_tac);


(* *** Goal "1.2.2.1.1.1" *** *)
a(asm_rewrite_tac[]);

(* *** Goal "1.2.2.1.1.1" *** *)
a(POP_ASM_T (fn _ => id_tac));
a(asm_rewrite_tac[squash_ë_ax,length_ë_one_thm,dot_dot_def,image_À_thm,À_¡_thm,image_single_thm]);
a(fc_tac[size_squash_id_dom_thm]);
a(POP_ASM_T rewrite_thm_tac);
a(cases_tac¬Size(Squash (Id (Dom(ListRel l‰2 ’ {r|c‰2 dominates R_exist r}))))
                             + 1  ns® THEN asm_rewrite_tac[]);
a(rewrite_tac[image_def]THEN REPEAT strip_tac);
(* *** Goal "1.2.2.1.1.1.1.1" *** *)
a(spec_nth_asm_tac 4 ¬x®);



,extract_ë_single_ax,
	squash_ë_ax,length_ë_one_thm,dot_dot_def,image_À_thm,À_¡_thm



a(LEMMA_T¬Length l‰1 + 1
                          {i|1 ¼ i ± i ¼ Length l‰1 + 1}
                           \ Squash
                                   (Id
                                       (Dom
                                           (ListRel l‰1
                                               ’ {r|c‰2 dominates R_exist r})))
                                 Image ns
                               ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}
                             À {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l‰1
                                                           ’ {r
                                                           |c‰2
           dominates R_exist r}))))
                                         + 1, Length l‰1 + 1)}
                                 Image ns
                               ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}
	¤
	Length l‰2 + 1
                          {i|1 ¼ i ± i ¼ Length l‰2 + 1}
                           \ Squash
                                   (Id
                                       (Dom
                                           (ListRel l‰2
                                               ’ {r|c‰2 dominates R_exist r})))
                                 Image ns
                               ¡ {i|R_exist (Nth (l‰2 ë [last]) i) = c‰2}
                             À {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l‰2
                                                           ’ {r
                                                           |c‰2
           dominates R_exist r}))))
                                         + 1, Length l‰2 + 1)}
                                 Image ns
                               ¡ {i|R_exist (Nth (l‰2 ë [last]) i) = c‰2}®asm_tac);
set_labelled_goal"1.2.2.1.1.2";
a(CASES_T¬Length l‰1 + 1
                {i|1 ¼ i ± i ¼ Length l‰1 + 1}
                 \ Squash
                         (Id (Dom (ListRel l‰1 ’ {r|c‰2 dominates R_exist r})))
                       Image ns
                     ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}
                   À {(Size
                                 (Squash
                                     (Id
                                         (Dom
                                             (ListRel l‰1
                                                 ’ {r
                                                 |c‰2 dominates R_exist r}))))
                               + 1, Length l‰1 + 1)}
                       Image ns
                     ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}®asm_tac);
(* *** Goal "1.2.2.1.1.2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[] THEN ´_T rewrite_thm_tac);
a(POP_ASM_T rewrite_thm_tac THEN POP_ASM_T rewrite_thm_tac);
a(asm_rewrite_tac[extract_def]);
a(LEMMA_T¬({i|1 ¼ i ± i ¼ Length l‰1 + 1}
                               \ Squash
                                       (Id
                                           (Dom
                                               (ListRel l‰1
                                                   ’ {r
                                                   |c‰2 dominates R_exist r})))
                                     Image ns
                                   ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}
                                 À {(Size
                                               (Squash
                                                   (Id
                                                       (Dom
                                                           (ListRel l‰1
           ’ {r|c‰2 dominates R_exist r}))))
                                             + 1, Length l‰1 + 1)}
                                     Image ns
                                   ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}
                             ò ListRel l‰1)=({i|1 ¼ i ± i ¼ Length l‰2 + 1}
                               \ Squash
                                       (Id
                                           (Dom
                                               (ListRel l‰2
                                                   ’ {r
                                                   |c‰2 dominates R_exist r})))
                                     Image ns
                                   ¡ {i|R_exist (Nth (l‰2 ë [last]) i) = c‰2}
                                 À {(Size
                                               (Squash
                                                   (Id
                                                       (Dom
                                                           (ListRel l‰2
           ’ {r|c‰2 dominates R_exist r}))))
                                             + 1, Length l‰2 + 1)}
                                     Image ns
                                   ¡ {i|R_exist (Nth (l‰2 ë [last]) i) = c‰2}
                             ò ListRel l‰2)®rewrite_thm_tac);



(* *** Goal "1.2.2.1.1.1" *** *)
a(POP_ASM_T (fn _ => id_tac));
a(fc_tac[size_squash_id_dom_thm]);
a(POP_ASM_T rewrite_thm_tac);
a(REPEAT strip_tac);



a(cases_tac¬Size(Squash (Id(Dom(ListRel l‰1 ’ {r|c‰2 dominates R_exist r}))))
                                       + 1  ns®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.1.1" *** *)
a(TOP_ASM_T


,image_single_thm


a(REPEAT µ_tac THEN cases_tac¬c‰2 dominates R_exist last®THEN 
	cases_tac¬c‰2 dominates R_exist last'® THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1" *** *)
a(lemma_tac¬c‰1 dominates R_exist last ± c‰1 dominates R_exist last'®);
(* *** Goal "1.2.2.1.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.2" *** *)
a(asm_rewrite_tac[]THEN strip_tac);
a(DROP_NTH_ASM_T 8(ante_tac o µ_elim¬l‰2®) THEN DROP_NTH_ASM_T 7(fn _ => id_tac) 
	THEN strip_tac);

(* *** Goal "1.2.2.1" *** *)
a(cases_tac¬c‰1 dominates R_exist last'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.2.1.1" *** *)
a strip_tac;
a(DROP_NTH_ASM_T 7 (ante_tac o µ_elim¬l‰2®)THEN asm_rewrite_tac[]);
a strip_tac;
a(asm_rewrite_tac[extract_ë_single_ax,squash_ë_ax,length_ë_one_thm,
	dot_dot_def,image_À_thm,À_¡_thm,image_single_thm]);






a(LEMMA_T¬µ l (last:Row)·Length l + 1
                          {i|1 ¼ i ± i ¼ Length l + 1}
                           \ Squash
                                   (Id
                                       (Dom
                                           (ListRel l
                                               ’ {r|c‰2 dominates R_exist r})))
                                 Image ns
                               ¡ {i|R_exist (Nth (l ë [last]) i) = c‰2}
                             À {(Size
                                           (Squash
                                               (Id
                                                   (Dom
                                                       (ListRel l
                                                           ’ {r
                                                           |c‰2
           dominates R_exist r}))))
                                         + 1, Length l + 1)}
                                 Image ns
                               ¡ {i|R_exist (Nth (l ë [last]) i) = c‰2}®rewrite_thm_tac);
(* *** Goal "1.2.2.1.1.1" *** *)
a(REPEAT strip_tac);
a(POP_ASM_T(asm_tac o rewrite_rule[nth_length_one_thm]));
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);

a(REPEAT strip_tac THEN POP_ASM_T(asm_tac o rewrite_rule[nth_length_one_thm])
	THEN DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[]);



a(CASES_T¬Length l‰1 + 1
                          1 .. Length (l‰1 ë [last'])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰1 ë [last'])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰1 ë [last']) i) = c‰2}®rewrite_thm_tac
	THEN CASES_T¬Length l‰2 + 1
                          1 .. Length (l‰2 ë [last])
                           \ Squash
                                 (Id
                                     (Dom
                                         (ListRel (l‰2 ë [last])
                                             ’ {r|c‰2 dominates R_exist r})))
                               Image ns
                             ¡ {i|R_exist (Nth (l‰2 ë [last]) i) = c‰2}®rewrite_thm_tac
	THEN_TRY asm_rewrite_tac[]);


a(REV_LIST_INDUCTION_T¬ds®asm_tac);
(* *** Goal "1.1" *** *)
a(rewrite_tac[map_def,ù_def]);
(* *** Goal "1.2" *** *)
a(rewrite_tac[map_ë_thm,ù_thm,get_spec¬MkRow®]);
a(µ_tac THEN GET_NTH_ASM_T 8 rewrite_thm_tac);
(****Need to change definition of colDefaults :

¹HOLCONST
Ü	ÛcolDefaultsÝ :  Class ­ TableSpec ­ (Num ª Data) ­  (Numª Data)
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	µ  clear : Class; ts : TableSpec; ds : Num ª Data
Ü	·	colDefaults clear ts ds
Ü		=
Ü		ds « {(n,d)|¶c · ³ c  visibleCols clear ts ± n = CS_posn c ± d = CS_default c}
°
****)
a(LEMMA_T¬cleanRow
                 c‰1
                 {col
                   |¶ y
                     · c‰1 dominates CC_exist y
                         ± (CS_consGroup col, y)  TS_cons t‰1}
                 (MkRow c‰2 (last
        « {(n, d)|¶ c· (³ c   visibleCols c‰2 t‰1) ± n = CS_posn c ± d = CS_default c}))
               = cleanRow
                 c‰1
                 {col
                   |¶ y
                     · c‰1 dominates CC_exist y
                         ± (CS_consGroup col, y)  TS_cons t‰2}
                 (MkRow c‰2 (last
        « {(n, d)|¶ c· (³ c  visibleCols c‰2 t‰2) ± n = CS_posn c ± d = CS_default c}))®asm_rewrite_thm_tac);
(* *** Goal "1.2.1" *** *)
a(POP_ASM_T (fn _ => id_tac));
a(POP_ASM_T(strip_asm_tac o rewrite_rule[rel_ext_clauses,’_thm]));
a(asm_rewrite_tac[colDefaults_def,cleanColCons_def,visibleCols_def,cleanRow_def,
	get_spec¬MkRow®,row_components,rel_ext_clauses,filterRow_def]);
a(REPEAT strip_tac);
(* *** Goal "1.2.1.1" *** *)
a(cases_tac¬³ x  Dom{(n, d)
               |¶ c
                 · ³ (¶ y
                       · c‰2 dominates CC_exist y
                           ± (CS_consGroup c, y)  TS_cons t‰1)
                     ± n = CS_posn c
                     ± d = CS_default c}®);
(* *** Goal "1.2.1.1.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
(* *** Goal "1.2.1.1.1.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
(* *** Goal "1.2.1.1.1.1.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.1.1.1.1.2" *** *)
a ²_left_tac;
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬y''®);
a(spec_nth_asm_tac 1 ¬c'®);
a(¶_tac¬y'''®THEN asm_rewrite_tac[]);
a(lemma_tac¬c‰1 dominates CC_exist y'''®);
(* *** Goal "1.2.1.1.1.1.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.1.1.1.1.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y'''®]);
(* *** Goal "1.2.1.1.1.2" *** *)
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬z®);
a(spec_nth_asm_tac 1 ¬c'®);
a(spec_nth_asm_tac 7 ¬y''®);
(* *** Goal "1.2.1.1.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
(* *** Goal "1.2.1.1.2.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.1.1.2.2" *** *)
a ²_right_tac;
a(¶_tac¬c'®THEN asm_rewrite_tac[]);
a(REPEAT strip_tac);
a(spec_nth_asm_tac 4 ¬y''®);
a contr_tac;
a(lemma_tac¬c‰1 dominates CC_exist y''®);
(* *** Goal "1.2.1.1.2.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.1.1.2.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y''®]);
(* *** Goal "1.2.1.2" *** *)
a(cases_tac¬³ x  Dom{(n, d)
               |¶ c
                 · ³ (¶ y
                       · c‰2 dominates CC_exist y
                           ± (CS_consGroup c, y)  TS_cons t‰2)
                     ± n = CS_posn c
                     ± d = CS_default c}®);
(* *** Goal "1.2.1.2.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
(* *** Goal "1.2.1.2.1.1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
(* *** Goal "1.2.1.2.1.1.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.1.2.1.1.2" *** *)
a ²_left_tac;
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬y''®);
a(spec_nth_asm_tac 1 ¬c'®);
a(¶_tac¬y'''®THEN asm_rewrite_tac[]);
a(lemma_tac¬c‰1 dominates CC_exist y'''®);
(* *** Goal "1.2.1.2.1.1.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.1.2.1.1.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y'''®]);
(* *** Goal "1.2.1.2.1.2" *** *)
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[dom_def]));
a(spec_nth_asm_tac 1 ¬z®);
a(spec_nth_asm_tac 1 ¬c'®);
a(spec_nth_asm_tac 7 ¬y''®);
(* *** Goal "1.2.1.2.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[«_thm]);
a(rewrite_tac[«_thm] THEN strip_tac);
a(¶_tac¬z®THEN asm_rewrite_tac[] THEN strip_tac);
(* *** Goal "1.2.1.2.2.1" *** *)
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(¶_tac¬y'®THEN asm_rewrite_tac[]);
(* *** Goal "1.2.1.2.2.2" *** *)
a ²_right_tac;
a(¶_tac¬c'®THEN asm_rewrite_tac[]);
a(REPEAT strip_tac);
a(spec_nth_asm_tac 4 ¬y''®);
a contr_tac;
a(lemma_tac¬c‰1 dominates CC_exist y''®);
(* *** Goal "1.2.1.2.2.2.1" *** *)
a(fc_tac[dominates_trans]THEN asm_fc_tac[]);
(* *** Goal "1.2.1.2.2.2.2" *** *)
a(list_spec_nth_asm_tac 13 [¬CS_consGroup c'®,¬y''®]);




val ÛinsertRows_lemmaÝ = save_pop_thm"insertRows_lemma";





a(LEMMA_T¬u = (Fst u,Snd u)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],asm_rewrite_tac[hideR_def,updateQuery_def,changeSpec_def]]);
a(DROP_NTH_ASM_T 23(strip_asm_tac o rewrite_rule[hideR_def,rel_ext_clauses]));
a(REPEAT strip_tac);








a(push_goal([],¬µ c i s‰1 s‰2 · tabExists c i s‰1 ± tabExists c i s‰2 
	´ (Dir_exist (s‰1 @ Front i) = Dir_exist (s‰2 @ Front i)
	± Dir_class (s‰1 @ Front i) = Dir_class (s‰2 @ Front i))®);



a(lemma_tac¬y = z®);
(* *** Goal "3.2.1.1.1.1" *** *)
a(DROP_NTH_ASM_T 14 ante_tac THEN TOP_ASM_T (rewrite_thm_tac o eq_sym_rule)
	THEN strip_tac); 
a(DROP_NTH_ASM_T 14(asm_tac o rewrite_rule[functional_def]));
a(POP_ASM_T (strip_asm_tac o list_µ_elim[¬x®,¬y®,¬z®]));





a(LEMMA_T¬u = (Fst u,Snd u)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],rewrite_tac[insertQuery_def]]);

(rewrite_tac[hideR_def,rel_ext_clauses]);
a(REPEAT strip_tac);

=TEX
=SML
push_goal([],¬µ c‰1 c‰2 t‰1 t‰2 s‰1 s‰2 u
	· c‰1 dominates c‰2
	± c‰2 dominates TS_class t‰1
        ± c‰2 dominates TS_class t‰2
        ± cleanTable c‰1 t‰1 = cleanTable c‰1 t‰2
		´ hideR (c‰1,insertQuery (c‰2, u, repState s‰1, t‰1))
		 = hideR (c‰1,insertQuery (c‰2, u, repState s‰2, t‰2))®);
a(REPEAT strip_tac);
a(LEMMA_T¬u = (Fst u,Snd u)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],rewrite_tac[insertQuery_def]]);
a(rewrite_tac[changeSpec_def,hideR_def,rel_ext_clauses]);




(* *** Goal "1" *** *)
a(¶_tac¬z®THEN asm_rewrite_tac[]);

a(rewrite_tac[hideR_def,rel_ext_clauses]THEN REPEAT strip_tac);



a(POP_ASM_T ante_tac);
a(lemma_tac¬cleanColCons c‰2 t‰1 = cleanColCons c‰2 t‰2® 
	THEN_LIST[pure_once_asm_rewrite_tac[prove_rule[pair_clauses]
	¬µ p  · p = (Fst p, Snd p)®]THEN asm_rewrite_tac[],
	DROP_NTH_ASM_T 3(fn _ => id_tac) 
	THEN  DROP_NTH_ASM_T 2(fn _ => id_tac)]);
a(TOP_ASM_T rewrite_thm_tac THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬c‰2®,¬t‰1®,¬t‰2®]cleanRows_size_lemma));
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac);
a(LEMMA_T¬u = (Fst u,Snd u)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],rewrite_tac[insertQuery_def]]);






=SML
push_goal([],¬µ c‰1 c‰2 s‰1 s‰2 e
        · hideR (c‰1, repState s‰1) = hideR (c‰1, repState s‰2) ± c‰1 dominates c‰2
            ´ hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰1)))
              = hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰2)))®);
a(rewrite_tac[hideR_def]);
a(rewrite_tac[rel_ext_clauses]THEN REPEAT strip_tac);
(* *** Goal "1" *** *)
a(DROP_NTH_ASM_T 5 (asm_tac o list_µ_elim[¬x®,¬cleanDirectory c‰1 z®]));
a(LEMMA_T¬¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰1)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z'®asm_tac);
(* *** Goal "1.1" *** *)
a(¶_tac¬z® THEN asm_rewrite_tac[]);
=GFT HOL output
(* *** Goal "1.1" *** *)

(*  5 *)  ¬c‰1 dominates c‰2®
(*  4 *)  ¬c‰1 dominates Dir_exist z®
(*  3 *)  ¬(x, z)  Fst (updateStateR (c‰2, e, repState s‰1))®
(*  2 *)  ¬y = cleanDirectory c‰1 z®
(*  1 *)  ¬(¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰1)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z')
             ¤ (¶ z'
             · (c‰1 dominates Dir_exist z' ± (x, z')  repState s‰2)
                 ± cleanDirectory c‰1 z = cleanDirectory c‰1 z')®

(* ?ô *)  ¬(x, z)  repState s‰1®
=TEX
set_labelled_goal"1.2";
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T rewrite_thm_tac);
a ´_tac;
a(¶_tac¬z'® THEN asm_rewrite_tac[]);
=GFT HOL output
(* *** Goal "1.2" *** *)

(*  7 *)  ¬c‰1 dominates c‰2®
(*  6 *)  ¬c‰1 dominates Dir_exist z®
(*  5 *)  ¬(x, z)  Fst (updateStateR (c‰2, e, repState s‰1))®
(*  4 *)  ¬y = cleanDirectory c‰1 z®
(*  3 *)  ¬c‰1 dominates Dir_exist z'®
(*  2 *)  ¬(x, z')  repState s‰2®
(*  1 *)  ¬cleanDirectory c‰1 z = cleanDirectory c‰1 z'®

(* ?ô *)  ¬(x, z')  Fst (updateStateR (c‰2, e, repState s‰2))®
=TEX

set_labelled_goal"2";


=TEX


\subsection{Proof Strategy}\label{STRATEGY}

We prove that if $updateStateR$ maintains the invariant
on the representation state, then $hide$  and $updateState$ satisfy the relation
$secureUpdate$.
=SML
push_goal([],
	¬((µ c‰1 c‰2 s‰1 s‰2 e
        · hideR (c‰1, repState s‰1) = hideR (c‰1, repState s‰2) ± c‰1 dominates c‰2
            ´ hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰1)))
              = hideR (c‰1, Fst (updateStateR (c‰2, e, repState s‰2)))) 
	± µ clear s u · isState s ´ isState(Fst(updateStateR(clear,u,s)))) 
	´ (hide,updateState)  secureUpdate®);
a(REPEAT strip_tac THEN rewrite_tac[conjunct4,secureUpdate_def,hide_def]);
a(LEMMA_T¬(µ c s‰1 s‰2 e
             · absState (hideR (c, repState s‰1))
                   = absState (hideR (c, repState s‰2))
                 ´ Snd (updateState (c, e, s‰1)) = Snd (updateState (c, e, s‰2)))®
	rewrite_thm_tac);
=TEX
=SML
(* *** Goal "1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬s‰1®isState_lemma));
a(strip_asm_tac(µ_elim¬s‰2®isState_lemma));
a(bc_tac[conjunct3,eq_sym_rule(all_µ_elim hide_eq_lemma)]);
a(fc_tac[hideR_lemma]);
a(spec_nth_asm_tac 2 ¬c®);
a(spec_nth_asm_tac 2 ¬c®);
a(strip_asm_tac(list_µ_elim[¬hideR (c, repState s‰1)®,¬hideR (c, repState s‰2)®]isState_lemma2));
=TEX
=SML
(* *** Goal "2" *** *)
a(LEMMA_T¬µ c‰1 c‰2 s‰1 s‰2 e
             · absState (hideR (c‰1, repState s‰1))
                     = absState (hideR (c‰1, repState s‰2))
                   ± c‰1 dominates c‰2
                 ´ absState
                     (hideR (c‰1, repState (Fst (updateState (c‰2, e, s‰1)))))
                   = absState
                     (hideR (c‰1, repState (Fst (updateState (c‰2, e, s‰2)))))®
	rewrite_thm_tac);
=TEX
=SML
(* *** Goal "2.1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬s‰2®isState_lemma));
a(strip_asm_tac(µ_elim¬s‰1®isState_lemma));
a(fc_tac[hideR_lemma]);
a(spec_nth_asm_tac 2 ¬c‰1®);
a(spec_nth_asm_tac 2 ¬c‰1®);
a(strip_asm_tac(list_µ_elim[¬hideR (c‰1, repState s‰1)®,¬hideR (c‰1, repState s‰2)®]isState_lemma2));
a(LEMMA_T¬e = (Fst e,Snd e)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],rewrite_tac[updateState_def]]);
a(list_spec_nth_asm_tac 10[¬c‰2®,¬repState s‰1®,¬e®]);
a(list_spec_nth_asm_tac 11[¬c‰2®,¬repState s‰2®,¬e®]);
a(list_spec_nth_asm_tac 13[¬c‰1®,¬c‰2®,¬s‰1®,¬s‰2®,¬e®]);(**should be conjunct2**)
a(fc_tac[isState_lemma1]THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬s®isState_lemma));
a(fc_tac[hideR_lemma]);
a(spec_nth_asm_tac 1 ¬c‰2®);
a(DROP_NTH_ASM_T 4 ante_tac);
a(LEMMA_T¬e = (Fst e,Snd e)® pure_once_asm_rewrite_thm_tac 
	THEN_LIST[rewrite_tac[],rewrite_tac[updateState_def]]);
a(asm_fc_tac[]);
a(list_spec_nth_asm_tac 2[¬c‰1®,¬e®]);
a(fc_tac[hideR_lemma]);
a(spec_nth_asm_tac 1 ¬c‰2®);
a(fc_tac[isState_lemma1]THEN asm_rewrite_tac[]);
a(´_tac THEN swap_nth_asm_concl_tac 1);
a(strip_asm_tac(list_µ_elim[¬hideR (c‰2, repState s)®,
	¬hideR (c‰2, Fst (updateStateR (c‰1, e, repState s)))®]isState_lemma2));
a(fc_tac[conjunct1]);
val ÛupdateStateR_updateState_lemmaÝ = save_pop_thm"updateStateR_updateState_lemma";
=TEX


\newpage
\input{fef012th.tex}

\newpage
\twocolumn[\section{INDEX} \label{INDEX}]
\small
\printindex

\end{document}


\section{CONSISTENCY PROOFS}
\subsection{Retrieving the Remaining Definitions of Constants}

\subsection{Axioms}
=SML
val Ûsquash_À_ax1Ý =  new_axiom(["squash_À_ax1"],¬µ r x y· (µ n · n  Dom r ´ x > n) 
	´  Squash(r À {(x,y)})= Squash r À {(# (Squash r) + 1,y)}®);
val Ûsquash_À_ax2Ý =  new_axiom(["squash_À_ax2"],¬µ l s ·  
	Squash(Id(Dom(ListRel l ’ s)) À {(#(ListRel l ’ s) + 1, #(ListRel l ’ s) + 1)})
	=
	Squash(Id(Dom(ListRel l ’ s))) À {(#(Squash(Id(Dom(ListRel l ’ s)))) + 1, #(ListRel l ’ s) + 1)}®);
=TEX
=SML	
val Ûlist_rel_ë_ò_axÝ =  new_axiom(["list_rel_ë_ò_ax"],
	¬µ l s x · s ò ListRel (l ë [x]) = 
		if Length l + 1  s then s ò ListRel l À {(Length l + 1,x)}
		else s ò ListRel l®);
=TEX




=SML
push_goal([],¬µ l (last:Row) s (u : î ª (î ª Update)) · 
	³ Length l + 1  Dom (RelCombine
                               (InvRel(Squash (Id (Dom
                                          (ListRel l ’ s)))) » u)
                               (ListRel (l ë [last])))®);
a(REPEAT µ_tac);
a(rewrite_tac[rel_combine_def,enumerate_def,r_»_r_thm,inv_rel_def,dom_def,id_def,squash_def,
	list_rel_def,’_thm,ò_thm,dot_dot_def,length_ë_one_thm,nth_length_one_thm]);
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[]);
val Ûlength_one_dom_lemmaÝ = save_pop_thm"length_one_dom_lemma";
=TEX
=SML
val Ûlist_rel_«_axÝ =  new_axiom(["list_rel_«_ax"],¬µ l s (us:î ª (î ª Update)) r‰1 r‰2 · ¶ l'
           · ListRel l « (RelCombine
                     (InvRel (Squash(Id(Dom
                                       (ListRel l ’ s)))) » us)
                     (ListRel l) » r‰1) » r‰2
               = ListRel l'®);
=TEX
a(rewrite_tac[map_def]);
