
=TEX
% TQtemplate.tex
\documentstyle[hol1,11pt,TQ]{article}
\def\Hide#1{}
\def\Bool{``$\it{:}bool\,$''}
\makeindex
\TPPproject{DRA FRONT END FILTER PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Table Computation Security Proofs}  %% Mandatory field
\TPPref{DS/FMU/FEF/035}  %% Mandatory field
\def\SCCSversion{$Revision$
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$
}}  %% Mandatory field (with sensible default)
\TPPstatus{Draft}			%% Mandatory field
\TPPtype{Specification}
\TPPkeywords{}
\TPPauthor{R.B.~Jones & WIN01}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthorisation{R.B.~Jones & HAT Manager}
\TPPabstract{This document completes the formal proofs relating to 
DS/FMU/FEF/033; it forms part of the Phase II proofs for the
DRA front end filter project RSRE 1C/6130.}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
	HAT FEF File \\
	Simon Wiseman
}}
%\TPPclass{CLASSIFICATION}
\newfont{\icllogo}{icllogo50}
\def\TPPheadlhs{$\vcenter{\halign{##\cr\icllogo ICL\cr}}$}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}

\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

%\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\newpage
\section {DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu,fef}

\subsection{Changes History}
\begin{description}
\item[Issue \SCCSversion(\FormatDate{$Date$
})] First draft.
\end{description}

\subsection{Changes Forecast}
None.
\pagebreak
\section{GENERAL}
\subsection{Scope}
This document provides a formal proof relating
to the specifications in ``An Execution Model for SWORD'' \cite{DS/FMU/FEF/026}.
It constitutes part of deliverable D13 of work package 3, as given
in section 3 of the Proposal for Phase 2, \cite{DS/FMU/FEF/018}.


(The current version is a rough draft of proofs of some of the propositions
produced as pilot work during the third stage of phase 2.)

\subsection{Introduction}
\section{PRELIMINARIES}
The following \Product{} instructions set up a new theory $fef035$
to hold the theorems to be proved and set up a proof context in which
to carry out the proofs. 

=SML 
open_theory "fef033";
new_theoryÛ"fef035"Ý;
set_pc"hol";
=TEX
\section{LEMMAS}
=SML
push_goal([],¬µ tl el gp gps ·
	ProjectData tl el [] = []
±	ProjectData tl el (Cons gp gps) = 
	Map (Ì r· MkDerTableRow (DTR_where r) (DTR_row r) (Map (Ì e· e tl gp r) el)) gp
	ë ProjectData tl el gps®);
a(rewrite_tac(map get_spec[¬Map®,¬ProjectData®,¬Flat®,¬Let®]) THEN REPEAT strip_tac);
val ÛProjectData_lemmaÝ = save_pop_thm"ProjectData_lemma";
=TEX
=SML
set_goal([], ¬µc t· DT_spec (HideDerTable c t) = DT_spec t®);
a(rewrite_tac (map get_spec[¬HideDerTable®, ¬DT_spec®, ¬Let®]));
val ÛDT_spec_HideDerTable_lemmaÝ = save_pop_thm"DT_spec_HideDerTable_lemma";
=TEX
=SML
set_goal([], ¬µc ts1 ts2·
	Map (HideDerTable c) ts1 = Map (HideDerTable c) ts2
´	(Map DT_spec ts1) = (Map DT_spec ts2)®);
a(REPEAT strip_tac);
a(LEMMA_T¬
	Map DT_spec(Map (HideDerTable c) ts1) =
	Map DT_spec(Map (HideDerTable c) ts2)®
	ante_tac THEN1 asm_rewrite_tac[]);
a(lemma_tac¬DT_spec o HideDerTable c = DT_spec®
	THEN1 PC_T1 "hol2" rewrite_tac[DT_spec_HideDerTable_lemma]);
a(asm_rewrite_tac[map_o_lemma]);
val Ûmap_HideDerTable_map_DT_spec_lemmaÝ =
	save_pop_thm"map_HideDerTable_map_DT_spec_lemma";
=TEX
=SML
push_goal([], ¬µc r rs·
	HideDerTableData c [] = []
±	HideDerTableData c (Cons r rs) = 
		if	c dominates DTR_row r
		then	Cons (HideDerTableRow c r) (HideDerTableData c rs)
		else	HideDerTableData c rs
®);
a(rewrite_tac(map get_spec[¬HideDerTableData®, ¬$ù®, ¬Map®, ¬Let®]));
a(REPEAT strip_tac);
a(cases_tac¬c dominates DTR_row r® THEN asm_rewrite_tac[get_spec¬Map®]);
val ÛHideDerTableData_lemmaÝ = save_pop_thm"HideDerTableData_lemma";
=TEX
=SML
push_goal([], ¬µc r1 r2 rs·
	JoinRows r1 [] = []
±	JoinRows r1 (Cons r2 rs) = 
	Cons
	(MkDerTableRow
		(DTR_where r1 lub DTR_where r2)
		(DTR_row r1 lub DTR_row r2)
		(DTR_cols r1 ë DTR_cols r2))
	(JoinRows r1 rs)
®);
a(rewrite_tac(map get_spec[¬JoinRows®, ¬Map®, ¬Let®]));
val ÛJoinRows_lemmaÝ = save_pop_thm"JoinRows_lemma";
=TEX
=SML
push_goal([], ¬µc blks·
	HideDerTableData c (Flat blks) = Flat (Map (HideDerTableData c) blks)
®);
a(REPEAT strip_tac);
a(list_induction_tac¬blks® THEN asm_rewrite_tac(map get_spec[¬Flat®, ¬Map®]));
(* *** Goal "1" *** *)
a(rewrite_tac(map get_spec[¬HideDerTableData®, ¬Map®, ¬Let®, ¬$ù®]));
(* *** Goal "2" *** *)
a(REPEAT strip_tac);
a(list_induction_tac¬x®);
(* *** Goal "1" *** *)
a(lemma_tac¬HideDerTableData c [] = []®
	THEN1 rewrite_tac(map get_spec[¬HideDerTableData®, ¬Map®, ¬Let®, ¬$ù®]));
a(asm_rewrite_tac(map get_spec[¬$Append®, ¬Map®, ¬Flat®]));
(* *** Goal "2.2" *** *)
a(rewrite_tac(map get_spec[¬$Append®, ¬Map®, ¬Flat®]));
a(all_asm_ante_tac
	THEN rewrite_tac(map get_spec[¬HideDerTableData®, ¬Map®, ¬Let®])
	THEN REPEAT strip_tac);
a(rewrite_tac[get_spec¬$ù®]);
a(cases_tac ¬c dominates DTR_row x'® THEN
	TOP_ASM_T rewrite_thm_tac
	THEN asm_rewrite_tac(map get_spec[¬Map®, ¬$Append®]));
val ÛHideDerTable_flat_lemmaÝ =
	save_pop_thm"HideDerTable_flat_lemma";
=TEX
=SML
val Ûconj1Ý = ¬µtl‰0  tl‰1 c·
	Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1 ´
	HideDerTable
               c
               (MkDerTable
                   (Fst (Join tl‰0))
                   (Snd (Join tl‰0)))
             = HideDerTable
               c
               (MkDerTable
                   (Fst (Join tl‰1))
                   (Snd (Join tl‰1)))®;
val Ûconj2Ý = ¬µc ts1 ts2·
	Map (HideDerTable c) ts1 = Map (HideDerTable c) ts2
´	HideDerTableData c (JoinData (Map DT_rows ts1)) =
	HideDerTableData c (JoinData (Map DT_rows ts2))®;
val Ûconj3Ý = ¬µc ts1 ts2·
	Map (HideDerTable c) ts1 = Map (HideDerTable c) ts2
´	Map (HideDerTableData c) (Map DT_rows ts1)
	= Map (HideDerTableData c) (Map DT_rows ts2)®;
val Ûconj4Ý = ¬µc ds1 ds2·
	Map (HideDerTableData c) ds1 = Map (HideDerTableData c) ds2
´	HideDerTableData c (JoinData ds1) =
	HideDerTableData c (JoinData ds2)®;
val Ûconj5Ý = ¬µc rs1 rs2·
	Flat(Map (Ìr· HideDerTableData c (JoinRows r rs2)) rs1) =
	Flat(Map (Ìr· JoinRows r (HideDerTableData c rs2)) (HideDerTableData c rs1))®;
val Ûconj6Ý = ¬µc r rs·
		HideDerTableData c (JoinRows r rs)
	=	if	c dominates DTR_row r
		then	JoinRows (HideDerTableRow c r) (HideDerTableData c rs)
		else []®;
=TEX
=SML
set_goal([conj2], conj1);
a(REPEAT strip_tac);
a(rewrite_tac(MkDerTable_lemma :: map get_spec[¬Join®, ¬HideDerTable®, ¬MkDerTable®]));
a(ALL_ASM_FC_T rewrite_tac [map_HideDerTable_map_DT_spec_lemma]);
val ÛJoin_lemma1Ý = save_pop_thm"Join_lemma1";
=TEX
=SML
set_goal([conj3, conj4], conj2);
a(REPEAT strip_tac THEN all_asm_fc_tac[]);
a(all_asm_fc_tac[]);
val ÛJoin_lemma2Ý = save_pop_thm"Join_lemma2";
=TEX
=SML
set_goal([], conj3);
a(REPEAT_N 2 strip_tac);
a(list_induction_tac¬ts1®);
(* *** Goal "1" *** *)
a(strip_tac);
a(strip_asm_tac(µ_elim¬ts2® list_cases_thm)
	THEN asm_rewrite_tac[map_def]);
(* *** Goal "2" *** *)
a(REPEAT_N 2 strip_tac);
a(strip_asm_tac(µ_elim¬ts2® list_cases_thm)
	THEN asm_rewrite_tac[map_def]);
a(REPEAT strip_tac THEN all_asm_fc_tac[]);
a(asm_ante_tac ¬HideDerTable c x = HideDerTable c x'®
	THEN rewrite_tac[MkDerTable_lemma, get_spec¬HideDerTable®]);
a(REPEAT strip_tac);
val ÛJoin_lemma3Ý = save_pop_thm"Join_lemma3";
=TEX
=SML
set_goal([conj5], conj4);
a(strip_tac THEN strip_tac);
a(list_induction_tac ¬ds1®);
(* *** Goal "1" *** *)
a(rewrite_tac[get_spec¬Map®, map_null_thm]);
a(REPEAT strip_tac THEN asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(rewrite_tac[get_spec¬Map®] THEN REPEAT µ_tac);
a(strip_asm_tac(µ_elim¬ds2®list_cases_thm) THEN 
	asm_rewrite_tac[get_spec¬Map®, map_null_thm]);
a(REPEAT strip_tac);
a(strip_asm_tac (µ_elim¬ds1®list_cases_thm));
=TEX
=SML
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[get_spec¬Map®, map_null_thm]);
a(REPEAT strip_tac THEN var_elim_asm_tac¬list2 = []®);
a(asm_rewrite_tac(map get_spec [¬JoinData®, ¬Let®]));
(* *** Goal "2.2" *** *)
a(lemma_tac¬³ds1 = [] ± ³list2 = []® THEN1 asm_rewrite_tac[]);
(* *** Goal "2.2.1" *** *)
a(swap_nth_asm_concl_tac 2 THEN asm_rewrite_tac[get_spec¬Map®, map_null_thm]);
(* *** Goal "2.2.2" *** *)
a(LIST_DROP_NTH_ASM_T [3, 6] (Combinators.K id_tac));
a(asm_rewrite_tac(let_def::HideDerTable_flat_lemma::map get_spec [¬JoinData®]));
a(asm_rewrite_tac[map_o_lemma,
	pc_rule1"hol2"prove_rule[]¬µf g z·(f o (Ìx·g x z)) = (Ìx·f(g x z))®]);
a(ALL_ASM_FC_T rewrite_tac[]);
val ÛJoin_lemma4Ý = save_pop_thm"Join_lemma4";
=TEX
=SML
set_goal([conj6], conj5);
a(REPEAT strip_tac);
a(list_induction_tac ¬rs1®);
(* *** Goal "1" *** *)
a(rewrite_tac(map get_spec[¬HideDerTableData®, ¬Flat®, ¬Map®, ¬Let®, ¬$ù®]));
(* *** Goal "2" *** *)
a(rewrite_tac[dominates_lub_lemma,HideDerTableData_lemma,get_spec¬Flat®,get_spec¬Map®]);
a(strip_tac);
a(cases_tac¬c dominates DTR_row x®
	THEN asm_rewrite_tac(map get_spec[¬$ë®, ¬Map®, ¬Flat®]));
val ÛJoin_lemma5Ý = save_pop_thm"Join_lemma5";
=TEX
=SML
set_goal([], conj6);
a(REPEAT strip_tac);
a(list_induction_tac¬rs®);
(* *** Goal "1" *** *)
a(rewrite_tac[HideDerTableData_lemma, JoinRows_lemma]);
a(CASES_T ¬c dominates DTR_row r® rewrite_thm_tac);
(* *** Goal "2" *** *)
a(strip_tac);
a(cases_tac ¬c dominates DTR_row r® THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.1" *** *)
a(swap_nth_asm_concl_tac 2 THEN asm_rewrite_tac[] THEN swap_nth_asm_concl_tac 1);
a(DROP_NTH_ASM_T 2 ante_tac);
a(rewrite_tac[HideDerTableData_lemma, JoinRows_lemma,
	dominates_lub_lemma, get_spec¬MkDerTableRow®]);
a(REPEAT strip_tac THEN asm_rewrite_tac[]);
a(cases_tac ¬c dominates DTR_row x®THEN asm_rewrite_tac[]);
a(rewrite_tac[JoinRows_lemma]);
a(asm_rewrite_tac(MkDerTableRow_lemma:: map_ë_thm1::
	map get_spec[¬HideDerTableRow®, ¬MkDerTableRow®, ¬Let®]));
(* *** Goal "2.2" *** *)
a(POP_ASM_T ante_tac);
a(asm_rewrite_tac[HideDerTableData_lemma, JoinRows_lemma,
	dominates_lub_lemma, get_spec¬MkDerTableRow®]);
a(REPEAT strip_tac THEN asm_rewrite_tac[]);
val ÛJoin_lemma6Ý = save_pop_thm"Join_lemma6";
=TEX
=SML
set_goal([], conj1);
a(MAP_EVERY (ante_tac o all_´_intro) [
	Join_lemma1,
	Join_lemma2,
	Join_lemma3,
	Join_lemma4,
	Join_lemma5,
	Join_lemma6]
	THEN taut_tac);
val ÛJoin_OK_lemmaÝ = save_pop_thm"Join_OK_lemma";
=TEX
=SML
push_goal([],¬µ c tl‰0 tl‰1 tel
· Elems tel € OK_TC c
      ± c dominates lubl (Fst (Split (Map (Ì te· te tl‰0) tel)))
      ± Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1
    ´ Map (HideDerTable c) (Snd (Split (Map (Ì te· te tl‰0) tel)))
      = Map (HideDerTable c) (Snd (Split (Map (Ì te· te tl‰1) tel)))®);
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 3 ante_tac THEN DROP_NTH_ASM_T 2 ante_tac);
a(list_induction_tac¬tel®);
(* *** Goal "1" *** *)
a(asm_rewrite_tac(map get_spec[¬Map®]));
(* *** Goal "2" *** *)
a(rewrite_tac[dominates_lub_lemma,lubl_lemma,split_thm,get_spec¬Map®]);
a(REPEAT strip_tac);
=TEX
=SML
(* *** Goal "3" *** *)
a(PC_T1 "sets_ext" asm_prove_tac[get_spec¬Elems®]);
(* *** Goal "4" *** *)
a(REPEAT strip_tac);
a(asm_rewrite_tac[split_thm,get_spec¬Map®]);
a(lemma_tac¬x  OK_TC c®);
(* *** Goal "4.1" *** *)
a(PC_T1 "sets_ext" asm_prove_tac[get_spec¬Elems®]);
(* *** Goal "4.2" *** *)
a(POP_ASM_T (strip_asm_tac o rewrite_rule[get_spec¬OK_TC®]));
a(DROP_NTH_ASM_T 3 (strip_asm_tac o rewrite_rule[dominates_lub_lemma,lubl_lemma,
	split_thm,get_spec¬Map®]));
a(contr_tac THEN all_asm_fc_tac[]);
val ÛAllTuples_lemma1Ý = save_pop_thm"AllTuples_lemma1";
=TEX
=SML
push_goal([],¬µ c tl‰0 tl‰1 rl‰0 rl‰1 r‰0 r‰1 sl· 
	Elems sl € OK_VC c ¡ OK_VC2 c
	± Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1
	± Map (HideDerTableRow c) rl‰0 = Map (HideDerTableRow c) rl‰1
	± HideDerTableRow c r‰0 = HideDerTableRow c r‰1
	´ HideDerTableRow c 
	     (MkDerTableRow (DTR_where r‰0) (DTR_row r‰0) (Map (Ì e· e tl‰0 rl‰0 r‰0) sl))
	= 
	HideDerTableRow c 
	     (MkDerTableRow (DTR_where r‰1) (DTR_row r‰1) (Map (Ì e· e tl‰1 rl‰1 r‰1) sl))®);
a(REPEAT strip_tac);
a(TOP_ASM_T ante_tac THEN rewrite_tac(MkDerTableRow_lemma :: 
	map get_spec[¬HideDerTableRow®,¬Let®,¬MkDerTableRow®])
	THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 7 ante_tac);
a(list_induction_tac ¬sl®);
(* *** Goal "1" *** *)
a(rewrite_tac[get_spec¬Map®]);
(* *** Goal "2" *** *)
a(PC_T1 "sets_ext" asm_prove_tac[get_spec¬Elems®]);
=TEX
=SML
(* *** Goal "3" *** *)
a(REPEAT strip_tac THEN asm_rewrite_tac[get_spec¬Map®]);
a(lemma_tac¬x  OK_VC c ± x  OK_VC2 c®);
(* *** Goal "3.1" *** *)
a(PC_T1 "sets_ext" asm_prove_tac[get_spec¬Elems®]);
(* *** Goal "3.2" *** *)
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac THEN 
	rewrite_tac(map get_spec[¬OK_VC®,¬OK_VC2®]));
a(REPEAT strip_tac THEN all_asm_fc_tac[]);
a(POP_ASM_T (asm_tac o eq_sym_rule));
a(cases_tac¬c dominates Fst (x tl‰0 rl‰0 r‰0)®THEN asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 3 discard_tac);
a(lemma_tac¬Snd (x tl‰0 rl‰0 r‰0) = Snd (x tl‰1 rl‰1 r‰1)®
	THEN1 contr_tac THEN all_asm_fc_tac[]);
a(once_rewrite_tac[prove_rule[]¬x tl‰0 rl‰0 r‰0 = (Fst (x tl‰0 rl‰0 r‰0), Snd (x tl‰0 rl‰0 r‰0))®]);
a(POP_ASM_T pure_rewrite_thm_tac);
a(DROP_NTH_ASM_T 2 (rewrite_thm_tac o eq_sym_rule));
val ÛProjectData_lemma1Ý = save_pop_thm"ProjectData_lemma1";
=TEX
=SML
push_goal([],¬µ c rl‰0 rl‰1 · Map (HideDerTableRow c) rl‰0 = Map (HideDerTableRow c) rl‰1
	´ HideDerTableData c rl‰0 = HideDerTableData c rl‰1®);
a(REPEAT µ_tac);
a(intro_µ_tac(¬rl‰1®,¬rl‰1®));
a(list_induction_tac¬rl‰0®);
(* *** Goal "1" *** *)
a µ_tac;
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
(* *** Goal "1.1" *** *)
a(asm_rewrite_tac[]);
(* *** Goal "1.2" *** *)
a(asm_rewrite_tac[get_spec¬Map®]);
=TEX
=SML
(* *** Goal "2" *** *)
a(REPEAT µ_tac);
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
(* *** Goal "2.1" *** *)
a(asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2" *** *)
a(asm_rewrite_tac[get_spec¬Map®,HideDerTableData_lemma]);
a(cases_tac¬c dominates DTR_row x® THEN
	cases_tac¬c dominates DTR_row x'® THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2.1" *** *)
a(REPEAT strip_tac THEN all_asm_fc_tac[]);
(* *** Goal "2.2.2" *** *)
a(rewrite_tac(MkDerTableRow_lemma :: map get_spec
	[¬HideDerTableRow®,¬MkDerTableRow®,¬Let®]));
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.3" *** *)
a(rewrite_tac(MkDerTableRow_lemma :: map get_spec
	[¬HideDerTableRow®,¬MkDerTableRow®,¬Let®]));
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.4" *** *)
a(REPEAT strip_tac THEN all_asm_fc_tac[]);
val ÛHideDerTableData_lemma1Ý = save_pop_thm"HideDerTableData_lemma1";
=TEX
\subsection{Conjectures required for $AllTuples$}
\subsubsection{Where}
=SML
val ÛWhere_conj1Ý = ¬µtl rl c e ·
	 c dominates lubl (Map DTR_row (Where c tl rl e))®;
=TEX

=SML
val ÛWhere_conj2Ý = ¬µ tl‰0 tl‰1 rl‰0 rl‰1 c e
· e  OK_VC c ¡ OK_VC2 c
      ± Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1
      ± HideDerTableData c rl‰0 = HideDerTableData c rl‰1
    ´ Map (HideDerTableRow c) (Where c tl‰0 rl‰0 e)
      = Map (HideDerTableRow c) (Where c tl‰1 rl‰1 e)®;
=TEX
\subsubsection{Group}
=SML
val ÛGroup_conjÝ = ¬µtl‰0  tl‰1 rl‰0 rl‰1 c e ml nl ·
	e  OK_VC c ¡ OK_VC2 c
±	c dominates lubl (Map DTR_row rl‰0)
±	c dominates lubl (Map DTR_row rl‰1)
±	Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1 
±	Map (HideDerTableRow c) rl‰0 = Map (HideDerTableRow c) rl‰1
±	³ Map (Map (HideDerTableRow c)) (Snd(Group c tl‰0 rl‰0 ml nl e)) 
	= 
	Map (Map (HideDerTableRow c)) (Snd(Group c tl‰1 rl‰1 ml nl e))
´	³ c dominates Fst(Group c tl‰0 rl‰0 ml nl e)® ;
=TEX
¹HOLCONST
Ü	GroupA	: DerTableRow LIST
Ü		­ î LIST
Ü		­ î LIST
Ü		­ (Class ¸ (DerTableRow LIST LIST))
÷üüüüüüüüüüüüüüüüüüü
Üµrl gbsterling gbclass·
Ü	GroupA rl gbsterling gbclass =
Ü	let	gpby row = (ListNth gbsterling (Map Snd (DTR_cols row)),
Ü				ListNth gbclass (Map Fst(DTR_cols row)))
Ü	in let	gbc row = lubl(ListNth gbsterling (Map Fst(DTR_cols row)))
Ü	in 	(lubl (Map gbc rl), MakeGroups gpby rl)
°

=TEX
¹HOLCONST
Ü	ÛGroupBÝ	: DerTable LIST
Ü			­ DerTableRow LIST LIST
Ü			­ VALUE_COMP
Ü			­ (Class ¸ (DerTableRow LIST LIST))
÷üüüüüüüüüüüüüüüüüü
Üµtl gps having·
Ü	GroupB tl gps having =
Ü	let	has_test gp = ((CommonValue having) tl gp Arbitrary)
Ü	in let	wanted_gps = gps ù {gp | ItemBool(Snd (has_test gp))}
Ü	in	(lubl(Map (Fst o has_test) gps), wanted_gps)
°
=TEX
=SML
set_goal([], ¬
µcc tl rl gbsterling gbclass having·
	Group cc tl rl gbsterling gbclass having =
	let	(c1, gps) = GroupA rl gbsterling gbclass
	in let	(c2, wanted_gps) = GroupB tl gps having
	in	((if cc dominates c1 then c2 else c1), wanted_gps)
®);
a(REPEAT strip_tac THEN
	rewrite_tac(map get_spec[¬Group®, ¬GroupA®, ¬GroupB®, ¬Let®]));
val ÛGroup_lemma1Ý = save_pop_thm"Group_lemma1";
=TEX
=SML
val ÛGroupA_conjÝ = ¬µrl‰0 rl‰1 c gbsterling gbclass ·
	c dominates lubl (Map DTR_row rl‰0)
±	c dominates lubl (Map DTR_row rl‰1)
±	Map (HideDerTableRow c) rl‰0 = Map (HideDerTableRow c) rl‰1
±	³ Map (Map (HideDerTableRow c)) (Snd(GroupA rl‰0 gbsterling gbclass)) 
	= 
	Map (Map (HideDerTableRow c)) (Snd(GroupA rl‰1 gbsterling gbclass))
´	³ c dominates Fst(GroupA rl‰0 gbsterling gbclass)® ;
=TEX
=SML
val ÛGroupB_conjÝ = ¬µtl‰0  tl‰1 gps‰0 gps‰1 c having ·
	having  OK_VC c ¡ OK_VC2 c
±	Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1 
±	Map (Map (HideDerTableRow c)) gps‰0 = Map (Map (HideDerTableRow c)) gps‰1 
±	³ Map (Map (HideDerTableRow c)) (Snd(GroupB tl‰0 gps‰0 having)) 
	= 
	Map (Map (HideDerTableRow c)) (Snd(GroupB tl‰1 gps‰1 having))
´	³ c dominates Fst(GroupB tl‰0 gps‰0 having)® ;
=TEX
=SML
set_goal([GroupA_conj, GroupB_conj], Group_conj);
a(rewrite_tac[Group_lemma1, let_def, dominates_lub_lemma]
	THEN REPEAT strip_tac);
a(cases_tac¬c dominates Fst (GroupA rl‰0 ml nl)® THEN asm_rewrite_tac[]);
a(GET_NTH_ASM_T 10 bc_thm_tac);
a(¶_tac¬Snd (GroupA rl‰1 ml nl)® THEN ¶_tac¬tl‰1®);
a(contr_tac THEN all_asm_fc_tac[]);
val ÛGroup_lemma2Ý = save_pop_thm"Group_lemma2";
=TEX
\subsubsection{ProjectData}
=SML
val ÛProjectData_conjÝ = ¬µtl‰0  tl‰1 gps‰0 gps‰1 c sl ·
	Elems sl € OK_VC c ¡ OK_VC2 c
±	Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1 
±	Map (Map (HideDerTableRow c)) gps‰0 = Map (Map (HideDerTableRow c)) gps‰1
´
	Map (HideDerTableRow c) (ProjectData tl‰0 sl gps‰0) 
	= 
	Map (HideDerTableRow c) (ProjectData tl‰1 sl gps‰1)®;
=TEX
\subsection{Proofs of Conjectures}
\subsubsection{Where}
$Where$ is first defined in terms of new operations W and H to assist in rewriting.

¹HOLCONST
Ü	ÛWÝ 	: Class
Ü		­ DerTable LIST
Ü		­ DerTableRow LIST
Ü		­ DerTableRow LIST
Ü		­ VALUE_COMP
Ü		­ DerTableRow LIST
÷üüüüüüüüüüüüüüüüüü
Üµc tl rl‰1 r rl‰2 e ·
Ü	W c tl rl‰1 [] e = []
Ü±	W c tl rl‰1 (Cons r rl‰2) e =   
Ü     (let w = DTR_where r lub Fst (e tl rl‰1 r)
Ü     in let h = ((ItemBool (Snd (e tl rl‰1 r)) ² ³ c dominates w)
Ü			± c dominates DTR_row r)
Ü     in	if h then Cons (MkDerTableRow w (DTR_row r) (DTR_cols r))
Ü			(W c tl rl‰1 rl‰2 e)
Ü		else (W c tl rl‰1 rl‰2 e))
°
=TEX
¹HOLCONST
Ü	ÛHÝ 	: Class
Ü		­ DerTableRow LIST
Ü		­ DerTableRow LIST
÷üüüüüüüüüüüüüüüüüü
Üµc rl · H c rl = rl ù {r|c dominates DTR_row r}
°
=TEX
=SML
push_goal([],¬µ c tl rl e · Where c tl rl e = W c tl (H c rl) (H c rl) e®);
a(rewrite_tac(map get_spec[¬Where®,¬W®,¬H®,¬Let®]) THEN REPEAT strip_tac);
a(lemma_tac¬µ rs ·Map
               Snd
               (Map
                     (Ì r
                       · ((ItemBool (Snd (e tl (rs ù {r|c dominates DTR_row r}) r))
                               ² ³ c
                                   dominates DTR_where r
                                     lub Fst (e tl (rs ù {r|c dominates DTR_row r}) r)),
                           MkDerTableRow
                               (DTR_where r
                                   lub Fst (e tl (rs ù {r|c dominates DTR_row r}) r))
                               (DTR_row r)
                               (DTR_cols r)))
                     (rl ù {r|c dominates DTR_row r})
                   ù {(t, r)|t})
             = W c tl (rs ù {r|c dominates DTR_row r}) (rl ù {r|c dominates DTR_row r}) e®
	THEN_LIST[id_tac,asm_rewrite_tac[]]);
=TEX
=SML
a(list_induction_tac¬rl®);
(* *** Goal "1" *** *)
a(rewrite_tac(map get_spec[¬W®,¬Map®,¬$ù®]));
(* *** Goal "2" *** *)
a(rewrite_tac(map get_spec[¬W®,¬Map®,¬$ù®,¬Let®]));
a(REPEAT strip_tac);
a(cases_tac¬c dominates DTR_row x®THEN asm_rewrite_tac
	(map get_spec[¬W®,¬Map®,¬$ù®,¬Let®]));
a(cases_tac¬ItemBool (Snd (e tl (rs ù {r|c dominates DTR_row r}) x))
                       ² ³ c dominates DTR_where x
                             lub Fst (e tl (rs ù {r|c dominates DTR_row r}) x)®
	THEN asm_rewrite_tac[get_spec¬Map®]);
val ÛWhere_W_lemmaÝ = save_pop_thm"Where_W_lemma";
=TEX
=SML
push_goal([],Where_conj1);
a(rewrite_tac[Where_W_lemma,get_spec¬H®]THEN REPEAT µ_tac);
a(lemma_tac¬µ rs · c dominates lubl 
	(Map DTR_row (W c tl (rs ù {r|c dominates DTR_row r})
                       (rl ù {r|c dominates DTR_row r}) e))®
	THEN_LIST[id_tac,asm_rewrite_tac[]]);
a(list_induction_tac¬rl®);
(* *** Goal "1" *** *)
a(rewrite_tac(lubl_lemma :: map get_spec[¬Map®,¬W®,¬$ù®,¬$dominates®]));
(* *** Goal "2" *** *)
a(rewrite_tac[get_spec¬$ù®] THEN REPEAT µ_tac);
a(cases_tac¬c dominates DTR_row x®THEN 
	asm_rewrite_tac(map get_spec[¬Map®,¬W®,¬Let®]));
a(cases_tac¬ItemBool (Snd (e tl (rs ù {r|c dominates DTR_row r}) x))
                           ² ³ c dominates DTR_where x
                            lub Fst (e tl (rs ù {r|c dominates DTR_row r}) x)®
	THEN asm_rewrite_tac(lubl_lemma :: dominates_lub_lemma :: map 
		get_spec[¬Map®,¬MkDerTableRow®]));
val ÛWhere_dominates_lemmaÝ = save_pop_thm"Where_dominates_lemma";
=TEX
=SML
push_goal([],¬µ tl‰0 tl‰1 rl‰0 rl‰1 r‰0 r‰1 c e
· e  OK_VC c ¡ OK_VC2 c
      ± Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1
      ± Map (HideDerTableRow c) rl‰0 = Map (HideDerTableRow c) rl‰1
      ± HideDerTableRow c r‰0 = HideDerTableRow c r‰1
    ´ (((ItemBool (Snd (e tl‰0 rl‰0 r‰0)) ² ³ c dominates DTR_where r‰0 lub Fst (e tl‰0 rl‰0 r‰0))
             ± c dominates DTR_row r‰0) ¤
	((ItemBool (Snd (e tl‰1 rl‰1 r‰1)) ² ³ c dominates DTR_where r‰1 lub Fst (e tl‰1 rl‰1 r‰1))
             ± c dominates DTR_row r‰1))®);
a(REPEAT µ_tac THEN ´_tac);
a(GET_NTH_ASM_T 1 ante_tac THEN
	rewrite_tac(MkDerTableRow_lemma :: 
	map get_spec[¬HideDerTableRow®,¬Let®,¬MkDerTableRow®])	THEN ´_tac);
=TEX
=SML
a(POP_ASM_T discard_tac);
a(DROP_NTH_ASM_T 7 ante_tac THEN DROP_NTH_ASM_T 6 ante_tac THEN 
	rewrite_tac(map get_spec[¬OK_VC®,¬OK_VC2®]));
a(´_tac THEN all_asm_fc_tac[]);
a(DROP_NTH_ASM_T 2 discard_tac THEN ´_tac);
a(cases_tac¬c dominates Fst (e tl‰0 rl‰0 r‰0)®);
(* *** Goal "1" *** *)
a(list_spec_nth_asm_tac 2 [¬tl‰0®,¬tl‰1®,¬rl‰0®,¬rl‰1®,¬r‰0®,¬r‰1®]);
a(asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(lemma_tac¬³ c dominates Fst (e tl‰1 rl‰1 r‰1)®);
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 3 (asm_rewrite_thm_tac o eq_sym_rule));
(* *** Goal "2.2" *** *)
a(asm_rewrite_tac[dominates_lub_lemma]THEN REPEAT strip_tac);
val ÛWhere_lemmaÝ = save_pop_thm"Where_lemma";
=TEX
=SML
push_goal([],¬µtl‰0  tl‰1 rl‰0 rl‰1  rl1 rl2 c e ·
	e  OK_VC c ¡ OK_VC2 c
±	Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1 
±	Map (HideDerTableRow c) rl‰0 = Map (HideDerTableRow c) rl‰1
±	Map (HideDerTableRow c) rl1 = Map (HideDerTableRow c) rl2
	´
	Map (HideDerTableRow c) (W c tl‰0 rl1 rl‰0 e) = 
	Map (HideDerTableRow c) (W c tl‰1 rl2 rl‰1 e)®);
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac);
a(intro_µ_tac(¬rl1®,¬rl1®) THEN intro_µ_tac(¬rl2®,¬rl2®) THEN intro_µ_tac(¬rl‰1®,¬rl‰1®));
=TEX
=SML
a(list_induction_tac¬rl‰0®);
(* *** Goal "1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
(* *** Goal "1.1" *** *)
a(POP_ASM_T rewrite_thm_tac);
a(rewrite_tac[get_spec¬W®]);
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
=TEX
=SML
(* *** Goal "2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
a(REPEAT strip_tac);
a(rewrite_tac(map get_spec[¬W®,¬Let®]));
a(CASES_T¬(ItemBool (Snd (e tl‰0 rl1 x)) ² 
	³ c dominates DTR_where x lub Fst (e tl‰0 rl1 x))
                       ± c dominates DTR_row x®asm_tac);
=TEX
=SML
(* *** Goal "2.2.1" *** *)
a(LEMMA_T¬(ItemBool (Snd (e tl‰1 rl2 x')) ² 
	³ c dominates DTR_where x' lub Fst (e tl‰1 rl2 x'))
                       ± c dominates DTR_row x'®rewrite_thm_tac);
(* *** Goal "2.2.1.1" *** *)
a(LEMMA_T¬e  OK_VC c ¡ OK_VC2 c®asm_tac THEN_LIST[REPEAT strip_tac,id_tac]);
a(ante_tac(list_µ_elim[¬tl‰0®,¬tl‰1®,¬rl1®,¬rl2®,¬x®,¬x'®,¬c®,¬e®]Where_lemma)
	THEN asm_rewrite_tac[]);
(* *** Goal "2.2.1.2" *** *)
a(POP_ASM_T rewrite_thm_tac);
a(rewrite_tac[get_spec¬Map®]);
a(all_asm_fc_tac[]);
a(POP_ASM_T rewrite_thm_tac THEN POP_ASM_T discard_tac);
a(GET_NTH_ASM_T 2 ante_tac THEN rewrite_tac
	(MkDerTableRow_lemma :: map get_spec[¬HideDerTableRow®,¬Let®,¬MkDerTableRow®])
	THEN REPEAT strip_tac);
a(DROP_NTH_ASM_T 10 ante_tac  THEN rewrite_tac[get_spec¬OK_VC2®]);
a(REPEAT strip_tac THEN all_asm_fc_tac[]);
a(asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.2.2" *** *)
a(LEMMA_T¬³((ItemBool (Snd (e tl‰1 rl2 x')) ² 
	³ c dominates DTR_where x' lub Fst (e tl‰1 rl2 x'))
                       ± c dominates DTR_row x')®rewrite_thm_tac);
(* *** Goal "2.2.2.1" *** *)
a(LEMMA_T¬e  OK_VC c ¡ OK_VC2 c®asm_tac THEN_LIST[REPEAT strip_tac,id_tac]);
a(ante_tac(list_µ_elim[¬tl‰0®,¬tl‰1®,¬rl1®,¬rl2®,¬x®,¬x'®,¬c®,¬e®]Where_lemma)
	THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.2" *** *)
a(POP_ASM_T rewrite_thm_tac);
a(all_asm_fc_tac[]);
val ÛW_lemmaÝ = save_pop_thm"W_lemma";
=TEX
=SML
push_goal([],Where_conj2);
a(REPEAT strip_tac);
a(rewrite_tac[Where_W_lemma]);
a(bc_tac[W_lemma]THEN_TRY PC_T1 "sets_ext" asm_rewrite_tac[]);
(* *** Goal "1" *** *)
a(POP_ASM_T ante_tac THEN rewrite_tac(map get_spec[¬Let®,¬HideDerTableData®,¬H®]));
val ÛWhere_OK_lemmaÝ = save_pop_thm"Where_OK_lemma";
=TEX
\subsubsection{Group}
=SML
push_goal([],¬µ f l· Length (Map f l) = Length l®);
a(REPEAT µ_tac);
a(list_induction_tac¬l®THEN asm_rewrite_tac(map get_spec[¬Map®,¬Length®]));
val Ûlength_map_lemmaÝ = save_pop_thm"length_map_lemma";
=TEX
=SML
push_goal([],¬µ xs gpby · ³ []  Elems (MakeGroups gpby xs)®);
a(REPEAT strip_tac);
a(list_induction_tac¬xs®);
(* *** Goal "1" *** *)
a(rewrite_tac(map get_spec[¬Elems®,¬MakeGroups®]));
(* *** Goal "2" *** *)
a(strip_tac THEN rewrite_tac(map get_spec[¬Elems®,¬MakeGroups®]));
a(lemma_tac¬¶ gps · MakeGroups gpby xs = gps®THEN1 prove_¶_tac);
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
a(POP_ASM_T discard_tac);
a(list_induction_tac¬gps®);
=TEX
=SML
(* *** Goal "2.1" *** *)
a(rewrite_tac(map get_spec[¬Elems®,¬PutInGroup®]));
(* *** Goal "2.2" *** *)
a(PC_T1 "sets_ext" asm_prove_tac[get_spec¬Elems®]);
(* *** Goal "2.3" *** *)
a(rewrite_tac(map get_spec[¬Elems®,¬PutInGroup®]));
a(REPEAT strip_tac);
a(cases_tac¬gpby x = gpby (Head x')®THEN asm_rewrite_tac[]);
(* *** Goal "2.3.1" *** *)
a(asm_prove_tac[get_spec¬Elems®]);
(* *** Goal "2.3.2" *** *)
a(asm_prove_tac[get_spec¬Elems®]);
val ÛMakeGroups_lemma1Ý = save_pop_thm"MakeGroups_lemma1";
=TEX
=SML
set_goal([],¬µ r‰1 r‰2 c · 
	HideDerTableRow c r‰1 = HideDerTableRow c r‰2
      ´ Map Fst (DTR_cols r‰1) =  Map Fst (DTR_cols r‰2)®);
a(REPEAT strip_tac);
a(POP_ASM_T  (strip_asm_tac o rewrite_rule(MkDerTableRow_lemma :: map get_spec
	[¬HideDerTableRow®,¬Let®,¬MkDerTableRow®])));
a(LIST_DROP_NTH_ASM_T [2,3](MAP_EVERY discard_tac));
a(POP_ASM_T ante_tac);
a(lemma_tac¬¶l1 · DTR_cols r‰1 = l1®THEN1 prove_¶_tac);
a(lemma_tac¬¶l2 · DTR_cols r‰2 = l2®THEN1 prove_¶_tac);
a(POP_ASM_T rewrite_thm_tac THEN POP_ASM_T rewrite_thm_tac );
a(intro_µ_tac(¬l2®,¬l2®));
a(list_induction_tac¬l1®);
=TEX
=SML
(* *** Goal "1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬l2®list_cases_thm));
(* *** Goal "1.1" *** *)
a(POP_ASM_T rewrite_thm_tac);
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬l2®list_cases_thm));
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
=TEX
=SML
(* *** Goal "2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(POP_ASM_T ante_tac);
a(rewrite_tac[get_spec¬Map®]);
a(REPEAT ´_tac);
a(all_asm_fc_tac[]);
a(asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 3 ante_tac);
a(cases_tac¬c dominates Fst x®THEN cases_tac¬c dominates Fst x'®THEN asm_rewrite_tac[]);
(* *** Goal "2.2.1" *** *)
a(´_T rewrite_thm_tac);
(* *** Goal "2.2.2" *** *)
a(´_T (strip_asm_tac o once_rewrite_rule[prove_rule[]¬x = (Fst x,Snd x)®]));
(* *** Goal "2.2.3" *** *)
a(´_T (strip_asm_tac o once_rewrite_rule[prove_rule[]¬x' = (Fst x',Snd x')®]));
val ÛGroupA_cols_lemma1Ý = save_pop_thm"GroupA_cols_lemma1";
=TEX
=SML
push_goal([],¬µ r‰1 r‰2 c gbsterling gbclass · 
	c dominates lubl (ListNth gbsterling (Map Fst (DTR_cols r‰1)))
±	HideDerTableRow c r‰1 = HideDerTableRow c r‰2
      ´ ListNth gbsterling (Map Snd (DTR_cols r‰1))
          = ListNth gbsterling (Map Snd (DTR_cols r‰2))®);
a(REPEAT strip_tac);
a(TOP_ASM_T  (strip_asm_tac o rewrite_rule(MkDerTableRow_lemma :: map get_spec
	[¬HideDerTableRow®,¬Let®,¬MkDerTableRow®])));
a(all_asm_fc_tac[HideDerTableRow_Length_lemma]);
a(all_asm_fc_tac[GroupA_cols_lemma1]);
a(LIST_DROP_NTH_ASM_T [4,5,6](MAP_EVERY discard_tac));
a(DROP_NTH_ASM_T 4 ante_tac);
a(LIST_INDUCTION_T¬gbsterling®asm_tac);
=TEX
=SML
(* *** Goal "1" *** *)
a(rewrite_tac[get_spec¬ListNth®]);
(* *** Goal "2" *** *)
a(asm_rewrite_tac[get_spec¬ListNth®,length_map_lemma,lubl_lemma,dominates_lub_lemma]);
a(µ_tac THEN CASES_T¬1 ¼ x ± x ¼ # (DTR_cols r‰2)®asm_tac THEN
	asm_rewrite_tac[]);
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
a(REPEAT strip_tac THEN_TRY all_asm_fc_tac[]);
a(lemma_tac¬x ¼ # (DTR_cols r‰1)®THEN1 asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 5 (strip_asm_tac));
a(lemma_tac¬c dominates Nth (Map Fst (DTR_cols r‰1)) x®THEN1 asm_rewrite_tac[]);
=TEX
=SML
a(strip_asm_tac(list_µ_elim[¬DTR_cols r‰1®,¬x®,
	¬Fst: Class ¸ (ValuedItem + ONE) ­ Class®]fun_nth_map_lemma));
a(DROP_NTH_ASM_T 2 ante_tac THEN POP_ASM_T (rewrite_thm_tac o eq_sym_rule) 
	THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬DTR_cols r‰2®,¬x®,
	¬Fst: Class ¸ (ValuedItem + ONE) ­ Class®]fun_nth_map_lemma));
a(DROP_NTH_ASM_T 7 ante_tac THEN POP_ASM_T (rewrite_thm_tac o eq_sym_rule) 
	THEN ´_tac);
a(strip_asm_tac(list_µ_elim[¬DTR_cols r‰1®,¬x®,
	¬Snd: Class ¸ (ValuedItem + ONE) ­ ValuedItem + ONE®]fun_nth_map_lemma));
a(POP_ASM_T (rewrite_thm_tac o eq_sym_rule));
a(strip_asm_tac(list_µ_elim[¬DTR_cols r‰2®,¬x®,
	¬Snd: Class ¸ (ValuedItem + ONE) ­ ValuedItem + ONE®]fun_nth_map_lemma));
a(POP_ASM_T (rewrite_thm_tac o eq_sym_rule));
=TEX
=SML
a(LIST_DROP_NTH_ASM_T [1,2,3,5,9,10](MAP_EVERY ante_tac));
a(lemma_tac¬¶l1 · DTR_cols r‰1 = l1®THEN1 prove_¶_tac);
a(lemma_tac¬¶l2 · DTR_cols r‰2 = l2®THEN1 prove_¶_tac);
a(POP_ASM_T rewrite_thm_tac THEN POP_ASM_T rewrite_thm_tac );
a(LIST_DROP_NTH_ASM_T [2,3,4](MAP_EVERY discard_tac));
a(POP_ASM_T ante_tac);
a(intro_µ_tac(¬l2®,¬l2®));
a(intro_µ_tac(¬x®,¬x®));
a(list_induction_tac¬l1®);
=TEX
=SML
(* *** Goal "2.1.1" *** *)
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 4(strip_asm_tac o rewrite_rule[length_def]));
a(DROP_NTH_ASM_T 7 ante_tac THEN POP_ASM_T  rewrite_thm_tac);
(* *** Goal "2.1.2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬l2®list_cases_thm));
(* *** Goal "2.1.2.1" *** *)
a(DROP_NTH_ASM_T 6 ante_tac THEN asm_rewrite_tac[get_spec¬Length®]);
(* *** Goal "2.1.2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(LIST_DROP_NTH_ASM_T [1,2,3,4,5,6](MAP_EVERY ante_tac));
a(rewrite_tac(map get_spec[¬Length®,¬Map®,¬Nth®]));
a(cases_tac¬x'=1®THEN asm_rewrite_tac[]);
=TEX
=SML
(* *** Goal "2.1.2.2.1" *** *)
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 5 ante_tac THEN asm_rewrite_tac[]);
a(´_T rewrite_thm_tac);
(* *** Goal "2.1.2.2.2" *** *)
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 10 (ante_tac o list_µ_elim[¬x'-1®,¬list2®]));
a(asm_rewrite_tac[]);
a(GET_ASM_T ¬1 ¼ x'® (strip_asm_tac o rewrite_rule[get_spec¬$¼®]));
a(var_elim_nth_asm_tac 1);
a(asm_rewrite_tac[]);
a(strip_asm_tac (µ_elim¬i® î_cases_thm));
a(POP_ASM_T rewrite_thm_tac);
(* *** Goal "2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[] THEN 
	REPEAT strip_tac THEN all_asm_fc_tac[]);
val ÛGroupA_cols_lemma2Ý = save_pop_thm"GroupA_cols_lemma2";
=TEX
=SML
push_goal([],¬µ rl‰0 rl‰1 g ·
	Map g rl‰0 = Map g rl‰1
´	Map (Map g) (MakeGroups g rl‰0) = Map (Map g) (MakeGroups g rl‰1)®);
a µ_tac;
a(list_induction_tac¬rl‰0®);
(* *** Goal "1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
(* *** Goal "1.1" *** *)
a(POP_ASM_T rewrite_thm_tac);
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
=TEX
=SML
(* *** Goal "2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(POP_ASM_T ante_tac THEN 
	rewrite_tac[get_spec¬Map®,get_spec¬MakeGroups®]); 
a(REPEAT ´_tac);
a(all_asm_fc_tac[]);
a(DROP_NTH_ASM_T 4 discard_tac);
=TEX
=SML
a(lemma_tac¬¶l0 · MakeGroups g rl‰0 = l0®THEN1 prove_¶_tac);
a(lemma_tac¬¶l1 · MakeGroups g list2 = l1®THEN1 prove_¶_tac);
a(ante_tac(list_µ_elim[¬rl‰0®,¬g®]MakeGroups_lemma1));
a(ante_tac(list_µ_elim[¬list2®,¬g®]MakeGroups_lemma1));
a(DROP_NTH_ASM_T 3 ante_tac THEN 
	POP_ASM_T rewrite_thm_tac THEN POP_ASM_T rewrite_thm_tac);
a(intro_µ_tac(¬l1®,¬l1®));
a(list_induction_tac¬l0®);
(* *** Goal "2.2.1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬l1®list_cases_thm));
(* *** Goal "2.2.1.1" *** *)
a(POP_ASM_T rewrite_thm_tac);
a(rewrite_tac[get_spec¬PutInGroup®,get_spec¬Map®]);
a(asm_rewrite_tac[]);
(* *** Goal "2.2.1.2" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
=TEX
=SML
(* *** Goal "2.2.2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬l1®list_cases_thm));
(* *** Goal "2.2.2.1" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2.2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(LIST_DROP_NTH_ASM_T [1,2,3](MAP_EVERY ante_tac) THEN 
	rewrite_tac(map get_spec[¬Map®,¬Elems®,¬PutInGroup®])); 
a(REPEAT strip_tac);
a(all_asm_fc_tac[]);
a(strip_asm_tac(µ_elim¬x''®list_cases_thm));
(* *** Goal "2.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.2.2" *** *)
a(strip_asm_tac(µ_elim¬x'''®list_cases_thm));
=TEX
=SML
(* *** Goal "2.2.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.2.2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(var_elim_nth_asm_tac 1);
a(LIST_DROP_NTH_ASM_T [2,3,4,5,8](MAP_EVERY discard_tac));
a(DROP_NTH_ASM_T 3 (strip_asm_tac o rewrite_rule[get_spec¬Map®]));
a(rewrite_tac[]);
a(cases_tac¬g x = g x''''®THEN cases_tac¬g x' = g x'''''®
	THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2.2.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
val ÛMakeGroups_lemma2Ý = save_pop_thm"MakeGroups_lemma2";
=TEX
=SML
push_goal([],¬µ rl‰0 rl‰1 g h ·
	Map g rl‰0 = Map g rl‰1
±	Map h rl‰0 = Map h rl‰1
´	Map (Map h) (MakeGroups g rl‰0) = Map (Map h) (MakeGroups g rl‰1)®);
a µ_tac;
a(list_induction_tac¬rl‰0®);
(* *** Goal "1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
(* *** Goal "1.1" *** *)
a(POP_ASM_T rewrite_thm_tac);
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
=TEX
=SML
(* *** Goal "2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(POP_ASM_T ante_tac THEN  POP_ASM_T ante_tac THEN
	rewrite_tac[get_spec¬Map®,get_spec¬MakeGroups®]); 
a(REPEAT ´_tac);
a(all_asm_fc_tac[]);
a(DROP_NTH_ASM_T 6 discard_tac);
a(lemma_tac¬Map (Map g) (MakeGroups g rl‰0) = Map (Map g) (MakeGroups g list2)®
	THEN1 all_asm_fc_tac[MakeGroups_lemma2]);
a(lemma_tac¬¶l0 · MakeGroups g rl‰0 = l0®THEN1 prove_¶_tac);
a(lemma_tac¬¶l1 · MakeGroups g list2 = l1®THEN1 prove_¶_tac);
=TEX
=SML
a(ante_tac(list_µ_elim[¬rl‰0®,¬g®]MakeGroups_lemma1));
a(ante_tac(list_µ_elim[¬list2®,¬g®]MakeGroups_lemma1));
a(DROP_NTH_ASM_T 4 ante_tac THEN DROP_NTH_ASM_T 3 ante_tac THEN
	POP_ASM_T rewrite_thm_tac THEN POP_ASM_T rewrite_thm_tac);
a(intro_µ_tac(¬l1®,¬l1®));
a(list_induction_tac¬l0®);
(* *** Goal "2.2.1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬l1®list_cases_thm));
(* *** Goal "2.2.1.1" *** *)
a(POP_ASM_T rewrite_thm_tac);
a(rewrite_tac[get_spec¬PutInGroup®,get_spec¬Map®]);
a(asm_rewrite_tac[]);
(* *** Goal "2.2.1.2" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
=TEX
=SML
(* *** Goal "2.2.2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬l1®list_cases_thm));
(* *** Goal "2.2.2.1" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2.2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(LIST_DROP_NTH_ASM_T [1,2,3,4](MAP_EVERY ante_tac) THEN 
	rewrite_tac(map get_spec[¬Map®,¬Elems®,¬PutInGroup®])); 
a(REPEAT strip_tac);
a(all_asm_fc_tac[]);
a(strip_asm_tac(µ_elim¬x''®list_cases_thm));
(* *** Goal "2.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 4 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.2.2" *** *)
a(strip_asm_tac(µ_elim¬x'''®list_cases_thm));
=TEX
=SML
(* *** Goal "2.2.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 7 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.2.2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(var_elim_nth_asm_tac 1);
a(LIST_DROP_NTH_ASM_T [2,3,4,5,10](MAP_EVERY discard_tac));
a(DROP_NTH_ASM_T 3 (strip_asm_tac o rewrite_rule[get_spec¬Map®]));
a(DROP_NTH_ASM_T 6 (strip_asm_tac o rewrite_rule[get_spec¬Map®]));
a(rewrite_tac[]);
a(cases_tac¬g x = g x''''®THEN cases_tac¬g x' = g x'''''®
	THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2.2.2.2.2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
(* *** Goal "2.2.2.2.2.2.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[]);
val ÛMakeGroups_lemma3Ý = save_pop_thm"MakeGroups_lemma3";
=TEX
=SML
push_goal([],¬µ rl‰0 rl‰1 c gbsterling gbclass ·
	c dominates lubl (Map (Ì row· lubl 
		(ListNth gbsterling (Map Fst (DTR_cols row)))) rl‰0)
±	Map (HideDerTableRow c) rl‰0 = Map (HideDerTableRow c) rl‰1
´	Map (Ì row · (ListNth gbsterling (Map Snd (DTR_cols row)), 
		ListNth gbclass (Map Fst (DTR_cols row)))) rl‰0 = 
	Map (Ì row · (ListNth gbsterling (Map Snd (DTR_cols row)), 
		ListNth gbclass (Map Fst (DTR_cols row)))) rl‰1®);
a(REPEAT strip_tac);
a(LIST_DROP_NTH_ASM_T [1,2](MAP_EVERY ante_tac) 
	THEN intro_µ_tac(¬rl‰1®,¬rl‰1®)); 
a(list_induction_tac¬rl‰0®);
=TEX
=SML
(* *** Goal "1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
(* *** Goal "1.1" *** *)
a(POP_ASM_T rewrite_thm_tac);
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
=TEX
=SML
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(LIST_DROP_NTH_ASM_T [1,2](MAP_EVERY ante_tac) THEN 
	rewrite_tac[get_spec¬Map®,lubl_lemma,dominates_lub_lemma]); 
a(REPEAT ´_tac);
a(all_asm_fc_tac[]);
a(DROP_NTH_ASM_T 6 discard_tac);
a(POP_ASM_T rewrite_thm_tac);
a(all_asm_fc_tac[GroupA_cols_lemma1]);
a(all_asm_fc_tac[GroupA_cols_lemma2]);
a(asm_rewrite_tac[]);
val ÛGroupA_lemmaÝ = save_pop_thm"GroupA_lemma";
=TEX
=SML
push_goal([], GroupA_conj);
a(rewrite_tac[get_spec¬GroupA®, let_def]
	THEN REPEAT strip_tac);
a(swap_nth_asm_concl_tac 1);
a(all_asm_fc_tac[GroupA_lemma]);
a(bc_tac[MakeGroups_lemma3]THEN_TRY asm_rewrite_tac[]);
val ÛGroupA_OK_lemmaÝ = save_pop_thm"GroupA_OK_lemma";
=TEX
=SML
push_goal([], GroupB_conj);
a(rewrite_tac[get_spec¬GroupB®, let_def]
	THEN REPEAT strip_tac);
a(swap_nth_asm_concl_tac 1);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac);
a(intro_µ_tac(¬gps‰1®,¬gps‰1®));
a(list_induction_tac¬gps‰0®);
=TEX
=SML
(* *** Goal "1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬gps‰1®list_cases_thm));
(* *** Goal "1.1" *** *)
a(asm_rewrite_tac[]THEN rewrite_tac[get_spec¬$ù®]);
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬gps‰1®list_cases_thm));
=TEX
=SML
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 3 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(POP_ASM_T ante_tac THEN POP_ASM_T ante_tac);
a(rewrite_tac(lubl_lemma :: dominates_lub_lemma :: map get_spec[¬Map®,¬$ù®]));
a(REPEAT strip_tac THEN all_asm_fc_tac[]);
a(all_asm_fc_tac[CommonValue_OK_lemma]);
a(POP_ASM_T (strip_asm_tac o rewrite_rule[get_spec¬OK_VC®]));
a(all_asm_fc_tac[CommonValue_OK2_lemma]);
a(POP_ASM_T (strip_asm_tac o rewrite_rule[get_spec¬OK_VC2®]));
a(LEMMA_T¬HideDerTableRow c Arbitrary = HideDerTableRow c Arbitrary®asm_tac 
	THEN_LIST[rewrite_tac[],all_asm_fc_tac[]]);
a(lemma_tac¬Snd (CommonValue having tl‰0 x Arbitrary)
	= Snd (CommonValue having tl‰1 x' Arbitrary)®
	THEN1 contr_tac THEN all_asm_fc_tac[]);
a(cases_tac¬ItemBool (Snd (CommonValue having tl‰1 x' Arbitrary))®
	THEN asm_rewrite_tac[get_spec¬Map®]);
val ÛGroupB_OK_lemmaÝ = save_pop_thm"GroupB_OK_lemma";
=TEX
=SML
push_goal([], Group_conj);
a(MAP_EVERY (ante_tac o all_´_intro) [
	Group_lemma2,
	GroupA_OK_lemma,
	GroupB_OK_lemma]
	THEN taut_tac);
val ÛGroup_OK_lemmaÝ = save_pop_thm"Group_OK_lemma";
=TEX
=SML
val ÛGroupA_OK2_conjÝ = ¬µ rl‰0 rl‰1 c gbsterling gbclass
           · Map (HideDerTableRow c) rl‰0 = Map (HideDerTableRow c) rl‰1
                ´ Fst (GroupA rl‰0 gbsterling gbclass)
                 = Fst (GroupA rl‰1 gbsterling gbclass)®;
=TEX
=SML
push_goal([],GroupA_OK2_conj);
a(rewrite_tac[get_spec¬GroupA®, let_def]
	THEN REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN intro_µ_tac(¬rl‰1®,¬rl‰1®)); 
a(list_induction_tac¬rl‰0®);
=TEX
=SML
(* *** Goal "1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
(* *** Goal "1.1" *** *)
a(POP_ASM_T rewrite_thm_tac);
(* *** Goal "1.2" *** *)
a(var_elim_nth_asm_tac 1);
a(POP_ASM_T (strip_asm_tac o rewrite_rule[get_spec¬Map®]));
(* *** Goal "2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬rl‰1®list_cases_thm));
=TEX
=SML
(* *** Goal "2.1" *** *)
a(var_elim_nth_asm_tac 1);
a(POP_ASM_T (strip_asm_tac o rewrite_rule[get_spec¬Map®]));
(* *** Goal "2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(POP_ASM_T ante_tac THEN 
	rewrite_tac[dominates_lub_lemma,lubl_lemma,get_spec¬Map®]); 
a(REPEAT strip_tac);
a(all_asm_fc_tac[]);
a(all_asm_fc_tac[GroupA_cols_lemma1]);
a(asm_rewrite_tac[]);
val ÛGroupA_OK2_lemmaÝ = save_pop_thm"GroupA_OK2_lemma";
=TEX
=SML
val ÛGroupB_OK2_conjÝ = ¬µ tl‰0 tl‰1 gps‰0 gps‰1 c having
· having  OK_VC2 c
      ± Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1
      ± Map (Map (HideDerTableRow c)) gps‰0
        = Map (Map (HideDerTableRow c)) gps‰1
    ´  Fst (GroupB tl‰0 gps‰0 having) = Fst (GroupB tl‰1 gps‰1 having)®;
=TEX
=SML
push_goal([],GroupB_OK2_conj);
a(rewrite_tac[get_spec¬GroupB®, let_def]
	THEN REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN intro_µ_tac(¬gps‰1®,¬gps‰1®));
a(list_induction_tac¬gps‰0®);
=TEX
=SML
(* *** Goal "1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬gps‰1®list_cases_thm));
(* *** Goal "1.1" *** *)
a(asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "1.2" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac(µ_elim¬gps‰1®list_cases_thm));
=TEX
=SML
(* *** Goal "2.1" *** *)
a(DROP_NTH_ASM_T 2 ante_tac THEN asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(POP_ASM_T ante_tac);
a(rewrite_tac[lubl_lemma,dominates_lub_lemma,get_spec¬Map®]);
a(REPEAT strip_tac THEN all_asm_fc_tac[]);
a(all_asm_fc_tac[CommonValue_OK2_lemma]);
a(POP_ASM_T (strip_asm_tac o rewrite_rule[get_spec¬OK_VC2®]));
a(LEMMA_T¬HideDerTableRow c Arbitrary = HideDerTableRow c Arbitrary®asm_tac 
	THEN_LIST[rewrite_tac[],all_asm_fc_tac[]]);
a(asm_rewrite_tac[]);
val ÛGroupB_OK2_lemmaÝ = save_pop_thm"GroupB_OK2_lemma";
=TEX
=SML
push_goal([],¬µ tl‰0 tl‰1 rl‰0 rl‰1 c e ml nl
    · e  OK_VC2 c
          ± Map (HideDerTableRow c) rl‰0 = Map (HideDerTableRow c) rl‰1
          ± Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1
          ´ Fst (Group c tl‰0 rl‰0 ml nl e) = Fst (Group c tl‰1 rl‰1 ml nl e)®);
a(rewrite_tac[Group_lemma1, let_def]THEN REPEAT strip_tac);
a(all_asm_fc_tac[GroupA_OK2_lemma]);
a(lemma_tac¬Fst (GroupA rl‰1 ml nl) = Fst (GroupA rl‰0 ml nl)® THEN1 asm_rewrite_tac[]);
a(DROP_NTH_ASM_T 2 discard_tac);
a(cases_tac¬c dominates Fst (GroupA rl‰0 ml nl)® THEN asm_rewrite_tac[]);
a(bc_tac[GroupB_OK2_lemma] THEN_TRY asm_rewrite_tac[]);
a(¶_tac¬c®THEN asm_rewrite_tac[]);
a(POP_ASM_T ante_tac THEN rewrite_tac(map get_spec[¬Let®,¬GroupA®]));
a(strip_tac THEN bc_tac[MakeGroups_lemma3] THEN_TRY asm_rewrite_tac[]);
a(all_asm_fc_tac[GroupA_lemma]);
a(asm_rewrite_tac[]);
val ÛGroup_OK2_lemmaÝ = save_pop_thm"Group_OK2_lemma";
=TEX
\subsubsection{ProjectData}
=SML
push_goal([],ProjectData_conj);
a(REPEAT strip_tac);
a(POP_ASM_T ante_tac THEN intro_µ_tac(¬gps‰1®,¬gps‰1®));
a(list_induction_tac¬gps‰0®);
(* *** Goal "1" *** *)
a µ_tac;
a(strip_asm_tac (µ_elim¬gps‰1®list_cases_thm));
(* *** Goal "1.1" *** *)
a(asm_rewrite_tac(map get_spec[¬Let®,¬ProjectData®,¬Map®]));
(* *** Goal "1.2" *** *)
a(asm_rewrite_tac[get_spec¬Map®]);
=TEX
=SML
(* *** Goal "2" *** *)
a(REPEAT µ_tac);
a(strip_asm_tac (µ_elim¬gps‰1®list_cases_thm));
(* *** Goal "2.1" *** *)
a(asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2" *** *)
a(var_elim_nth_asm_tac 1);
a(´_T (strip_asm_tac o rewrite_rule(map get_spec[¬Map®])));
a(all_asm_fc_tac[]);
a(rewrite_tac[ProjectData_lemma]);
=TEX
=SML
a(lemma_tac¬µ x1 x2 x' ·
	Map (HideDerTableRow c) x = Map (HideDerTableRow c) x'
±	Map (HideDerTableRow c) x1 = Map (HideDerTableRow c) x2
´
	Map
               (HideDerTableRow c)
               (Map (Ì r· MkDerTableRow (DTR_where r) (DTR_row r) 
			(Map (Ì e· e tl‰0 x1 r) sl)) x
                   ë ProjectData tl‰0 sl gps‰0)
             = Map
               (HideDerTableRow c)
               (Map (Ì r· MkDerTableRow (DTR_where r) (DTR_row r) 
			(Map (Ì e· e tl‰1 x2 r) sl)) x'
                   ë ProjectData tl‰1 sl list2)®THEN_LIST[id_tac, all_asm_fc_tac[]]);
a(DROP_NTH_ASM_T 3 discard_tac);
a(list_induction_tac¬x®);
=TEX
=SML
(* *** Goal "2.2.1" *** *)
a(REPEAT strip_tac);
a(strip_asm_tac (µ_elim¬x'®list_cases_thm));
(* *** Goal "2.2.1.1" *** *)
a(asm_rewrite_tac(map get_spec[¬Map®,¬$ë®]));
(* *** Goal "2.2.1.2" *** *)
a(var_elim_nth_asm_tac 1);
a(DROP_NTH_ASM_T 2(strip_asm_tac o rewrite_rule[get_spec¬Map®]));
(* *** Goal "2.2.2" *** *)
a(REPEAT µ_tac);
a(strip_asm_tac(µ_elim¬x''®list_cases_thm));
(* *** Goal "2.2.2.1" *** *)
a(asm_rewrite_tac[get_spec¬Map®]);
(* *** Goal "2.2.2.2" *** *)
a(asm_rewrite_tac(map get_spec[¬Map®,¬$ë®]));
a(REPEAT strip_tac THEN all_asm_fc_tac[ProjectData_lemma1]);
val ÛProjectData_OK_lemmaÝ = save_pop_thm"ProjectData_OK_lemma";
=TEX
\section{OKNESS PROOFS}
\subsection{$TableContents$}
=SML
set_goal([], ¬µc i· TableContents i  OK_TC c®);
a(rewrite_tac(map get_spec[¬OK_TC®, ¬TableContents®])
	THEN REPEAT strip_tac);
a(POP_ASM_T ante_tac);
a(lemma_tac¬# (Map (HideDerTable c) tl‰1)
             = # (Map (HideDerTable c) tl‰0)®
	THEN1 asm_rewrite_tac[]);
a(POP_ASM_T (strip_asm_tac o rewrite_rule [length_map_thm]));
a(cases_tac ¬1 ¼ i ± i ¼ # tl‰0® THEN asm_rewrite_tac[]);
a(REPEAT strip_tac);
a(all_fc_tac[fun_nth_map_lemma1]);
val ÛTableContents_OK_lemmaÝ = save_pop_thm"TableContents_OK_lemma";
=TEX
\subsection{$AllTuples$}
=SML
push_goal([], ¬µc esl tel e1 ml nl e2 · 
	Elems (Map Fst esl) € OK_VC c ¡ OK_VC2 c ±
	Elems tel € OK_TC c ±
	e1  OK_VC c ¡ OK_VC2 c±
	e2  OK_VC c ¡ OK_VC2 c ´
	AllTuples c esl tel e1 ml nl e2  OK_TC c®);
a(rewrite_tac[get_spec¬OK_TC®]);
a(REPEAT strip_tac);
a(swap_nth_asm_concl_tac 1);
a(lemma_tac¬Map
               (HideDerTable c)
               (Snd (Split (Map (Ì te· te tl‰0) tel)))
             = Map
               (HideDerTable c)
               (Snd (Split (Map (Ì te· te tl‰1) tel)))®);
(* *** Goal "1" *** *)
a(bc_tac[AllTuples_lemma1]THEN_TRY asm_rewrite_tac[]);
a(POP_ASM_T (strip_asm_tac o rewrite_rule(dominates_lub_lemma :: lubl_lemma :: 
	map get_spec [¬Let®,¬AllTuples®,¬Map®,¬Group®])));
=TEX
=SML
(* *** Goal "2" *** *)
a(all_fc_tac[Join_OK_lemma]);
a(POP_ASM_T (fn x => id_tac));
a(POP_ASM_T ante_tac);
a(DROP_NTH_ASM_T 2 ante_tac);
a(rewrite_tac(MkDerTable_lemma :: dominates_lub_lemma :: map get_spec
	[¬AllTuples®,¬Let®,¬HideDerTable®,¬Project®,¬DT_spec®]));
a(REPEAT strip_tac THEN_TRY asm_rewrite_tac[]);
=TEX
=SML
a(lemma_tac¬Map
               (HideDerTableRow c)
               (Where
                               c
                               tl‰0
                               (Snd (Join (Snd (Split (Map (Ì te· te tl‰0) tel)))))
                               e1)
             = Map
               (HideDerTableRow c)
               (Where
                               c
                               tl‰1
                               (Snd (Join (Snd (Split (Map (Ì te· te tl‰1) tel)))))
                               e1)® THEN_LIST[all_asm_fc_tac[Where_OK_lemma],id_tac]);
=TEX
=SML
a(lemma_tac¬c dominates lubl (Map DTR_row 
	(Where c tl‰0 (Snd (Join (Snd (Split (Map (Ì te· te tl‰0) tel))))) e1))
± 	c dominates lubl (Map DTR_row 
	(Where c tl‰1 (Snd (Join (Snd (Split (Map (Ì te· te tl‰1) tel))))) e1))®
		THEN1 rewrite_tac[Where_dominates_lemma]);
=TEX
=SML
a(lemma_tac¬Map (Map (HideDerTableRow c)) 
 (Snd (Group c tl‰0 (Where c tl‰0 (Snd (Join (Snd (
	Split (Map (Ì te· te tl‰0) tel))))) e1) ml nl e2))
            = Map (Map (HideDerTableRow c)) 
 (Snd (Group c tl‰1 (Where c tl‰1 (Snd (Join (Snd (
	Split (Map (Ì te· te tl‰1) tel))))) e1) ml nl e2))®
	THEN1 contr_tac THEN all_asm_fc_tac[Group_OK_lemma]);
a(all_asm_fc_tac[ProjectData_OK_lemma]);
a(bc_tac[HideDerTableData_lemma1]THEN asm_rewrite_tac[]);
val ÛAllTuples_OK_lemmaÝ = save_pop_thm"AllTuples_lemma_OK";
=TEX
\section{OKNESS2 PROOFS}
\subsection{$TableContents$}
=SML
set_goal([], ¬µc i· TableContents i  OK_TC2 c®);
a(rewrite_tac(map get_spec[¬OK_TC2®, ¬TableContents®])
	THEN REPEAT strip_tac);
a(lemma_tac¬# (Map (HideDerTable c) tl‰1)
             = # (Map (HideDerTable c) tl‰0)®
	THEN1 asm_rewrite_tac[]);
a(POP_ASM_T (strip_asm_tac o rewrite_rule [length_map_thm]));
a(cases_tac ¬1 ¼ i ± i ¼ # tl‰0® THEN asm_rewrite_tac[]);
val ÛTableContents_OK2_lemmaÝ = save_pop_thm"TableContents_OK2_lemma";
=TEX
\subsection{$AllTuples$}
=SML
push_goal([],¬µ c tl‰0 tl‰1 tel
· Elems tel € OK_TC2 c
      ± Map (HideDerTable c) tl‰0 = Map (HideDerTable c) tl‰1
    ´ lubl (Fst (Split (Map (Ì te· te tl‰0) tel)))
      = lubl (Fst (Split (Map (Ì te· te tl‰1) tel)))®);
a(REPEAT strip_tac);
a(DROP_NTH_ASM_T 2 ante_tac);
a(list_induction_tac¬tel®);
(* *** Goal "1" *** *)
a(asm_rewrite_tac(map get_spec[¬Map®]));
(* *** Goal "2" *** *)
a(PC_T1 "sets_ext" asm_prove_tac[get_spec¬Elems®]);
(* *** Goal "3" *** *)
a(POP_ASM_T ante_tac THEN rewrite_tac
	[fst_snd_split_thm,map_o_lemma,lubl_lemma,get_spec¬Map®,get_spec¬Elems®]);
a(REPEAT strip_tac);
a(lemma_tac¬x  OK_TC2 c®THEN1 PC_T1 "sets_ext" asm_prove_tac[]);
a(POP_ASM_T (strip_asm_tac o rewrite_rule[get_spec¬OK_TC2®]));
a(all_asm_fc_tac[]);
a(asm_rewrite_tac[]);
val ÛAllTuples_lemma2Ý = save_pop_thm"AllTuples_lemma2";
=TEX
=SML
push_goal([], ¬µc esl tel e1 ml nl e2 · 
	e1  OK_VC2 c ¡ OK_VC c ±
	Elems tel € OK_TC c ¡ OK_TC2 c ±
	e2  OK_VC2 c ´
	AllTuples c esl tel e1 ml nl e2  OK_TC2 c®);
a(rewrite_tac[get_spec¬OK_TC2®]);
a(REPEAT strip_tac);
a(lemma_tac¬Elems tel € OK_TC2 c ± Elems tel € OK_TC c®
	THEN1 PC_T1 "sets_ext" asm_prove_tac[]);
a(all_asm_fc_tac[AllTuples_lemma2]);
a(rewrite_tac(map get_spec[¬Let®,¬AllTuples®]));
=TEX
=SML
a(POP_ASM_T (rewrite_thm_tac o eq_sym_rule));
a(cases_tac¬c dominates lubl (Fst (Split (Map (Ì te· te tl‰0) tel)))®
	THEN asm_rewrite_tac[]);
a(bc_tac[Group_OK2_lemma]THEN_TRY asm_rewrite_tac[]);
a(bc_tac[Where_OK_lemma]THEN_TRY PC_T1 "sets_ext" asm_rewrite_tac[]);
a(all_fc_tac[AllTuples_lemma1]);
a(all_asm_fc_tac[Join_OK_lemma]);
a(POP_ASM_T discard_tac);
a(POP_ASM_T (strip_asm_tac o rewrite_rule(MkDerTable_lemma :: 
	map get_spec[¬HideDerTable®,¬MkDerTable®])));
val ÛAllTuples_OK2_lemmaÝ = save_pop_thm"AllTuples_OK2_lemma";
=TEX
\section{CLOSING DOWN}
=TEX

\newpage
\HOLindexOff
\input{fef035th.tex}
\HOLindexOn
\newpage
\twocolumn[\section{INDEX} \label{INDEX}]
\small
\printindex

\end{document}
